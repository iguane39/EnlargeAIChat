try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7f43c2fc-f864-4cc6-ad69-3b3994c07e7a",e._sentryDebugIdIdentifier="sentry-dbid-7f43c2fc-f864-4cc6-ad69-3b3994c07e7a")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{113:(e,t,a)=>{a.d(t,{NewChat:()=>ea});var n=a(64784),l=a(6016),i=a(5936),s=a(7763),r=a(63929),o=a.n(r),d=a(12330),u=a(93706),c=a(64371),m=a(2308),f=a(8380),h=a(63123),p=a(6664),x=a(18544),g=a(73672),v=a(8424),y=a(30063),b=a(22354),I=a(83403),j=a(63695),w=a(6974),M=a(35111);function _(e){let{session:t}=e,{data:a,isLoading:n}=M.api.featureMetadata.all.useQuery(void 0,{staleTime:3e5,refetchOnWindowFocus:!1,enabled:!!t});return{metadata:null!=a?a:null,isLoading:n}}var S=a(21413),C=a(19494),N=a(50517);let E={MEMORIES_INTRODUCTION:"memories-introduction",MCP_INTRODUCTION:"mcp-introduction"},F=[{id:E.MEMORIES_INTRODUCTION,domain:"memories",property:"hasSeenIntroductionModalV1At",gating:{type:"feature",feature:x.K6}},{id:E.MCP_INTRODUCTION,domain:"mcp",property:"hasSeenIntroductionModalV1At",cooldownHours:24,gating:{type:"feature",feature:x.H_}}];var O=a(8672),V=a(32735);function A(e,t){var a;let n=null!=(a=e.gating)?a:{type:"none"};return(0,V.YW)(n).with({type:"featureFlag"},e=>{let{featureFlag:a}=e;return t.featureFlags[a]}).with({type:"feature"},e=>{let{feature:t}=e;return(0,g.C)(t)}).with({type:"none"},()=>!0).exhaustive()}var D=a(8866),P=a(9360),T=a(68084),H=a(9590),k=a(68669),R=a(32638),U=a(23964),L=a(85277),Z=a(10655),Q=a(52907);let z=(0,f.memo)(e=>{let{height:t}=e;return(0,n.jsxs)("svg",{viewBox:"0 0 120 102",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"".concat(1.4*t),height:"".concat(t),children:[(0,n.jsx)("path",{d:"M38.4845 14.6323H23.9375V29.1793H38.4845V14.6323Z",fill:"#FFD700"}),(0,n.jsx)("path",{d:"M96.672 14.6323H82.125V29.1793H96.672V14.6323Z",fill:"#FFD700"}),(0,n.jsx)("path",{d:"M53.0315 29.1792H23.9375V43.7262H53.0315V29.1792Z",fill:"#FFAF00"}),(0,n.jsx)("path",{d:"M96.6731 29.1792H67.5791V43.7262H96.6731V29.1792Z",fill:"#FFAF00"}),(0,n.jsx)("path",{d:"M96.6726 43.7261H23.9375V58.2731H96.6726V43.7261Z",fill:"#FF8205"}),(0,n.jsx)("path",{d:"M38.4845 58.2734H23.9375V72.8205H38.4845V58.2734Z",fill:"#FA500F"}),(0,n.jsx)("path",{d:"M67.5783 58.2734H53.0312V72.8205H67.5783V58.2734Z",fill:"#FA500F"}),(0,n.jsx)("path",{d:"M96.672 58.2734H82.125V72.8205H96.672V58.2734Z",fill:"#FA500F"}),(0,n.jsx)("path",{d:"M53.0307 72.8203H9.38965V87.3673H53.0307V72.8203Z",fill:"#E10500"}),(0,n.jsx)("path",{d:"M111.22 72.8203H67.5791V87.3673H111.22V72.8203Z",fill:"#E10500"}),(0,n.jsx)("rect",{x:"21",y:"56",width:"79",height:"15",fill:"black"}),(0,n.jsx)("rect",{x:"96.9004",y:"48",width:"8",height:"8",fill:"black"}),(0,n.jsx)("rect",{x:"104",y:"56",width:"5",height:"10",fill:"black"})]})});var q=a(16273);let B=e=>{let{incognito:t=!1,session:a}=e,l=(0,u.c3)("Chat.incognito");return(0,n.jsx)("div",{className:"absolute bottom-[65%] flex w-full justify-center desktop-mac:drag",children:(0,n.jsx)("div",{className:"flex flex-col items-center",children:t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(z,{height:110}),(0,n.jsxs)("div",{className:"mt-4 flex items-center gap-2 rounded-md border border-dashed border-strong p-1 ps-3 text-center text-sm text-default",children:[l((0,g.C)(x.K6)?"description":"description_old"),(0,n.jsx)(Q.v,{href:"/chat",variant:"ghost",children:l("turnOff")})]})]}):(0,n.jsx)(q.i,{session:a,size:68})})})},Y={top:"40%",y:"0"},G={top:"100%",y:"calc(-100% - 88px)"},K=e=>{let{children:t,onAnimationComplete:a,isCreatingChat:i,hasPlaceholderMessage:s,disableAnimation:r}=e;return r?(0,n.jsx)("div",{className:"absolute top-[40%] flex w-full max-w-(--breakpoint-md) flex-col",children:t}):(0,n.jsx)(l.P.div,{initial:Y,animate:i&&s?G:Y,exit:{top:"40%",y:"50px"},transition:{duration:.4,ease:"easeInOut"},className:(0,y.cn)("absolute flex w-full max-w-(--breakpoint-md) flex-col",!s&&!i&&"px-2"),onAnimationComplete:a,children:t})};var W=a(20752),X=a(47799),$=a(29766);let J=(0,s.default)(()=>a.e(3519).then(a.bind(a,3519)),{loadableGenerated:{webpack:()=>[3519]},ssr:!1}),ee=(0,s.default)(()=>a.e(9858).then(a.bind(a,9858)),{loadableGenerated:{webpack:()=>[9858]},ssr:!1}),et=e=>{let{children:t,className:a,id:i}=e;return(0,n.jsx)(l.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0,transition:{delay:.5}},exit:{opacity:0,y:8},className:(0,y.cn)("space-y-4 rounded-lg bg-muted p-5",a),children:t},i)};function ea(e){var t,a,s,r,y,V,Q;let{session:z,chatId:q,features:Y,initialMessage:G,agent:ea,incognito:en=!1}=e,el=M.api.useUtils(),ei=(0,u.c3)("Chat"),es=(0,u.c3)("Connections.myConnections.connectionError"),{track:er}=(0,D.n)(),eo=(0,d.useRouter)(),[{model:ed,library:eu,document:ec,project:em,error:ef,integration_id:eh}]=(0,m.ab)(H.V);(0,f.useEffect)(()=>{q&&z&&(window.history.pushState(null,"","/chat/".concat(q)),el.chat.last.invalidate())},[q,z,el.chat.last]);let{metadata:ep,isLoading:ex}=_({session:z}),eg=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=M.api.useUtils();return M.api.featureMetadata.update.useMutation({...e,onMutate:async function(){for(var a,n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];let[{feature:s,data:r}]=l;return await t.featureMetadata.all.cancel(),t.featureMetadata.all.setData(void 0,e=>e?{...e,[s]:{...e[s],...r}}:e),await (null==(a=e.onMutate)?void 0:a.call(e,...l)),{feature:s}},onError:function(){for(var a,n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];t.featureMetadata.all.invalidate(),null==(a=e.onError)||a.call(e,...l)},onSuccess:function(){for(var a,n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];t.featureMetadata.all.invalidate(),null==(a=e.onSuccess)||a.call(e,...l)}})}(),ev=function(e){let{session:t}=e,{metadata:a,isLoading:n}=_({session:t});return(0,f.useMemo)(()=>{if(n)return null;var e,l=null!=(e=null==t?void 0:t.organization.featureFlags)?e:null;if(!(F.length>0)||!a||!l)return null;let i={metadata:a,featureFlags:l};for(let e of F)if(function(e,t,a){let n=a.metadata[e.domain][e.property];return!!A(e,a)&&!!(0,O.u)(n)&&(!!function(e,t,a){let n=t.indexOf(e);for(let e=0;e<n;e++){let n=t[e];if(n&&A(n,a))return!1}return!0}(e,t,a)||!!function(e,t,a){var n;let l=null!=(n=e.cooldownHours)?n:0;if(0===l)return!0;let i=function(e,t){let a=[];for(let n of e){let e=t[n.domain][n.property];if("string"==typeof e)try{a.push(new Date(e))}catch(e){continue}}return 0===a.length?null:a.reduce((e,t)=>t>e?t:e)}(t,a.metadata);return!i||Date.now()-i.getTime()>=60*l*6e4}(e,t,a))}(e,F,i))return e;return null},[t,a,n])}({session:z});(0,f.useEffect)(()=>{z&&!ex&&ep&&(ep.memories.hasSeenIntroductionModalV1At||null===localStorage.getItem("memory.feature-introduction")||(eg.mutate({feature:"memories",data:{hasSeenIntroductionModalV1At:new Date().toISOString()}}),localStorage.removeItem("memory.feature-introduction")),ep.mcp.hasSeenIntroductionModalV1At||null===localStorage.getItem("memory.feature-introduction-mcp")||(eg.mutate({feature:"mcp",data:{hasSeenIntroductionModalV1At:new Date().toISOString()}}),localStorage.removeItem("memory.feature-introduction-mcp")))},[z,ex,ep,eg]);let[ey,eb]=(0,f.useState)(!!q),[eI,ej]=(0,f.useState)(null!=G?G:null),[ew,eM]=(0,f.useState)(!!q),e_=(0,I.m)(),eS=v.Bx2.useSidebar({required:!1}),{setCanvas:eC,tempCanva:eN}=(0,U.o)(),eE=P.P.use.setAnonymousChatId();(0,f.useEffect)(()=>{q?eE(q):eE(void 0)},[q,eE]),(0,f.useEffect)(()=>{ef&&eh&&v.oRP.error({title:es("title"),description:es("description")})},[es,ef,eh]);let eF=(0,T.q)(),eO=P.P.use.anonymousChatId(),eV=null!=(s=null!=q?q:eF)?s:eO,eA=null!==eu&&!ec,eD=null!==eu&&null!==ec?{libraryId:eu,documentId:ec}:void 0,eP=eA?[eu]:null!=(r=null==ea?void 0:ea.libraries)?r:void 0,eT=(0,f.useMemo)(()=>{var e;return null!=(e=null==ea?void 0:ea.features)?e:void 0},[ea]);(0,f.useEffect)(()=>{eV||(eb(!1),ej(null),eM(!1))},[eV]);let eH=M.api.chat.byId.useQuery({id:eV},{enabled:!!eV}),ek=M.api.message.all.useQuery({chatId:eV},{enabled:!!eV}),eR=M.api.canva.all.useQuery({chatId:eV},{enabled:!!eV}),eU=M.api.quote.all.useQuery({chatId:eV},{enabled:!!eV});(0,f.useEffect)(()=>{var e,t;eC(null!=(t=null==(e=eR.data)?void 0:e.items)?t:[])},[eR.data,eC]);let eL=(0,N.F)({onSettled:()=>{eg.mutate({feature:"memories",data:{hasSeenIntroductionModalV1At:new Date().toISOString()}})}}),eZ=(0,f.useCallback)(async e=>{await eL.mutateAsync({isEnabled:e})},[eL]),eQ=(0,c.Ym)();if(eV&&ew&&eH.data&&ek.data&&eR.data&&eU.data)return(0,n.jsx)(L.ChatPageLayout,{session:z,chat:eH.data,chatId:eV,incognito:en,children:(0,n.jsx)(Z.ChatContainer,{features:Y,session:z,initialChat:eH.data,initialMessages:ek.data.items,initialCanvas:eR.data.items,initialQuotes:eU.data.items,chatId:eV})});let ez=eN?[{...eN,messageId:null!=(y=null==eI?void 0:eI.id)?y:null,messageVersion:null!=(V=null==eI?void 0:eI.version)?V:null,status:"active",prevVersion:null,nextVersion:null,versionCount:1,versionIndex:1}]:[],eq=null!=(Q=null==(t=w._.NEXT_PUBLIC_CUSTOM_DISCLAIMER)?void 0:t[eQ])?Q:null==(a=w._.NEXT_PUBLIC_CUSTOM_DISCLAIMER)?void 0:a.en;return(0,n.jsxs)(L.ChatPageLayout,{session:z,chat:eH.data,chatId:null!=eV?eV:void 0,incognito:en,children:[(0,n.jsx)($.i,{children:(0,n.jsx)(C.IntegrationsProvider,{features:Y,session:z,initialFeatures:eT,saveSelection:!0,chatId:null!=eV?eV:null,children:(0,n.jsxs)(S.DocumentLibraryProvider,{session:z,initialSelection:eP,saveSelection:!0,withDocumentPayload:eD,children:[eI&&ey?(0,n.jsx)("div",{className:"flex h-full w-full flex-col-reverse items-center overflow-y-auto",children:(0,n.jsx)("div",{className:L.yZ,children:(0,n.jsx)(L.M$,{children:(0,n.jsx)(L.Nc,{children:(0,n.jsx)(L.pu,{children:(0,n.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.4,ease:"easeInOut"},className:"flex h-fit w-full flex-col",children:(0,n.jsx)(W.Q,{isGenerating:!0,isReadOnly:!1,isLastTurn:!0,isLastMessage:!0,handleEdit:()=>{},handleRewrite:()=>{},handleToolCallConfirmation:()=>{},handleFollowUp:()=>{},user:null==z?void 0:z.user,session:z,message:eI,canvas:ez,incognito:en})})})})})})}):(0,n.jsx)(B,{incognito:en,session:z}),(0,n.jsx)(K,{isCreatingChat:ey,hasPlaceholderMessage:!!eI,onAnimationComplete:()=>{eM(!0)},children:(0,n.jsx)(X.A,{enableSuggestions:!!(null==z?void 0:z.organization.featureFlags.what_about_that),initialChatAgentId:null==ea?void 0:ea.id,model:null!=ed?ed:void 0,session:z,onSubmit:e=>{let{messageInput:t,files:a,canva:n,action:l,voiceInputUrl:i,transcriptions:s,agentId:r,agentsApiAgentId:o}=e;eb(!0),ej((0,p.Mb)({id:(0,h.A)(),text:"string"==typeof t?t:"",contentChunks:"string"!=typeof t?t:[],files:a,userId:null==z?void 0:z.user.id,canva:n,action:l,voiceInputUrl:i,transcriptions:s,leChatAgentId:r,agentsApiAgentId:o}))},onSubmitFailed:()=>{eb(!1),ej(null)},onNewChatCreated:e=>{let{chatId:t,hasPastedText:a}=e;z&&!en?((0,j.g6)({chatId:t,metadata:{hasPastedText:a}}),window.history.pushState(null,"","/chat/".concat(t))):eE(t)},incognito:en,projectId:null!=em?em:void 0})}),ey&&eI&&(0,n.jsx)("div",{className:"relative flex h-[110px] min-h-[110px] w-full flex-1"}),(0,n.jsxs)(i.N,{children:[!(null==eS?void 0:eS.open)&&!eV&&z&&null===z.leChatPlan&&(0,n.jsxs)(et,{id:"to-pro",className:"fixed start-4 bottom-4 z-10 hidden sm:block",children:[(0,n.jsx)(b.w,{}),(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsx)("div",{className:"font-medium",children:ei("upgrade_banner.to_le_chat_pro.title")}),(0,n.jsx)("div",{className:"text-xs text-muted sm:max-w-[216px] dark:text-subtle",children:ei("upgrade_banner.to_le_chat_pro.description")})]}),(0,n.jsx)(o(),{href:"/upgrade/plans",className:"block",children:(0,n.jsx)(v.$nd,{variant:"dark",className:"w-full rounded-lg",children:ei("upgrade_banner.to_le_chat_pro.upgrade_button")})})]}),null===z&&!ey&&!eV&&void 0!==e_.data&&e_.data.message_send.remainingPoints<e_.data.message_send.points&&(0,n.jsxs)(et,{id:"to-sign-up",className:"fixed start-4 bottom-4 z-10 hidden sm:block",children:[(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsx)("div",{className:"font-medium",children:ei("upgrade_banner.to_sign_up.title",{remainingMessages:e_.data.message_send.remainingPoints})}),(0,n.jsx)("div",{className:"text-xs text-muted sm:max-w-[216px] dark:text-subtle",children:ei("upgrade_banner.to_sign_up.description")})]}),(0,n.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,n.jsx)(k.M,{className:"h-8 grow"}),(0,n.jsx)(R.N,{className:"h-8 grow"})]})]})]}),eq&&(0,n.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeInOut"},className:"flex flex-1 items-end px-2 py-3 text-center text-xs text-muted sm:px-8 md:px-12",children:(0,n.jsx)("p",{children:eq})})]})})}),(null==ev?void 0:ev.id)===E.MEMORIES_INTRODUCTION&&(0,n.jsx)(J,{isDisabled:!(0,g.C)(x.K6)||eL.isPending,onOptIn:()=>{er(D.f.MEMORY_OPT_IN),eZ(!0)},onOptOut:()=>{er(D.f.MEMORY_OPT_OUT),eZ(!1)}}),(null==ev?void 0:ev.id)===E.MCP_INTRODUCTION&&(0,n.jsx)(ee,{onLater:()=>{eg.mutate({feature:"mcp",data:{hasSeenIntroductionModalV1At:new Date().toISOString()}})},onDiscover:()=>{eg.mutate({feature:"mcp",data:{hasSeenIntroductionModalV1At:new Date().toISOString()}}),eo.push("/connections")}})]})}},50517:(e,t,a)=>{a.d(t,{F:()=>s});var n=a(93706),l=a(8424),i=a(35111);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,n.c3)("Memories"),a=i.api.useUtils();return i.api.memory.toggleFeatureActivation.useMutation({...e,onMutate:async function(){for(var t,n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];let[{isEnabled:s}]=l;await a.memory.getIsFeatureEnabled.cancel();let r=a.memory.getIsFeatureEnabled.getData();return a.memory.getIsFeatureEnabled.setData(void 0,s),null==(t=e.onMutate)||t.call(e,...l),{previousIsFeatureEnabled:r}},onSettled:function(){for(var t,n=arguments.length,l=Array(n),i=0;i<n;i++)l[i]=arguments[i];a.memory.getIsFeatureEnabled.invalidate(),null==(t=e.onSettled)||t.call(e,...l)},onError:function(){for(var n,i=arguments.length,s=Array(i),r=0;r<i;r++)s[r]=arguments[r];let[,,o]=s;(null==o?void 0:o.previousIsFeatureEnabled)&&a.memory.getIsFeatureEnabled.setData(void 0,o.previousIsFeatureEnabled),l.oRP.error(t("feature_activation.error",{isEnabled:String(!(null==o?void 0:o.previousIsFeatureEnabled))})),null==(n=e.onError)||n.call(e,...s)}})}},68084:(e,t,a)=>{a.d(t,{q:()=>i});var n=a(12330),l=a(8380);function i(){let e=(0,n.usePathname)();return(0,l.useMemo)(()=>{let[t,a,n]=e.split("/");return"chat"===a&&n?n:null},[e])}}}]);