try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d7f17fcb-dd53-4237-ba31-cb2407e9bac9",e._sentryDebugIdIdentifier="sentry-dbid-d7f17fcb-dd53-4237-ba31-cb2407e9bac9")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9143],{6124:(e,t,n)=>{n.d(t,{T:()=>h});var r=n(64784),a=n(5936),l=n(6016),i=n(18815),s=n(55936),o=n(8380),c=n(8424),u=n(75429),d=n(30063),f=n(90907);let g=/<\/?strong>/g;function h(e){var t,n,h;let{references:p,activeIndex:m,onActiveIndexChange:x,onClickReference:v}=e,[w,y]=o.useState(null),b=p[m],C=b&&b.hostname,_=b&&b.sourceDisplayName,E=null==(n=null==b?void 0:b.isOpenable)||n,N=null==(h=null==b?void 0:b.isSelectable)||h,j=o.useCallback(()=>{let e=0===m?p.length-1:m-1;y(m>e?"forward":"backward"),x(e)},[m,x,p.length]),I=o.useCallback(()=>{let e=m===p.length-1?0:m+1;y(m>e?"forward":"backward"),x(e)},[m,x,p.length]);return(0,r.jsxs)(r.Fragment,{children:[p.length>1&&(0,r.jsxs)("div",{className:"text-muted-foreground flex w-full items-center justify-between border-b bg-card-subtle p-2 text-xs",children:[(0,r.jsx)(u.$n,{onClick:j,variant:"ghost",size:"sm",children:(0,r.jsx)(i.A,{className:"h-4 w-4"})}),(0,r.jsx)(u.$n,{onClick:I,variant:"ghost",size:"sm",children:(0,r.jsx)(s.A,{className:"h-4 w-4"})}),(0,r.jsx)("span",{className:"flex-1"}),(0,r.jsxs)("span",{className:"pe-2",children:[m+1," / ",p.length]})]}),(0,r.jsx)(a.N,{mode:"wait",initial:!1,children:b&&(0,r.jsxs)(l.P.div,{initial:{opacity:0,x:"forward"===w?-8:8},animate:{opacity:1,x:0},exit:{opacity:0,x:"forward"===w?8:-8},transition:{duration:.15,type:"tween"},children:[(0,r.jsx)(c.FKN,{viewportClassName:"max-h-[170px]",children:(0,r.jsxs)("div",{className:"p-4",children:[E?(0,r.jsx)("a",{className:"cursor-pointer font-semibold hover:underline",target:"_blank",href:b.href,onClick:e=>v(e,b),children:b.title}):(0,r.jsx)("div",{className:"font-semibold",children:b.title}),(0,r.jsx)("div",{className:(0,d.cn)("text-sm text-subtle",!N&&"select-none"),children:null==(t=b.content)?void 0:t.replace(g,"")})]})}),C&&(0,r.jsx)("div",{className:"p-4 pt-2 shadow-sm",children:(0,r.jsxs)("a",{className:"flex cursor-pointer items-center gap-1 pt-2 hover:underline",target:"_blank",href:b.href,onClick:e=>v(e,b),children:[(0,r.jsx)(f.A,{className:"relative h-5 w-5 bg-card",height:18,width:18,hostname:C},C),(0,r.jsx)("span",{className:"text-sm text-subtle",children:_})]})})]},m)})]})}},6270:(e,t,n)=>{n.d(t,{$:()=>s});var r=n(93706),a=n(8380),l=n(51039),i=n(88544);function s(){let e=(0,r.c3)("Chat.files");return{getReferenceSourceDisplayName:(0,a.useCallback)(t=>{var n,r,a;if((0,i.a7)(t,t.metadata))return t.metadata?t.metadata.library_name:e("document_library.libraries");let s=(0,l.Ax)(t);return(a=null!=s?s:null)&&[l.Mv,l.kY,l.K2].includes(a)?null==s?void 0:s.toLocaleUpperCase():null!=(r=null!=s?s:null==(n=t.source)?void 0:n.toUpperCase())?r:""},[e])}}},10659:(e,t,n)=>{n.d(t,{q:()=>w});var r=n(42936),a=n(16544),l=n(60063),i=n(6939),s=n(39874);function o(){let e=(0,s._)(['\nInlineXML {\n  document   = fragment*\n\n  fragment   = element\n             | text\n\n  element    = selfClosingTag\n             | tagWithChildren\n\n  selfClosingTag    = "<" identifier spaces attribute* "/>"\n  \n  tagWithChildren   = openingTag spaces fragment* spaces closingTag?\n  openingTag        = "<" identifier spaces attribute*  ">"\n  closingTag        = "</" identifier ">"\n\n  text       = textChar+\n  textChar   = ~"<" any\n\n  attribute  = spaces identifier "=" string spaces\n\n  identifier = #(alnum | "-" | "_" | ":")+\n\n  string       = doubleQuoted | singleQuoted | identifier\n  doubleQuoted = """ doubleChar* """\n  doubleChar   = "\\""     -- escapedQuote\n               | ~""" any  -- anyCharButQuote\n  singleQuoted = "\'"  singleChar* "\'"\n  singleChar   = "\\\'"     -- escapedQuote\n               | ~"\'" any  -- anyCharButQuote\n}\n'],['\nInlineXML {\n  document   = fragment*\n\n  fragment   = element\n             | text\n\n  element    = selfClosingTag\n             | tagWithChildren\n\n  selfClosingTag    = "<" identifier spaces attribute* "/>"\n  \n  tagWithChildren   = openingTag spaces fragment* spaces closingTag?\n  openingTag        = "<" identifier spaces attribute*  ">"\n  closingTag        = "</" identifier ">"\n\n  text       = textChar+\n  textChar   = ~"<" any\n\n  attribute  = spaces identifier "=" string spaces\n\n  identifier = #(alnum | "-" | "_" | ":")+\n\n  string       = doubleQuoted | singleQuoted | identifier\n  doubleQuoted = "\\"" doubleChar* "\\""\n  doubleChar   = "\\\\\\""     -- escapedQuote\n               | ~"\\"" any  -- anyCharButQuote\n  singleQuoted = "\'"  singleChar* "\'"\n  singleChar   = "\\\\\'"     -- escapedQuote\n               | ~"\'" any  -- anyCharButQuote\n}\n']);return o=function(){return e},e}let c=n(99520).qN(String.raw(o())),u=c.createSemantics();u.addOperation("ast",{_iter:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(e=>e.ast())},document:e=>({type:"document",children:e.ast()}),fragment:e=>e.ast(),element:e=>e.ast(),selfClosingTag:(e,t,n,r,a)=>{let l=r.ast();return{type:"tag",tagName:t.sourceString,attributes:l.reduce((e,t)=>({...e,[t.key]:t.value}),{}),children:[],sourceString:"".concat(e.sourceString).concat(t.sourceString).concat(n.sourceString).concat(r.sourceString).concat(a.sourceString)}},tagWithChildren:(e,t,n,r,a)=>{let l=e.ast();return{type:"tag",tagName:l.tagName,attributes:l.attributes.reduce((e,t)=>({...e,[t.key]:t.value}),{}),children:n.ast(),sourceString:"".concat(e.sourceString).concat(t.sourceString).concat(n.sourceString).concat(r.sourceString).concat(a.sourceString)}},openingTag:(e,t,n,r,a)=>({type:"openingTag",tagName:t.sourceString,attributes:r.ast()}),closingTag:(e,t,n)=>({type:"closingTag",tagName:t.sourceString}),attribute:(e,t,n,r,a)=>{let l=r.ast();return{type:"attribute",key:t.sourceString,value:l.value}},text:e=>({type:"text",value:e.sourceString}),textChar:e=>({type:"textChar",value:e.sourceString}),identifier:e=>({type:"identifier",value:e.sourceString}),string:e=>({type:"string",value:e.ast().value}),doubleQuoted:(e,t,n)=>({type:"doubleQuoted",value:t.sourceString}),doubleChar:e=>({type:"doubleChar",value:e.sourceString}),singleQuoted:(e,t,n)=>({type:"singleQuoted",value:t.sourceString}),singleChar:e=>({type:"singleChar",value:e.sourceString})});var d=n(1883),f=n(76531),g=n(56046);let h=d.Ik({tagName:d.eu("custom-element"),attributes:d.Ik({"data-json":d.Yj()})}).transform(e=>({name:"custom-element",attributes:{element:(0,f.a)(e.attributes["data-json"])}})),p=d.Ik({tagName:d.eu("followup"),attributes:d.Ik({encodedFollowup:d.Yj()})}).transform(e=>{let t=(0,g.rQ)(e.attributes.encodedFollowup);return t.success?{name:"followup",attributes:{followup:t.data}}:null}),m=d.KC([h,p]),x=()=>function(e){return(0,r.YR)(e,"html",(e,t,n)=>{let r=(e=>{let t=(e=>{let t=c.match(e);return t.failed()?{success:!1,error:t.message}:{success:!0,value:u(t).ast()}})(e);return t.success?t.value.children.filter(e=>"tag"===e.type):[]})(e.value).flatMap(e=>{let t=m.safeParse(e);if(!t.success)return[];let n=t.data;return n?{type:n.name,data:{hName:n.name,hProperties:n.attributes}}:[]});r.length&&n&&"number"==typeof t&&n.children.splice(t,1,...r)}),e};function v(){return e=>{(0,r.YR)(e,e=>{"children"in e&&e.children.forEach((t,n)=>{"html"===t.type&&"<br>"===t.value&&e.children.splice(n,1,{type:"break"})})})}}function w(){return[l.A,i.A,a.A,v,x,y]}function y(){return e=>{(0,r.YR)(e,e=>{if("containerDirective"===e.type||"leafDirective"===e.type||"textDirective"===e.type){var t,n;let r=null!=(t=e.data)?t:e.data={};r.hName=e.name,r.hProperties=null!=(n=e.attributes)?n:{}}})}}},17210:(e,t,n)=>{function r(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function a(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:"long",yesterdayTranslation:null},n=new Date,a=e.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"}),l=e.toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"}),i=e.toLocaleDateString(void 0,{day:"2-digit",month:"2-digit",year:"numeric"});if(r(n,e))return a;let s=new Date;s.setDate(n.getDate()-1);let{format:o,yesterdayTranslation:c}=t;return r(s,e)&&c?"long"===o?"".concat(c,", ").concat(a):c:n.getFullYear()===e.getFullYear()?"long"===o?"".concat(l," ").concat(a):i:i+("long"===o?" ".concat(a):"")}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{locale:navigator.language,yesterdayTranslation:null,format:"relative"},n=new Date(e),r=a(new Date),l=new Date(r);l.setDate(r.getDate()-1);let i=a(n),s=i.getTime()===r.getTime(),o=i.getTime()===l.getTime(),{format:c,locale:u,yesterdayTranslation:d}=t,f=new Intl.DateTimeFormat(u,{hour:"numeric",minute:"2-digit"}),g=new Intl.DateTimeFormat(u,{month:"short",day:"numeric"}),h=f.format(n);/AM|PM/i.test(h)&&(h=h.replace(/\s?(AM|PM)/i,(e,t)=>t.toLowerCase()));let p="".concat(g.format(n),", ").concat(h);return"long"===c?p:s?h:o&&d?"".concat(d," ").concat(h):p}function s(e){let t=Math.floor(e/6e4),n=Math.floor(e%6e4/100)/10;return 0===t?"".concat(n.toString(),"s"):"".concat(t,"min ").concat(n.toString(),"s")}n.d(t,{Wo:()=>l,fU:()=>s,tI:()=>i})},19303:(e,t,n)=>{n.d(t,{C:()=>_});var r=n(64784),a=n(8380),l=n(8424),i=n(84544),s=n(6124),o=n(90859),c=n(85180),u=n(49036),d=n(69189),f=n(8672),g=n(39343),h=n(51039),p=n(96166),m=n(6270);function x(e){return!(0,f.u)(e.refIndex)&&!(0,f.u)(e.reference)}var v=n(8866),w=n(24180),y=n(21104);async function b(e){let{item:t,referenceContentSpan:n,contentChunkIndex:r}=e,a=await (0,y.DB)(t.ragResult,n,r);return{...t,content:a.text}}var C=n(81078);function _(e){let{children:t}=e,n=(0,a.useContext)(c.N);if(!n)throw Error("ReferencesBlock must be used within a MessageContext provider.");let[f,_]=(0,a.useState)(!1),[E,N]=(0,a.useState)(!1),{dialogOpen:j,afpArticle:I,onClickAFPArticle:S,setDialogOpen:D}=(0,u.h)({message:n}),{refItemsWithRagResults:T,contentChunkIndex:k}=function(e){let{children:t}=e,{references:n}=(0,p.G)(),{getReferenceSourceDisplayName:r}=(0,m.$)(),{refItemsWithRagResults:l,contentChunkIndex:i}=(0,a.useMemo)(()=>{let e="string"==typeof t?(0,g.dX)(t):null;if(null===e)return{refItemsWithRagResults:[],contentChunkIndex:0};let{contentChunkIndex:a,referenceIds:l}=e;return{refItemsWithRagResults:l.map(e=>(0,g.t3)(n,e)).filter(x).map(e=>{var t,n,a,l;let i,s=e.reference.source===h.Mv;return{source:(i=e.reference).source===h.Mv?h.Mv:i.source===h.kY?h.kY:i.source===h.K2?h.K2:i.source===h.gK?"document-library":"web",sourceDisplayName:null!=(n=r(e.reference))?n:"",title:e.reference.title,content:null==(t=e.reference.snippets)?void 0:t[0],isSelectable:!s,isOpenable:!0,hostname:null!=(a=(0,h.Ax)(e.reference))?a:void 0,href:null!=(l=(0,h.vH)(e.reference))?l:void 0,ragResult:e.reference}}),contentChunkIndex:a}},[n,t,r]);return{refItemsWithRagResults:l,contentChunkIndex:i}}({children:t}),{refItemsWithSnippets:R}=function(e){let{message:t,refItemsWithRagResults:n,contentChunkIndex:r,hasHovered:l,isPopoverOpen:i}=e,s=(0,a.useMemo)(()=>(0,y.yY)(t.contentChunks,t.references),[t.contentChunks,t.references]);return{refItemsWithSnippets:(0,w.useQuery)({queryKey:["references-snippets-content",s,r,n],queryFn:async()=>Promise.all(n.map(e=>b({item:e,referenceContentSpan:s,contentChunkIndex:r}))),enabled:l||i}).data}}({message:n,refItemsWithRagResults:T,contentChunkIndex:k,hasHovered:E,isPopoverOpen:f}),{onOpenChangeTrackReferencesHovered:A}=function(e){let{message:t,references:n}=e,{trackMessageEvent:r}=(0,v.n)();return{onOpenChangeTrackReferencesHovered:(0,a.useCallback)(e=>{e&&r(v.f.REFERENCE_HOVERED,{chat_id:t.chatId,message_id:t.id,message_version:t.version,references:n.map(e=>({reference_url:e.href,reference_source:e.hostname})),answer_id:t.id,answer_version:t.version})},[n,t.id,t.version,t.chatId,r])}}({message:n,references:T}),L=(0,a.useCallback)(e=>{_(e),A(e)},[A,_]),M=null!=R?R:T,[O,P]=(0,a.useState)(0),{onClickReference:U}=(0,d.E)({onClickAFPArticle:S});return 0===M.length?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.jcX,{openDelay:150,closeDelay:100,open:f,onOpenChange:L,children:[(0,r.jsx)(l.d05,{asChild:!0,onMouseEnter:()=>N(!0),children:(0,r.jsx)("span",{...o.Ux,children:(0,r.jsx)(C.m,{activeIndex:O,referenceItems:M,onClickReference:U})})}),(0,r.jsx)(l.Etv,{align:"start",className:"my-2 flex w-[360px] flex-col overflow-hidden rounded-xl p-0 shadow-2xl",children:(0,r.jsx)(s.T,{references:M,activeIndex:O,onActiveIndexChange:P,onClickReference:U})})]}),(0,r.jsx)(i.A,{article:I,isOpen:j,handleDialogOpenChange:D})]})}},21104:(e,t,n)=>{n.d(t,{DB:()=>c,yY:()=>u});var r=n(33152),a=n(8672),l=n(51039);let i=["!",".","?","։","؟","۔","܀","܁","܂","߹","।","॥","၊","။","።","፧","፨","᙮","᜵","᜶","᠃","᠉","᥄","᥅","᪨","᪩","᪪","᪫","᭚","᭛","᭞","᭟","᰻","᰼","᱾","᱿","‼","‽","⁇","⁈","⁉","⸮","⸼","꓿","꘎","꘏","꛳","꛷","꡶","꡷","꣎","꣏","꤯","꧈","꧉","꩝","꩞","꩟","꫰","꫱","꯫","﹒","﹖","﹗","！","．","？","\uD802\uDE56","\uD802\uDE57","\uD804\uDC47","\uD804\uDC48","\uD804\uDCBE","\uD804\uDCBF","\uD804\uDCC0","\uD804\uDCC1","\uD804\uDD41","\uD804\uDD42","\uD804\uDD43","\uD804\uDDC5","\uD804\uDDC6","\uD804\uDDCD","\uD804\uDDDE","\uD804\uDDDF","\uD804\uDE38","\uD804\uDE39","\uD804\uDE3B","\uD804\uDE3C","\uD804\uDEA9","\uD805\uDC4B","\uD805\uDC4C","\uD805\uDDC2","\uD805\uDDC3","\uD805\uDDC9","\uD805\uDDCA","\uD805\uDDCB","\uD805\uDDCC","\uD805\uDDCD","\uD805\uDDCE","\uD805\uDDCF","\uD805\uDDD0","\uD805\uDDD1","\uD805\uDDD2","\uD805\uDDD3","\uD805\uDDD4","\uD805\uDDD5","\uD805\uDDD6","\uD805\uDDD7","\uD805\uDE41","\uD805\uDE42","\uD805\uDF3C","\uD805\uDF3D","\uD805\uDF3E","\uD806\uDE42","\uD806\uDE43","\uD806\uDE9B","\uD806\uDE9C","\uD807\uDC41","\uD807\uDC42","\uD81A\uDE6E","\uD81A\uDE6F","\uD81A\uDEF5","\uD81A\uDF37","\uD81A\uDF38","\uD81A\uDF44","\uD82F\uDC9F","\uD836\uDE88","｡","。"];function s(e,t){var n,r,a;let l=function(e){let t=i.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|");return e.split(new RegExp("(".concat(t,")")))}(e),s=[],o=0;for(;o<l.length;){let e=l[o];if(!(null==e?void 0:e.trim())||i.includes(e)){o+=1;continue}let r=e,a=r.split(/\s+/).filter(e=>e.trim()).length;if(o+1<l.length&&i.includes(l[o+1])&&(r+=l[o+1],o+=1),a<=t){for(let e=0;e<s.length;e++){let[l,i]=null!=(n=s[e])?n:[];if(!l||!i)throw Error("Error while processing reference extract : empty span / length element.");a+i<=t&&(s[e]=[l+r,i+a])}s.push([r,a])}else{let e=function(e,t){let n=e.split(/(\s+)/),r="",a=0;for(let e of n)if(e.trim()&&(a+=1),r+=e,a>=t)break;return r}(r,t);s.push([e,t])}o+=1}for(let e=s.length-1;e>0;e--){let t=e-1,[n]=null!=(r=s[e])?r:[],[l]=null!=(a=s[t])?a:[];if(!n||!l)throw Error("Error while processing reference extract : empty span pair.");if(l.includes(n)){s.splice(e,1);continue}}return s.map(e=>{let[t]=e;return t.trim()})}async function o(e,t){let[n]=await (0,r.v7)(e,t,{processor:e=>e.trim().toLowerCase(),limit:1});if(!n)throw Error("Error while processing reference extract : empty fuzzball extract.");return{textChoice:n[0],score:n[1],extractIndex:n[2]}}let c=async(e,t,n)=>{if(!e||(0,a.u)(n)||e.source===l.ip)return{text:""};if(e.snippets&&e.snippets.length>0)try{let r=t[n];if(void 0===r)return{text:e.snippets.join(" ")};let a=function(e,t){let n=e.snippets;if(!n)return[];let r=function(e){e.sort((e,t)=>t.length-e.length);let t=[];for(let n of e){let e=!1;for(let r of t)if(r.includes(n)){e=!0;break}e||t.push(n)}return t}(n);if(!r.length)return[];let a=[];for(let e of r)a.push(...s(e,80));return[...new Set(a)]}(e,0),l=await o(r,a);return{text:l.textChoice,hasPreviousContent:a.length>1&&l.extractIndex>0,hasNextContent:a.length>1&&l.extractIndex<a.length-1}}catch(t){return{text:e.snippets.join(" ")}}if(e.content)try{let r=t[n];if(void 0!==r){let t=s(e.content,80),n=await o(r,t);return{text:n.textChoice,hasPreviousContent:t.length>1&&n.extractIndex>0,hasNextContent:t.length>1&&n.extractIndex<t.length-1}}}catch(e){}return e.description?{text:e.description}:{text:""}};function u(e,t){let n,r={};return t&&e?(e.forEach((e,t)=>{"text"===e.type&&e.text.length>0?n=e.text.slice(-80):"reference"===e.type?r[t]=n:n=void 0}),r):r}},31715:(e,t,n)=>{n.d(t,{$:()=>a});var r=n(68273);let a=(e,t)=>{try{return t.safeParse(JSON.parse(e))}catch(e){return{success:!1,error:new r.G([{message:"Failed to parse JSON",code:r.eq.custom,path:[]}])}}}},32612:(e,t,n)=>{async function r(e){let t=/Chrom(?:ium|e)\/([0-9]{3})\.[0-9]*\.[0-9]*/.exec(navigator.userAgent),n=null==t?void 0:t.at(1);if(n&&137>=parseInt(n)){let t=e.types.find(e=>"text/plain"===e);t&&await navigator.clipboard.writeText(t)}else await navigator.clipboard.write([e])}n.d(t,{J:()=>r,U:()=>a});let a=(e,t)=>{let n=e.cloneNode(!0);return n.querySelectorAll(t).forEach(e=>e.remove()),Array.from(n.children).forEach(e=>{a(e,t)}),n}},34327:(e,t,n)=>{n.d(t,{q:()=>a});let r=["127.0.0.1","mistralaichatupprodswe.blob.core.windows.net","mistralaifilesapiprodswe.blob.core.windows.net","mistralaichatupstagswe.blob.core.windows.net","mistralaifilesapistagswe.blob.core.windows.net","mistral.ai","mistralai.com"],a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{if(e.startsWith("/"))return!0;let n=new URL(e).hostname;return[...new Set([...r,...t])].some(e=>n===e||n.endsWith(".".concat(e)))}catch(e){return!1}}},38912:(e,t,n)=>{n.d(t,{D:()=>x});var r=n(64784);n(46070);var a=n(93706),l=n(8380),i=n(34327),s=n(76432),o=n(30063),c=n(94654),u=n(6974),d=n(81494),f=n(8424),g=n(8866),h=n(85180);async function p(e){var t,n,r;let a=await fetch(e);if(!a.ok)throw Error("Download image failed.");let l=await a.blob(),i=null!=(n=l.type.split("/").at(1))?n:"jpg",s=null!=(r=null==(t=e.split("?").at(0))?void 0:t.split("/").pop())?r:"image";return{blob:l,fileName:[".jpg",".png",".jpeg"].some(e=>s.endsWith(e))?s:"".concat(s,".").concat(i)}}async function m(e){let t=await createImageBitmap(e),n=new OffscreenCanvas(t.width,t.height),r=n.getContext("2d");if(!r)throw Error("Unable to convert image to PNG : canvas context not found.");return r.drawImage(t,0,0),await n.convertToBlob({type:"image/png"})}let x=e=>{let{onLinkClick:t,src:n,...l}=e,s=(0,a.c3)("Chat");return"string"!=typeof n?null:(0,i.q)(n,u._.NEXT_PUBLIC_WHITELISTED_IMAGE_DOMAINS)?(0,r.jsx)(v,{...l,src:n}):t?(0,r.jsx)(d.A,{...l,href:n,onClick:t,shouldFade:l.shouldFade||!1,children:l.alt||s("message.image_preview")}):null},v=e=>{let{src:t,alt:n,referenceTitle:i,referenceUrl:d,referenceHostname:x,originalWidth:v,originalHeight:w,enableLowerResThumbnail:y=!0,thumbnailWidth:b=400,showBlur:C=!0,className:_,imageClassName:E}=e,[N,j]=(0,l.useState)(!1),{canDownload:I,handleDownload:S}=function(e){let{src:t}=e,n=(0,l.useContext)(h.N),{trackMessageEvent:r}=(0,g.n)(),i=(0,a.c3)("Chat");if(!n)throw Error("useDownloadImage must be used within a MessageProvider");let{id:s,version:o,chatId:c}=n,u=!!t,d=(0,l.useCallback)(async()=>{if(t){r(g.f.DOWNLOAD_IMAGE_BUTTON,{chat_id:c,message_id:s,message_version:o,image_url:t,answer_id:s,answer_version:o});try{let{blob:e,fileName:n}=await p(t),r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}catch(e){console.error("Error downloading image:",e),f.oRP.error(i("message.image_download_error"))}}},[s,o,c,t,i,r]);return{canDownload:u,handleDownload:d}}({src:t}),{canCopy:D,handleCopy:T}=function(e){let{src:t}=e,n=(0,l.useContext)(h.N),{track:r}=(0,g.n)(),i=(0,a.c3)("Chat");if(!n)throw Error("useCopyImage must be used within a MessageProvider");let{id:s,version:o,chatId:c}=n,u=!!t,d=(0,l.useCallback)(async()=>{if(t){r(g.f.COPY_IMAGE_BUTTON,{image_url:t,answer_id:s,answer_version:o,chat_id:c});try{let{blob:e}=await p(t),n=await m(e);await navigator.clipboard.write([new ClipboardItem({[n.type]:n})]),f.oRP.success(i("message.image_copy_success"))}catch(e){f.oRP.error(i("message.image_copy_error"))}}},[s,o,c,t,i,r]);return{canCopy:u,handleCopy:d}}({src:t}),k=y&&b?function(e){let{originalUrl:t,width:n}=e;return s._K.NEXT_PUBLIC_THUMBNAIL_URL_TEMPLATE.replace("{{width}}",n.toString()).replace("{{originalUrl}}",t)}({originalUrl:t,width:b}):null;return(0,r.jsx)("span",{className:(0,o.cn)("image-block relative block w-fit transition-all duration-200 ease-in-out fade-in hover:shadow-lg",_),children:(0,r.jsx)(c.p,{canDownload:I,onDownload:S,canCopy:D,onCopy:T,className:"h-full w-full",referenceTitle:i,referenceUrl:d,referenceHostname:x,originalWidth:v,originalHeight:w,src:N?u._.NEXT_PUBLIC_CHAT_IMAGE_PLACEHOLDER:t,showBlur:C,children:(0,r.jsx)("img",{src:N?u._.NEXT_PUBLIC_CHAT_IMAGE_PLACEHOLDER:null!=k?k:t,alt:null!=n?n:"",className:(0,o.cn)("m-0 h-auto max-h-[30vh] min-h-[250px] w-auto",E),onError:()=>j(!0)})})})}},39161:(e,t,n)=>{n.d(t,{v:()=>l});var r=n(42573),a=n(35111);function l(){let e=a.api.useUtils(),t=a.api.user.integrationFunctionPermissions.update.useMutation({onMutate:t=>{let{updates:n}=t,r=e.user.integrationFunctionPermissions.all.getData();return e.user.integrationFunctionPermissions.all.setData(void 0,e=>{let t;return t=null!=e?e:{},n.reduce((e,t)=>{let{integrationId:n,functionName:r,permission:a}=t;return{...e,[n]:{...e[n],[r]:a}}},t)}),{snapshot:r}},onError(t,n,r){e.user.integrationFunctionPermissions.all.setData(void 0,null==r?void 0:r.snapshot)},onSuccess:()=>{e.user.integrationFunctionPermissions.invalidate()}});return(0,r.DK)(e=>t.mutateAsync({updates:e}))}},39343:(e,t,n)=>{n.d(t,{GR:()=>c,LT:()=>d,dX:()=>s,kD:()=>i,t3:()=>l});var r=n(74032),a=n(6790);let l=(e,t)=>{if(null===t||!e)return{};let n=(0,r.p)(e,e=>e.id.toString()),a=n.findIndex(e=>e.id.toString()===t.toString()),l=n[a];return l?{reference:l,refIndex:a}:{}};function i(e){let{contentChunkIndex:t,referenceIds:n}=e;return":".concat("refs","[").concat(t,"-").concat(n.join(","),"]")}function s(e){let[t,n]=e.split("-"),r=Number(t),a=null==n?void 0:n.split(",");return a&&r?{contentChunkIndex:r,referenceIds:a}:null}function o(e){return null===e?"":e.replace(/[&<>'"|]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;","|":"&verbar;"})[e]||e)}function c(e){return":".concat("tool_references","[references]{").concat(e.flatMap((e,t)=>{let{description:n,favicon:r,title:a,url:l}=e;return["ref_".concat(t,"_url='").concat(o(l),"'"),"ref_".concat(t,"_title='").concat(o(a),"'"),"ref_".concat(t,"_favicon='").concat(o(r),"'"),"ref_".concat(t,"_description='").concat(o(n),"'")]}).join(" "),"}")}let u=RegExp("ref_(?<referenceIndex>\\d+)_(?<data>url|title|favicon|description)");function d(e){let t=[];return(0,a.u)(e,(e,n)=>{var r;let a=null==(r=u.exec(n))?void 0:r.groups;if(!a)return;let l=Number(a.referenceIndex);void 0===t[l]&&(t[l]={}),t[l][a.data]=e}),t}},49036:(e,t,n)=>{n.d(t,{h:()=>l});var r=n(8380),a=n(35111);function l(e){let{message:t}=e,[n,l]=(0,r.useState)(!1),[i,s]=(0,r.useState)(null),o=a.api.reference.getAFPArticle.useMutation({onSuccess:e=>{s(t=>({...t,html:e,status:{name:"loaded"}}))},onError:e=>{s(t=>{var n;return{...t,status:{name:"error",code:null==(n=e.data)?void 0:n.code}}})}}),c=(0,r.useCallback)(e=>{var n;o.mutate({articleId:null!=(n=e.url)?n:"",messageData:{id:t.id,version:t.version,chatId:t.chatId}}),l(!0),s(t=>{var n;return{...t,title:e.title,date:null!=(n=e.date)?n:"",status:{name:"loading"}}})},[t.id,t.version,t.chatId,o]);return{dialogOpen:n,afpArticle:i,onClickAFPArticle:(0,r.useCallback)((e,t)=>{e.preventDefault(),c(t)},[c]),setDialogOpen:l}}},55400:(e,t,n)=>{n.d(t,{b:()=>f});var r=n(64784),a=n(7763),l=n(37984),i=n(8380),s=n(75227),o=n(61323),c=n(32735),u=n(30063);let d=(0,a.default)(()=>Promise.all([n.e(3904),n.e(6643)]).then(n.bind(n,86643)),{loadableGenerated:{webpack:()=>[86643]}});function f(e){let{fallback:t,theme:n,className:a,customStyle:f,...g}=e,{resolvedTheme:h}=(0,l.D)(),p=(0,c.YW)(null!=n?n:h).with("dark",()=>s.A).with("light",()=>o.A).with(c.P.string,()=>o.A).with(void 0,()=>void 0).exhaustive();return(0,r.jsx)(i.Suspense,{fallback:null!=t?t:(0,r.jsx)("div",{className:(0,u.cn)("p-[1rem] text-xs text-default",a),children:g.children}),children:(0,r.jsx)(d,{style:p,PreTag:"div",wrapLongLines:!0,className:(0,u.cn)("text-sm text-default select-text",a),customStyle:{padding:"1rem",...f},...g})})}},56046:(e,t,n)=>{n.d(t,{rQ:()=>i,t4:()=>s});var r=n(1883),a=n(31715);let l=r.Ik({snippet:r.Yj(),question:r.Yj(),id:r.Yj()}),i=e=>(0,a.$)(decodeURIComponent(e),l),s=(e,t)=>{let n=o(t);return c(e.reduce((e,t)=>{let n=e.find(e=>"text_with_hidden_parts"===e.type&&e.content.some(e=>"text"===e.type&&e.text.includes(t.snippet)));if(!n)return e;let r=n.content.find(e=>"text"===e.type&&e.text.includes(t.snippet));if(!r)return e;let a=r.text,l=a.indexOf(t.snippet),i=l+t.snippet.length;return e.toSpliced(e.indexOf(n),1,{type:"text_with_hidden_parts",content:n.content.toSpliced(n.content.indexOf(r),1,{type:"text",text:a.slice(0,l)},{type:"hidden",text:(e=>{var t;let n=encodeURIComponent(JSON.stringify({...e,id:null!=(t=e.id)?t:"unknown"}));return'<followup encodedFollowup="'.concat(n,'" />')})(t)},{type:"text",text:a.slice(i)})})},n))},o=e=>e.map(e=>"text"===e.type?{type:"text_with_hidden_parts",content:u(e.text)}:e),c=e=>e.map(e=>"text_with_hidden_parts"===e.type?f(e.content):e),u=e=>h.reduce((e,t)=>e.flatMap(e=>{if("text"!==e.type)return[e];let n=Array.from(e.text.matchAll(t.regex));return d(e.text.split(t.regex).map(e=>({type:"text",text:e})),n.map(e=>({type:"hidden",text:e[0]})))}),[{type:"text",text:e}]),d=(e,t)=>e.flatMap((e,n)=>[e,...n<t.length?[t[n]]:[]]),f=e=>({type:"text",text:e.map(e=>e.text).join("")}),g={name:"FOUR_TICKS_CODE_BLOCK_REGEX",regex:RegExp("(?:^|\\n)\\s*````[^\\n]*\\n[\\s\\S]+?\\n\\s*````","gs")},h=[g,{name:"THREE_TICKS_CODE_BLOCK_REGEX",regex:RegExp("(?:^|\\n)\\s*```[^\\n]*\\n[\\s\\S]+?\\n\\s*```","gs")},{name:"LATEX_BLOCK_REGEX",regex:/\\\[[\s\S]+?\\\]/g},{name:"LINK_OR_IMAGE_REGEX",regex:/!?\[[^\n|\]]+\]\([^\n|)]+\)/g},{name:"INLINE_CODE_BLOCK_REGEX",regex:/``[^\n]+?``/g},{name:"INLINE_CODE_BLOCK_REGEX",regex:/`[^`\n]+?`/g},{name:"FOLLOWUP_MARKUP_REGEX",regex:/<followup encodedFollowup="[^"]*" \/>/g},{name:"CUSTOM_ELEMENT_MARKUP_REGEX",regex:/<custom-element data-json="[^"]*" \/>/g},{name:"ESCAPED_CHARACTER_REGEX",regex:/\\./g}]},69111:(e,t,n)=>{function r(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function a(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/-/g," ").replace(/_/g," ").replace(/\s+/g," ").trim().split(" ").map(r).join(" ")}n.d(t,{q_:()=>s,Sn:()=>a,EJ:()=>o});let l=function(e){let t=null;return function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return(null==t?void 0:t.value.args)&&r.every((e,n)=>Object.is(e,null==t?void 0:t.value.args[n]))?t.value.result:(t={value:{args:r,result:e(...r)}}).value.result}}(()=>document.createElement("canvas").getContext("2d")),i={fontFamily:"Inter, system-ui, sans-serif",fontSize:"12px",fontWeight:"normal"};function s(e,t){let n=l();if(!n)return console.error(Error("Failed to get canvas context")),0;let r=t?{...i,...t}:i;return n.font="".concat(r.fontWeight," ").concat(r.fontSize," ").concat(r.fontFamily),n.measureText(e).width}let o=e=>{let{text:t,maxWidth:n,stylesProp:r,preserveWords:a}=e,l=0,i=t.length,o=Math.floor((l+i)/2);for(;l<i;)s(t.slice(0,o),r)<=n?l=o+1:i=o,o=Math.floor((l+i)/2);let c=t.slice(0,o);return a?c.split(" ").slice(0,-2).join(" "):c}},69189:(e,t,n)=>{n.d(t,{E:()=>o});var r=n(42573),a=n(51039),l=n(8380),i=n(8866),s=n(85180);function o(e){let{onClickAFPArticle:t}=e,{trackReferenceClicked:n}=function(){let e=(0,l.useContext)(s.N),{trackMessageEvent:t}=(0,i.n)();return{trackReferenceClicked:(0,l.useCallback)(n=>{t(i.f.REFERENCE_CLICKED,{chat_id:null==e?void 0:e.chatId,message_id:null==e?void 0:e.id,message_version:null==e?void 0:e.version,reference_url:n.href,reference_source:n.source,answer_id:null==e?void 0:e.id,answer_version:null==e?void 0:e.version})},[null==e?void 0:e.id,null==e?void 0:e.version,null==e?void 0:e.chatId,t])}}();return{onClickReference:(0,r.DK)((e,r)=>{r.source===a.Mv&&"ragResult"in r?t(e,r.ragResult):"A"!==e.currentTarget.tagName&&(e.preventDefault(),window.open(r.href,"_blank","noopener,noreferrer")),n(r)})}}},70852:(e,t,n)=>{n.d(t,{K:()=>d});var r=n(64784),a=n(8380),l=n(39343),i=n(51039),s=n(8424),o=n(6124),c=n(69189),u=n(81078);function d(e){let t=(0,l.LT)(e),n=(0,a.useMemo)(()=>t.map(e=>{var t,n,r;return{title:e.title,sourceDisplayName:null!=(t=(0,i.zd)(e.url))?t:"",content:null!=(n=e.description)?n:void 0,href:e.url,hostname:null!=(r=(0,i.zd)(e.url))?r:void 0,isSelectable:!0,isOpenable:!0,source:"web"}}),[t]),[d,f]=(0,a.useState)(0),{onClickReference:g}=(0,c.E)({onClickAFPArticle:()=>{}});return 0===n.length?null:(0,r.jsxs)(s.jcX,{openDelay:150,closeDelay:100,children:[(0,r.jsx)(s.d05,{asChild:!0,children:(0,r.jsx)("span",{children:(0,r.jsx)(u.m,{activeIndex:d,referenceItems:n,onClickReference:g})})}),(0,r.jsx)(s.Etv,{align:"start",className:"my-2 flex w-[360px] flex-col overflow-hidden rounded-xl p-0 shadow-2xl",children:(0,r.jsx)(o.T,{references:n,activeIndex:d,onActiveIndexChange:f,onClickReference:g})})]})}},76531:(e,t,n)=>{function r(e){return'<custom-element data-json="'.concat(encodeURIComponent(JSON.stringify(e)),'" />')}n.d(t,{a:()=>a,s:()=>r});let a=e=>JSON.parse(decodeURIComponent(e))},81078:(e,t,n)=>{n.d(t,{m:()=>i});var r=n(64784),a=n(93706),l=n(75429);function i(e){let{referenceItems:t,activeIndex:n,onClickReference:i}=e,s=(0,a.c3)("Chat"),o=t.map(e=>e.sourceDisplayName).filter(Boolean),c=o.at(n),u=o.length-1;return(0,r.jsx)("span",{className:"ps-1",children:(0,r.jsxs)(l.$n,{size:"2xs",variant:"soft",className:"inline-flex gap-0",onClick:e=>{let r=t[n];r&&i(e,r)},children:[(0,r.jsx)("span",{className:"text-xs",children:c||s("message.sources_button_title")}),u>0&&(0,r.jsxs)("span",{className:"ps-0.5 text-xs text-hint",children:["+",u]})]})})}},81494:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(64784),a=n(30063);function l(e){let{node:t,children:n,shouldFade:l,...i}=e;return(0,r.jsx)("a",{...i,target:"_blank",rel:"nofollow noopener noreferrer external",className:(0,a.cn)(l&&"fade-in"),children:n})}},84544:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(64784),a=n(47765),l=n(21917),i=n(79497),s=n(93706),o=n(8424);function c(e){let{nbLines:t=5}=e;return(0,r.jsxs)("div",{className:"flex w-full flex-col items-start space-y-4",children:[t&&Array.from({length:t-1}).map((e,t)=>(0,r.jsx)(o.EAD,{className:"h-5 w-full"},t)),(0,r.jsx)(o.EAD,{className:"h-5 w-2/3"})]})}var u=n(57743),d=n(17210);function f(e){let{errorCode:t}=e,n=(0,s.c3)("Chat"),i="TOO_MANY_REQUESTS"===t?"rateLimitReached":"default",c="TOO_MANY_REQUESTS"===t?a.A:l.A;return(0,r.jsx)(o.FcD,{children:(0,r.jsx)("div",{className:"flex w-full flex-row items-start gap-4",children:(0,r.jsxs)("div",{className:"flex w-full flex-col",children:[(0,r.jsxs)("div",{className:"flex w-full flex-row gap-2",children:[(0,r.jsx)(c,{className:"h-4 min-h-4 w-4 min-w-4"}),(0,r.jsx)(o.XL1,{children:n("afp_reference_dialog.errors.".concat(i,".title"))})]}),(0,r.jsx)(o.TND,{className:"ps-6 whitespace-break-spaces text-muted",children:n("afp_reference_dialog.errors.".concat(i,".description"))})]})})})}function g(e){var t,n,a;let{article:l,handleDialogOpenChange:g,isOpen:h}=e,p=(0,s.c3)("Chat");return(0,r.jsx)(o.lGe,{open:h,onOpenChange:g,children:(0,r.jsxs)(o.Cff,{className:"w-3xl max-w-3xl overflow-hidden px-4 select-none sm:px-9",children:[(0,r.jsx)(o.c75,{className:"justify-between py-1",children:(0,r.jsxs)("div",{className:"flex flex-row",children:[(0,r.jsx)(i.default,{src:u.A,alt:"favicon",className:"me-4 max-h-[50px] shrink-0 items-center rounded-full",width:50,height:50}),(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)(o.L33,{className:"line-clamp-2 text-lg font-semibold text-default",children:null==l?void 0:l.title}),(0,r.jsx)(o.rrK,{className:"pt-2 whitespace-break-spaces",children:"".concat(p("afp_reference_dialog.published_date")).concat((null==l?void 0:l.date)?(0,d.Wo)(new Date(l.date),{format:"short",yesterdayTranslation:p("left_panel.yesterday")}):"")})]})]})}),(0,r.jsxs)(o.FKN,{className:"relative -me-3 h-96 pe-5",children:[(null==l||null==(t=l.status)?void 0:t.name)==="loaded"&&(0,r.jsx)("div",{className:"article-content",dangerouslySetInnerHTML:{__html:l.html||""}}),(null==l||null==(n=l.status)?void 0:n.name)==="loading"&&(0,r.jsx)(c,{nbLines:8}),(null==l||null==(a=l.status)?void 0:a.name)==="error"&&(0,r.jsx)(f,{errorCode:l.status.code}),(0,r.jsx)(o.$H1,{dir:"vertical"}),(0,r.jsx)("div",{className:"pointer-events-none absolute inset-x-0 top-0 h-1 bg-linear-to-b from-default to-transparent"}),(0,r.jsx)("div",{className:"pointer-events-none absolute inset-x-0 bottom-0 h-4 bg-linear-to-t from-default to-transparent"})]})]})})}},85180:(e,t,n)=>{n.d(t,{N:()=>r});let r=(0,n(8380).createContext)(null)},90859:(e,t,n)=>{n.d(t,{Si:()=>i,Ux:()=>l});var r=n(32612);let a="data-exclude-copy",l={[a]:!0};function i(e){return(0,r.U)(e,"[".concat(a,"]"))}},96166:(e,t,n)=>{n.d(t,{G:()=>a,o:()=>l});var r=n(8380);let a=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useReferences must be used within a ReferencesProvider");return e},l=(0,r.createContext)(void 0)}}]);