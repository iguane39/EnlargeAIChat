try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0191eccc-2ddc-4226-b9ca-5fd13bc40100",e._sentryDebugIdIdentifier="sentry-dbid-0191eccc-2ddc-4226-b9ca-5fd13bc40100")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8918],{3324:(e,t,n)=>{n.d(t,{_:()=>j,z:()=>_});var a=n(64784),i=n(5936),l=n(6016),r=n(57577),s=n(14847),o=n(93706),c=n(42573),d=n(18544),u=n(8424),m=n(75429),p=n(28008),h=n(30063),g=n(50259),f=n(23964),x=n(28504),v=n(19494),b=n(29453);let _=e=>{let{maxIconDisplay:t,integrations:n}=e;return(0,a.jsxs)(i.N,{children:[n.slice(0,t).map(e=>(0,a.jsx)(l.P.div,{initial:{opacity:0,scale:0,width:0},exit:{opacity:0,scale:0,width:0},animate:{opacity:1,scale:1,width:"auto"},transition:{duration:.1},children:e.icon_url?(0,a.jsx)(u.Ybv,{src:e.icon_url,name:e.name,size:14},e.id):(0,a.jsx)(u.HHk,{className:"size-4"})},e.id)),0!==t&&n.length>t&&(0,a.jsx)(l.P.div,{initial:{opacity:0,scale:0,width:0},exit:{opacity:0,scale:0,width:0},animate:{opacity:1,scale:1,width:"auto"},transition:{duration:.05},className:"mt-auto",children:(0,a.jsx)(r.A,{className:(0,h.cn)("size-2",(0,p.M0)({variant:"hint"}))})})]})},y=e=>{let{disabled:t,...n}=e,i=(0,o.c3)("Chat"),l=(0,c.DE)(),{openCanva:r}=(0,f.o)(),{selectedIntegrations:u,availableIntegrationData:b}=(0,v.mr)(),y=(0,v.xn)(d.wt),j=(0,c.Ub)("(pointer: coarse)"),E=b.filter(e=>u.includes(e.id)),N=i("features.integration_selection_button_label");return(0,a.jsxs)(m.$n,{variant:"ghost",isDisabled:t||!l||y,className:(0,h.cn)("text-subtle hover:text-default"),"data-testid":"tools-selection-button",...n,children:[(0,a.jsx)(m.GM,{...x.dd,children:y?i("integrations.disabled_because_deep_research"):(0,a.jsxs)(a.Fragment,{children:[i("features.integration_selection_button_tooltip"),(0,a.jsx)(g.m,{hotkey:"/",className:"px-1 text-sm"})]})}),u.length<2&&(0,a.jsx)(m.IM,{icon:s.A}),0===u.length&&(0,a.jsx)(p.o5,{className:(0,h.cn)("max-sm:hidden",!!r&&"hidden"),children:N}),u.length>0&&(0,a.jsx)("div",{className:(0,h.cn)("flex gap-1"),children:(0,a.jsx)(_,{maxIconDisplay:4*!j,integrations:E})})]})},j=e=>{let{disabled:t,session:n,isLoading:i,side:l,showDrawer:r,agent:s}=e,d=(0,c.Ub)("(pointer: coarse)"),m=(0,c.DE)(),p=(0,o.c3)("Chat"),{isLoading:h,isDisabledFeaturesSelection:g}=(0,v.mr)();return m&&(d||r)?(0,a.jsxs)(u._s,{children:[(0,a.jsx)(u.Uz,{asChild:!0,children:(0,a.jsx)(y,{disabled:t})}),(0,a.jsxs)(u.zj7,{className:"bg-default text-start md:px-12",children:[(0,a.jsxs)(u.s6o,{children:[(0,a.jsx)(u.gkR,{inert:!0,children:p("integrations.panel.aria_title")}),(0,a.jsx)(u.I6p,{inert:!0,children:p("integrations.panel.aria_title")})]}),(0,a.jsx)(b.c,{session:n,disabled:i||h||g,agent:s,className:"h-full max-h-100 border-none bg-inherit"}),(0,a.jsx)(u.tbu,{className:"space-y-4"})]})]}):(0,a.jsxs)(u.AMh,{children:[(0,a.jsx)(u.dTQ,{className:"pointer-events-none absolute start-0 top-0 z-0 h-full w-full"}),(0,a.jsx)(u.Wvm,{asChild:!0,children:(0,a.jsx)(y,{disabled:t})}),(0,a.jsx)(u.hlN,{className:"m-0 w-[var(--radix-popover-trigger-width)] rounded-xl border-none bg-none p-0 shadow-none",align:"start",sideOffset:12,side:l,avoidCollisions:!1,children:(0,a.jsx)(b.c,{session:n,disabled:i||h||g,agent:s,className:"h-full max-h-100"})})]})}},4639:(e,t,n)=>{n.d(t,{C3:()=>d,IP:()=>c,O$:()=>s,iC:()=>r});var a=n(64784),i=n(8380);let l=(0,i.createContext)(null),r=()=>{let e=(0,i.useContext)(l);return e||null},s=e=>{let{children:t,getSelectedFile:n,uploadFiles:r,deleteFileByInlinePositionId:s}=e,o=(0,i.useMemo)(()=>({uploadFiles:r,getSelectedFile:n,deleteFileByInlinePositionId:s}),[r,n,s]);return(0,a.jsx)(l.Provider,{value:o,children:t})},o=(0,i.createContext)(null),c=()=>{let e=(0,i.useContext)(o);return e||{files:[]}},d=e=>{let{children:t,files:n}=e,l=(0,i.useMemo)(()=>({files:null!=n?n:[]}),[n]);return(0,a.jsx)(o.Provider,{value:l,children:t})}},5610:(e,t,n)=>{n.d(t,{r:()=>r});var a=n(64784),i=n(35102);let l=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"flex flex-shrink-1 flex-row flex-wrap items-start gap-1 pb-1",children:t})};function r(e){let{messageFiles:t}=e;return[...[{type:"image",files:t.filter(e=>"image"===e.type)},{type:"document",files:t.filter(e=>"image"!==e.type)}].map(e=>{let{type:t,files:n}=e;return n.length>0?(0,a.jsx)(l,{children:n.map((e,n)=>(0,a.jsx)(i.d,{file:e,deleteMessage:e.deleteMessage,onDelete:e.onDelete},"".concat(t,"-").concat(n)))},t):null})]}},8740:(e,t,n)=>{n.d(t,{r:()=>a});let a=e=>{let{contentChunks:t,canvas:n}=e;return t?t.map((e,a)=>{if("text"===e.type)return e.text;if("inline_tag"===e.type){let n=a>0?t.at(a-1):void 0,i=a<t.length-1?t.at(a+1):void 0,l=(null==n?void 0:n.type)!=="text"||n.text.endsWith(" ")?"":" ",r=(null==i?void 0:i.type)!=="text"||i.text.startsWith(" ")?"":" ";return l+e.label+r}if("canva"===e.type){if(!n)return null;let t=n.find(t=>t.id===e.id&&t.version===e.version);return t?"\n"+t.content+"\n":null}return"custom_element"===e.type&&"table-metadata"===e.element.type?"\n"+e.element.attributes.title+"\n":null}).filter(e=>null!==e).join(""):""}},8748:(e,t,n)=>{n.d(t,{Eg:()=>r,p:()=>s,pe:()=>o});var a=n(64784),i=n(6016);n(8380);var l=n(30063);function r(e){let{children:t,className:n}=e,r=(0,l.eX)(t,{message:s,actions:o});return(0,a.jsxs)(i.P.div,{initial:{height:0},animate:{height:"auto",overflow:"hidden"},exit:{height:0},transition:{duration:.2,ease:"easeInOut"},className:(0,l.cn)("grid grid-cols-1 items-center rounded-b-xl px-3 py-2 sm:grid-cols-[1fr_auto]",n),children:[r.message,r.actions]})}function s(e){let{className:t,...n}=e;return(0,a.jsx)("div",{...n,className:(0,l.cn)("text-sm",t)})}function o(e){let{className:t,...n}=e;return(0,a.jsx)("div",{...n,className:(0,l.cn)("flex items-center justify-end gap-0.5",t)})}s.displayName="NotificationMessage",o.displayName="NotificationActions"},9590:(e,t,n)=>{n.d(t,{V:()=>i});var a=n(89320);let i={q:a.tU,model:a.tU,library:a.tU,document:a.tU,project:a.tU,"le-chat-agent":a.tU,integrations:a.tU,error:a.tU,integration_id:a.tU,"prompt-key":a.tU};(0,a.Eq)(i)},13101:(e,t,n)=>{n.d(t,{I:()=>c,s:()=>o});var a=n(64784),i=n(93706),l=n(30063),r=n(3171),s=n(19494);let o=e=>{let{feature:t,disabled:n,Icon:o,allowed:c=!0,label:d,subLabel:u,onClick:m,hideSelectionStatus:p,session:h}=e,g=(0,i.c3)("Chat"),{selectedFeatures:f,isLoading:x}=(0,s.mr)(),v=f.includes(t);return(0,a.jsx)(r.tO,{tailDisplay:!p&&"checkbox",active:v,disabled:n||x||!c,leadIcon:(0,a.jsx)(o,{className:(0,l.cn)("size-6",v?"text-(--yellow-500)":""),strokeWidth:2}),label:d,subLabel:u,tooltip:function(e){let{isAllowed:t,session:n,t:a}=e;if(!t)return a(n?"features.disabled_feature_warning":"features.not_anonymous_accessible_warning")}({isAllowed:c,session:h,t:g}),onClick:m})},c=e=>{let{feature:t,disabled:n,Icon:i,allowed:o=!0,label:c,subLabel:d,hideSelectionStatus:u,className:m}=e,{selectedFeatures:p,isLoading:h}=(0,s.mr)(),g=p.includes(t);return(0,a.jsx)(r.vy,{tailDisplay:!u&&"checkbox",active:g,disabled:n||h||!o,className:m,leadIcon:(0,a.jsx)(i,{className:(0,l.cn)("size-6",g?"text-(--yellow-500)":""),strokeWidth:2}),label:c,subLabel:d})}},18182:(e,t,n)=>{n.d(t,{BO:()=>w,Go:()=>C,f3:()=>k,vA:()=>L});var a=n(64784),i=n(5936),l=n(6016),r=n(17584),s=n(18815),o=n(38178),c=n(9624),d=n(63929),u=n.n(d),m=n(93706),p=n(8380),h=n(42573),g=n(8424),f=n(75429),x=n(801),v=n(88318),b=n(28008),_=n(30063),y=n(3171),j=n(8866),E=n(35111),N=n(94419),A=n(72617),I=n(68142);let w=e=>{let{documentId:t,libraryId:n,documentName:a,documentType:i}=e,l=E.api.useUtils(),{track:r}=(0,j.n)(),s=(0,m.c3)("Chat.files");return(0,p.useCallback)(async()=>{let e=await l.library.libraryDocumentUrl.fetch({libraryId:n,documentId:t}),o=await (0,N.fG)(e,a,i);return(0,N.zz)(o)?r(j.f.MESSAGE_INPUT_DOCUMENT_UPLOAD_FROM_LIBRARY,{status:"success",document_id:t,library_id:n}):(r(j.f.MESSAGE_INPUT_DOCUMENT_UPLOAD_FROM_LIBRARY,{status:"fail",document_id:t,library_id:n,error:o.error}),g.oRP.error(s("document_library.document_upload_failed"))),o},[t,a,i,n,s,r,l.library.libraryDocumentUrl])},T=e=>{let{name:t,id:n,disabled:i,placeholder:l,libraryId:s,onSelectDocument:o,mimeType:c}=e,d=(0,m.c3)("Chat.files"),{supportedFileMime:u}=(0,I.j)(),[h,g]=(0,p.useState)(!1),f=w({documentId:n,libraryId:s,documentName:t,documentType:c}),x=async()=>{g(!0);let e=await f();(0,N.zz)(e)&&o([e.file]),g(!1)},v=!u.includes(c);return(0,a.jsx)(y.tO,{isLoading:h,disabled:!c||v||null!=i&&i||null!=l&&l,isPlaceholder:l,leadIcon:(0,a.jsx)(r.A,{className:"size-5"}),label:t,onClick:x,tooltip:v?d("document_library.unsupported_file_type"):void 0})},C=()=>(0,a.jsx)(T,{name:"",id:"skeleton",libraryId:"lib",placeholder:!0,onSelectDocument:()=>{},mimeType:""}),S=e=>{let{length:t}=e;return(0,a.jsx)(a.Fragment,{children:Array.from({length:t}).map((e,t)=>(0,a.jsx)(C,{},"doc-skeleton-".concat(t)))})},R=e=>{let{onSearchChange:t,loading:n,className:i,onReturn:l}=e,r=(0,m.c3)("Chat.files");return(0,a.jsxs)("div",{className:(0,_.cn)("flex items-center bg-inherit pe-2",i),children:[(0,a.jsxs)(v.m_,{children:[(0,a.jsx)(v.k$,{asChild:!0,children:(0,a.jsx)(f.$n,{onClick:l,variant:"ghost",mode:"icon-only",icon:s.A})}),(0,a.jsx)(v.ZI,{side:"bottom",children:r("document_library.go_back")})]}),(0,a.jsxs)(x.A0,{variant:"default",className:(0,_.cn)("grow",A.x),children:[(0,a.jsx)(x.pd,{type:"search",isDisabled:n,className:"ps-2!",placeholder:r("document_library.search_document_placeholder"),onChange:e=>{t(e.target.value)}}),(0,a.jsx)(x.IZ,{icon:o.A})]})]})},D=e=>{let{libraryId:t}=e,n=(0,m.c3)("Chat.files");return(0,a.jsxs)("div",{className:"my-4 flex h-full flex-1 grow flex-col items-center justify-center gap-2",children:[(0,a.jsx)(b.o5,{variant:"hint",size:"sm",children:n("document_library.no_documents")}),(0,a.jsx)(u(),{href:"/libraries/".concat(t),children:(0,a.jsxs)(f.$n,{variant:"soft",children:[n("document_library.add_documents"),(0,a.jsx)(f.qF,{icon:c.A})]})})]})},O=()=>{let e=(0,m.c3)("Chat.files");return(0,a.jsx)("div",{className:"my-4 flex h-full flex-1 grow flex-col items-center justify-center gap-2",children:(0,a.jsx)(b.o5,{variant:"hint",size:"sm",children:e("document_library.no_documents_found")})})},L=e=>{let{onBottomScrollReached:t}=e,n=(0,p.useRef)(null);return(0,p.useEffect)(()=>{let e=new IntersectionObserver(e=>{var n;(null==(n=e[0])?void 0:n.isIntersecting)&&t()},{threshold:.1}),a=n.current;if(a)return e.observe(a),()=>{e.unobserve(a)}},[t]),{bottomScrollTriggerRef:n}},P=e=>{let{libraryId:t,searchValue:n,onSelectDocument:i}=e,l=E.api.library.libraryDocuments.useInfiniteQuery({libraryId:t,pageSize:15,search:n&&n.length>2?n:void 0},{getNextPageParam:e=>e.pagination.has_more?e.pagination.current_page+1:void 0}),{data:r,isLoading:s}=l,{bottomScrollTriggerRef:o}=L({onBottomScrollReached:()=>{l.hasNextPage&&!l.isFetchingNextPage&&l.fetchNextPage()}});return(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(S,{length:6}),!s&&r&&(0,a.jsxs)(a.Fragment,{children:[r.pages.flatMap(e=>e.data).map(e=>(0,a.jsx)(T,{name:e.name,id:e.id,libraryId:t,mimeType:e.mime_type,onSelectDocument:i},"document-".concat(e.id))),(0,a.jsx)("div",{ref:o}),l.isFetchingNextPage&&(0,a.jsx)(S,{length:3})]}),!s&&r&&r.pages[0]&&0===r.pages[0].data.length&&(0,a.jsx)(a.Fragment,{children:n?(0,a.jsx)(O,{}):(0,a.jsx)(D,{libraryId:t})})]})},k=e=>{let{onReturn:t,currentLibraryId:n,onSelectDocument:r}=e,[s,o]=(0,h.Q3)("",250);return(0,a.jsxs)(y.$3,{className:"mt-3 h-full overflow-y-auto bg-inherit pb-4",children:[(0,a.jsx)(i.N,{children:(0,a.jsx)(l.P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.1,ease:"easeInOut"},className:"sticky top-0 z-10 bg-inherit text-sm text-subtle",children:(0,a.jsx)(R,{className:"py-1 text-sm text-subtle",onReturn:t,onSearchChange:o})})}),(0,a.jsx)(P,{libraryId:n,searchValue:s,onSelectDocument:r})]})}},22354:(e,t,n)=>{n.d(t,{w:()=>l});var a=n(64784);let i=(0,n(3385).F)("flex items-stretch",{variants:{size:{sm:"h-3 w-6",md:"h-4 w-9"}},defaultVariants:{size:"md"}}),l=e=>{let{className:t,size:n}=e;return(0,a.jsx)("div",{className:i({className:t,size:n}),children:["#FFD700","#FFAF00","#FF8205","#FA500F"].map(e=>(0,a.jsx)("div",{className:"grow",style:{backgroundColor:e}},e))})}},22731:(e,t,n)=>{n.d(t,{R:()=>X});var a=n(64784),i=n(85653),l=n(86668),r=n(15627),s=n(8380),o=n(66318),c=n(49943),d=n(4639),u=n(81075),m=n(65858),p=n(11139),h=n(33627);let g=e=>{let{newLineKey:t}=e,{"Mod-Enter":n,Enter:a,...i}=u.RV,l="enter"===t?{Enter:u.RV.Enter}:{"Shift-Enter":u.RV.Enter},r={Delete:u.ic,Backspace:(0,u.st)(u.ic,u.Qv,u._e),...i,...l,"Mod-z":m.tN,"Shift-Mod-z":m.ZS};return[(0,p.sM)({rules:[]}),(0,h.w)(r),(0,m.b6)()]};var f=n(78135);let x=e=>new l.k_({key:new l.hs(f.lf),props:{handleKeyDown:(t,n)=>(e&&e(n),!1)}}),v=e=>{let t=!1,n=n=>{n.state.doc.textContent||(e=>{var t;let n=null==(t=e.doc.firstChild)?void 0:t.content;if(!n)return!1;for(let e of n.content)if(!e.type.isText||e.textContent)return!0;return!1})(n.state)||t?n.dom.removeAttribute("data-placeholder"):n.dom.setAttribute("data-placeholder",e)};return new l.k_({view(e){let a=()=>{t=!0,n(e)},i=()=>{t=!1,n(e)};return e.dom.addEventListener("compositionstart",a),e.dom.addEventListener("compositionend",i),n(e),{update:n,destroy:()=>{e.dom.removeEventListener("compositionstart",a),e.dom.removeEventListener("compositionend",i)}}}})};var b=n(60126);let _=(e,t,n)=>{let a=e.state.tr;return a.replaceSelection(n),e.dispatch(a),t.preventDefault(),!0};var y=n(44750),j=n(8424),E=n(28008),N=n(30063),A=n(35102),I=n(64371),w=n(30817),T=n(18544),C=n(25211),S=n(21413),R=n(44960),D=n(19494),O=n(35263),L=n(35111),P=n(85139);let k=e=>{let{nodeAttr:t}=e;return"inline-file"===t.slashType?(0,a.jsx)(H,{nodeAttr:t}):(0,a.jsx)(G,{nodeAttr:t})},M=e=>{let{feature:t,className:n}=e,{selectedFeatures:i}=(0,D.mr)(),l=i.includes(t),r=O.A[t];return(0,a.jsx)(r,{className:(0,N.cn)("mr-1 inline-block size-3.5",l?"text-(--yellow-500)":"",n)})},U=e=>{let{libraryId:t,className:n}=e,{activeLibrarySelection:i}=(0,S.TY)();return(0,a.jsx)(R.$n,{id:t,className:(0,N.cn)("mr-1 size-3.5",n),placeholder:!i.includes(t)})},F=e=>{let{fileExtension:t,className:n}=e,i=(0,C.HA)(t)?A.F[t]:"bg-(--blue-500)";return(0,a.jsx)("span",{className:(0,N.cn)("rounded-md px-2 text-xs leading-6 font-semibold text-inverted-default select-none",i,n),spellCheck:!1,children:t.toUpperCase()})},z=e=>{let{nodeAttr:t}=e;if(t.iconUrl)return(0,a.jsx)(j.Ybv,{src:t.iconUrl,name:t.iconUrl,size:14,className:"me-1 mb-[1px] inline-block"});if(t.componentName){if((0,T.DS)(t.componentName))return(0,a.jsx)(M,{className:"mb-[1px]",feature:t.componentName});if(t.componentName===P.A)return(0,a.jsx)(U,{className:"mb-[1px]",libraryId:t.selectedValue})}return null},V=e=>{let{nodeAttr:t}=e,{subType:n,selectedLabel:i,selectedValue:l,componentName:r}=t,o="library"===n||r===P.A,{data:c,isLoading:d}=L.api.library.get.useQuery({id:l},{enabled:o}),u=(0,O.P)(),{availableIntegrationData:m}=(0,D.mr)(),p=(0,I.Ym)(),h=(0,w.ad)(p)?p:w.rc.en,g=(0,s.useMemo)(()=>{var e,t,n,a,r;if(o)return d?i:null!=(e=null==c?void 0:c.name)?e:i;if((0,T.DS)(l))return u[l].name;let s=m.find(e=>e.id===l);return s&&((null==(n=s.locale)||null==(t=n.name)?void 0:t[h])||(null==(r=s.locale)||null==(a=r.name)?void 0:a.en)||s.name)||i},[m,o,d,h,null==c?void 0:c.name,i,l,u]);return(0,a.jsx)("span",{className:(0,N.cn)("inline w-auto",d?"opacity-50":""),children:g})},G=e=>{let{nodeAttr:t,asFileLabel:n,asReadOnly:i}=e,{selectedLabel:l,selectedValue:r}=t,s=n&&l.includes(".")?l.split(".").pop():void 0;return(0,a.jsxs)(a.Fragment,{children:[""===r&&(0,a.jsx)("span",{className:"me-0.5",children:"/"}),(0,a.jsxs)(E.ac,{spellCheck:!1,className:(0,N.cn)(i?"":"selection:bg-transparent"),children:[s?(0,a.jsx)(F,{fileExtension:s,className:"me-1 align-middle"}):(0,a.jsx)(z,{nodeAttr:t}),n?l:(0,a.jsx)(V,{nodeAttr:t})]})]})},H=e=>{var t;let{nodeAttr:n}=e,i=(0,d.iC)(),{getSelectedFile:l}=null!=i?i:{},r=null==l?void 0:l(),s=null==r?void 0:r.find(e=>e.inlinePositionId===n.selectedValue);if(!s)return(0,a.jsx)(G,{nodeAttr:n,asFileLabel:!0});let o=null==(t=s.name)?void 0:t.split(".").pop();return(0,a.jsxs)("span",{className:(0,N.cn)("text-center align-middle","w-fit border-none p-0 text-inherit outline-none selection:bg-transparent"),children:[o&&(0,a.jsx)(F,{fileExtension:o,className:"me-1 align-middle selection:bg-transparent"}),(0,a.jsx)(E.ac,{spellCheck:!1,variant:"default",className:(0,N.cn)("selection:bg-transparent"),children:s.name})]})},B=(0,N.cn)("mx-0.5 inline-flex w-fit cursor-pointer items-center gap-1 rounded-full px-2 py-0.5 text-sm font-medium","bg-state-soft"),Y=e=>{let t=e.node.attrs,[n,r]=(0,s.useState)(""===t.selectedValue),o=(0,i._N)(),c=e=>{if(e.state.doc.nodeAt(o+1))e.dispatch(e.state.tr.setSelection(l.LN.near(e.state.doc.resolve(o+2))));else{let t=o+1,n=e.state.tr.insertText(" ",t),a=n.mapping.map(o+2);n.setSelection(l.LN.near(n.doc.resolve(a))),e.dispatch(n)}e.focus()},u=(0,d.iC)(),{uploadFiles:m}=null!=u?u:{},p=(0,s.useRef)(t.selectedValue),h=(0,i.CU)(e=>t=>{let n=crypto.randomUUID();if((0,f.vi)(t)){var a,i;if(!m)return;let{files:l,subType:r}=t;e.dispatch(e.state.tr.setNodeAttribute(o,"selectedValue",n).setNodeAttribute(o,"selectedLabel",null!=(i=null==(a=l[0])?void 0:a.name)?i:"file").setNodeAttribute(o,"subType",r).setNodeAttribute(o,"slashType","inline-file")),m(l,n,p.current),p.current=n}else{let{label:n,value:a,componentName:i,iconUrl:l,subType:r}=t;e.dispatch(e.state.tr.setNodeAttribute(o,"selectedValue",a).setNodeAttribute(o,"selectedLabel",n).setNodeAttribute(o,"iconUrl",l).setNodeAttribute(o,"componentName",i).setNodeAttribute(o,"subType",r).setNodeAttribute(o,"slashType","text-tag"))}r(!1),c(e)}),g=(0,i.CU)(e=>t=>{var n;let a=null==(n=e.state.tr.doc.nodeAt(o))?void 0:n.attrs;r(t),t||a.selectedValue||(e.dispatch(e.state.tr.replaceWith(o,o+1,e.state.schema.text("/"))),c(e))});return(0,a.jsxs)(j.AMh,{...e,open:n,onOpenChange:g(),modal:!0,children:[(0,a.jsx)(j.Wvm,{asChild:!0,disabled:!0,children:(0,a.jsx)(E.ac,{className:(0,N.cn)(B,"cursor-pointer hover:bg-state-soft-hover",n?"ring-1 ring-basic-blue-subtle":""),children:(0,a.jsx)("span",{contentEditable:!1,children:(0,a.jsx)(k,{nodeAttr:t})})})}),(0,a.jsx)(j.hlN,{className:"m-0 rounded-xl border-none bg-card p-0 shadow-lg",align:"start",sideOffset:12,children:(0,a.jsx)(P.M,{closePanelCallback:()=>{var e;null==(e=g())||e(!1)},handleNewFiles:(e,t)=>{var n;return null==(n=h())?void 0:n({files:e,subType:t})},handleOptionSelection:e=>{var t;let{value:n,label:a,iconSrc:i,componentName:l,subType:r}=e;return null==(t=h())?void 0:t({value:n,label:a,iconUrl:i,componentName:l,subType:r})},className:"m-auto h-[75vh] w-full max-w-3xl border-none bg-inherit"})})]})},Q=e=>{let{nodeAttr:t}=e,{files:n}=(0,d.IP)(),i=n.find(e=>e.inlineId===t.selectedValue);return"inline-file"===t.slashType&&i?(0,a.jsxs)(j.jcX,{openDelay:200,children:[(0,a.jsx)(j.d05,{asChild:!0,children:(0,a.jsx)(E.ac,{className:(0,N.cn)(B,"cursor-auto"),children:(0,a.jsx)(G,{nodeAttr:t,asFileLabel:!0,asReadOnly:!0})})}),(0,a.jsx)(j.Etv,{align:"center",className:"w-fit p-2 text-sm",children:(0,a.jsx)(A.d,{file:i,fileTag:(0,a.jsx)(y.A,{className:"size-4"})})})]}):(0,a.jsx)(E.ac,{className:(0,N.cn)(B,"cursor-auto"),children:(0,a.jsx)(G,{nodeAttr:t,asFileLabel:"inline-file"===t.slashType,asReadOnly:!0})})},$=e=>{let{className:t,editorContent:n}=e,i=(0,s.useMemo)(()=>(null!=n?n:[]).map(e=>"text"===e.type?e.content.split(/(\n)/).map(e=>({type:"text",content:e})):e).flat(),[n]);return(0,a.jsx)("div",{className:t,children:(0,a.jsx)("div",{className:"select-text",children:i.map((e,t)=>{switch(e.type){case"text":if("\n"===e.content)return(0,a.jsx)("br",{},t);return(0,a.jsx)("span",{className:"whitespace-pre-wrap",children:e.content},t);case"slash":return(0,a.jsx)(Q,{nodeAttr:e.content},t);default:return null}})})})};var K=n(36901);let X=e=>{let{initialValue:t,className:n}=e;if(e.readonly)return(0,a.jsx)($,{editorContent:t,className:n});let{onChange:i,onKeyDown:l,ref:r,autoFocus:s,placeholder:o,newLineKey:c,onTextPasted:d,onFilesPasted:u,firstLineIndentation:m,mentionTrigger:p,isSlashEnabled:h=!0,isMentionEnabled:g=!0}=e;return(0,a.jsx)(q,{onChange:i,value:t,ref:r,onKeyDown:l,autoFocus:s,placeholder:o,className:n,newLineKey:c,onTextPasted:d,onFilesPasted:u,firstLineIndentation:m,mentionTrigger:p,slashComponent:Y,isSlashEnabled:h,isMentionEnabled:g})},q=e=>{let{onChange:t,value:n,onKeyDown:u,ref:m,autoFocus:p,placeholder:h,className:y,newLineKey:j,onTextPasted:E,onFilesPasted:N,firstLineIndentation:A,mentionTrigger:I,slashComponent:w,isSlashEnabled:T,isMentionEnabled:C}=e,[S,R]=(0,s.useState)(()=>{let e=n?(0,c.Oq)(n):void 0;return l.$t.create({schema:K.h,plugins:[(0,i.wv)(),...g({newLineKey:j}),x(u),...h?[v(h)]:[]],doc:e,selection:e&&l.LN.atEnd(e)})}),[D,O]=(0,s.useState)(null);(0,s.useImperativeHandle)(m,()=>({appendText(e){R(t=>{let n=t.doc.content.size,a=t.doc.content.lastChild,i=a&&"paragraph"===a.type.name?n-a.nodeSize+a.content.size+1:n,r=(0,o.q)(i,{min:0,max:n}),s=t.tr;return s.insertText(e,r),s.setSelection(l.LN.atEnd(s.doc)),t.apply(s)})},insertTextAt(e,t){t<0||t>S.doc.content.size||R(n=>{let a=n.tr.insertText(e,t);return n.apply(a)})},focus(){null==D||D.focus()},get value(){return(0,c.Qr)(S.doc)},set value(value){let e=(0,c.Oq)(value);R(l.$t.create({schema:K.h,plugins:[(0,i.wv)(),...g({newLineKey:j}),x(u),...h?[v(h)]:[]],doc:e,selection:e&&l.LN.atEnd(e)}))}}));let L=(0,d.iC)(),{deleteFileByInlinePositionId:P}=null!=L?L:{},k=(0,s.useMemo)(()=>({slash:()=>({component:w,dom:document.createElement("span")})}),[w]),{nodeViews:M,renderNodeViews:U}=(0,i.G7)(k);return(0,a.jsx)("div",{className:y,children:(0,a.jsxs)(i.NH,{attributes:{autocomplete:"off",autocorrect:"off",autocapitalize:"off"},mount:D,state:S,handlePaste:(e=>{let{onTextPasted:t,onFilesPasted:n}=e;return(e,a,i)=>{var l,r,s;let o=null==(l=a.clipboardData)?void 0:l.files;(null==o?void 0:o.length)&&n&&n(Array.from(o));let c=e.state,d=e.state.tr,u=null==(r=a.clipboardData)?void 0:r.getData("text/plain"),m=null==(s=a.clipboardData)?void 0:s.getData("text/html");if(u&&!u.includes("\n")&&m&&m.includes("<br>"))return _(e,a,i);if(u){t&&t(u);let n=u.split(/(?:\r\n|\r|\n)/g).reduce((e,t)=>{if(t.length>0){let n=c.schema.text(t);e.push(c.schema.nodes.paragraph.create({},n))}return e},[]);return d.replaceSelection(b.Ji.maxOpen(b.FK.fromArray(n))),e.dispatch(d),a.preventDefault(),!0}return _(e,a,i)}})({onTextPasted:E,onFilesPasted:N}),dispatchTransaction:e=>{R(n=>(P&&(e=>{let{prevEditor:t,newEditor:n}=e,a=(0,r.O6)(t,K.h.nodes[f.lf]).map(e=>e.node),i=(0,r.O6)(n,K.h.nodes[f.lf]).map(e=>e.node);return a.length===i.length?[]:a.filter(e=>!i.some(t=>t.attrs.selectedValue===e.attrs.selectedValue))})({prevEditor:n.doc,newEditor:e.doc}).forEach(e=>{P(e.attrs.selectedValue)}),e.docChanged&&(null==t||t((0,c.Qr)(e.doc))),n.apply(e)))},nodeViews:M,children:[(0,a.jsx)(W,{autoFocus:p,setMount:O,firstLineIndentation:A,mentionTrigger:I,isSlashEnabled:T,isMentionEnabled:C}),U()]})})},W=e=>{let{isSlashEnabled:t,isMentionEnabled:n,autoFocus:l,setMount:r,firstLineIndentation:s,mentionTrigger:o}=e;return(0,i.k3)(e=>{l&&e.focus()},[]),((e,t)=>{let{enabled:n}=t;return(0,i.RV)("beforeinput",(t,a)=>{if(n&&a.data===e){let{from:e,to:n}=t.state.selection,i=t.state.doc.textBetween(e-1,n);return(!!/^\s*$/.exec(i)||0===i.length)&&(a.preventDefault(),(0,f.RT)(t,K.h))}})})("/",{enabled:t}),((e,t)=>{let{enabled:n=!0}=t;return(0,i.RV)("beforeinput",(t,a)=>{if(!n||!e)return!1;let{key:i,onTrigger:l}=e;if(a.data===i){let{from:e,to:n}=t.state.selection,i=t.state.doc.textBetween(e-1,n);return(!!/^\s*$/.exec(i)||0===i.length)&&(a.preventDefault(),l(n),!0)}})})(o,{enabled:n}),(0,a.jsx)("div",{ref:r,className:s?"Editor-indented":void 0,style:{"--first-line-indentation":null!=s?s:"0px"}})}},23192:(e,t,n)=>{n.d(t,{W:()=>a});let a=e=>"Backspace"===e.key||"Backspace"===e.code||8===e.keyCode},23661:(e,t,n)=>{n.d(t,{s:()=>a}),n(6343);var a=n(69904)},25211:(e,t,n)=>{n.d(t,{HA:()=>c,NP:()=>s,NU:()=>i,UI:()=>u,VI:()=>d,a0:()=>a,aj:()=>o});let a=["image","document","spreadsheet","text"],i=[...a,"audio"];[...i];let l=["py","js","md","html","json","jsonl","txt","ts","sh"],r=["pdf","docx","pptx"],s={image:[{mime:"image/png",extension:"png"},{mime:"image/gif",extension:"gif"},{mime:"image/jpeg",extension:"jpeg"},{mime:"image/jpg",extension:"jpg"},{mime:"image/webp",extension:"webp"}],document:[{mime:"application/pdf",extension:"pdf"},{mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",extension:"docx"},{mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation",extension:"pptx"}],spreadsheet:[{mime:"text/csv",extension:"csv"},{mime:"text/comma-separated-values",extension:"csv"},{mime:"application/csv",extension:"csv"},{mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",extension:"xlsx"}],text:[{extension:"txt",mime:"text/plain"},{extension:"json",mime:"application/json"},{extension:"jsonl",mime:"application/jsonlines"},{extension:"html",mime:"text/html"},{extension:"js",mime:"application/javascript"},{extension:"md",mime:"text/markdown"},{extension:"md",mime:"text/x-markdown"},{extension:"py",mime:"text/x-python"},{extension:"ts",mime:"application/typescript"},{extension:"sh",mime:"application/x-sh"}]};function o(e){return i.includes(e)}function c(e){return void 0!==e&&(l.includes(e)||r.includes(e))}function d(e){return"unsupported"===e.type}function u(e,t){return e.filter(e=>e.type===t)}},28504:(e,t,n)=>{n.d(t,{Q$:()=>d,QC:()=>o,dd:()=>c,i_:()=>u});var a=n(64784),i=n(93706),l=n(8424),r=n(91518),s=n(28008);let o="flex flex-col items-start p-0",c={side:"bottom",sideOffset:20},d=e=>{let{title:t,description:n,displayFlashStatus:r}=e,o=(0,i.c3)("Chat");return(0,a.jsxs)("div",{className:"flex flex-col gap-2 px-3 py-3",children:[(0,a.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,a.jsx)(s.r6,{weight:"medium",children:t}),r&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.Hxo,{}),(0,a.jsx)(s.r6,{weight:"medium",className:"text-basic-yellow-accent",children:o("features.with_flash_info")})]})]}),(0,a.jsx)(s.r6,{variant:"muted",children:n})]})},u=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:(0,r.e5)({colorScheme:"cyan"}).base({className:"h-fit min-h-8 w-full justify-center rounded-none text-wrap whitespace-normal"}),children:t})}},29453:(e,t,n)=>{n.d(t,{c:()=>L});var a=n(64784),i=n(5936),l=n(6016),r=n(55936),s=n(38178),o=n(63929),c=n.n(o),d=n(93706),u=n(8380),m=n(14455),p=n(18544),h=n(91518),g=n(75429),f=n(801),x=n(28008),v=n(30063),b=n(83403),_=n(3171),y=n(8866),j=n(64371),E=n(30817),N=n(8424),A=n(19494),I=n(93339);let w=()=>(0,a.jsx)(a.Fragment,{children:Array.from({length:3}).map((e,t)=>(0,a.jsx)(N.EAD,{className:"mb-2 h-6 w-full"},"int-skeleton-".concat(t)))}),T=e=>{let{disabled:t,disableReason:n,filter:i,agent:l}=e,r=(0,d.c3)("Chat"),{availableIntegrationData:s,isLoading:o,selectedIntegrations:c}=(0,A.mr)(),m=s.length>0,p=(0,j.Ym)(),h=(0,E.ad)(p)?p:E.rc.en,g=(0,u.useCallback)(e=>{var t;return!!(!i||e.name.toLowerCase().includes(i.toLowerCase()))||null!=(t=e.locale)&&!!t.name&&!!e.locale.name[h]&&e.locale.name[h].toLowerCase().includes(i.toLowerCase())},[i,h]),[f]=(0,u.useState)(()=>c),x=(0,u.useMemo)(()=>s.length?[...s].sort((e,t)=>{var n,a,i,l;let r=e.computedIntegrationInfo,s=t.computedIntegrationInfo,o=f.includes(e.id),c=f.includes(t.id);if(o&&!c)return -1;if(!o&&c)return 1;if(r.isActive&&!s.isActive)return -1;if(!r.isActive&&s.isActive)return 1;if(r.isReady&&!s.isReady)return -1;if(!r.isReady&&s.isReady)return 1;if(r.isConnected&&!s.isConnected)return -1;if(!r.isConnected&&s.isConnected)return 1;if(!r.isCustomIntegration&&s.isCustomIntegration)return -1;if(r.isCustomIntegration&&!s.isCustomIntegration)return 1;if(!r.isMCPIntegration&&s.isMCPIntegration)return -1;if(r.isMCPIntegration&&!s.isMCPIntegration)return 1;let d=(null==(a=e.locale)||null==(n=a.name)?void 0:n[h])||e.name,u=(null==(l=t.locale)||null==(i=l.name)?void 0:i[h])||t.name;return d.localeCompare(u,h,{sensitivity:"base"})}):[],[s,h,f]),v=(0,u.useMemo)(()=>x.filter(g),[x,g]);return o?(0,a.jsx)(w,{}):(0,a.jsx)(a.Fragment,{children:m?(0,a.jsx)(a.Fragment,{children:v.map(e=>(0,a.jsx)(I.VQ,{disabled:t,disableReason:n,agent:l,integration:e.computedIntegrationInfo},e.id))}):(0,a.jsx)("div",{className:"m-1 text-xs text-brand-600",children:r("message_input.no_integrations")})})};var C=n(13101),S=n(35263);let R="@2xl:min-w-0 @2xl:flex-1 @2xl:overflow-y-auto @2xl:pb-4",D=()=>{let e=(0,d.c3)("Chat"),[t,n]=(0,u.useState)(!1),{selectedIntegrations:s,setSelectedIntegrations:o}=(0,A.mr)(),{track:m}=(0,y.n)(),p=(0,u.useCallback)(()=>{o([]),m(y.f.MESSAGE_INPUT_FEATURES_DESELECTION,{feature:"reset_all"})},[o,m]),f=s.length>0;return(0,a.jsx)("div",{className:(0,v.cn)("sticky top-0 z-10 bg-inherit pt-4 pb-1"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(c(),{href:"/connections",className:(0,v.cn)("w-fit","flex items-center",(0,x.M0)({size:"sm",variant:"hint"}),"hover:text-default"),onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[(0,a.jsx)(x.o5,{size:"sm",children:e("integrations.label")}),(0,a.jsx)(i.N,{children:t&&(0,a.jsx)(l.P.div,{initial:{width:0},animate:{width:"auto"},exit:{width:0},transition:{duration:.1,delay:.1},className:"flex justify-end overflow-hidden",children:(0,a.jsx)(r.A,{className:"ms-1 size-4"})})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[f&&(0,a.jsx)(g.$n,{variant:"ghost",size:"xs",onClick:p,isDisabled:!f,title:"Reset selections",className:(0,v.cn)("h-auto min-h-0 px-2 py-0.5 font-light text-(--bg-basic-blue-strong)",(0,x.M0)({size:"sm"})),children:"Reset"}),(0,a.jsx)(h.Ex,{colorScheme:"cyan",className:"text-xs",children:"Beta"})]})]})})},O=e=>{let{disabled:t,agent:n,session:i,filter:l}=e,{features:r,allowedFeatures:s,isLoading:o,selectedFeatures:c,setSelectedFeatures:d}=(0,A.mr)(),h=(0,S.P)(),{track:g}=(0,y.n)(),f=(0,u.useCallback)(e=>{let t=!c.includes(e);o||(t?(d(Array.from(new Set([...c,e]))),g(y.f.MESSAGE_INPUT_FEATURES_SELECTION,{feature:e})):(d(c.filter(t=>t!==e)),g(y.f.MESSAGE_INPUT_FEATURES_DESELECTION,{feature:e})))},[o,c,d,g]),x=(0,m.E)(p.s2,r).filter(e=>{if(!l)return!0;let t=h[e].name.toLowerCase()||"",n=h[e].description.toLowerCase()||"",a=l.toLowerCase();return t.includes(a)||n.includes(a)});return(0,a.jsx)(a.Fragment,{children:x.map(e=>{var l;return(0,a.jsx)(C.s,{feature:e,disabled:t||!s.includes(e)||(null==n||null==(l=n.features)?void 0:l.includes(e)),onClick:()=>f(e),allowed:s.includes(e),Icon:S.A[e],label:h[e].name,subLabel:h[e].description,session:i},e)})})},L=e=>{var t;let{session:n,disabled:i,agent:l,className:r}=e,{features:o}=(0,A.mr)(),c=(0,d.c3)("Chat"),[m,h]=(0,u.useState)(""),g=o.filter(p.DS).length>0,y=(null==(t=(0,b.m)().data)?void 0:t.connector_tool_call.remainingPoints)===0,j=g||n;return(0,a.jsxs)(_.W2,{className:(0,v.cn)("@container flex w-full flex-col bg-card",r),children:[j&&(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1 border-b-1 border-default px-4 py-2",children:[(0,a.jsx)(s.A,{className:"size-4 text-muted"}),(0,a.jsx)(f.pd,{placeholder:c("features.search_placeholder"),value:m,onChange:e=>h(e.target.value),className:"h-8 text-sm text-default placeholder:text-hint",variant:"unstyled"})]}),(0,a.jsxs)("div",{className:(0,v.cn)("flex h-full w-full flex-col justify-start gap-4 overflow-y-scroll bg-inherit","@2xl:flex-row @2xl:gap-0 @2xl:overflow-auto",_.U7),children:[g&&(0,a.jsxs)(_.$3,{className:R,children:[(0,a.jsx)(x.o5,{variant:"hint",size:"sm",className:"sticky top-0 z-10 bg-inherit pt-4 pb-1",children:c("features.label")}),(0,a.jsx)(O,{disabled:i,agent:l,session:n,filter:m})]}),n&&g&&(0,a.jsx)("div",{className:"border-e-1 border-b-1 border-default"}),n&&(0,a.jsxs)(_.$3,{className:R,children:[(0,a.jsx)(D,{}),(0,a.jsx)(T,{disabled:i||y,disableReason:y?"connector_tools_rate_limit":void 0,agent:l,filter:m})]})]},"feature-selection")]})}},35102:(e,t,n)=>{n.d(t,{d:()=>N,F:()=>f});var a=n(64784);n(46070);var i=n(6016),l=n(52614),r=n(93706),s=n(8380),o=n(25211),c=n(8424),d=n(75429),u=n(88318),m=n(30063),p=n(6974),h=n(94654);function g(e){let{src:t,alt:n}=e,[i,l]=(0,s.useState)(!1);return(0,a.jsx)(h.p,{src:i?p._.NEXT_PUBLIC_CHAT_IMAGE_PLACEHOLDER:t,className:"h-full max-h-full w-full max-w-full",children:(0,a.jsx)("img",{src:i?p._.NEXT_PUBLIC_CHAT_IMAGE_PLACEHOLDER:t,alt:n,className:"h-full max-h-full w-full max-w-full rounded-md object-cover",onError:()=>l(!0)})})}let f={py:"bg-(--blue-700)",js:"bg-(--yellow-500)",md:"bg-(--neutral-900)",css:"bg-(--blue-500)",html:"bg-(--orange-500)",json:"bg-(--emerald-500)",jsonl:"bg-(--emerald-500)",xml:"bg-(--green-500)",txt:"bg-(--neutral-900)",docx:"bg-(--blue-500)",pdf:"bg-(--rose-500)",pptx:"bg-(--orange-600)",ts:"bg-(--blue-600)",java:"bg-(--orangebright-600)",c:"bg-(--slate-600)",cpp:"bg-(--bluedeep-700)",cs:"bg-(--purple-600)",php:"bg-(--purpledeep-600)",rb:"bg-(--rose-600)",swift:"bg-(--orangebright-500)",kt:"bg-(--bluedeep-500)",go:"bg-(--sky-600)",rs:"bg-(--orange-700)",scala:"bg-(--rose-500)",r:"bg-(--blue-500)",dart:"bg-(--sky-500)",clj:"bg-(--green-600)",hs:"bg-(--purpledeep-500)",erl:"bg-(--red-600)",lua:"bg-(--blue-400)",jl:"bg-(--teal-500)",pl:"bg-(--blue-700)",m:"bg-(--yellowbright-600)",sql:"bg-(--cyan-600)",sh:"bg-(--green-700)",ps1:"bg-(--bluedeep-500)",groovy:"bg-(--green-500)",coffee:"bg-(--yellow-600)",fs:"bg-(--bluedeep-400)",ml:"bg-(--orange-500)",rkt:"bg-(--purple-700)",sol:"bg-(--cyan-700)",vy:"bg-(--green-500)",zig:"bg-(--orange-600)",nim:"bg-(--yellow-600)",cr:"bg-(--red-500)",v:"bg-(--bluedeep-600)",d:"bg-(--red-700)",elm:"bg-(--teal-600)",re:"bg-(--orangebright-600)",purs:"bg-(--purple-600)",idr:"bg-(--bluedeep-700)",agda:"bg-(--purpledeep-600)",coq:"bg-(--purpledeep-700)",lean:"bg-(--bluedeep-800)",red:"bg-(--red-500)",factor:"bg-(--green-600)",forth:"bg-(--yellow-700)",st:"bg-(--purple-500)",apl:"bg-(--cyan-500)",j:"bg-(--blue-600)",k:"bg-(--cyan-700)",q:"bg-(--blue-800)",glsl:"bg-(--orange-600)",hlsl:"bg-(--orangebright-600)",wasm:"bg-(--yellowbright-500)",graphql:"bg-(--pinkdeep-600)",ahk:"bg-(--green-600)",au3:"bg-(--green-700)",bat:"bg-(--gray-700)",vbs:"bg-(--purple-700)",logo:"bg-(--green-500)",pde:"bg-(--blue-500)",sb:"bg-(--orange-500)",yaml:"bg-(--yellow-600)",toml:"bg-(--yellow-500)",ini:"bg-(--gray-600)",tex:"bg-(--slate-600)",abap:"bg-(--bluedeep-700)",ada:"bg-(--slate-700)",apex:"bg-(--blue-700)",asm:"bg-(--red-700)",cob:"bg-(--gray-700)",ex:"bg-(--purple-600)",f90:"bg-(--orange-700)",lisp:"bg-(--purpledeep-600)",pas:"bg-(--yellow-700)",plsql:"bg-(--orangebright-700)",tsql:"bg-(--cyan-700)",vb:"bg-(--blue-600)",less:"bg-(--blue-600)",scss:"bg-(--pink-600)",sass:"bg-(--pink-700)",styl:"bg-(--purple-500)"};function x(e){let{children:t,onDelete:n,deleteMessage:i}=e,r=(0,a.jsx)(d.$n,{onClick:n,className:"absolute -end-3 -top-3 z-10 h-6 w-6 rounded-full border-2 border-background p-0",children:(0,a.jsx)(l.A,{className:"size-3"})});return(0,a.jsxs)("div",{className:"relative rounded-md border border-default bg-muted",children:[t,n&&(i?(0,a.jsxs)(u.m_,{children:[(0,a.jsx)(u.k$,{asChild:!0,children:r}),(0,a.jsx)(u.ZI,{side:"top",children:i&&(0,a.jsx)("p",{children:i})})]}):r)]})}function v(e){var t,n;let{file:i,deleteMessage:l,onDelete:s,alt:o}=e,c=(0,r.c3)("Chat");return i.url===p._.NEXT_PUBLIC_CHAT_IMAGE_PLACEHOLDER?(0,a.jsxs)(u.m_,{children:[(0,a.jsx)(u.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"m-1.5 h-20 w-32",children:(0,a.jsx)("img",{src:p._.NEXT_PUBLIC_CHAT_IMAGE_PLACEHOLDER,className:"h-full max-h-full w-full max-w-full rounded-md object-cover",alt:o})})}),(0,a.jsx)(u.ZI,{children:(0,a.jsx)("p",{children:c("message.image_placeholder")})})]}):(0,a.jsx)(x,{deleteMessage:l,onDelete:s,children:(0,a.jsx)("div",{className:"m-1.5 h-20 w-32",children:(0,a.jsx)(g,{src:null!=(n=null!=(t=i.url)?t:i.b64Data)?n:p._.NEXT_PUBLIC_CHAT_IMAGE_PLACEHOLDER})})})}function b(e){var t;let{file:n,fileTag:i,deleteMessage:l,openFile:r,onDelete:o}=e,d=(0,s.useCallback)(async()=>{let e;if(n.data)e=n.data;else if(n.url){let t=await fetch(n.url);e=await t.blob()}if(e){let t=URL.createObjectURL(e);try{let e=document.createElement("a");e.href=t,r?window.open(t,"_blank"):(e.target="_blank",e.download=n.name||"document",e.click())}finally{URL.revokeObjectURL(t)}}},[n.url,n.data,n.name]);return(0,a.jsx)(x,{deleteMessage:l,onDelete:o,children:(0,a.jsxs)("div",{className:"flex cursor-pointer items-center gap-3 py-1.5 ps-2 pe-4",onClick:d,children:[void 0!==i?i:(0,a.jsx)(y,{}),(0,a.jsx)("div",{className:"text-sm leading-6 font-medium",children:(0,a.jsx)(c.ec,{children:null!=(t=n.name)?t:"Document"})})]})})}function _(e){let{onDelete:t}=e,n=(0,r.c3)("Chat");return(0,a.jsx)(x,{deleteMessage:n("audio.actions.delete_recording"),onDelete:t,children:(0,a.jsxs)("div",{className:"flex items-center gap-3 py-1.5 ps-2 pe-4",children:[(0,a.jsx)(j,{}),(0,a.jsx)("div",{className:"text-sm leading-6 font-medium",children:n("audio.audio_recording")})]})})}function y(){let e=(0,r.c3)("Chat");return(0,a.jsx)("div",{className:"rounded-md bg-(--grey-500) px-2 text-xs leading-6 font-semibold",children:e("file_display.default")})}function j(){let e=(0,r.c3)("Chat");return(0,a.jsx)("div",{className:"rounded-md bg-(--purple-500) px-2 text-xs leading-6 font-semibold text-inverted-default",children:e("file_display.audio")})}let E=e=>{let{children:t}=e;return(0,a.jsx)(i.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.1},children:t})};function N(e){let{file:t,deleteMessage:n,onDelete:i,fileTag:l}=e;switch(t.type){case"image":return(0,a.jsx)(E,{children:(0,a.jsx)(v,{file:t,onDelete:i,deleteMessage:n})});case"spreadsheet":return(0,a.jsx)(E,{children:(0,a.jsx)(b,{onDelete:i,deleteMessage:n,file:t,fileTag:null!=l?l:function(){let e=(0,r.c3)("Chat");return(0,a.jsx)("div",{className:"rounded-md bg-(--green-500) px-2 text-xs leading-6 font-semibold text-inverted-default",children:e("file_display.spreadsheet")})}()})});case"document":case"text":{let e;return t.name&&(e=t.name.split(".").pop()),(0,a.jsx)(E,{children:(0,a.jsx)(b,{fileTag:null!=l?l:void 0!==e?function(e){let t=(0,o.HA)(e)?f[e]:"bg-(--blue-500)";return(0,a.jsx)("div",{className:(0,m.cn)("rounded-md px-2 text-xs leading-6 font-semibold text-inverted-default",t),children:e.toUpperCase()})}(e):y(),onDelete:i,deleteMessage:n,file:t})})}case"audio_recording":return(0,a.jsx)(E,{children:(0,a.jsx)(_,{onDelete:i})});case"other":return(0,a.jsx)(E,{children:(0,a.jsx)(b,{fileTag:null!=l?l:y(),onDelete:i,deleteMessage:n,file:t})});case"audio":case"unsupported":return null}}},35263:(e,t,n)=>{n.d(t,{A:()=>o,P:()=>c});var a=n(65007),i=n(83407),l=n(17584),r=n(57073),s=n(93706);let o={"beta-websearch":a.A,"beta-imagegen":i.A,"beta-trampoline":l.A,"beta-code-interpreter":r.A},c=()=>{let e=(0,s.c3)("Chat");return{"beta-websearch":{name:e("features.websearch.name"),description:e("features.websearch.description")},"beta-imagegen":{name:e("features.imagegen.name"),description:e("features.imagegen.description")},"beta-trampoline":{name:e("features.canvas.name"),description:e("features.canvas.description")},"beta-code-interpreter":{name:e("features.codeinterpreter.name"),description:e("features.codeinterpreter.description")}}}},36168:(e,t,n)=>{n.d(t,{T:()=>a});var a=function(e){return e[e.QUOTA_UNREACHABLE_BACKEND=1100]="QUOTA_UNREACHABLE_BACKEND",e[e.QUOTA_INCOMPLETE_RESPONSE=1110]="QUOTA_INCOMPLETE_RESPONSE",e[e.QUOTA_UNKNOWN_CONSUMER=1200]="QUOTA_UNKNOWN_CONSUMER",e[e.QUOTA_INVALID_MODEL=1500]="QUOTA_INVALID_MODEL",e[e.QUOTA_MISCONFIGURED_MODEL=1600]="QUOTA_MISCONFIGURED_MODEL",e[e.QUOTA_INVALID_AGENT=1700]="QUOTA_INVALID_AGENT",e[e.QUOTA_INVALID_TOOLS=1800]="QUOTA_INVALID_TOOLS",e[e.QUOTA_INVALID_INTEGRATION=1900]="QUOTA_INVALID_INTEGRATION",e[e.QUOTA_INVALID_DOCUMENT_TYPE=1901]="QUOTA_INVALID_DOCUMENT_TYPE",e[e.HARMATTAN_DOCUMENT_PARSER_INTERNAL_SERVER_ERROR=3700]="HARMATTAN_DOCUMENT_PARSER_INTERNAL_SERVER_ERROR",e[e.HARMATTAN_DOCUMENT_PARSER_UNAVAILABLE=3710]="HARMATTAN_DOCUMENT_PARSER_UNAVAILABLE",e[e.HARMATTAN_DOCUMENT_PARSER_TIMEOUT=3720]="HARMATTAN_DOCUMENT_PARSER_TIMEOUT",e[e.HARMATTAN_DOCUMENT_TOO_LARGE=3730]="HARMATTAN_DOCUMENT_TOO_LARGE",e[e.HARMATTAN_INVALID_DOCUMENT_TYPE=3310]="HARMATTAN_INVALID_DOCUMENT_TYPE",e[e.CHAT_STREAM_INTERRUPTED=6e3]="CHAT_STREAM_INTERRUPTED",e[e.CHAT_STREAM_FINISHED_ON_TOOL_CALL=6001]="CHAT_STREAM_FINISHED_ON_TOOL_CALL",e[e.CHAT_STREAM_FRONT_END=6002]="CHAT_STREAM_FRONT_END",e[e.CHAT_REQUEST_UNKNOWN_ERROR=6100]="CHAT_REQUEST_UNKNOWN_ERROR",e[e.CHAT_REQUEST_SERVER_VALIDATION_FAILED=6101]="CHAT_REQUEST_SERVER_VALIDATION_FAILED",e[e.CHAT_REQUEST_CREATION_FAILED=6102]="CHAT_REQUEST_CREATION_FAILED",e[e.CHAT_REQUEST_REQUEST_TOO_LARGE=6103]="CHAT_REQUEST_REQUEST_TOO_LARGE",e[e.CHAT_MESSAGE_LIMIT_REACHED=6200]="CHAT_MESSAGE_LIMIT_REACHED",e[e.CHAT_NOT_FOUND=6300]="CHAT_NOT_FOUND",e[e.CHAT_AGENT_NOT_FOUND=6301]="CHAT_AGENT_NOT_FOUND",e[e.CHAT_MESSAGE_ALREADY_EXISTS=6400]="CHAT_MESSAGE_ALREADY_EXISTS",e[e.CHAT_REQUEST_VALIDATION_FAILED_INTEGRATION_NOT_USABLE=6104]="CHAT_REQUEST_VALIDATION_FAILED_INTEGRATION_NOT_USABLE",e[e.CHAT_REQUEST_VALIDATION_FAILED_INTEGRATION_WITHOUT_SESSION=6105]="CHAT_REQUEST_VALIDATION_FAILED_INTEGRATION_WITHOUT_SESSION",e[e.CHAT_REQUEST_VALIDATION_FAILED_NO_TOOLS_SUPPORT=6106]="CHAT_REQUEST_VALIDATION_FAILED_NO_TOOLS_SUPPORT",e[e.CHAT_REQUEST_VALIDATION_FAILED_NO_CONNECTOR_SUPPORT=6107]="CHAT_REQUEST_VALIDATION_FAILED_NO_CONNECTOR_SUPPORT",e[e.CHAT_REQUEST_CLIENT_VALIDATION_FAILED=6108]="CHAT_REQUEST_CLIENT_VALIDATION_FAILED",e}({})},36901:(e,t,n)=>{n.d(t,{h:()=>r});var a=n(60126),i=n(83989),l=n(78135);let r=new a.Sj({nodes:i.wQ.spec.nodes.remove("image").remove("code_block").addToEnd(l.lf,l.Vo)})},42708:(e,t,n)=>{n.d(t,{XK:()=>p,bB:()=>d,Zn:()=>h});var a=n(54122),i=n(26235),l=n(24168),r=n(25211),s=n(35111),o=n(98346).hp;async function c(e){return new Promise((t,n)=>{let a=new FileReader;a.onloadend=()=>t(a.result),a.onerror=n,a.readAsDataURL(e)})}async function d(e){return e=await u(e),new Promise((t,n)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>{if("string"!=typeof a.result)return n(Error("FileReader result is not a string"));t(a.result)},a.onerror=e=>{n(e)}})}async function u(e){var t;let n=await e.arrayBuffer(),a=await (0,i.BI)(n);return(null!=(t=null==a?void 0:a.mime)?t:e.type)==="image/gif"?await m(e):e}async function m(e){let t=await e.arrayBuffer(),n=(0,l.O5)(t),a=(0,l.Ud)(n,!0)[0];if(!a)throw Error("GIF file contains no frames to process");let i=new ImageData(a.patch,a.dims.width,a.dims.height),r=new OffscreenCanvas(a.dims.width,a.dims.height),s=r.getContext("2d");if(!s)throw Error("Failed to get 2D rendering context");return s.putImageData(i,0,0),new File([await r.convertToBlob({type:"image/png"})],e.name,{type:"image/png"})}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio",n=await (0,i.iS)(e);if(!n)throw Error("Could not determine type of audio file");let a=new File([e],"".concat(t,".").concat(n.ext),{type:e.type||n.mime,lastModified:Date.now()}),l=await c(e);return{type:"audio",name:a.name,mimeType:a.type,data:a,b64Data:l}}async function h(e,t){let n=e=>({image:e,document:e,spreadsheet:e,text:e,audio:e}),i=n(0),l=n([]);e.forEach(e=>{if(!e.url){if(!e.data)throw Error("No file data to upload");i[e.type]+=1}});let c=Object.keys(i);return await Promise.all(c.map(async e=>{let n=i[e];if(0!==n)try{let t=await s.u.file.uploadFile.mutate({type:e,count:n});l[e]=t.uploadURLs}catch(e){if(e instanceof a.HN){var r;throw Error(e instanceof a.HN&&(null==(r=e.data)?void 0:r.code)==="TOO_MANY_REQUESTS"?t("files.upload_file_error.rate_limit_exceeded"):t("files.upload_file_error.unknown"))}throw e}})),await Promise.all(e.map(async e=>{if(e.url)return e;let t=l[e.type].pop();if(!t)throw Error("Failed to get upload URL for file type: ".concat(e.type));if(!(0,r.aj)(e.type))throw Error("Unsupported file type: ".concat(e.type));if(!e.mimeType)throw Error("File of type ".concat(e.type," is missing MIME type"));let n=await fetch(t,{method:"PUT",headers:{"Content-Type":e.mimeType,"x-ms-blob-type":"BlockBlob"},body:function(e){if(e.b64Data){let t=e.b64Data.replace(/data:.*;base64,/,"");return o.from(t,"base64")}return e.data?e.data:null}(e)});if(!n.ok)throw Error("".concat(e.type," upload failed with status: ").concat(n.status));return{...e,url:t}}))}},44960:(e,t,n)=>{n.d(t,{$n:()=>A,NA:()=>k,Pc:()=>C,VK:()=>T,xL:()=>I});var a=n(64784),i=n(5936),l=n(6016),r=n(5508),s=n(4422),o=n(9624),c=n(38178),d=n(63929),u=n.n(d),m=n(93706),p=n(8380),h=n(42573),g=n(75429),f=n(801),x=n(88318),v=n(28008),b=n(30063),_=n(3171),y=n(6974),j=n(8866),E=n(21413),N=n(72617);let A=e=>{let{id:t,placeholder:n,className:i}=e,l=(0,b.Zh)(t);return(0,a.jsx)("span",{className:(0,b.cn)("inline-block h-5 w-5 shrink-0 content-center rounded-4 align-middle",l,n?"bg-(--text-placeholder)":"",i),children:(0,a.jsx)(r.A,{className:(0,b.cn)((0,v.M0)({variant:"inverted"}),"h-4/7 w-4/7","m-auto block","align-middle")})})},I=e=>{let{track:t}=(0,j.n)(),{activeLibrarySelection:n,toggleLibrarySelection:a,setSelectedLibrary:i}=(0,E.TY)(),l=(0,h.DK)(e=>{if(n.includes(e))return void i([]);i([e]),t(j.f.MESSAGE_INPUT_DOCUMENT_LIBRARY_SELECTION,{id:e})});return 1===e?l:a},w=e=>{var t,n,i,l,r,o,c;let{label:d,id:u,disabled:p,placeholder:h,hideSelectionStatus:f,agent:x,libraryBrowseEnabled:v,onLibraryBrowse:b}=e,j=(0,m.c3)("Chat"),{availableLibrariesLoading:N}=(0,E.TY)(),w=null!=(l=y._.NEXT_PUBLIC_MAX_LIBRARIES_SELECTION)?l:1,{activeLibrarySelection:T}=(0,E.TY)(),C=T.includes(u),S=null!=(r=null==x||null==(t=x.libraries)?void 0:t.includes(u))&&r,R=1===w?!C&&(null!=(o=null==x||null==(n=x.libraries)?void 0:n.length)?o:0)>=w:!C&&T.length>=w,D=null!=p&&p||null!=h&&h||N||S||R||!C&&(null!=(c=null==x||null==(i=x.libraries)?void 0:i.length)?c:0)>=w,O=I(w);return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(_.tO,{tailDisplay:!f&&(w>1?"checkbox":"radio"),active:C,disabled:D,isPlaceholder:h,leadIcon:(0,a.jsx)(A,{id:u,placeholder:h}),label:d,onClick:()=>{O(u)},tooltip:S?j("files.document_library.cant_unselect_active_library"):R?j("files.document_library.cant_add_more_libraries",{maxLibrarySelection:w}):void 0}),v&&(0,a.jsx)(g.$n,{variant:"ghost",mode:"icon-only",icon:s.A,onClick:()=>null==b?void 0:b()})]})},T=e=>{var t;let{label:n,id:i,disabled:l,placeholder:r,hideSelectionStatus:s,className:o}=e,{availableLibrariesLoading:c}=(0,E.TY)(),d=null!=(t=y._.NEXT_PUBLIC_MAX_LIBRARIES_SELECTION)?t:1,{activeLibrarySelection:u}=(0,E.TY)(),m=u.includes(i),p=1!==d&&!m&&u.length>=d,h=null!=l&&l||null!=r&&r||c||p;return(0,a.jsx)(_.vy,{className:o,tailDisplay:!s&&(d>1?"checkbox":"radio"),active:m,disabled:h,isPlaceholder:r,leadIcon:(0,a.jsx)(A,{id:i,placeholder:r}),label:n})},C=e=>{let{label:t,id:n,disabled:i,placeholder:l,className:r,mode:o}=e;return(0,a.jsx)(_.vy,{className:r,disabled:null!=i&&i||null!=l&&l,isPlaceholder:l,leadIcon:(0,a.jsx)(A,{id:n,placeholder:l}),label:t,tailDisplay:"browse"===o?(0,a.jsx)(s.A,{}):void 0})},S="/libraries",R=()=>{let e=(0,m.c3)("Chat");return(0,a.jsxs)(x.m_,{children:[(0,a.jsx)(x.k$,{asChild:!0,children:(0,a.jsx)(u(),{href:S,children:(0,a.jsx)(g.$n,{variant:"ghost",mode:"icon-only",icon:o.A})})}),(0,a.jsx)(x.ZI,{side:"bottom",children:e("files.document_library.view_libraries")})]})},D=e=>{let{onSearchChange:t,loading:n,className:i,hideCreateLibrary:l}=e,r=(0,m.c3)("Chat"),{track:s}=(0,j.n)();return(0,a.jsxs)("div",{className:(0,b.cn)("flex items-center gap-2 bg-inherit",i),children:[(0,a.jsxs)(f.A0,{variant:"default",className:(0,b.cn)("grow",N.x),children:[(0,a.jsx)(f.QX,{icon:c.A}),(0,a.jsx)(f.pd,{type:"search",isDisabled:n,placeholder:r("files.document_library.search_placeholder"),onChange:e=>t(e.target.value),onBlur:e=>(e=>{0!==e.length&&s(j.f.MESSAGE_INPUT_DOCUMENT_LIBRARY_SEARCH,{search:e})})(e.target.value)})]}),!l&&(0,a.jsx)(R,{})]})},O=()=>(0,a.jsx)(a.Fragment,{children:Array.from({length:5}).map((e,t)=>(0,a.jsx)(w,{label:"",id:"".concat(t),placeholder:!0},"lib-skeleton-".concat(t)))}),L=()=>{let e=(0,m.c3)("Chat");return(0,a.jsxs)("div",{className:"my-4 flex h-full flex-1 grow flex-col items-center justify-center gap-2",children:[(0,a.jsx)(v.o5,{variant:"hint",size:"sm",children:e("files.document_library.no_libraries")}),(0,a.jsx)(u(),{href:S,children:(0,a.jsxs)(g.$n,{variant:"soft",onClick:()=>{},children:[e("files.document_library.create_library"),(0,a.jsx)(g.qF,{icon:o.A})]})})]})},P=()=>{let e=(0,m.c3)("Chat");return(0,a.jsx)("div",{className:"my-4 flex h-full flex-1 grow flex-col items-center justify-center gap-2",children:(0,a.jsx)(v.o5,{variant:"hint",size:"sm",children:e("files.document_library.no_libraries_found")})})},k=e=>{let{agent:t,libraryBrowseEnabled:n,onLibraryBrowse:r}=e,[s,o]=(0,p.useState)(""),{availableLibraries:c,availableLibrariesLoading:d}=(0,E.TY)(),u=c.filter(e=>e.name.toLowerCase().includes(s.toLowerCase()));return(0,a.jsxs)(_.$3,{className:"mt-3 h-full overflow-y-auto bg-inherit pb-4",children:[(0,a.jsx)(i.N,{children:!d&&c.length>0&&(0,a.jsx)(l.P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.1,ease:"easeInOut"},className:"sticky top-0 z-10 bg-inherit text-sm text-subtle",children:(0,a.jsx)(D,{className:"py-1 text-sm text-subtle",loading:d,onSearchChange:o})})}),d&&(0,a.jsx)(O,{}),!d&&c.length>0&&u.map(e=>(0,a.jsx)(w,{label:e.name,id:e.id,agent:t,libraryBrowseEnabled:n,onLibraryBrowse:()=>null==r?void 0:r(e.id)},e.id)),!d&&0===c.length&&(0,a.jsx)(L,{}),!d&&c.length>0&&0===u.length&&(0,a.jsx)(P,{})]})}},47799:(e,t,n)=>{n.d(t,{A:()=>g});var a=n(64784),i=n(93706),l=n(8380),r=n(97561),s=n(8424),o=n(21413),c=n(12330),d=n(69957),u=n(35111),m=n(42708),p=n(77515),h=n(79373);function g(e){let{chatId:t,messages:n,initialChatAgentId:g,initialChatAgentsApiAgentId:f,session:x,onSubmit:v,onSubmitFailed:b,onNewChatCreated:_,incognito:y=!1,ref:j,projectId:E,onAgentChange:N,enableSuggestions:A,...I}=e,[w,T]=(0,l.useState)(!1);(0,l.useImperativeHandle)(j,()=>({isCreatingChat:w}));let C=(0,i.c3)("Chat"),S=u.api.useUtils(),R=u.api.message.newChat.useMutation({onError:e=>{s.oRP.error(C("message_input.sending_failed")),console.error(e),T(!1)},async onSettled(){await S.chat.last.invalidate({chatVisibility:r.jZ.PRIVATE,chatPermission:r.Jj.WRITE})}}),D=(0,p.r)(),{activeLibrarySelection:O}=(0,o.TY)(),L=(0,l.useCallback)(async function(e){var a,i,l,r;let o,{value:c,model:d,agentId:u,agentsApiAgentId:p,features:h,integrations:g,hasPastedText:f}=e;if(c.canva&&!(null==h?void 0:h.includes("beta-trampoline")))return void s.oRP.error(C("canvas.feature_required"));T(!0);let j=c.inputValue;if(v&&v({messageInput:j,voiceInputUrl:c.voiceInputUrl,transcriptions:c.transcriptions,model:d,agentId:null!=u?u:null,agentsApiAgentId:null!=p?p:null,files:c.files.map(e=>({type:e.type,url:e.url,name:e.name,inlineFileId:e.inlinePositionId})),canva:c.canva,action:c.action}),c.files.length>0){if(!x)return;try{c.files=await (0,m.Zn)(c.files,C)}catch(e){s.oRP.error("".concat(e)),null==b||b(),T(!1);return}}let N=c.canva?{content:c.canva.content,type:c.canva.type,identifier:c.canva.identifier,options:null!=(i=c.canva.options)?i:{},title:null!=(l=c.canva.title)?l:"",id:c.canva.id}:void 0,A={content:j,voiceInput:c.voiceInputUrl?{url:c.voiceInputUrl}:void 0,audioRecording:(null==(a=c.transcriptions)?void 0:a.length)?c.transcriptions:void 0,agentId:null!=u?u:void 0,agentsApiAgentId:null!=p?p:void 0,files:c.files.map(e=>({type:e.type,url:e.url,name:e.name,inlineFileId:e.inlinePositionId})),isSampleChatForAgentId:D.agentId,model:d,features:h,integrations:g,canva:N,action:null!=(r=c.action)?r:void 0,libraries:O,projectId:E};o=t&&n?{...A,chatId:t,parentId:n.at(-1).id,parentVersion:n.at(-1).version}:{...A,incognito:y},R.mutate(o,{onSuccess:e=>{let{chatId:t}=e;_({chatId:t,hasPastedText:f})}})},[v,t,n,C,x,b,R,D.agentId,O,E,y,_]),P=function(e){let t=u.api.useUtils(),n=(0,c.useRouter)();return(0,l.useCallback)(()=>{var e,a;let i=null==(a=t.chat.last.getData({chatVisibility:d.j.PRIVATE,chatPermission:d.J.WRITE}))||null==(e=a.items.at(0))?void 0:e.id;i&&n.prefetch("/chat/".concat(i))},[void 0,n,t.chat.last])}();return(0,a.jsx)(h.A,{...I,defaultAgentsApiAgentId:null!=f?f:null,defaultAgentId:null!=g?g:null,onSubmit:L,isLoading:w,chatId:t,session:x,incognito:y,onChange:e=>{let{agentId:t}=e;P(),null==N||N(null!=t?t:null)},showSuggestions:!!A&&!w})}},49943:(e,t,n)=>{n.d(t,{Oq:()=>p,Qk:()=>d,Qr:()=>m,zZ:()=>c});var a=n(60126),i=n(1883),l=n(36901),r=n(78135);let s=i.Ik({type:i.eu("text"),content:i.Yj()}),o=i.Ik({type:i.eu("slash"),content:i.Ie(e=>"object"==typeof e&&"selectedValue"in e&&"selectedLabel"in e)}),c=i.KC([s,o]),d=i.YO(c),u=(e,t)=>{if(e.isText&&""!==e.text){var n;t({type:"text",content:null!=(n=e.text)?n:""})}else e.type.name===r.lf&&t({type:"slash",content:e.attrs}),"paragraph"===e.type.name&&t({type:"text",content:"\n"}),"hard_break"===e.type.name&&t({type:"text",content:"\n"}),e.content.forEach(e=>u(e,t))},m=e=>{var t,n;if(!e)return[];let a=[];for(u(e,e=>a.push(e));(null==(t=a[0])?void 0:t.type)==="text"&&(null==(n=a[0])?void 0:n.content)==="\n";)a.shift();return a},p=e=>{let t=a.FK.empty;if(0===e.length)return l.h.nodes.doc.create({},t.addToEnd(l.h.nodes.paragraph.create(null)));let n=l.h.nodes.paragraph.create();return e.flatMap(e=>{if("slash"===e.type)return[e];if("\n"===e.content)return[{type:"text",content:"\n"}];let t=e.content.split("\n");return 1===t.length?[e]:e.content.split("\n").flatMap((e,n)=>[{type:"text",content:e},...n!==t.length-1?[{type:"text",content:"\n"}]:[]])}).forEach(e=>{"text"===e.type&&("\n"===e.content?(t=t.addToEnd(n),n=l.h.nodes.paragraph.create()):""!==e.content&&(n=n.copy(n.content.addToEnd(l.h.text(e.content))))),"slash"===e.type&&(n=n.copy(n.content.addToEnd(l.h.nodes[r.lf].create(e.content))))}),t=t.addToEnd(n),l.h.nodes.doc.create({},t)}},54277:(e,t,n)=>{n.d(t,{E:()=>a});function a(e){return e}},54736:(e,t,n)=>{n.d(t,{N:()=>o});var a=n(64784),i=n(42573),l=n(75429),r=n(8492),s=n(9360);let o=e=>{let{children:t,onClick:n,path:o="/login",returnTo:c,size:d="xs",...u}=e,{desktopApi:m}=(0,r.A)(),{value:p,setTrue:h,setFalse:g}=(0,i.Cg)(!1);(0,i.Z3)(()=>{g()},p?1e3:null);let f=s.P.use.anonymousChatId(),x=null!=c?c:f?"/chat/".concat(f):void 0,v=x?"".concat(o,"?return_to=").concat(x):o;return(0,a.jsx)(l.$n,{isLoading:p,size:d,...u,onClick:()=>{h(),null==n||n(),m?m.login({returnTo:x}):window.location.href=v},children:t})}},68142:(e,t,n)=>{n.d(t,{v:()=>s,j:()=>r});var a=n(8380),i=n(25211),l=n(6974);let r=()=>(0,a.useMemo)(()=>(e=>{let t=[];return e["image-allowed"]&&t.push("image"),e["document-allowed"]&&t.push("document"),e["spreadsheet-allowed"]&&t.push("spreadsheet"),e["text-allowed"]&&t.push("text"),{supportedFileType:t,supportedFileExtension:[...new Set(t.flatMap(e=>i.NP[e].map(e=>e.extension)))],supportedFileMime:t.flatMap(e=>i.NP[e].map(e=>e.mime))}})({"document-allowed":!l._.NEXT_PUBLIC_DISABLE_UPLOAD_DOCUMENTS,"image-allowed":!l._.NEXT_PUBLIC_DISABLE_UPLOAD_IMAGES,"spreadsheet-allowed":!l._.NEXT_PUBLIC_DISABLE_UPLOAD_SPREADSHEETS,"text-allowed":!l._.NEXT_PUBLIC_DISABLE_UPLOAD_TEXT}),[]),s=e=>[...e.supportedFileExtension.map(e=>".".concat(e)),...e.supportedFileMime].join(",")},68328:(e,t,n)=>{n.d(t,{xb:()=>s,Kv:()=>c,Eg:()=>r.Eg,pe:()=>r.pe,p:()=>r.p,fv:()=>m,wz:()=>h,Ed:()=>a.E});var a=n(54277),i=n(64784),l=n(93706);n(8380);var r=n(8748);function s(e){let{contentLength:t,maxContentLength:n}=e,a=(0,l.c3)("Chat");return(0,i.jsx)(r.Eg,{children:(0,i.jsx)(r.p,{className:"text-inverted-default",children:a("message_input.max_message_size",{count:Intl.NumberFormat().format(t),max:Intl.NumberFormat().format(n)})})})}var o=n(75429);function c(e){let{onDisableClick:t}=e,n=(0,l.c3)("Chat");return(0,i.jsxs)(r.Eg,{children:[(0,i.jsx)(r.p,{className:"text-inverted-default",children:n("message_input.reasoning_no_images")}),(0,i.jsx)(r.pe,{children:(0,i.jsx)(o.$n,{size:"xs",variant:"ghost",onClick:t,className:"text-inverted-default",children:n("message_input.disable")})})]})}var d=n(52907),u=n(8424);function m(e){let{onHideClick:t}=e,n=(0,l.c3)("Chat");return(0,i.jsxs)(r.Eg,{children:[(0,i.jsx)(r.p,{children:(0,i.jsxs)("span",{className:"inline-flex items-center gap-2 font-semibold text-(--yellowbright-100)",children:[(0,i.jsx)(u.Hxo,{fill:"#FFF7C5",className:"h-3 w-3"}),n("message_input.reasoning_no_flash")]})}),(0,i.jsxs)(r.pe,{children:[(0,i.jsx)(d.v,{href:"/upgrade",variant:"ghost",size:"xs",className:"font-bold text-white-default",children:n("message_input.upgrade")}),(0,i.jsx)(o.$n,{variant:"ghost",size:"xs",className:"text-white-subtle",onClick:t,children:n("message_input.hide")})]})]})}var p=n(54736);function h(e){let{onDisableClick:t}=e,n=(0,l.c3)("Chat");return(0,i.jsxs)(r.Eg,{children:[(0,i.jsx)(r.p,{className:"text-inverted-default",children:n("message_input.reasoning_not_logged_in")}),(0,i.jsxs)(r.pe,{children:[(0,i.jsx)(p.N,{variant:"ghost",className:"font-bold text-inverted-default",children:n("message_input.login")}),(0,i.jsx)(o.$n,{variant:"ghost",size:"xs",className:"text-inverted-subtle",onClick:t,children:n("message_input.disable")})]})]})}},72617:(e,t,n)=>{n.d(t,{x:()=>a});let a=(0,n(30063).cn)("border-0 has-[input:focus]:shadow-none has-[input:focus]:ring-0 [input:focus]:ring-0","gap-2")},77515:(e,t,n)=>{n.d(t,{r:()=>s});var a=n(12330),i=n(2308),l=n(8380);let r={"sample-chat-id":n(89320).tU};function s(){let{agentId:e}=(0,a.useParams)(),[t,n]=(0,i.ab)(r,{shallow:!1}),s=(0,l.useCallback)(()=>{n({"sample-chat-id":null})},[n]),o=(0,l.useCallback)(e=>{n({"sample-chat-id":e})},[n]);return{isSampleAgentChat:!!e,agentId:e,sampleChatId:t["sample-chat-id"],resetSampleChatId:s,setSampleChatId:o}}},78135:(e,t,n)=>{n.d(t,{RT:()=>r,Vo:()=>i,lf:()=>a,vi:()=>l});let a="slash",i={group:"inline",inline:!0,attrs:{slashType:{default:"",validate:"string"},selectedValue:{default:"",validate:"string"},selectedLabel:{default:"",validate:"string"},subType:{default:"",validate:"string"},iconUrl:{default:"",validate:"string"},componentName:{default:"",validate:"string"}},parseDOM:[{tag:"tag.slash-node",getAttrs:e=>({slashType:e.getAttribute("slashType")||"",selectedValue:e.getAttribute("selectedValue")||"",selectedLabel:e.getAttribute("selectedLabel")||"",subType:e.getAttribute("subType")||"",iconUrl:e.getAttribute("iconUrl")||"",componentName:e.getAttribute("componentName")||""})}],toDOM(e){let{selectedValue:t,subType:n,selectedLabel:a,slashType:i,iconUrl:l,componentName:r}=e.attrs;return["span",{class:"slash-node",selectedValue:t,subType:n,selectedLabel:a,slashType:i,iconUrl:l,componentName:r},0]}},l=e=>"files"in e,r=(e,t,n)=>{let{state:i,dispatch:l}=e,{tr:r}=i,{selection:s}=r,{from:o,to:c}=s;if(""===i.doc.textBetween(o,c)){let e=t.nodes[a].create();return l(r.replaceRangeWith(o-(null!=n?n:0),c,e).scrollIntoView().insertText(" ",c+1)),!0}}},79373:(e,t,n)=>{n.d(t,{A:()=>nu});var a=n(64784),i=n(13166),l=n(23536),r=n(5936),s=n(6016),o=n(21655),c=n(60234),d=n(52614),u=n(24205),m=n(71585),p=n(12330),h=n(93706),g=n(2308),f=n(8380),x=n(10315),v=n(82248),b=n(66564),_=n(41585),y=n(4815),j=n(81457),E=n(6807),N=n(6506),A=n(83145),I=n(42573),w=n(63123),T=n(1883),C=n(68273),S=n(18544),R=n(86130),D=n(87790),O=n(97561),L=n(25211);let P=["text","inline_tag"],k=T.Ie(e=>Array.isArray(e)&&e.every(e=>"object"==typeof e&&"type"in e&&P.includes(e.type))),M=T.KC([T.Yj().max(258e3),k.refine(e=>258e3>=e.reduce((e,t)=>("text"===t.type?e+=t.text.length:e+=t.label.length,e),0),{message:"Content too long"})]),U=T.Ik({content:T.Yj(),type:T.k5(R.JH),identifier:T.Yj(),options:T.g1(T.Yj(),T.Yj()).optional(),title:T.Yj(),id:T.Yj()}),F=T.k5(["memory-inference","memory-recall"]),z={chatId:T.Yj(),agentId:T.Yj().optional(),agentsApiAgentId:T.Yj().optional(),features:T.YO(T.k5(S.qY)).optional(),integrations:T.YO(T.Yj()).optional(),activeCanvaId:T.Yj().optional(),customConfig:D.xJ.optional(),stableAnonymousIdentifier:T.Yj().max(64).optional().describe("Stable id for rate limiting in anonymous mode"),clientPromptData:T.Ik({currentDate:T.Yj().optional(),userTimezone:T.Yj().optional()}).optional(),platform:T.k5(O.HD).optional().describe("Deprecated: platform is now inferred from user-agent"),canva:U.optional(),libraries:T.YO(T.Yj()).optional(),shouldUseMessagePatch:T.zM().default(!1),shouldAwaitStreamBackgroundTasks:T.zM().optional().default(!1),followupQuestionId:T.Yj().optional(),shouldUsePersistentStream:T.zM().optional().default(!1),disabledFeatures:T.YO(F).optional().default([])},V=T.Ik({type:T.k5(L.NU),url:T.Yj(),name:T.Yj().nullable().default(null),inlineFileId:T.Yj().optional()}),G=T.k5(["allow","deny"]),H=T.Ik({toolCallId:T.Yj(),confirmation:G}),B=T.Ik({...z,mode:T.eu("toolCallConfirmation"),confirmations:T.YO(H)}),Y=T.Ik({url:T.Yj(),originalTranscript:T.Yj().optional(),transcriptionId:T.Yj().optional(),recordingId:T.Yj().optional()}),Q=T.KC([Y,T.YO(Y)]),$=T.Ik({url:T.Yj()}),K=T.Ik({messageInput:M.optional(),voiceInput:$.optional()}).refine(e=>{let{messageInput:t,voiceInput:n}=e;return t||n},{message:"Either messageInput or voiceInput must be provided"});T.KC([T.Ik({mode:T.eu("start"),...z}),T.Ik({mode:T.k5(["append","edit"]),...z,model:T.Yj().optional(),messageId:T.Yj(),messageFiles:T.YO(V).optional(),action:T.Yj().optional(),audioRecording:Q.optional(),quote:T.Ik({content:T.Yj(),canvaId:T.Yj(),canvaVersion:T.ai()}).optional()}).and(K),T.Ik({mode:T.k5(["rewrite","retry"]),...z,model:T.Yj().optional()}),B]);var X=n(8740),q=n(76432);let W=[32,64,128,256,512,1024,2048,4096,8192,16384,32768];function Z(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var t=arguments.length,n=Array(t>2?t-2:0),a=2;a<t;a++)n[a-2]=arguments[a]}W[0],W[W.length-1];let J={IDLE:"idle",RECORDING:"recording",PAUSED:"paused",STOPPED:"stopped"},ee={GRANTED:"granted",DENIED:"denied",PROMPT:"prompt"},et={SET_SUPPORT:"SET_SUPPORT",SET_PERMISSION:"SET_PERMISSION",START_RECORDING:"START_RECORDING",PAUSE_RECORDING:"PAUSE_RECORDING",RESUME_RECORDING:"RESUME_RECORDING",STOP_RECORDING:"STOP_RECORDING",SET_ERROR:"SET_ERROR",RESET:"RESET",HARD_RESET:"HARD_RESET",UPDATE_RECORDING_TIME:"UPDATE_RECORDING_TIME"},en={status:J.IDLE,isSupported:!1,permission:ee.PROMPT,recordingTime:0,startTime:null,pauseTime:0};function ea(e,t){switch(t.type){case et.SET_SUPPORT:return{...e,isSupported:t.isSupported};case et.SET_PERMISSION:return{...e,permission:t.permission};case et.START_RECORDING:if(e.status!==J.IDLE&&e.status!==J.STOPPED)return Z("Cannot start recording when it is ".concat(e.status,"."),"warn"),e;return{...e,status:J.RECORDING,recorder:t.recorder,error:void 0,recordingBlob:void 0,startTime:Date.now(),pauseTime:0,recordingTime:0};case et.PAUSE_RECORDING:if(e.status!==J.RECORDING)return Z("Cannot pause recording when it is ".concat(e.status,"."),"warn"),e;return{...e,status:J.PAUSED,pauseTime:e.startTime?e.pauseTime+(Date.now()-e.startTime):e.pauseTime,startTime:null};case et.RESUME_RECORDING:if(e.status!==J.PAUSED)return Z("Cannot resume recording when it is ".concat(e.status,"."),"warn"),e;return{...e,status:J.RECORDING,startTime:Date.now()};case et.STOP_RECORDING:if(e.status===J.IDLE)return Z("Cannot stop recording when idle","warn"),e;return{...e,status:J.STOPPED,recordingBlob:t.blob,recorder:void 0,recordingTime:e.startTime?e.pauseTime+(Date.now()-e.startTime):e.pauseTime,startTime:null};case et.SET_ERROR:return{...e,error:t.error,status:J.IDLE,recorder:void 0,startTime:null,pauseTime:0,recordingTime:0};case et.RESET:return{...en,isSupported:e.isSupported,permission:e.permission};case et.HARD_RESET:return{...en};case et.UPDATE_RECORDING_TIME:if(e.status!==J.RECORDING)return e;return{...e,recordingTime:t.time};default:return e}}let ei=function(){let{trackConstraints:e,recorderOptions:t,onNotAllowedOrFound:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[a,i]=(0,f.useReducer)(ea,en),l=(0,f.useRef)(null),r=(0,f.useRef)([]),s=(0,f.useRef)(null),o=(0,f.useRef)(null),c=(0,I.DK)(()=>{l.current&&(l.current.getTracks().forEach(e=>{e.stop()}),l.current=null)});(0,f.useEffect)(()=>{let e="mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices,t="MediaRecorder"in window,n="AudioContext"in window||"webkitAudioContext"in window;i({type:et.SET_SUPPORT,isSupported:e&&t&&n})},[]);let d=(0,I.DK)(async()=>{if(!("permissions"in navigator))return void i({type:et.SET_PERMISSION,permission:ee.PROMPT});try{let e=await navigator.permissions.query({name:"microphone"});i({type:et.SET_PERMISSION,permission:e.state});let t=()=>{i({type:et.SET_PERMISSION,permission:e.state})};return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}}catch(e){i({type:et.SET_PERMISSION,permission:ee.PROMPT})}});(0,f.useEffect)(()=>{let e;if(a.isSupported)return(async()=>{e=await d()})(),()=>{null==e||e()}},[a.isSupported,d]),(0,f.useEffect)(()=>(a.status===J.RECORDING&&(s.current=setInterval(()=>{let e=a.startTime,t=a.pauseTime;if(null!==e){let n=Date.now()-e+t;i({type:et.UPDATE_RECORDING_TIME,time:n})}},100)),()=>{s.current&&(clearInterval(s.current),s.current=null)}),[a.status,a.startTime,a.pauseTime]),(0,f.useEffect)(()=>()=>{c()},[c]);let u=(0,f.useMemo)(()=>a.permission===ee.GRANTED||a.permission!==ee.DENIED&&null,[a.permission]),m=(0,I.DK)(e=>({dataAvailableHandler:e=>{r.current.push(e.data)},stopHandler:()=>{let t;r.current.length>0&&(t=new Blob(r.current,{type:e.mimeType||"audio/webm"})),i({type:et.STOP_RECORDING,blob:t}),o.current&&(o.current.resolve(t),o.current=null)},errorHandler:()=>{let e=Error("A MediaRecorder error occurred.");i({type:et.SET_ERROR,error:e}),o.current&&(o.current.reject(e),o.current=null)}})),p=(0,I.DK)(e=>{e instanceof DOMException?("NotAllowedError"===e.name&&i({type:et.SET_PERMISSION,permission:ee.DENIED}),i({type:et.SET_ERROR,error:e}),null==n||n(e)):i({type:et.SET_ERROR,error:e instanceof Error?e:Error(String(e))})}),h=(0,I.DK)(async()=>{try{if(!a.isSupported)throw Error("Audio recording is not supported in this browser.");c(),r.current=[];let n=await navigator.mediaDevices.getUserMedia({audio:null==e||e});l.current=n,i({type:et.SET_PERMISSION,permission:ee.GRANTED});let s=new MediaRecorder(n,t),o=m(s);s.addEventListener("dataavailable",o.dataAvailableHandler),s.addEventListener("stop",o.stopHandler),s.addEventListener("error",o.errorHandler),s.start(),i({type:et.START_RECORDING,recorder:s})}catch(e){p(e)}}),g=(0,I.DK)(()=>new Promise((e,t)=>{if(a.status===J.IDLE){Z("Cannot stop recording when already idle","warn"),e(void 0);return}if(a.status===J.STOPPED){Z("Cannot stop recording when already stopped, returning existing blob","info"),e(a.recordingBlob);return}if(!a.recorder){Z("Cannot stop recording when no recorder exists","warn"),i({type:et.RESET}),e(void 0);return}o.current={resolve:e,reject:t};try{a.recorder.stop(),c()}catch(e){o.current=null,i({type:et.RESET}),t(e instanceof Error?e:Error(String(e)))}})),x=(0,I.DK)(()=>{a.recorder&&(a.status===J.PAUSED?(a.recorder.resume(),i({type:et.RESUME_RECORDING})):a.status===J.RECORDING&&(a.recorder.pause(),i({type:et.PAUSE_RECORDING})))}),v=(0,I.DK)(()=>{if(a.recorder&&a.status!==J.IDLE){try{a.recorder.stop()}catch(e){}o.current&&(o.current.resolve(void 0),o.current=null)}}),b=(0,I.DK)(()=>{s.current&&(clearInterval(s.current),s.current=null)}),_=(0,I.DK)(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];b(),v(),c(),i({type:e?et.RESET:et.HARD_RESET})});return{recorder:a.recorder,startRecording:h,stopRecording:g,togglePauseResume:x,reset:_,recordingBlob:a.recordingBlob,recordingTime:a.recordingTime,error:a.error,isSupported:a.isSupported,isAllowed:u,isRecording:a.status===J.RECORDING||a.status===J.PAUSED,isPaused:a.status===J.PAUSED}},el={drnDecayFactor:.95,drnInitialRMS:.2,drnMinimumFloor:.1,rmsThresholdGate:.1};var er=n(66318);let es={SET_PLAYING:"SET_PLAYING",SET_LOADED:"SET_LOADED",SET_DURATION:"SET_DURATION",SET_ERROR:"SET_ERROR",RESET:"RESET"},eo={isPlaying:!1,isLoaded:!1,duration:0,error:null},ec=(e,t)=>{switch(t.type){case es.SET_PLAYING:return{...e,isPlaying:t.payload};case es.SET_LOADED:return{...e,duration:t.payload,error:null,isLoaded:!0};case es.SET_DURATION:return{...e,duration:t.payload};case es.SET_ERROR:return{...e,error:t.payload};case es.RESET:return eo;default:return e}},ed=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{volume:n=1,loop:a=!1,preload:i=!0,playbackRate:l=1}=t,r=(0,f.useRef)(null),[s,o]=(0,f.useReducer)(ec,eo);(0,f.useEffect)(()=>{if(!e)return;let t=new Audio(e);r.current=t,t.volume=(0,er.q)(n,{min:0,max:1}),t.playbackRate=(0,er.q)(l,{min:.25,max:4}),t.loop=a,i&&(t.preload="auto");let s=()=>{o({type:es.SET_LOADED,payload:t.duration})},c=()=>{o({type:es.SET_PLAYING,payload:!1})},d=e=>{let t=e.target;if(t&&"object"==typeof t&&"error"in t){var n;let e=(null==(n=t.error)?void 0:n.message)||"Unknown audio error";o({type:es.SET_ERROR,payload:"Audio loading error: ".concat(e)})}},u=()=>{o({type:es.SET_PLAYING,payload:!0})};return t.addEventListener("loadeddata",s),t.addEventListener("ended",c),t.addEventListener("error",d),t.addEventListener("play",u),t.load(),()=>{t.removeEventListener("loadeddata",s),t.removeEventListener("ended",c),t.removeEventListener("error",d),t.removeEventListener("play",u),t.pause(),t.src="",r.current=null}},[e,n,a,l,i]);let c=(0,I.DK)(async()=>{if(r.current&&s.isLoaded)try{await r.current.play()}catch(t){let e=t instanceof Error?t.message:"Unknown audio playback error";o({type:es.SET_ERROR,payload:"Audio playback error: ".concat(e)})}}),d=(0,I.DK)(()=>{r.current&&(r.current.pause(),r.current.currentTime=0)}),u=(0,I.DK)(e=>{if(!r.current)return;let t=(0,er.q)(e,{min:0,max:1});r.current.volume=t});return{...s,audioRef:r,play:c,stop:d,setVolume:u}};var eu=n(56337),em=n(8424),ep=n(75429),eh=n(30063),eg=n(83403),ef=n(8492),ex=n(99994),ev=n(5610),eb=n(94419),e_=n(21413),ey=n(68142),ej=n(478),eE=n(19494),eN=n(8866),eA=n(73672),eI=n(89366),ew=n(42708),eT=n(26235),eC=n(35111),eS=n(35287);let eR=RegExp("((?:\\n|\\r)+)((?:\\s{2,}|\\t)+)?|(```)|([#*_-]+)|([(){}[\\]]+)|([\\x21-\\x2F\\x3A-\\x40\\x5B-\\x60\\x7B-\\x7E]+)|(\\b(?:await|break|case|catch|class|continue|default|define|except|extends|export|finally|implements|import|include|print|private|protected|public|return|span|switch|system|template|throw|type|using|while)\\b)|(\\b(?:async|breakpoint|cin|cmd|console|const|constexpr|cout|def|defn|div|env|fn|func|function|href|html|img|interface|lambda|namespace|println|src|stdout|struct|var|workdir|yield)\\b)","gi"),eD=[80.33911781017851,19.194942847935266,-78.96158351597562,31.404985863148777,48.13976028814005,82.48501866379408,15.781632991361631,67.81666324403915];var eO=n(79705),eL=n(6974);let eP=eL._.NEXT_PUBLIC_MAX_DOCUMENT_SIZE,ek=eL._.NEXT_PUBLIC_MAX_IMAGE_PER_MESSAGE,eM=eL._.NEXT_PUBLIC_MAX_SPREADSHEET_SIZE,eU=eL._.NEXT_PUBLIC_MAX_SPREADSHEET_PER_MESSAGE,eF=eL._.NEXT_PUBLIC_MAX_TEXT_FILE_SIZE,ez=eL._.NEXT_PUBLIC_MAX_TEXT_FILE_PER_MESSAGE,eV=eL._.NEXT_PUBLIC_MAX_IMAGE_SIZE,eG=eL._.NEXT_PUBLIC_MAX_IMAGE_WIDTH,eH=eL._.NEXT_PUBLIC_MAX_IMAGE_HEIGHT,eB={image:eL._.NEXT_PUBLIC_MAX_IMAGE_PER_MESSAGE,document:ek,spreadsheet:eU,text:ez},eY=(e,t,n)=>{if(t+n>eB[e])return{code:"error_max_file_per_message",count:eB[e],fileType:e}},eQ={audio:[],image:[eX(L.NP.image),eK(eV),eq],document:[eX(L.NP.document),eK(eP)],spreadsheet:[eX(L.NP.spreadsheet),eK(eM)],text:[eX(L.NP.text),eK(eF)]};async function e$(e,t){let n=[],a=[];return await Promise.all(e.map(async e=>{let i=[];if((0,L.VI)(e)){var l,r,s,o,c;return void a.push({error:{code:"error_file_type",args:{filename:null!=(s=null==(l=e.data)?void 0:l.name)?s:"",types:t.join(", ")}},filename:null!=(c=null!=(o=null==(r=e.data)?void 0:r.name)?o:e.url)?c:""})}if(!e.data)throw Error("Nothing to validate");for(let t of eQ[e.type])try{let n=await t(e.data);void 0!==n&&i.push(n)}catch(t){i.push({filename:e.data.name,error:{code:"error",args:{filename:e.data.name}}})}i.length>0?a.push(...i):n.push(e)})),{acceptedFiles:n,errors:a}}function eK(e){return async function(t){return new Promise(n=>{t.size>e&&n({filename:t.name,error:{code:"error_file_size",args:{size:(0,eO.A)(e,{binary:!0}),filename:t.name}}}),n(void 0)})}}function eX(e){let t=e.map(e=>e.extension);return async function(e){let n=await e.arrayBuffer(),a=await (0,eT.BI)(n);return new Promise(n=>{var i,l;t.includes(null!=(l=null!=(i=null==a?void 0:a.ext)?i:e.name.split(".").pop())?l:"")||n({filename:e.name,error:{code:"error_file_type",args:{filename:e.name,types:t}}}),n(void 0)})}}async function eq(e){let{width:t,height:n}=await eW(e);if(t>eG||n>eH)return{filename:e.name,error:{code:"error_image_dimensions",args:{width:eG,height:eH,filename:e.name}}}}async function eW(e){return new Promise((t,n)=>{let a=new Image;a.src=URL.createObjectURL(e),a.onload=()=>t({width:a.width,height:a.height}),a.onerror=()=>n("Error loading image")})}var eZ=n(77515);let eJ="click-focus-input";var e0=n(9590),e1=n(67781),e2=n(16624);let e3={intensity:.2,scaleX:.4,scaleY:.001},e4={smoothingFactor:.9},e5={frequencyBins:22,baseCellsAccentCount:6,bellWidthRatio:1/7,activeCellsPerHalfBin:10,binWidth:8,cellHeight:5,cellBorderRadius:1,horizontalGap:2,verticalGap:1,baseColor:"#34c759",baseColorAccent:"#cddc1e",activeColorGradient:[{position:0,color:"#59dc09"},{position:.2,color:"#cddc1e"},{position:.4,color:"#ffd700"},{position:.6,color:"#ff8205"},{position:.8,color:"#fa520f"},{position:1,color:"#fa520f"}],transitionColor:"#6b7280",transitionOpacity:.15,inactiveColor:"#000000",inactiveOpacity:0,inactiveTransitionDurationMs:100,animationTransition:{duration:.1,ease:(0,e1.A)(0,0,0,1)}},e6=e=>{let{mediaStream:t,config:n}=e,{frequencyBins:i,baseCellsAccentCount:l,bellWidthRatio:r,activeCellsPerHalfBin:o,binWidth:c,cellHeight:d,cellBorderRadius:u,horizontalGap:m,verticalGap:p,baseColor:h,baseColorAccent:g,activeColorGradient:x,transitionColor:v,transitionOpacity:b,inactiveColor:_,inactiveOpacity:y,inactiveTransitionDurationMs:j,animationTransition:E}={...e5,...n},{rms:N}=function(e){let[t,n]=(0,f.useState)(0),a=(0,f.useRef)(null),i=(0,f.useRef)(null),l=(0,f.useRef)(null),r=(0,f.useRef)(null),s=(0,f.useRef)(null);return(0,f.useEffect)(()=>{if(!e)return;let t=new AudioContext,o=t.createMediaStreamSource(e),c=t.createAnalyser();c.fftSize=2048;let d=new Uint8Array(c.fftSize);o.connect(c),a.current=t,i.current=c,l.current=d,r.current=o;let u=()=>{let e;c.getByteTimeDomainData(d),n((e=0,d.forEach(t=>{let n=(t-128)/128;e+=n*n}),Math.sqrt(e/d.length))),s.current=requestAnimationFrame(u)};return u(),()=>{null!==s.current&&cancelAnimationFrame(s.current),c.disconnect(),o.disconnect(),t.close()}},[e]),{rms:t}}(t),{applyDRN:A}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{drnDecayFactor:t,drnInitialRMS:n,drnMinimumFloor:a,rmsThresholdGate:i}={...el,...e},l=(0,f.useRef)(n);return{resetDRN:(0,f.useCallback)(()=>{l.current=n},[n]),applyDRN:(0,f.useCallback)(e=>{l.current=Math.max(a,Math.max(e,l.current*t));let n=Math.min(e/l.current,1);return n<i?0:n},[a,t,i])}}(),{getNoise:I}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{intensity:t,scaleX:n,scaleY:a}={...e3,...e},i=(0,f.useRef)((0,e2.fu)()),l=(0,f.useRef)(0);return{resetNoise:(0,f.useCallback)(()=>{i.current=(0,e2.fu)()},[]),getNoise:(0,f.useCallback)(e=>(l.current+=a,i.current(e*n,l.current)*t),[t,n,a])}}(),{getActiveColor:w}=function(e){let{activeCellsPerHalfBin:t,baseColor:n,activeColorGradient:a}=e,i=(0,f.useMemo)(()=>{if(t<=1){var e,i;return[null!=(i=null==(e=a[0])?void 0:e.color)?i:n]}let l=[];for(let e=0;e<t;e++){let n=e/(t-1);l.push(function(e,t){if(0===e.length)throw Error("Gradient array must not be empty.");if(1===e.length&&e[0])return e[0].color;let n=e[0],a=e[e.length-1];if(!n||!a)throw Error("Invalid gradient color array.");if(t<=n.position)return n.color;for(let n=0;n<e.length-1;n++){let a=e[n],i=e[n+1];if(!a||!i)throw Error("Invalid gradient color array.");if(t>=a.position&&t<=i.position){let e=i.position-a.position,n=e>0?(t-a.position)/e:0;return function(e,t,n){let a=parseInt(e.slice(1),16),i=parseInt(t.slice(1),16),l=a>>16&255,r=a>>8&255,s=255&a,o=Math.round(l+n*((i>>16&255)-l)),c=Math.round(r+n*((i>>8&255)-r)),d=Math.round(s+n*((255&i)-s));return"#".concat((0x1000000+(o<<16)+(c<<8)+d).toString(16).slice(1))}(a.color,i.color,n)}}return a.color}(a,n))}return l},[t,a,n]);return{getActiveColor:(0,f.useCallback)(e=>{var t;return null!=(t=i[e])?t:n},[i,n])}}({activeCellsPerHalfBin:o,baseColor:h,activeColorGradient:x}),{smoothenSpectrum:T}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{smoothingFactor:t}={...e4,...e},n=(0,f.useRef)(null);return{smoothenSpectrum:(0,f.useCallback)(e=>{let a=e.map((e,a)=>{var i,l;let r=null!=(l=null==(i=n.current)?void 0:i[a])?l:e;return e*(1-t)+r*t});return n.current=a,a},[t])}}(),{cells:C}=function(e){let{activeCellsPerHalfBin:t,baseCellsAccentCount:n,baseColor:a,baseColorAccent:i,transitionColor:l,transitionOpacity:r,inactiveColor:s,inactiveOpacity:o,inactiveTransitionDurationMs:c,getActiveColor:d,spectrum:u}=e,m=(0,f.useRef)(null),p=(0,f.useMemo)(()=>({status:"active",transitionStartTime:null,color:a,opacity:1}),[a]),h=(0,f.useMemo)(()=>({status:"active",transitionStartTime:null,color:i,opacity:1}),[i]),g=(0,f.useCallback)(e=>{let t=(u.length-n)/2,a=t+n-1;return e>=t&&e<=a},[u.length,n]);return{cells:(0,f.useMemo)(()=>{let e=u.map(e=>{let n=e*t,a=[];for(let e=0;e<t;e++){let t=e+1<=n;a.push(t)}return a}).map((e,t)=>e.map((e,n)=>{var a,i;return function(e){let{isActive:t,previousCellState:n,activeColor:a,transitionColor:i,transitionOpacity:l,inactiveColor:r,inactiveOpacity:s,inactiveTransitionDurationMs:o}=e;return t?{status:"active",transitionStartTime:null,color:a,opacity:1}:(null==n?void 0:n.status)==="active"?{status:"transitioning",transitionStartTime:Date.now(),color:i,opacity:l}:(null==n?void 0:n.status)==="transitioning"&&n.transitionStartTime&&Date.now()-n.transitionStartTime<o?n:{status:"inactive",transitionStartTime:null,color:r,opacity:s}}({isActive:e,previousCellState:null==(i=m.current)||null==(a=i[t])?void 0:a[n],activeColor:d(n),transitionColor:l,transitionOpacity:r,inactiveColor:s,inactiveOpacity:o,inactiveTransitionDurationMs:c})}));return m.current=e,e.map((e,t)=>{var n;return[...e.slice().reverse(),g(t)&&(null==(n=e[0])?void 0:n.status)!=="active"?h:p,...e]})},[u,t,h,p,g,d,l,r,s,o,c])}}({activeCellsPerHalfBin:o,baseCellsAccentCount:l,baseColor:h,baseColorAccent:g,transitionColor:v,transitionOpacity:b,inactiveColor:_,inactiveOpacity:y,inactiveTransitionDurationMs:j,getActiveColor:w,spectrum:(0,f.useMemo)(()=>T(function(e){let{rms:t,frequencyBins:n,bellWidthRatio:a,getNoise:i}=e,l=[],r=n/2,s=n*a;for(let e=0;e<n;e++){let n=t*Math.exp(-Math.pow(e-r,2)/(2*s*s))+(i?i(e)*t:0);l.push(Math.min(1,Math.max(0,n)))}return l[0]=0,l[n-1]=0,l}({frequencyBins:i,bellWidthRatio:r,rms:A(N),getNoise:I})),[A,r,i,I,N,T])});return(0,a.jsx)("div",{className:"flex",style:{gap:m},children:C.map((e,t)=>(0,a.jsx)("div",{className:"flex flex-col",style:{gap:p},children:e.map((e,t)=>{let{color:n,opacity:i}=e;return(0,a.jsx)(s.P.div,{animate:{backgroundColor:n,opacity:i},transition:E,style:{width:c,height:d,borderRadius:u}},t)})},t))})};var e8=n(91518);function e7(){return(0,a.jsxs)("div",{className:"relative flex",children:[(0,a.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-(--red-400) opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-(--red-400)"})]})}function e9(e){let{elapsedTime:t=0,withIcon:n=!1,iconSide:i="right",isRecording:l=!1,className:o,...c}=e;return(0,a.jsxs)("div",{className:(0,eh.cn)("flex items-center justify-center gap-2","left"===i?"flex-row":"flex-row-reverse",o),...c,children:[(0,a.jsx)(r.N,{mode:"wait",initial:!1,children:n&&l&&(0,a.jsx)(s.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.175},children:(0,a.jsx)(e7,{})},"recording-icon")}),(0,a.jsx)("span",{className:"font-medium text-subtle tabular-nums",children:function(e){let t=Math.floor(e/1e3),n=Math.floor(t/3600),a=Math.floor(t%3600/60),i=n>0?String(n).padStart(2,"0")+":":"",l=String(a).padStart(2,"0"),r=String(t%60).padStart(2,"0");return"".concat(i).concat(l,":").concat(r)}(t)})]})}function te(e){let{elapsedTime:t,isRecording:n=!1,isProcessing:i=!1,isAutoSendEnabled:l,onCancel:o,onSend:c,onToggleAutosend:d,className:u,...m}=e,p=(0,h.c3)("Chat");return(0,a.jsxs)("div",{className:(0,eh.cn)("flex w-full items-center justify-between",u),...m,children:[(0,a.jsx)(ep.$n,{"aria-label":p("audio.actions.cancel"),onClick:o,isDisabled:i,variant:"secondary",mode:"icon-only",icon:(0,a.jsx)(em.FBV,{size:"14"}),"aria-describedby":"cancel-tooltip",children:(0,a.jsx)(ep.GM,{id:"cancel-tooltip",children:p("audio.actions.cancel")})}),(0,a.jsxs)("div",{className:"flex items-center gap-2","aria-live":"polite",children:[(0,a.jsx)(r.N,{mode:"wait",initial:!1,children:n&&(0,a.jsx)(s.P.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.175},children:(0,a.jsx)(e9,{elapsedTime:t,iconSide:"left",withIcon:!0,isRecording:n,className:"px-2"})},"recording-timer")}),(0,a.jsxs)(ep.$n,{variant:"secondary",onClick:d,children:[p("audio.autosend"),(0,a.jsxs)(e8.Ex,{size:"sm",colorScheme:l?"orangebright":"neutral",className:"relative",children:[(0,a.jsx)("span",{className:"opacity-0",children:"OFF"}),(0,a.jsx)("span",{className:"absolute inset-0 flex items-center justify-center",children:l?"ON":"OFF"})]})]}),(0,a.jsx)(ep.$n,{"aria-label":p("audio.actions.send"),onClick:c,isLoading:i,variant:"primary",mode:"icon-only",icon:(0,a.jsx)(em.Qpb,{className:"-rotate-90",size:"14"}),"aria-describedby":"send-tooltip",children:(0,a.jsx)(ep.GM,{id:"send-tooltip",children:p("audio.actions.send")})})]})]})}var tt=n(99639),tn=n(23964),ta=n(4639),ti=n(22731),tl=n(89595),tr=n(85139),ts=n(4580),to=n(79763),tc=n(63929),td=n.n(tc),tu=n(28008);function tm(e){switch(e){case"highlight":return(0,eh.cn)("bg-basic-blue-accent");case"upsell":return(0,eh.cn)("bg-state-brand");case"blocker":return(0,eh.cn)("bg-state-primary");case"subtle":return(0,eh.cn)("bg-state-ghost")}}function tp(e){let{className:t,...n}=e;return(0,a.jsx)(s.P.div,{...n,initial:{height:0},animate:{height:"auto",overflow:"hidden"},exit:{height:0},transition:{duration:.2,ease:"easeInOut"},className:(0,eh.cn)("flex items-center rounded-t-xl px-3 py-2",t)})}function th(e){let{agentName:t,agentId:n,canEdit:i,onAgentDropdownClick:l,showClose:r,onClose:s}=e,o=(0,h.c3)("Chat");return(0,a.jsxs)(tp,{className:"group gap-2",children:[(0,a.jsxs)(ep.$n,{onPointerDown:e=>{e.preventDefault(),l()},variant:"ghost",className:"h-7 px-1.5 text-sm font-medium text-brand-50",children:["@",t,(0,a.jsx)(ep.qF,{children:(0,a.jsx)(ts.A,{className:"size-3 text-brand-200"})})]}),i&&(0,a.jsx)(tu.o5,{size:"xs",className:"text-brand-50 opacity-0 transition-opacity group-hover:opacity-100",children:(0,a.jsx)(td(),{href:"/agents/".concat(n),children:o("message_input.agents.customize")})}),(0,a.jsx)("div",{className:"flex-1"}),r&&(0,a.jsx)(ep.$n,{variant:"ghost",mode:"icon-only",icon:(0,a.jsx)(to.A,{className:"size-4 text-brand-200"}),size:"xs",onClick:s})]})}var tg=n(68328),tf=n(52907),tx=n(38256),tv=n(8748);function tb(e){var t,n;let{onDismiss:i}=e,l=(0,h.c3)("Chat"),r=(0,eg.m)();return(0,a.jsxs)(tv.Eg,{className:(0,eh.cn)("text-(--zinc-00)"),children:[(0,a.jsxs)(tv.p,{className:"flex items-center gap-2",children:[(0,a.jsx)(em.Hxo,{}),l("deep_research.out_of_deep_researches_rate_limit",{maxDeepReasearch:null!=(n=null==(t=r.data)?void 0:t.deep_research.points)?n:"-"})]}),(0,a.jsxs)(tv.pe,{children:[(0,a.jsx)(tf.v,{href:"/upgrade",variant:"ghost",size:"xs",className:"font-bold text-white-default",children:l("message_input.upgrade")}),(0,a.jsx)(ep.$n,{variant:"ghost",size:"xs",className:"text-white-subtle",onClick:()=>{i()},children:l("message_input.hide")})]})]})}function t_(e){var t,n;let{onDismiss:i}=e,l=(0,h.c3)("Chat"),r=(0,tx.w)(),s=null==r?void 0:r.session.isLeChatPro,o=(0,eg.m)();return(0,a.jsxs)(tv.Eg,{children:[(0,a.jsx)(tv.p,{children:l("deep_research.out_of_flash_deep_researches_rate_limit",{maxFlashDeepReasearch:null!=(n=null==(t=o.data)?void 0:t.fast_deep_research.points)?n:"-"})}),(0,a.jsxs)(tv.pe,{children:[!s&&(0,a.jsx)(tf.v,{href:"/upgrade",variant:"brand",size:"xs",className:"font-bold text-white-default",children:l("message_input.upgrade")}),(0,a.jsx)(ep.$n,{variant:"ghost",size:"xs",onClick:()=>{i()},children:l("message_input.hide")})]})]})}n(49619),n(30817),n(39);let ty={webSearch:"web_search",blackForest:"black_forest",codeInterpreter:"code_interpreter",documentLibrary:"document_library"},tj=[ty.webSearch,ty.blackForest,ty.codeInterpreter,ty.documentLibrary],tE=e=>tj.includes(e);function tN(e){let{onDismiss:t}=e,n=(0,h.c3)("Chat");return(0,a.jsxs)(tv.Eg,{className:"text-inverted-default",children:[(0,a.jsx)(tv.p,{className:"flex items-center gap-2",children:n("message_input.out_of_tools_rate_limit")}),(0,a.jsxs)(tv.pe,{children:[(0,a.jsx)(tf.v,{href:"/upgrade",variant:"ghost",size:"xs",className:"font-bold text-inverted-default",children:n("message_input.upgrade")}),(0,a.jsx)(ep.$n,{variant:"ghost",size:"xs",className:"text-inverted-default",onClick:()=>{t()},children:n("message_input.hide")})]})]})}var tA=n(28504),tI=n(57690),tw=n(6028);function tT(e){let{isOpen:t,icon:n,label:i}=e,{openCanva:l}=(0,tn.o)();return(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(tw.gM,{icon:n}),(0,a.jsxs)("div",{className:(0,eh.cn)("flex overflow-hidden transition-all interpolate-size-allow-keywords max-sm:w-0 max-sm:opacity-0",{"w-0 opacity-0":!t&&!!l,"max-sm:w-auto! max-sm:opacity-100!":t}),children:[(0,a.jsx)("div",{className:"w-2"}),i]})]})}let tC=e=>{let{session:t,disabled:n,regularDRLimit:i,fastDRLimit:l,loading:o,onDeepResearchExceeded:c}=e,{features:d,selectedFeatures:u,setSelectedFeatures:m}=(0,eE.mr)(),p=(0,h.c3)("Chat"),g=u.includes(S.wt);if(!d.includes(S.wt)||!t.permissions.start_deepresearch)return null;let f=(null==i?void 0:i.remainingPoints)===0&&!t.organization.internal,x=(null==l?void 0:l.remainingPoints)===0&&!t.organization.internal,v=f&&t.isLeChatPro,b=n||o||v;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(tw.vu,{variant:"ghost",disabled:b,pressed:g&&(null==i?void 0:i.remainingPoints)!==0,onPressedChange:()=>{if(!b){if(f)return void c("dr-limit-exceeded");g?(m(u.filter(e=>e!==S.wt)),x&&t.acceleratedAnswersEnabled&&c("fast-dr-limit-exceeded",!1)):(m((0,A.A)(u.filter(e=>!(0,S.Ft)(e)).concat(S.wt))),x&&t.acceleratedAnswersEnabled&&c("fast-dr-limit-exceeded",!0))}},shape:"rounded",className:(0,eh.cn)("h-9 gap-0",b?"cursor-not-allowed":""),children:[(0,a.jsxs)(tw.er,{className:tA.QC,...tA.dd,children:[(0,a.jsx)(tA.Q$,{title:p("features.deep_research.tooltip_title"),description:p("features.deep_research.tooltip_description"),displayFlashStatus:t.acceleratedAnswersEnabled}),(0,a.jsx)(r.N,{children:i&&(0,a.jsx)(s.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.15},className:"w-full",children:(0,a.jsx)(tA.i_,{children:p.rich("features.deep_research.rate_limit_info",{remaining:i.remainingPoints,available:i.points,strong:e=>(0,a.jsx)("strong",{children:e})})})})})]}),(0,a.jsx)(tT,{icon:tI.A,label:p("features.deep_research.name"),isOpen:g})]})})};var tS=n(36055),tR=n(81118),tD=n(5508),tO=n(17584),tL=n(50259),tP=n(3171),tk=n(18182);function tM(e){var t;let{handleNewFiles:n,supportedFiles:i,isLoading:l,iconOnly:r=!1,className:s}=e,o=(0,h.c3)("Chat"),c=(0,f.useRef)(null),d=(0,tx.w)(),u=null!=(t=null==d?void 0:d.session)?t:null,m={"aria-label":"Add files",variant:"secondary",onClick:()=>{if(null!==c.current){try{c.current.value=""}catch(e){}c.current.click()}},isDisabled:!u||l,className:s,"data-testid":"attach-file-button"},p=(0,eh.cn)(!u||l?"text-icon-default-muted":"text-icon-default","size-4"),g=r?(0,a.jsx)(ep.$n,{...m,mode:"icon-only",icon:(0,a.jsx)(tR.A,{className:p})}):(0,a.jsxs)(ep.$n,{...m,children:[(0,a.jsx)(ep.IM,{className:p,icon:tR.A}),o("files.upload_file")]});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"file",multiple:!0,name:"file-upload",accept:(0,ey.v)(i),className:"hidden",ref:c,onChange:e=>{(0,tS.R)(e).then(e=>{n(e.filter(e=>e instanceof File))})}}),g]})}let tU=e=>{let{supportedFiles:t,handleNewFiles:n,containerClassName:i,className:l}=e;return(0,a.jsx)("div",{className:(0,eh.cn)("flex w-full items-center justify-center px-4 pt-4",i),children:(0,a.jsx)(tM,{handleNewFiles:n,supportedFiles:t,isLoading:!1,className:(0,eh.cn)("h-10 grow",l)})})};var tF=n(44960);let tz=e=>{let{agent:t,supportedFiles:n,handleNewFiles:i,className:l}=e,{supportedFileMime:r}=(0,ey.j)(),[s,o]=(0,f.useState)(null);return(0,a.jsxs)(tP.W2,{className:(0,eh.cn)("flex flex-col bg-card","h-full justify-start gap-0 overflow-hidden",tP.I6,l),children:[r.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tU,{handleNewFiles:i,supportedFiles:n}),(0,a.jsx)("div",{className:"mt-4 w-full border-b"})]}),s?(0,a.jsx)(tk.f3,{currentLibraryId:s,onReturn:()=>o(null),onSelectDocument:i}):(0,a.jsx)(tF.NA,{agent:t,libraryBrowseEnabled:r.length>0,onLibraryBrowse:o})]})},tV=e=>{var t;let{isLoading:n,onClick:i,className:l}=e,o=(0,h.c3)("Chat"),c=(0,tx.w)(),d=null!=(t=null==c?void 0:c.session)?t:null,{activeLibrarySelection:u}=(0,e_.TY)(),m=u.length>0,p=(0,eE.xn)(S.wt),g=!d||n||p;return(0,a.jsxs)(ep.$n,{"aria-label":"Add files",variant:"secondary",isDisabled:g,onClick:i,className:(0,eh.cn)("shrink-0 gap-0 overflow-hidden px-0",l,{"cursor-not-allowed!":g}),"data-testid":"attach-file-button",children:[(0,a.jsx)(ep.IM,{className:(0,eh.cn)(g?"text-icon-default-muted":"text-icon-default","mx-[9px]"),icon:tR.A}),(0,a.jsx)(r.N,{children:!p&&m&&(0,a.jsx)(s.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},transition:{duration:.175},className:"h-full",children:(0,a.jsxs)("div",{className:"flex h-full items-center justify-center gap-1 bg-badge-sky px-2.5 text-basic-blue-strong hover:bg-badge-sky/70",children:[(0,a.jsx)(tD.A,{className:"size-4 shrink-0"}),(0,a.jsx)("span",{className:"shrink-0 text-sm",children:u.length})]})})}),(0,a.jsx)(ep.GM,{...tA.dd,children:p?(0,a.jsx)("p",{children:o("file_upload.disabled_because_deep_research")}):d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:o("file_upload.enabled")}),(0,a.jsx)(tL.m,{hotkey:"/",className:"px-1 text-sm"})]}):(0,a.jsx)("p",{children:o("file_upload.disabled")})})]})};function tG(e){let{agent:t,handleNewFiles:n,supportedFiles:i,isLoading:l,side:r,showDrawerOption:s}=e,o=(0,f.useRef)(null),c=(0,h.c3)("Chat"),d=(0,I.Ub)("(pointer: coarse)"),u=(0,I.DE)(),[m,p]=(0,f.useState)(void 0),[g,x]=(0,f.useState)(void 0);return eL._.NEXT_PUBLIC_DISABLE_DOCUMENT_LIBRARY?(0,a.jsx)(tM,{isLoading:l,handleNewFiles:n,supportedFiles:i,iconOnly:!0}):u&&(d||s)?(0,a.jsxs)(em._s,{open:m,onOpenChange:p,children:[(0,a.jsx)(em.Uz,{disabled:l,asChild:!0,children:(0,a.jsx)(tV,{isLoading:l||!u})}),(0,a.jsxs)(em.zj7,{className:"bg-default text-start md:px-12","aria-describedby":c("files.aria_description"),children:[(0,a.jsxs)(em.s6o,{children:[(0,a.jsx)(em.gkR,{inert:!0,children:c("files.aria_title")}),(0,a.jsx)(em.I6p,{inert:!0,children:c("files.aria_description")})]}),(0,a.jsx)(tz,{agent:t,handleNewFiles:e=>{n(e),p(!1)},supportedFiles:i,className:"m-auto h-[75vh] w-full max-w-3xl border-none bg-inherit shadow-none"}),(0,a.jsx)(em.tbu,{className:"space-y-4"})]})]}):(0,a.jsxs)(em.AMh,{open:g,onOpenChange:x,children:[(0,a.jsx)(em.dTQ,{className:"pointer-events-none absolute start-0 top-0 z-0 h-full w-full"}),(0,a.jsx)(em.Wvm,{asChild:!0,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"file",multiple:!0,name:"file-upload",accept:(0,ey.v)(i),className:"hidden",ref:o,onChange:e=>{if(null!==o.current){try{o.current.value=""}catch(e){}o.current.click()}(0,tS.R)(e).then(e=>{n(e.filter(e=>e instanceof tO.A))})}}),(0,a.jsx)(tV,{isLoading:l})]})}),(0,a.jsx)(em.hlN,{className:"m-0 rounded-xl border-none bg-none p-0 shadow-none",align:"start",sideOffset:12,side:r,avoidCollisions:!1,children:(0,a.jsx)(tz,{agent:t,handleNewFiles:e=>{n(e),x(!1)},supportedFiles:i,className:"w-sm"})})]})}var tH=n(3324),tB=n(99681);let tY=e=>{var t;let{disabled:n,session:i,limit:l}=e,{features:r,selectedFeatures:s,setSelectedFeatures:o}=(0,eE.mr)(),c=(0,h.c3)("Chat"),d=(0,S.q2)(s);return r.includes(S.pZ)?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(tw.vu,{variant:"ghost",disabled:n,pressed:d,onPressedChange:()=>{if(d)return o(s.filter(e=>!(0,S.Ft)(e)));o((0,A.A)(s.filter(e=>e!==S.wt).concat(S.pZ)))},shape:"rounded",className:(0,eh.cn)("h-9 gap-0",n?"cursor-not-allowed":""),children:[(0,a.jsx)(tw.er,{...tA.dd,className:(0,eh.cn)(tA.QC),children:(0,a.jsx)(tA.Q$,{title:c("features.reasoning.tooltip_title"),description:c("features.reasoning.description"),displayFlashStatus:(null==i?void 0:i.acceleratedAnswersEnabled)&&(null!=(t=null==l?void 0:l.remainingPoints)?t:0)>0})}),(0,a.jsx)(tT,{icon:tB.A,label:c("features.reasoning.name"),isOpen:d})]})}):null};var tQ=n(82710),t$=n(23192),tK=n(3819);let tX=()=>(0,a.jsx)("div",{className:"flex size-12 shrink-0 items-center justify-center rounded-md bg-subtle",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 298.24155 298.24154",width:24,height:24,className:"text-hint",fill:"currentColor",children:(0,a.jsx)("polygon",{points:"242.424,90.909 242.424,121.212 212.121,121.212 212.121,151.515 181.818,151.515 181.818,121.212 151.515,121.212 151.515,90.909 121.212,90.909 121.212,212.121 90.909,212.121 90.909,242.424 181.818,242.424 181.818,212.121 151.515,212.121 151.515,181.818 181.818,181.818 181.818,212.121 212.121,212.121 212.121,181.818 242.424,181.818 242.424,212.121 212.121,212.121 212.121,242.424 303.03,242.424 303.03,212.121 272.727,212.121 272.727,90.909",transform:"translate(-47.848728,-17.545727)"})})}),tq=e=>{let{onOpenChange:t,agentId:n,onSelectLeChatAgent:i,onSelectAgentsApiAgent:r,session:s,className:o,agentListClassName:c}=e,d=(0,h.c3)("Chat"),u=(0,h.c3)("Agents"),m=null===n?"<no-agent>":n,g=(0,p.useRouter)(),x=eC.api.useUtils(),v=eC.api.agent.create.useMutation({onSuccess(){x.agent.list.invalidate()},onError(){em.oRP.error(d("message_input.agents.create_new_agent_error"))}}),{data:b}=eC.api.agent.list.useQuery(s?{includeUntouched:!0}:l.hT),{data:_}=eC.api.agent.agentsApiList.useQuery(s&&s.organization.featureFlags.agent_k?void 0:l.hT),y=null==b?void 0:b.filter(e=>"active"===e.status||e.id===n),j=eC.api.agent.templates.useQuery(),[E,N]=f.useState("");return(0,a.jsxs)(em.uBz,{className:(0,eh.cn)(o),children:[(0,a.jsx)(em.G7v,{placeholder:d("message_input.agents.search_placeholder"),className:"h-12 bg-inherit p-2",onValueChange:e=>{if(" "===e)return t(!1);N(e)},onKeyDown:e=>{(0,t$.W)(e)&&""===E&&(e.preventDefault(),t(!1))},children:(0,a.jsxs)(ep.$n,{variant:"ghost",onClick:async()=>{let e=await v.mutateAsync({name:u("list.new_agent_default_name")});g.push("/agents/".concat(e.id))},isDisabled:v.isPending,size:"sm",children:[(0,a.jsx)(ep.IM,{children:(0,a.jsx)(tR.A,{className:"size-3 bg-state-ghost"})}),d("message_input.agents.create_new_agent_cta")]})}),(0,a.jsxs)(em.oIj,{className:(0,eh.cn)("px-1 py-2",c),children:[(0,a.jsx)(em.xLI,{children:d("message_input.agents.search_results_empty")}),y&&y.length>0&&(0,a.jsx)(em.L$M,{heading:d("message_input.agents.category_le_chat"),children:(0,a.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:y.map(e=>(0,a.jsxs)(em.h_I,{className:"cursor-pointer gap-4 rounded-lg transition-colors duration-100",keywords:[e.name],value:e.id,onSelect:e=>{let n=y.find(t=>t.id===e);n&&(i(n),t(!1))},children:[e.avatar?(0,a.jsx)(tK.m,{avatar:e.avatar,className:"flex size-12 shrink-0 items-center justify-center rounded-md",children:(0,a.jsx)(tK.l,{size:24})}):(0,a.jsx)(tX,{}),(0,a.jsxs)("div",{className:"min-w-0 grow",children:[(0,a.jsx)("div",{className:"min-w-0 overflow-hidden text-sm font-medium text-ellipsis whitespace-nowrap text-default",children:e.name}),(0,a.jsx)("div",{className:"mt-1 min-w-0 overflow-hidden text-xs text-ellipsis whitespace-nowrap text-hint",children:e.description})]}),(0,a.jsx)(tQ.A,{className:(0,eh.cn)("ms-auto size-[1em] shrink-0",m!==e.id&&"invisible")})]},e.id))})}),j.data&&y&&y.length<3&&(0,a.jsx)(em.L$M,{heading:d("message_input.agents.category_default"),children:(0,a.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:j.data.filter(e=>y.every(t=>t.createdFromTemplateId!==e.id)).map(e=>(0,a.jsxs)(em.h_I,{className:"cursor-pointer gap-4 rounded-lg transition-colors duration-100",keywords:[e.name],value:e.id,onSelect:async()=>{i(await v.mutateAsync({templateId:e.id})),t(!1)},children:[(0,a.jsx)(tK.m,{avatar:e.avatar,className:"flex size-12 shrink-0 items-center justify-center rounded-md",children:(0,a.jsx)(tK.l,{size:24})}),(0,a.jsxs)("div",{className:"min-w-0 grow",children:[(0,a.jsx)("div",{className:"min-w-0 overflow-hidden text-sm font-medium text-ellipsis whitespace-nowrap text-default",children:e.name}),(0,a.jsx)("div",{className:"mt-1 min-w-0 overflow-hidden text-xs text-ellipsis whitespace-nowrap text-hint",children:e.description})]}),(0,a.jsx)(tQ.A,{className:(0,eh.cn)("ms-auto size-[1em] shrink-0",m!==e.id&&"invisible")})]},e.id))})}),_&&_.length>0&&(0,a.jsx)(em.L$M,{heading:d("message_input.agents.category_agents_api"),children:(0,a.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:_.map(e=>(0,a.jsxs)(em.h_I,{className:"cursor-pointer gap-4 rounded-lg transition-colors duration-100",keywords:[e.name],value:e.id,onSelect:()=>{r(e.id),t(!1)},children:[(0,a.jsx)(tX,{}),(0,a.jsxs)("div",{className:"min-w-0 grow",children:[(0,a.jsx)("div",{className:"min-w-0 overflow-hidden text-sm font-medium text-ellipsis whitespace-nowrap text-default",children:e.name}),(0,a.jsx)("div",{className:"mt-1 min-w-0 overflow-hidden text-xs text-ellipsis whitespace-nowrap text-hint",children:e.description})]}),(0,a.jsx)(tQ.A,{className:(0,eh.cn)("ms-auto size-[1em] shrink-0",m!==e.id&&"invisible")})]},e.id))})})]})]})};function tW(e){let{open:t,onOpenChange:n,agentId:i,onSelectLeChatAgent:l,onSelectAgentsApiAgent:r,session:s,side:o}=e;return(0,a.jsxs)(em.AMh,{open:t,onOpenChange:e=>n(e),children:[(0,a.jsx)(em.dTQ,{className:"pointer-events-none absolute start-0 top-0 z-0 h-full w-full"}),(0,a.jsx)(em.hlN,{className:"m-0 w-[var(--radix-popover-trigger-width)] rounded-xl border-none bg-none p-0 shadow-none",side:o,align:"start",sideOffset:12,avoidCollisions:!1,onCloseAutoFocus:e=>{e.preventDefault()},children:(0,a.jsx)(tP.W2,{className:tP.I6,children:(0,a.jsx)(tq,{agentId:i,onOpenChange:n,onSelectLeChatAgent:l,onSelectAgentsApiAgent:r,session:s})})})]})}var tZ=n(16273);let tJ=e=>{let{session:t,isDisabled:n,isDeepResearchEnabled:i,onPointerDown:l,...r}=e,s=(0,h.c3)("Chat.message_input.agents");return(0,a.jsx)(ep.$n,{...r,"aria-label":"Select agent",variant:t&&!n?"brand":"secondary",isDisabled:n,icon:(0,a.jsx)(tZ.n,{session:t,iconScale:1,size:"20",inverted:n,className:"bg-transparent"}),mode:"icon-only",onPointerDown:e=>{e.preventDefault(),null==l||l()},className:(0,eh.cn)({"cursor-not-allowed":n}),children:(0,a.jsxs)(ep.GM,{...tA.dd,children:[s(n?i?"disabled_because_deep_research":"disabled":"tooltip"),!n&&(0,a.jsx)(tL.m,{hotkey:"@",className:"px-1 text-sm"})]})})},t0=e=>{let{agentId:t,session:n,agentsComboboxOpen:i,setAgentsComboboxOpen:l,onSelectLeChatAgent:o,onSelectAgentsApiAgent:c,side:d,showDrawerOption:u}=e,m=(0,h.c3)("Chat.message_input.agents"),p=(0,eE.xn)(S.wt),g=!n||p,f=(0,I.DE)(),x=(0,I.Ub)("(pointer: coarse)");return f&&(x||u)?(0,a.jsxs)(em._s,{open:i,onOpenChange:l,children:[(0,a.jsx)(em.Uz,{asChild:!0,disabled:g,children:(0,a.jsx)(tJ,{isDeepResearchEnabled:p,isDisabled:g,session:n})}),(0,a.jsxs)(em.zj7,{className:"bg-default text-start md:px-12","aria-describedby":m("tooltip"),children:[(0,a.jsxs)(em.s6o,{children:[(0,a.jsx)(em.gkR,{inert:!0,children:m("tooltip")}),(0,a.jsx)(em.I6p,{inert:!0,children:m("tooltip")})]}),(0,a.jsx)(tq,{onSelectLeChatAgent:o,onSelectAgentsApiAgent:c,agentId:t,onOpenChange:l,session:n,className:"h-[75vh] bg-inherit",agentListClassName:"max-h-full"}),(0,a.jsx)(em.tbu,{className:"space-y-4"})]})]}):(0,a.jsxs)(a.Fragment,{children:[!g&&(0,a.jsx)(tW,{onSelectLeChatAgent:o,onSelectAgentsApiAgent:c,agentId:t,onOpenChange:l,open:i,session:n,side:d}),(0,a.jsx)(r.N,{initial:!1,children:!t&&(0,a.jsx)(s.P.div,{initial:{width:0},animate:{width:"auto"},exit:{width:0},transition:{duration:.2,ease:"easeInOut"},className:"shrink-0",children:(0,a.jsx)(tJ,{isDeepResearchEnabled:p,isDisabled:g,session:n,onPointerDown:()=>l(!0)})})})]})},t1=e=>{var t,n,i,l,r,s,o,c;let{handleNewFiles:d,session:u,isLoading:m,showDrawer:p,agent:h,side:g,agentsComboboxOpen:f,agentsApiAgent:x,onSelectAgentsApiAgent:v,setAgentsComboboxOpen:b,onSelectLeChatAgent:_,onDeepResearchExceeded:y,incognito:j}=e,E=(0,ey.j)(),{isLoading:N,availableIntegrationIds:A,features:I,isDisabledFeaturesSelection:w}=(0,eE.mr)(),T=I.length>0,C=A.length>0,S=(0,eg.m)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t0,{agentId:null!=(r=null!=(l=null==h?void 0:h.id)?l:null==x?void 0:x.id)?r:null,agentsComboboxOpen:f,setAgentsComboboxOpen:b,onSelectLeChatAgent:_,onSelectAgentsApiAgent:v,session:u,side:g,showDrawerOption:p}),(0,a.jsx)(tG,{agent:h,handleNewFiles:d,isLoading:m,supportedFiles:E,showDrawerOption:p,side:g}),(null==u?void 0:u.organization.featureFlags.je_cherche_encore)&&!j&&(0,a.jsx)(tC,{session:u,disabled:m||w,regularDRLimit:null!=(s=null==(t=S.data)?void 0:t.deep_research)?s:null,fastDRLimit:null!=(o=null==(n=S.data)?void 0:n.fast_deep_research)?o:null,loading:S.isLoading,onDeepResearchExceeded:y}),(0,a.jsx)(tY,{disabled:m||w,session:u,limit:null!=(c=null==(i=S.data)?void 0:i.fast_reasoning)?c:null}),(T||C)&&(0,a.jsx)(tH._,{session:u,disabled:m||N,isLoading:m,showDrawer:p,agent:h,side:g})]})};var t2=n(1518),t3=n(95247),t4=n(14847),t5=n(83407),t6=n(38178),t8=n(39299),t7=n(1672);let t9=["discover","visualize","learn","productivity","image"],ne=e=>{var t;let{onSelectSuggestion:n,maxSuggestions:i,enableDynamicSuggestions:l}=e,{availableIntegrationData:r,isLoading:s,features:o}=(0,eE.mr)(),{data:c}=eC.api.experiments.getPersonalizedSuggestions.useQuery(void 0,{enabled:l}),d=eC.api.suggestions.getStaticSuggestions.useQuery(void 0);if(s||d.isLoading||!(null==(t=d.data)?void 0:t.staticSuggestions))return null;let u=l?null==c?void 0:c.dynamicSuggestions:void 0;return(0,a.jsx)(nt,{onSelectSuggestion:n,maxSuggestions:i,availableIntegrationData:r.map(e=>e.computedIntegrationInfo),features:o,staticSuggestions:d.data.staticSuggestions,dynamicSuggestions:u})},nt=e=>{let{availableIntegrationData:t,features:n,staticSuggestions:i,dynamicSuggestions:l,onSelectSuggestion:r,maxSuggestions:s}=e,o=(e=>{let{suggestionData:t,availableIntegrationData:n,availableFeatures:a}=e;return t.map(e=>{if(!(e=>{let{suggestion:t,availableIntegrationData:n,availableFeatures:a}=e,i=n.filter(e=>{var n;return(0,t7.PT)(e.dbName)&&(null==(n=t.startChatAction.requiredIntegrations)?void 0:n.includes(e.dbName))}),l=t.startChatAction.requiredIntegrations&&i.length<t.startChatAction.requiredIntegrations.length,r=t.startChatAction.requiredFeatures&&t.startChatAction.requiredFeatures.some(e=>!a.includes(e));return!l&&!r})({suggestion:e,availableIntegrationData:n,availableFeatures:a}))return;let t=n.filter(t=>{var n;return(0,t7.PT)(t.dbName)&&(null==(n=e.startChatAction.requiredIntegrations)?void 0:n.includes(t.dbName))});return{...e,integrationsAdditionalData:t.map(e=>({id:e.id,shouldActivate:!e.isReady,connectionInformation:e}))}}).filter(e=>void 0!==e)})({suggestionData:i,availableIntegrationData:t,availableFeatures:n});return(0,a.jsx)(no,{actionableSuggestionsWithPrompt:o,dynamicSuggestions:l,onSelectSuggestion:r,maxSuggestions:s})},nn=e=>{let{onClick:t,active:n,className:i,icon:l,label:r}=e;return(0,a.jsxs)(tw.vu,{size:"lg",onPressedChange:e=>null==t?void 0:t(e),className:(0,eh.cn)("rounded-lg border-[0.5px] p-3 select-none","@xl/suggestion-categories:p-2",i),pressed:n,variant:"brand",value:r,children:[l&&(0,a.jsx)(tw.gM,{icon:l}),r&&(0,a.jsx)("div",{className:(0,eh.cn)(!n&&"hidden @xl/suggestion-categories:block"),children:r})]})},na={discover:t2.A,visualize:t3.A,learn:tB.A,productivity:t4.A,image:t5.A},ni=["discover","visualize","learn","productivity","image"],nl=e=>{let{isCategorySelected:t,selectedCategory:n,selectCategory:i,categorizedSuggestions:l}=e,o=(0,h.c3)("Chat");return(0,a.jsx)(s.P.div,{layout:!0,className:(0,eh.cn)("group/suggestion-categories","@container/suggestion-categories","flex w-full flex-row gap-2",t?"":"justify-center",t&&"cursor-pointer"),transition:{duration:.15},onClick:()=>{t&&i(void 0)},children:(0,a.jsx)(r.N,{children:ni.filter(e=>l[e].length>0&&(void 0===n||e===n)).map(e=>{let t=e===n;return(void 0===n||t)&&(0,a.jsxs)(s.P.div,{layout:!0,initial:{opacity:0,transition:{delay:.2}},animate:{opacity:1},exit:{opacity:0,transition:{duration:0}},transition:{duration:.1},className:"flex gap-2",children:[(0,a.jsx)(nn,{icon:na[e],active:t,onClick:t=>{i(t?e:void 0)},label:o("suggestions.categories.".concat(e))}),t&&(0,a.jsx)(s.P.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,delay:.15},children:(0,a.jsx)(nn,{icon:d.A,active:!1,onClick:()=>{i(void 0)},className:(0,eh.cn)("p-2","group-hover/suggestion-categories:bg-state-ghost-hover group-hover/suggestion-categories:text-default")})})]},e)})})})},nr=e=>{let{actionableSuggestions:t,onSelectSuggestion:n,maxSuggestions:i}=e,l=(0,f.useMemo)(()=>(0,t8.k)(Array(t.length).fill(void 0).map((e,t)=>t)),[t.length]).map(e=>t[e]).filter(e=>!!e).slice(0,null!=i?i:void 0);return(0,a.jsx)(r.N,{children:l.map((e,t)=>(0,a.jsx)(s.P.button,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.07,delay:.015*t},className:(0,tu.M0)({size:"default",variant:"subtle",className:"group/suggestion-prompt w-full cursor-pointer rounded-sm select-none"}),onClick:()=>n(e),children:(0,a.jsxs)("div",{className:(0,eh.cn)("w flex w-fit gap-2 rounded-sm px-2 py-1","group-hover/suggestion-prompt:bg-state-ghost-hover"),children:[(0,a.jsx)("div",{className:"flex h-4 pt-1",children:(0,a.jsx)(t6.A,{className:"size-4"})}),(0,a.jsx)("div",{className:"text-start text-wrap",children:e.startChatAction.userPrompt})]})},t))})},ns=e=>{let{activeCategoryName:t}=e,n=(0,h.c3)("Chat");return(0,a.jsxs)("div",{className:(0,eh.cn)("flex items-center gap-2 p-2",(0,tu.M0)({variant:"muted",size:"sm",weight:"normal"})),children:[(0,f.createElement)(na[t],{className:"size-4"}),n("suggestions.categories.".concat(t))]})},no=e=>{let{onSelectSuggestion:t,maxSuggestions:n,actionableSuggestionsWithPrompt:i,dynamicSuggestions:l}=e,[r,s]=(0,f.useState)(),o=t9.reduce((e,t)=>(e[t]=i.filter(e=>e.category===t),e),{}),c=(0,I.Ub)("(pointer: coarse)"),d=(0,I.DE)()&&c;return(0,a.jsxs)("div",{className:"flex w-full flex-col gap-4",children:[(0,a.jsx)(nl,{isCategorySelected:!!r,selectCategory:s,categorizedSuggestions:o,selectedCategory:r}),r&&!d&&(0,a.jsx)("div",{className:"flex w-full flex-col gap-3",children:(0,a.jsx)(nr,{maxSuggestions:n,actionableSuggestions:o[r],onSelectSuggestion:t})}),!r&&l&&l.length>0&&(0,a.jsx)("div",{className:"flex w-full flex-col gap-3",children:(0,a.jsx)(nr,{maxSuggestions:n,actionableSuggestions:l.map((e,t)=>({category:"personalized",label:e,startChatAction:{type:"user-prompt",userPrompt:e,requiredFeatures:[],requiredIntegrations:[]},integrationsAdditionalData:[],key:"dynamic-suggestions-".concat(t)})),onSelectSuggestion:t})}),(0,a.jsx)(em._s,{open:!!r&&d,onOpenChange:e=>{e||s(void 0)},children:(0,a.jsxs)(em.zj7,{className:"bg-default px-4 py-2 text-start md:px-12",children:[(0,a.jsx)(em.gkR,{inert:!0,children:r&&(0,a.jsx)(ns,{activeCategoryName:r})}),(0,a.jsx)("div",{className:"flex flex-col gap-2 pt-3 pb-8",children:r&&(0,a.jsx)(nr,{actionableSuggestions:o[r],onSelectSuggestion:t})})]})})]})},nc=T.Ik({message:T.Ik({richInput:T.YO(T.Ie()),transcriptions:T.YO(Y),voiceInputUrl:T.Yj().optional(),files:T.YO(T.Ie()),quote:T.Ie().optional(),action:T.Ie().optional(),canva:T.Ie().optional()}),agentId:T.Yj().nullable(),agentsApiAgentId:T.Yj().nullable()}).superRefine((e,t)=>{let n=e.message.richInput.filter(e=>"text"===e.type).length>0,a=e.message.files.length>0;[n,a,e.message.canva,e.message.voiceInputUrl].every((0,b.w)(_.z))&&t.addIssue({code:C.eq.custom,message:"Empty message",path:["message"]})}),nd=e=>e.reduce((e,t)=>("text"===t.type?e+=t.content.length:e+=t.content.selectedLabel.length,e),0),nu=e=>{var t,n,b,_,T,C,R,D,O,P,k;let{defaultValue:M,defaultAgentId:U,defaultAgentsApiAgentId:F,defaultModel:z,onSubmit:V,onCancel:G,onStop:H,chatId:B,className:Y,session:Q,isLoading:$=!1,editMode:K=!1,dragAndDropDisabled:W=!1,onChange:Z,placeholder:J,disabled:ee=!1,notification:et,autoFocus:en=!0,incognito:ea,showSuggestions:el}=e,er=(0,h.c3)("Chat"),{isSampleAgentChat:es,agentId:eo}=(0,eZ.r)(),ec=(0,v.mN)({resolver:(0,i.u)(nc),defaultValues:{message:{richInput:(null==M?void 0:M.richInput)&&M.richInput.length>0?M.richInput:(null==M?void 0:M.text)?[{type:"text",content:M.text}]:[],transcriptions:null!=(b=null==M?void 0:M.transcriptions)?b:[],voiceInputUrl:null!=(_=null==M?void 0:M.voiceInputUrl)?_:void 0,files:null!=(T=null==M?void 0:M.files)?T:[],canva:null!=(C=null==M?void 0:M.canva)?C:void 0,quote:null!=(R=null==M?void 0:M.quote)?R:void 0,action:null!=(D=null==M?void 0:M.action)?D:void 0},agentId:null!=eo?eo:U,agentsApiAgentId:null!=F?F:null},mode:"onChange"}),eO=(0,f.useRef)(null);(0,f.useEffect)(()=>{es||(ec.setValue("agentsApiAgentId",null!=F?F:null),ec.setValue("agentId",null!=U?U:null))},[U,ec,es,F]);let eL=[ec.getValues("message.canva"),ec.getValues("message.files"),ec.getValues("message.richInput").filter(e=>{let{type:t}=e;return"text"===t})].every(y.I),eP=(0,I.DK)(Z);(0,f.useEffect)(()=>{eP&&ec.watch(e=>{eP(e)})},[ec,eP]);let[ek,eM]=(0,f.useState)(!1),eU=(0,p.useRouter)(),{audioFeatureStatus:eF}=(0,eA.C)(S.BN)?{audioFeatureStatus:Q?"enabled":"nudge"}:{audioFeatureStatus:"disabled"},[ez,eV]=(0,f.useState)((0,w.A)()),{isDesktop:eG,desktopApi:eH}=(0,ef.A)(),{recorder:eB,recordingTime:eQ,startRecording:eK,stopRecording:eX,reset:eq,isRecording:eW,isSupported:e1}=ei({onNotAllowedOrFound:e=>{nU(eN.f.AUDIO_ERROR,{...e,recording_id:ez}),em.oRP.error(er("audio.errors.recording"))}}),{isProcessingAudio:e2,isAutoSendEnabled:e3,handleToggleAutoSend:e4,handleAudioSubmission:e5}=function(e){let{recordingId:t,stopRecording:n,onTranscriptionInput:a,onVoiceInput:i,submitForm:l}=e,r=(0,h.c3)("Chat"),[s,o]=(0,f.useState)(!1),[c,d]=(0,I.Mj)("isAutoSendEnabled",!0),{transcribeAudioFile:u}=function(){let e=eC.api.message.transcribe.useMutation();return{transcribeAudioFile:(0,f.useCallback)(async t=>{let{blob:n,recordingId:a}=t,i=await (0,eT.BI)(await n.arrayBuffer());if(!i)throw Error("Could not determine type of audio file");let l=new File([n],"recording.".concat(i.ext),{type:n.type||i.mime,lastModified:Date.now()}),r=new FormData;r.append("file",l),r.append("recordingId",a);let{originalTranscript:s,url:o,transcriptionId:c}=await e.mutateAsync(r);return{originalTranscript:s,url:o,transcriptionId:null!=c?c:void 0,recordingId:a}},[e])}}(),{track:m}=(0,eN.n)(),{play:p}=ed("/sounds/audio-submission.mp3",{volume:.1}),g=(0,f.useCallback)(async e=>{let n=await u({blob:e,recordingId:t});m(eN.f.AUDIO_SEND_RECORDING,{correlation_id:n.transcriptionId,recording_id:n.recordingId}),a(n)},[t,u,m,a]),x=(0,f.useCallback)(async e=>{var t;let n=await (0,ew.XK)(e),a=null==(t=(await (0,ew.Zn)([n],r))[0])?void 0:t.url;if(!a)return void em.oRP.error(r("audio.errors.processing"));i(a),l()},[i,l,r]),v=(0,f.useCallback)(async()=>{o(!0);try{let e=await n();if(!e)return;c?await x(e):await g(e),await p()}catch(n){m(eN.f.AUDIO_ERROR,{...n instanceof Error?n:{},recording_id:t});let e=(0,eI.p6)({error:n,t:r});e&&em.oRP.error(e)}finally{o(!1)}},[c,x,g,p,t,m,r,n]);return{isProcessingAudio:s,isAutoSendEnabled:c,handleToggleAutoSend:(0,f.useCallback)(()=>{d(e=>!e)},[d]),handleAudioSubmission:v}}({recordingId:ez,stopRecording:eX,onTranscriptionInput:e=>{var t;let n=ec.getValues("message.richInput"),a=n.findLast(e=>"text"===e.type),i=(null==a?void 0:a.content)&&!a.content.endsWith(" ")?" ":"";ec.setValue("message.richInput",[...n,{type:"text",content:"".concat(i).concat(null!=(t=e.originalTranscript)?t:"")}],{shouldValidate:!0});let l=ec.getValues("message.transcriptions");ec.setValue("message.transcriptions",[...l,e],{shouldValidate:!0})},onVoiceInput:e=>ec.setValue("message.voiceInputUrl",e),submitForm:()=>{var e,t;(null==(e=eO.current)?void 0:e.requestSubmit)?eO.current.requestSubmit():null==(t=eO.current)||t.submit()}});(0,f.useEffect)(()=>{0===ec.getValues("message.richInput").filter(e=>"text"===e.type).length&&ec.setValue("message.transcriptions",[])},[ec]);let e8=async()=>{if("disabled"===eF)return;if("nudge"===eF)return void(eG&&eH?eH.login():eU.push("/login"));let e=(0,w.A)();eV(e),nU(eN.f.AUDIO_START_RECORDING,{recording_id:e});try{await eK()}catch(t){nU(eN.f.AUDIO_ERROR,{...t instanceof Error?t:{},recording_id:e})}},{isLoading:e7,selectedFeatures:e9,setSelectedFeatures:ts,setSelectedIntegrations:to,selectedIntegrations:tc,allowedFeatures:td,setIsDisabledFeaturesSelection:tu}=(0,eE.mr)(),{openCanva:tp,tempCanva:tf,setHandleSubmit:tx,isGeneratingMetadata:tv,deleteTemparyCanva:ty,toggleTempCanva:tj,createTemporaryCanva:tI}=(0,tn.o)(),tw=(0,f.useCallback)(()=>{tj(),e9.includes("beta-trampoline")||tp||ts([...e9,"beta-trampoline"])},[e9,ts,tj,tp]),tT=eC.api.canva.getMetadata.useMutation();(0,f.useEffect)(()=>{ec.setValue("message.canva",null!=tf?tf:void 0)},[ec,tf]);let tC=ec.watch("message.files"),tS=tC.filter(e=>void 0===e.inlinePositionId),tR=(0,f.useCallback)(e=>{e.forEach(e=>{em.oRP.error(er("file_upload.".concat(e.error.code),e.error.args))})},[er]),{supportedFileExtension:tD}=(0,ey.j)(),tO=(0,f.useCallback)((e,t,n)=>{let a,i=ec.getValues("message.files");if(!Q)return;let l={image:0,document:0,spreadsheet:0,text:0},r=e.map(e=>{var t,n;let a=null!=(t=e.name.split(".").pop())?t:"",i=null!=(n=Object.keys(L.NP).find(t=>{let n=L.NP[t].map(e=>e.mime).includes(e.type),i=L.NP[t].map(e=>e.extension).includes(a);return n||i}))?n:"unsupported",r={type:i,name:e.name,data:e,mimeType:"text"===i?e.type||"text/plain":e.type};return l[i]+=1,r});for(let e=0;e<L.a0.length;e++){let t=L.a0[e];if(t){if(0!==l[t]){if(a=eY(t,l[t],(0,L.UI)(i,t).length))return void em.oRP.error(er("file_upload.".concat(a.code),{count:a.count,fileType:a.fileType}));["spreadsheet","text"].includes(t)&&!e9.includes(S.Wc)&&ts([...e9,S.Wc])}}}r.length&&e$(r,tD).then(async e=>{let{acceptedFiles:a,errors:l}=e;tR(l);let r=await Promise.all(a.map(async e=>"image"===e.type&&e.data?{...e,inlinePositionId:t,b64Data:await (0,ew.bB)(e.data)}:{...e,inlinePositionId:t}));ec.setValue("message.files",[...i.filter(e=>!e.inlinePositionId||e.inlinePositionId!==n),...r],{shouldValidate:!0})})},[ec,Q,er,tD,e9,ts,tR]),{isDragging:tL}=(0,eu.Ur)({fileHandler:tO,disableDrag:!Q||W}),tP=(0,f.useCallback)(e=>{let t=ec.getValues("message.files");ec.setValue("message.files",t.filter(t=>t.inlinePositionId!==e))},[ec]),{withDocumentPayload:tk,setSelectedLibrary:tM}=(0,e_.TY)(),{getDocumentFileFromId:tU}=(0,eb.Sn)(),tF=(0,f.useRef)(!1);(0,f.useEffect)(()=>{tk&&!tF.current&&(async()=>{tF.current=!0;let e=await tU({documentId:tk.documentId,libraryId:tk.libraryId});(0,eb.zz)(e)?tO([e.file]):tF.current=!1})()},[tU,tO,tk]);let tz=(0,eg.m)(),tV=(e=>(null==e?void 0:e.organization.featureFlags.reasoning_model_rc)&&q._K.NEXT_PUBLIC_MULTIMODAL_REASONING_RC||!(null==e?void 0:e.organization.featureFlags.reasoning_model_rc)&&q._K.NEXT_PUBLIC_MULTIMODAL_REASONING)(Q),[tG,tH]=(0,I.Mj)("hide-message-input-banner-reasoning-fast",!1),tB=(0,S.q2)(e9),tY=(0,tg.Ed)({id:"no-image-with-reasoning",type:"blocker",active:!tV&&(0,L.UI)(tC,"image").length>0&&tB,element:(0,a.jsx)(tg.Kv,{onDisableClick:()=>{ts((0,j.i)(e9,S.op))}})}),tQ=tB?14e4:258e3,[t$,tK]=(0,f.useState)(((e,t)=>0===e?"empty":e>t?e:"within-limit")(nd(null!=(O=null==M?void 0:M.richInput)?O:[]),tQ)),tX=(0,f.useCallback)(e=>{let t=nd(e);if(0===t&&"empty"!==t$)return void tK("empty");t<=tQ&&null!==t$&&tK("within-limit"),t>tQ&&tK(t)},[tQ,t$,tK]),tq=(0,tg.Ed)({id:"max-length-exceeded",type:"blocker",active:"within-limit"!==t$&&"empty"!==t$,element:(0,a.jsx)(tg.xb,{contentLength:Number(t$),maxContentLength:tQ})}),[tW,tZ]=(0,f.useState)(!1),tJ=(0,tg.Ed)({id:"deep-research-limit-exceed",type:"upsell",active:tW,element:(0,a.jsx)(tb,{onDismiss:()=>tZ(!1)})}),[t0,t2]=(0,f.useState)(!1),t3=(0,tg.Ed)({id:"fast-deep-research-limit-exceed",type:"subtle",active:t0,element:(0,a.jsx)(t_,{onDismiss:()=>t2(!1)})}),t4=(0,f.useCallback)((e,t)=>{"dr-limit-exceeded"===e&&(t2(!1),tZ(e=>void 0!==t?t:!e)),"fast-dr-limit-exceeded"===e&&(tZ(!1),t2(e=>void 0!==t?t:!e))},[]),t5=(0,tg.Ed)({id:"reasoning-logged-out",type:"blocker",active:!Q&&tB,element:(0,a.jsx)(tg.wz,{onDisableClick:()=>{ts((0,j.i)(e9,S.op))}})}),[t6,t8]=function(){var e,t;let{availableIntegrationData:n,selectedIntegrations:a,setSelectedIntegrations:i}=(0,eE.mr)(),l=(0,I.DK)(()=>{i(n.filter(e=>a.includes(e.id)).filter(e=>tE(e.name)).map(e=>e.id))}),r=n.filter(e=>a.includes(e.id)).some(e=>!tE(e.name)),s=null!=(t=null==(e=(0,eg.m)().data)?void 0:e.connector_tool_call.remainingPoints)?t:0;return[r&&s<=0,l]}(),t7=(0,tg.Ed)({id:"connector-tools-rate-limit-exceeded",type:"blocker",active:(null==(t=tz.data)?void 0:t.connector_tool_call.remainingPoints)===0&&t6,element:(0,a.jsx)(tN,{onDismiss:t8})}),t9=!!tf&&!e9.includes("beta-trampoline")||tT.isPending,nt=(0,tg.Ed)({id:"reasoning-flash-upsell",type:"upsell",active:!(null==Q?void 0:Q.isLeChatPro)&&(null==(n=tz.data)?void 0:n.fast_reasoning.remainingPoints)===0&&tB&&!tG,element:(0,a.jsx)(tg.fv,{onHideClick:()=>{tH(!0)}})}),nn=(0,I.DE)(),na="disabled"!==eF&&(e1||!nn),ni=na?!eW&&!e2&&!$&&G:!$&&G,nl=na?!eW&&!e2&&!$&&!eL:!$,nr=!!na&&!eW&&!e2,ns=!!na&&(eW||e2),no=ec.formState.isValid,nu=[et,tY,t5,tq,t7,nt,tJ,t3].filter(E.h).find((0,N._)("active")),nm=!!nu,np=(null==nu?void 0:nu.type)==="blocker",nh=!($||e7||ee||t9||np),ng=eS.E.use.unsetDraftMessageByChatId(),nf=(0,f.useRef)(null),nx=(0,I.DK)(e=>{var t,n;if(!nh)return;nO.cancel(),B&&ng(B);let{richInput:a,voiceInputUrl:i,...l}=e.message,r=i?{voiceInputUrl:i,richInput:[],inputValue:[],transcriptions:void 0}:{richInput:a,inputValue:(0,tl.vo)(e.message.richInput),transcriptions:e.message.transcriptions.length>0?e.message.transcriptions:void 0};V({value:{...l,...r},agentId:null!=(t=e.agentId)?t:null,agentsApiAgentId:null!=(n=e.agentsApiAgentId)?n:null,features:void 0!==e.features?e.features:e9,integrations:void 0!==e.integrations?e.integrations:tc,hasPastedText:ek}),nf.current&&(nf.current.value=[]),ec.reset(),i?(ec.setValue("message.richInput",e.message.richInput),ec.setValue("message.transcriptions",e.message.transcriptions)):nf.current&&(nf.current.value=[]),ec.setValue("agentId",e.agentId),ec.setValue("agentsApiAgentId",e.agentsApiAgentId),eM(!1)});(0,f.useEffect)(()=>{tx(V)},[tx,V]);let nv=(0,I.DK)((e,t)=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),!t&&(nL||x.Fr||nx(ec.getValues())))}),nb=(0,f.useRef)(null),{data:n_}=eC.api.agent.list.useQuery(Q?{includeUntouched:!0}:l.hT),ny=ec.watch("agentId"),nj=ny?null==n_?void 0:n_.find(e=>e.id===ny):void 0,{data:nE}=eC.api.agent.agentsApiList.useQuery(Q&&Q.organization.featureFlags.agent_k?void 0:l.hT),nN=ec.watch("agentsApiAgentId"),nA=nN?null==nE?void 0:nE.find(e=>e.id===nN):void 0;(0,f.useEffect)(()=>{var e;if(!nA)return void tu(!1);tu(!0);let t=[];null==(e=nA.originalTools)||e.forEach(e=>{("web_search"===e.type||"web_search_premium"===e.type)&&t.push(S.tE),"image_generation"===e.type&&t.push(S.eE),"code_interpreter"===e.type&&t.push(S.Wc),"document_library"===e.type&&tM(e.libraryIds)}),ts(t)},[nA,ts,tM,tu]),(0,f.useEffect)(()=>{nj&&(nj.features&&ts(nj.features),nj.integrations&&to(nj.integrations),nj.libraries&&tM(nj.libraries))},[nj,ts,to,tM]);let nI=nj||nA,nw=nI?tm("upsell"):nu?tm(nu.type):null,[nT,nC]=(0,f.useState)(!1),[,nS]=(0,g.ab)(e0.V),nR=eS.E.use.setDraftMessageByChatId(),nD=(0,I.DK)(e=>{let{chatId:t,editorState:n}=e;return nR(t,{serializedMessage:JSON.stringify(n)})}),nO=(0,I._6)(nD,1e3),nL=!no||!nh,{containerRef:nP,availableSpaceAbove:nk,availableSpaceBelow:nM}=(e=>{let t=(0,f.useRef)(null),n=(0,f.useRef)(!0),a=(0,f.useRef)(!0),[i,l]=(0,f.useState)(!0),[r,s]=(0,f.useState)(!0),o=(0,f.useCallback)(()=>{if(t.current){let i=t.current.getBoundingClientRect(),r=window.innerHeight-i.bottom,o=i.top,c=r>e,d=o>e;c!==n.current&&(n.current=c,l(c)),d!==a.current&&(a.current=d,s(d))}},[e]);return(0,I.wY)({ref:t,onResize:o}),(0,f.useEffect)(()=>(o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}),[o]),{containerRef:t,availableSpaceAbove:r,availableSpaceBelow:i}})(270),{track:nU}=(0,eN.n)();(e=>{let{selectedFeatures:t,setSelectedFeatures:n,setSelectedIntegrations:a,selectedIntegrations:i}=(0,eE.mr)(),{setSelectedLibrary:l,activeLibrarySelection:r}=(0,e_.TY)();(0,f.useEffect)(()=>{if(!e)return;let{inlineConnections:s,inlineTools:o,inlineLibraries:c}=(e=>{let t=e.filter(e=>"slash"===e.type&&"text-tag"===e.content.slashType),n=t.filter(e=>"slash"===e.type).map(e=>e.content.selectedValue).filter(S.hg);return{inlineTools:n,inlineConnections:t.filter(e=>"slash"===e.type).filter(e=>""!==e.content.iconUrl||"connection"===e.content.subType).map(e=>e.content.selectedValue),inlineLibraries:t.filter(e=>"slash"===e.type).filter(e=>"library"===e.content.subType||e.content.componentName===tr.A).map(e=>e.content.selectedValue)}})(e.richInput);o.length>0&&n([...new Set([...t,...o])]),s.length>0&&a([...new Set([...i,...s])]),c.length>0&&c[0]&&l([...new Set([...r,c[0]])])},[])})(M),function(e){let{richInputRef:t,isKeyboardEventDisabled:n=!1}=e,a=(0,f.useCallback)(()=>{let e=document.activeElement;return(null==e?void 0:e.tagName)==="INPUT"||(null==e?void 0:e.tagName)==="TEXTAREA"||"true"===e.contentEditable||(null==e?void 0:e.getAttribute("contenteditable"))==="true"},[]),i=(0,f.useCallback)(e=>{t.current&&(t.current.focus(),t.current.appendText(e))},[t]),l=(0,f.useCallback)(e=>{!n&&(!e.key||1!==e.key.length||e.ctrlKey||e.metaKey||e.altKey||e.isComposing||a()||(e.preventDefault(),e.stopPropagation(),i(e.key)))},[a,i,n]),r=(0,f.useCallback)(e=>{if(!t.current)return;let n=e.target;n&&n instanceof HTMLElement&&n.classList.contains(eJ)&&t.current.focus()},[t]),s=(0,f.useCallback)(e=>{var t;if(n||a())return;let l=null==(t=e.clipboardData)?void 0:t.getData("text/plain");l&&(e.preventDefault(),e.stopPropagation(),i(l))},[a,i,n]);(0,f.useEffect)(()=>(document.addEventListener("keydown",l),document.addEventListener("click",r),document.addEventListener("paste",s,!0),()=>{document.removeEventListener("keydown",l),document.removeEventListener("click",r),document.removeEventListener("paste",s,!0)}),[l,r,s])}({richInputRef:nf,isKeyboardEventDisabled:!!tp});let[nF,nz]=(0,f.useState)(null);return(0,a.jsxs)("div",{className:(0,eh.cn)("mb-0 flex w-full flex-col items-center rounded-xl transition-all",tp&&!K&&"md:mx-3","w-full gap-y-6"),children:[(0,a.jsxs)("form",{className:(0,eh.cn)("mb-0 w-full rounded-xl transition-all","w-full",!es&&"shadow-big",nw,!nw&&"delay-150",(nI||nm)&&"p-0.5",Y),onSubmit:ec.handleSubmit(nx),ref:eO,children:[(0,a.jsx)(r.N,{initial:!1,children:nI&&(0,a.jsx)(th,{agentName:null!=(P=null==nj?void 0:nj.name)?P:null==nA?void 0:nA.name,agentId:null!=(k=null==nj?void 0:nj.id)?k:null==nA?void 0:nA.id,onAgentDropdownClick:()=>{nC(!0)},showClose:!es,canEdit:!es&&!(null==nA?void 0:nA.id),onClose:()=>{ec.setValue("agentId",null),ec.setValue("agentsApiAgentId",null)}})}),(0,a.jsxs)("div",{inert:ee,className:(0,eh.cn)("relative w-full overflow-hidden rounded-[12px] bg-card transition-colors duration-300 ease-in-out"),children:[ee&&(0,a.jsx)("div",{"aria-label":"disabled-overlay",className:"absolute z-10 h-full w-full bg-state-disabled"}),(0,a.jsx)(r.N,{initial:!1,children:tS.length>0&&(0,a.jsx)(s.P.div,{className:"border-b border-dashed",initial:{height:0},animate:{height:"auto",overflow:"hidden"},exit:{height:0},transition:{duration:.2,ease:"easeInOut"},children:(0,a.jsx)("div",{className:"p-3",children:(0,a.jsx)(ev.r,{messageFiles:tS.map((e,t)=>({...e,onDelete:()=>ec.setValue("message.files",tC.filter((e,n)=>n!==t)),deleteMessage:er("file_upload.delete")}))})})})}),(0,a.jsx)(r.N,{children:!tf&&(null==Q?void 0:Q.organization.featureFlags["feathers-mcgraw"])&&(()=>{let e=ec.getFieldState("message.richInput");return e.isDirty&&!e.invalid})()&&(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(ep.$n,{variant:"ghost",className:"absolute end-4 top-5 z-10",mode:"icon-only",icon:(0,a.jsx)(o.A,{className:"size-[14px] text-icon-default-muted"}),size:"xs",onClick:()=>{(()=>{let e=(0,X.r)({contentChunks:(0,tl.vo)(ec.getValues("message.richInput"))});if(!(null==Q?void 0:Q.organization.featureFlags["feathers-mcgraw"])||!e||!td.includes("beta-trampoline"))return;let t=function(e,t,n){let a=-9.860574779222393;for(let n=0;n<e.length;n++){let i=t[n],l=e[n];i&&l&&(a+=i*l)}return a}(function(e){let t=[0,0,0,0,0,0,0,0];if(!e)return t;for(let n of e.matchAll(eR))for(let e=0;e<t.length;e++){let a=n[e+1];a&&a.length&&(t[e]=(t[e]||0)+a.length)}for(let n=0;n<t.length;n++)t[n]=(t[n]||0)/e.length;return t}(e),eD,0)>0?"code":"text";tI({content:e,inferedCanvaEditorType:t,onCleanValue:()=>{ec.resetField("message.richInput")},onToggleFeature:()=>{e9.includes("beta-trampoline")||ts([...e9,"beta-trampoline"])}})})()},children:(0,a.jsx)(ep.GM,{children:er("canvas.open_in_canva")})})})}),tL&&Q&&(0,a.jsx)(em.ZLI.Root,{children:(0,a.jsx)("div",{className:"fixed start-0 top-0 z-70 flex h-dvh w-dvw items-center justify-center bg-muted/70 p-1.5 backdrop-blur-xs",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 text-subtle",children:[(0,a.jsx)(c.A,{className:"h-8 w-8 text-icon-default",strokeWidth:1}),(0,a.jsx)("p",{className:"text-sm font-medium text-wrap",children:er("file_upload.dropzone")})]})})}),(0,a.jsxs)("div",{className:(0,eh.cn)("relative flex w-full flex-col px-4 pt-3 pb-4 max-sm:px-2",eJ,"hover:cursor-text",!!tp&&"px-2",ns&&"h-35 justify-end"),ref:nP,children:[ns?(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.15},className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(e6,{mediaStream:(null==eB?void 0:eB.stream)||null})}):(0,a.jsxs)(a.Fragment,{children:[tf&&!$&&(null==Q?void 0:Q.organization.featureFlags["feathers-mcgraw"])&&(0,a.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,a.jsxs)(ep.$n,{onClick:tw,variant:"secondary",type:"button",className:"m-0.5 flex w-full items-center justify-start gap-2 overflow-hidden rounded-lg bg-default px-3",children:[tt.e[tf.type]&&(0,a.jsx)("span",{className:"flex h-4 min-h-4 w-4 min-w-4 items-center justify-center p-0 group-hover/canva-card:text-default",children:tt.e[tf.type]}),tv?(0,a.jsx)(em.EAD,{className:"h-4 w-full"}):(0,a.jsx)("span",{className:"w-fit max-w-full overflow-hidden text-sm font-medium text-ellipsis group-hover/canva-card:text-default",children:tf.title})]}),(0,a.jsx)(ep.$n,{onClick:()=>{ty(),ec.resetField("message.canva")},variant:"ghost",mode:"icon-only",icon:d.A,className:"me-2 flex items-center justify-start gap-2 overflow-hidden rounded-lg p-0"})]}),(0,a.jsxs)(em.FKN,{className:"mb-5 min-h-10 w-full",viewportClassName:"max-h-[30vh]",children:[(0,a.jsx)(em.$H1,{}),nn?(0,a.jsx)(ex.w,{className:"my-1 w-full justify-center p-4",onError:e=>{nU(eN.f.MESSAGE_INPUT_RICH_INPUT_ERROR,{...e})},children:(0,a.jsx)(ta.O$,{uploadFiles:tO,getSelectedFile:()=>ec.getValues("message.files"),deleteFileByInlinePositionId:tP,children:(0,a.jsx)(v.xI,{name:"message.richInput",control:ec.control,render:e=>{let{field:t}=e;return(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(ti.R,{isSlashEnabled:!!Q,isMentionEnabled:!!Q,placeholder:null!=J?J:tp?er("canvas.input_placeholder"):er("message_input.placeholder"),ref:nf,onKeyDown:e=>nv(e,e.isComposing),onTextPasted:e=>{!ek&&e&&eM(!0)},onFilesPasted:tO,className:"px-0.5 py-2 caret-brand-500",autoFocus:en,newLineKey:"shift-enter",onChange:e=>{if(B)try{nO({chatId:B,editorState:e})}catch(e){}tX(e),t.onChange(e)},initialValue:t.value,mentionTrigger:{key:"@",onTrigger:e=>{if(es){var t;null==(t=nf.current)||t.insertTextAt("@",e)}else nb.current=e,nC(!0)}}})})}})})}):(0,a.jsx)(em.No,{autoFocus:!x.Fr&&en,disabled:!0,placeholder:null!=J?J:tp?er("canvas.input_placeholder"):er("message_input.placeholder"),className:(0,eh.cn)("focus-visible:ring-none firefox:min-h-16 sm:firefox:min-h-0 relative m-0 box-border h-10 min-h-0 resize-none border-0 bg-transparent px-[2px] text-base placeholder:text-placeholder focus-visible:ring-0 focus-visible:ring-offset-0 focus-visible:outline-hidden focus-visible:outline-0 sm:text-base")},x.Fr?"mobile":"desktop")]})]}),(0,a.jsxs)("div",{className:(0,eh.cn)("flex w-full max-w-full items-center justify-start gap-3 max-sm:gap-1",eJ,!!tp&&"gap-1"),children:[!ns&&(0,a.jsx)(t1,{showDrawer:!nk&&!nM,side:nM?"bottom":"top",session:Q,handleNewFiles:tO,isLoading:$,agent:nj,agentsApiAgent:nA,agentsComboboxOpen:nT,onDeepResearchExceeded:t4,incognito:ea,setAgentsComboboxOpen:e=>{var t,n,a;if(nC(e),e)return;let i=!!ec.getValues("agentId")||!!ec.getValues("agentsApiAgentId");nb.current&&!i?(null==(t=nf.current)||t.insertTextAt("@",nb.current),nb.current=null,null==(n=nf.current)||n.focus()):(nb.current=null,null==(a=nf.current)||a.focus())},onSelectLeChatAgent:e=>{nS({"le-chat-agent":null}),ec.setValue("agentId",e.id),ec.setValue("agentsApiAgentId",null)},onSelectAgentsApiAgent:e=>{ec.setValue("agentsApiAgentId",e),ec.setValue("agentId",null)}}),(0,a.jsx)("div",{className:(0,eh.cn)("flex",!ns&&"ms-auto",ns&&"w-full"),children:$&&H?(0,a.jsx)(ep.$n,{"aria-label":"Stop generation",title:er("message_input.stop_generation"),onClick:async e=>{e.preventDefault(),await H()},variant:"primary",mode:"icon-only",icon:(0,a.jsx)(u.A,{className:"size-4 fill-current"}),className:"shadow-none inset-shadow-none"}):(0,a.jsxs)(a.Fragment,{children:[ni&&(0,a.jsx)(ep.$n,{"aria-label":"Cancel",onClick:G,variant:"ghost",mode:"icon-only",className:"shadow-none inset-shadow-none",icon:d.A}),nr&&(0,a.jsx)("div",{className:"flex items-center justify-center ps-2",children:(0,a.jsx)(ep.$n,{"aria-label":er("audio.actions.start"),onClick:e8,mode:"icon-only",variant:nn&&nl?"secondary":"primary",icon:(0,a.jsx)(m.A,{size:"16"}),children:(0,a.jsx)(ep.GM,{...tA.dd,children:er("audio.actions.start")})})}),ns&&(0,a.jsx)(te,{elapsedTime:eQ,isRecording:eW,isProcessing:e2,isAutoSendEnabled:e3,onCancel:()=>{nU(eN.f.AUDIO_CANCEL_RECORDING,{recording_id:ez}),eq()},onSend:e5,onToggleAutosend:e4}),(0,a.jsx)(r.N,{children:nl&&(0,a.jsx)(s.P.div,{initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:{width:0,opacity:0},className:"overflow-hidden",children:(0,a.jsx)("div",{className:"ps-2",children:(0,a.jsx)(em.b7j,{type:"submit",isDisabled:nL,isLoading:$})})})})]})})]})]})]}),(0,a.jsx)(r.N,{initial:!1,children:null==nu?void 0:nu.element})]}),(0,a.jsx)(r.N,{children:el&&"empty"===t$&&(0,a.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"w-full",children:(0,a.jsx)(ne,{maxSuggestions:4,enableDynamicSuggestions:null==Q?void 0:Q.organization.featureFlags.careless_whisper,onSelectSuggestion:e=>{let t=ec.getValues(),n=e.integrationsAdditionalData.find(e=>e.shouldActivate);if(n)return void nz({integrationConnectionInfo:n.connectionInformation,startingPrompt:e.startChatAction.userPrompt,promptKey:e.key});nU(eN.f.SUGGESTION_PROMPT_SUBMITTED,{prompt_key:e.key,activated_features:e.startChatAction.requiredFeatures,activated_integrations:e.integrationsAdditionalData.map(e=>e.id)}),nx({...t,message:{...t.message,richInput:[{type:"text",content:e.startChatAction.userPrompt}]},features:(0,A.A)(e9.concat(e.startChatAction.requiredFeatures)),integrations:(0,A.A)(tc.concat(e.integrationsAdditionalData.map(e=>e.id)))})}})})}),nF&&(0,a.jsx)(ej.f,{integration:nF.integrationConnectionInfo,open:!0,setIsOpen:e=>{e||nz(null)},redirectUrl:window.location.href+"?"+new URLSearchParams({q:nF.startingPrompt,integrations:nF.integrationConnectionInfo.id,"prompt-key":nF.promptKey}).toString()})]})}},83403:(e,t,n)=>{n.d(t,{m:()=>l});var a=n(90044),i=n(35111);function l(){let e=(0,a.t)();return i.api.user.limits.useQuery({stableAnonymousIdentifier:e.stableAnonymousId},{enabled:null!==e.stableAnonymousId})}},85139:(e,t,n)=>{n.d(t,{A:()=>P,M:()=>k});var a=n(64784),i=n(36055),l=n(5936),r=n(6016),s=n(39962),o=n(15548),c=n(18815),d=n(17584),u=n(93706),m=n(64371),p=n(8380),h=n(30817),g=n(18544),f=n(8424),x=n(28008),v=n(30063),b=n(38256),_=n(3171),y=n(6974),j=n(94419),E=n(21413),N=n(18182),A=n(44960),I=n(68142),w=n(93339),T=n(19494),C=n(13101),S=n(35263),R=n(8866),D=n(35111),O=n(23192),L=n(4639);let P="library-inline-icon",k=e=>{let{handleNewFiles:t,handleOptionSelection:n,className:i,closePanelCallback:l}=e,[r,s]=(0,p.useState)(null),[o,c]=(0,p.useState)(""),d=(0,p.useRef)(null),u=(0,b.w)(),m=null===(0,L.iC)();return(0,a.jsx)(_.W2,{className:(0,v.cn)("bg-badge-card flex flex-col","h-full justify-start gap-0 overflow-hidden",_.I6,i),children:(0,a.jsxs)(f.uBz,{onKeyDown:e=>{if("ArrowLeft"===e.key&&null!==r){var t;e.preventDefault(),s(null),c(""),null==(t=d.current)||t.focus()}if("ArrowRight"===e.key){let t=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,which:13,bubbles:!0,cancelable:!0});e.preventDefault(),e.target.dispatchEvent(t)}},children:[(0,a.jsx)(f.G7v,{placeholder:"Search",value:o,onValueChange:e=>{if(" "===e)return l();c(e)},ref:d,onKeyDown:e=>{(0,O.W)(e)&&""===o&&l()}}),(0,a.jsxs)(f.oIj,{className:"max-h-none",children:[null===r&&(0,a.jsxs)(a.Fragment,{children:[(null==u?void 0:u.session)&&(0,a.jsx)(F,{handleOptionSelection:e=>{n({...e,subType:"connection"})}}),(0,a.jsx)(U,{handleOptionSelection:e=>{n({...e,subType:"tool"})}}),(null==u?void 0:u.session)&&(0,a.jsx)(z,{mode:m?"select":"browse",onLibraryBrowseSelect:e=>{var t;c(""),s(e),null==(t=d.current)||t.focus()},handleOptionSelection:e=>{n({...e,subType:"library"})}}),(null==u?void 0:u.session)&&!m&&(0,a.jsx)(M,{handleNewFiles:e=>{t(e,"file")}})]}),null!==r&&(0,a.jsx)(V,{currentLibrary:r,handleNewFiles:e=>{t(e,"document")},handleOptionSelection:e=>{n({...e,subType:"library"})},searchValue:o,onGoBack:()=>{var e;s(null),c(""),null==(e=d.current)||e.focus()}})]})]})})},M=e=>{let{handleNewFiles:t}=e,n=(0,u.c3)("Chat"),{supportedFileMime:l}=(0,I.j)(),r=(0,p.useRef)(null);return(0,a.jsx)(f.L$M,{heading:n("files.upload_file"),children:(0,a.jsxs)(f.h_I,{keywords:n("files.upload_file").split(" "),onSelect:()=>{if(null!==r.current){try{r.current.value=""}catch(e){}r.current.click()}},children:[(0,a.jsx)("input",{type:"file",multiple:!1,name:"file-upload",accept:l.join(","),className:"hidden",ref:r,onChange:e=>{(0,i.R)(e).then(e=>{t(e.filter(e=>e instanceof File))})}}),(0,a.jsx)(_.vy,{disabled:!1,leadIcon:(0,a.jsx)(s.A,{className:"size-4"}),label:"Upload file",className:"min-h-8"})]})})},U=e=>{let{handleOptionSelection:t}=e,n=(0,u.c3)("Chat"),{selectedFeatures:i,setSelectedFeatures:l,features:r,allowedFeatures:s}=(0,T.mr)(),o=(0,p.useCallback)(e=>{i.includes(e)||l([...i,e])},[i,l]),c=(0,S.P)();return(0,a.jsx)(f.L$M,{heading:n("features.label"),children:r.filter(g.DS).map(e=>(0,a.jsx)(f.h_I,{keywords:[c[e].name,n("features.label")],value:e,disabled:!s.includes(e),onSelect:()=>{o(e),t({value:e,label:c[e].name,componentName:e,subType:"tool"})},children:(0,a.jsx)(C.I,{className:"min-h-8",hideSelectionStatus:!0,feature:e,disabled:!s.includes(e),allowed:s.includes(e),Icon:S.A[e],label:c[e].name},e)},e))})},F=e=>{let{handleOptionSelection:t}=e,n=(0,u.c3)("Chat"),{selectedIntegrations:i,setSelectedIntegrations:s,isLoading:c,availableIntegrationData:d}=(0,T.mr)(),g=d.filter(e=>e.computedIntegrationInfo.isReady),{track:x}=(0,R.n)(),v=(0,p.useCallback)(e=>{c||i.includes(e.id)||(s([...i,e.id]),x(R.f.MESSAGE_INPUT_INTEGRATIONS_DESELECTION,{integration_id:e.id,integration_name:e.name}))},[c,i,s,x]),b=(0,m.Ym)(),y=(0,h.ad)(b)?b:h.rc.en;return c||0!==g.length?(0,a.jsxs)(f.L$M,{heading:n("integrations.label"),children:[c&&Array.from({length:4}).map((e,t)=>(0,a.jsx)(f.h_I,{disabled:!0,children:(0,a.jsx)(l.N,{children:(0,a.jsx)(r.P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.1,delay:.15*t},className:"w-full overflow-x-hidden",children:(0,a.jsx)(_.vy,{className:"min-h-8",label:"",disabled:!0,isPlaceholder:!0,leadIcon:(0,a.jsx)(o.A,{className:"h-6 w-6 animate-spin text-muted"})})})})},"skeleton-".concat(t))),!c&&g.map(e=>{var i,l;return(0,a.jsx)(f.h_I,{keywords:[e.name,null==(l=e.locale)||null==(i=l.name)?void 0:i[y],n("integrations.label")].filter(e=>void 0!==e),value:e.id,onSelect:()=>{var n;v(e),t({value:e.id,label:(0,w.Sr)(e.computedIntegrationInfo.name,y),iconSrc:null!=(n=e.icon_url)?n:"",subType:"connection"})},children:(0,a.jsx)(w.hN,{integration:e.computedIntegrationInfo,className:"min-h-8"})},e.id)})]}):null},z=e=>{var t;let{onLibraryBrowseSelect:n,mode:i,handleOptionSelection:s}=e,{availableLibraries:o,availableLibrariesLoading:c,activeLibrarySelection:d}=(0,E.TY)(),m=null!=(t=y._.NEXT_PUBLIC_MAX_LIBRARIES_SELECTION)?t:1,p=(0,A.xL)(m),h=(0,u.c3)("Libraries");return c||0!==o.length?(0,a.jsxs)(f.L$M,{heading:h("title"),children:[c&&Array.from({length:4}).map((e,t)=>(0,a.jsx)(f.h_I,{disabled:!0,children:(0,a.jsx)(l.N,{children:(0,a.jsx)(r.P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.1,delay:.15*t},className:"w-full overflow-x-hidden",children:(0,a.jsx)(_.vy,{className:"min-h-8",label:"",disabled:!0,isPlaceholder:!0,leadIcon:(0,a.jsx)(A.$n,{id:"",placeholder:!0})})})})},"skeleton-".concat(t))),!c&&o.map(e=>(0,a.jsx)(f.h_I,{keywords:[e.name,h("title")],value:e.id,onSelect:()=>{if("browse"===i)n(e.id);else{var t,a;d.includes(e.id)||p(e.id),s({value:e.id,label:null!=(a=null==(t=o.find(t=>t.id===e.id))?void 0:t.name)?a:e.id,componentName:P})}},children:(0,a.jsx)(A.Pc,{label:e.name,id:e.id,className:"min-h-8",mode:i},e.id)},e.id))]}):null},V=e=>{var t,n,i;let{handleNewFiles:s,handleOptionSelection:o,currentLibrary:d,searchValue:m,onGoBack:p}=e,{availableLibraries:h,activeLibrarySelection:g}=(0,E.TY)(),v=(0,u.c3)("Libraries"),b=null!=(n=y._.NEXT_PUBLIC_MAX_LIBRARIES_SELECTION)?n:1,_=(0,A.xL)(b),j=D.api.library.libraryDocuments.useInfiniteQuery({libraryId:d,pageSize:15,search:m&&m.length>2?m:void 0},{getNextPageParam:e=>e.pagination.has_more?e.pagination.current_page+1:void 0}),{data:I,isLoading:w}=j,{bottomScrollTriggerRef:T}=(0,N.vA)({onBottomScrollReached:()=>{j.hasNextPage&&!j.isFetchingNextPage&&j.fetchNextPage()}});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.h_I,{onSelect:()=>p(),children:(0,a.jsxs)("div",{className:"flex items-center gap-4 px-2",children:[(0,a.jsx)(c.A,{className:"size-4 text-hint",strokeWidth:2}),(0,a.jsx)(x.o5,{variant:"hint",children:"Go back"})]})}),(0,a.jsx)(f.L$M,{heading:v("LibrarySelector.fullLibrary"),children:(0,a.jsx)(f.h_I,{value:d,disabled:g.length>0&&!g.includes(d),onSelect:()=>{var e,t;g.includes(d)||_(d),o({value:d,label:null!=(t=null==(e=h.find(e=>e.id===d))?void 0:e.name)?t:d,componentName:P})},children:(0,a.jsx)(A.VK,{className:"min-h-8",id:d,label:null!=(i=null==(t=h.find(e=>e.id===d))?void 0:t.name)?i:"",hideSelectionStatus:!0})},"full-lib-".concat(d))}),(0,a.jsxs)(f.L$M,{heading:v("LibrarySelector.documents"),children:[w&&Array.from({length:5}).map((e,t)=>(0,a.jsx)(f.h_I,{children:(0,a.jsx)(l.N,{children:(0,a.jsx)(r.P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.1,delay:.15*t},className:"w-full overflow-x-hidden",children:(0,a.jsx)(N.Go,{})})})},"doc-skeleton-".concat(t))),I&&!w&&(0,a.jsxs)(a.Fragment,{children:[I.pages.flatMap(e=>e.data).map(e=>(0,a.jsx)(G,{id:e.id,libraryId:d,mimeType:e.mime_type,name:e.name,onSelectDocument:s,className:"min-h-8"},"doc-".concat(e.id))),(0,a.jsx)("div",{ref:T}),j.isFetchingNextPage&&Array.from({length:5}).map((e,t)=>(0,a.jsx)(f.h_I,{children:(0,a.jsx)(N.Go,{})},"doc-skeleton-".concat(t)))]})]})]})},G=e=>{let{name:t,id:n,disabled:i,placeholder:s,libraryId:c,onSelectDocument:u,mimeType:m,className:h}=e,{supportedFileMime:g}=(0,I.j)(),[x,v]=(0,p.useState)(!1),b=(0,N.BO)({documentId:n,libraryId:c,documentName:t,documentType:m}),y=async()=>{v(!0);let e=await b();(0,j.zz)(e)&&u([e.file]),v(!1)},E=!g.includes(m);return(0,a.jsx)(f.h_I,{value:n,keywords:[t],onSelect:y,disabled:!m||E||null!=i&&i||null!=s&&s,children:(0,a.jsx)(l.N,{children:(0,a.jsx)(r.P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.1},className:"w-full overflow-x-hidden",children:(0,a.jsx)(_.vy,{className:h,disabled:!m||E||null!=i&&i||null!=s&&s,isPlaceholder:s,leadIcon:(0,a.jsx)(d.A,{className:"size-5"}),tailDisplay:x&&(0,a.jsx)(o.A,{className:"size-3 animate-spin"}),label:t})})})},"document-".concat(c,"-").concat(n))}},89366:(e,t,n)=>{n.d(t,{IN:()=>d,kF:()=>c,mW:()=>o,p6:()=>u});var a=n(54122),i=n(36168);let l=[i.T.HARMATTAN_DOCUMENT_PARSER_INTERNAL_SERVER_ERROR,i.T.HARMATTAN_DOCUMENT_PARSER_TIMEOUT,i.T.HARMATTAN_DOCUMENT_PARSER_UNAVAILABLE],r=[i.T.QUOTA_INVALID_DOCUMENT_TYPE],s=[i.T.CHAT_STREAM_INTERRUPTED],o=e=>400!==e.httpCode&&404!==e.httpCode&&415!==e.httpCode&&422!==e.httpCode&&429!==e.httpCode,c=e=>400===e.httpCode||415===e.httpCode,d=(e,t)=>{if(413===t.httpCode)return{title:e("message_error_card.error_413.title"),description:e("message_error_card.error_413.description")};if(403===t.httpCode)return{title:e("message_error_card.error_403.title"),description:e("message_error_card.error_403.description")};if(404===t.httpCode)return t.internalCode===i.T.CHAT_NOT_FOUND?{title:e("message_error_card.chat_not_found.title"),description:e("message_error_card.chat_not_found.description")}:t.internalCode===i.T.CHAT_AGENT_NOT_FOUND?{title:e("message_error_card.agent_not_found.title"),description:e("message_error_card.agent_not_found.description")}:{title:e("message_error_card.error_404.title"),description:e("message_error_card.error_404.description")};if(504===t.httpCode)return{title:e("message_error_card.error_504.title"),description:e("message_error_card.error_504.description")};if(void 0===t.internalCode)return{title:e("message_error_card.error_other.title"),description:e("message_error_card.error_other.description")};if([i.T.HARMATTAN_DOCUMENT_TOO_LARGE].includes(t.internalCode)){var n;let[a,i]=t.internalMessage&&null!=(n=t.internalMessage.match(/\b\d+\b/g))?n:[void 0,void 0];return void 0!==a&&void 0!==i?{title:e("message_error_card.document_too_large_error.title"),description:e("message_error_card.document_too_large_error.description",{nb_pages_document:a,max_pages_document:i})}:{title:e("message_error_card.document_too_large_error.title"),description:e("message_error_card.document_too_large_error.fallback_description")}}return l.includes(t.internalCode)?{title:e("message_error_card.document_processing_error.title"),description:e("message_error_card.document_processing_error.description")}:r.includes(t.internalCode)?{title:e("message_error_card.document_invalid_content.title"),description:e("message_error_card.document_invalid_content.description")}:s.includes(t.internalCode)?{title:e("message_error_card.streaming_error.title"),description:e("message_error_card.streaming_error.description")}:{title:e("message_error_card.error_other.title"),description:e("message_error_card.error_other.description")}};function u(e){let{error:t,t:n}=e;if(t instanceof a.HN){var i,l;if((null==(i=t.data)?void 0:i.httpStatus)===429)return n("audio.errors.limit_reached");if((null==(l=t.data)?void 0:l.httpStatus)===422)return null}return n("audio.errors.unknown")}},89595:(e,t,n)=>{n.d(t,{TG:()=>l,tl:()=>a,vo:()=>i});let a=e=>{var t,n,a;return{slashType:"inline-file"===e.contentType?"inline-file":"text-tag",selectedLabel:e.label,selectedValue:e.value,componentName:null!=(t=e.iconName)?t:"",iconUrl:null!=(n=e.iconSrc)?n:"",subType:null!=(a=e.subType)?a:""}},i=e=>e.filter(e=>!("text"===e.type&&!e.content)).map(e=>"slash"===e.type?(e=>({type:"inline_tag",contentType:"inline-file"===e.slashType?"inline-file":"inline-option",label:e.selectedLabel,value:e.selectedValue,iconName:e.componentName,iconSrc:e.iconUrl,subType:e.subType}))(e.content):{type:"text",text:e.content}),l=e=>e.filter(e=>"text"===e.type||"inline_tag"===e.type).filter(e=>!("text"===e.type&&!e.text)).map(e=>"inline_tag"===e.type?{type:"slash",content:a(e)}:{type:"text",content:e.text})},90044:(e,t,n)=>{n.d(t,{StableAnonymousIdProvider:()=>o,t:()=>s});var a=n(64784),i=n(8380),l=n(22158);let r=i.createContext({stableAnonymousId:null,loading:!0}),s=()=>i.useContext(r),o=e=>{let{children:t}=e,[n,s]=(0,i.useState)(null),[o,c]=(0,i.useState)(!0);(0,i.useEffect)(()=>{let e=async()=>{await (0,l.Hd)().then(e=>s(e)).finally(()=>c(!1))};c(!0),e()},[]);let d=i.useMemo(()=>!n||o?{stableAnonymousId:n,loading:!0}:{stableAnonymousId:n,loading:!1},[n,o]);return(0,a.jsx)(r.Provider,{value:d,children:t})}},94419:(e,t,n)=>{n.d(t,{Sn:()=>s,fG:()=>r,zz:()=>l});var a=n(8380),i=n(35111);let l=e=>"file_upload_success"===e._tag,r=async(e,t,n)=>{try{let a=await fetch(new URL(e));if(!a.ok)return{_tag:"file_upload_error",error:{type:"file url fetch error",payload:await a.json()}};let i=await a.blob(),l=new File([i],t,{type:n});return{_tag:"file_upload_success",file:l}}catch(e){return{_tag:"file_upload_error",error:{type:"file construction error",message:e instanceof Error?e.message:String(e)}}}},s=()=>{let e=i.api.useUtils();return{getDocumentFileFromId:(0,a.useCallback)(async t=>{let{libraryId:n,documentId:a}=t,[i,l]=await Promise.all([e.library.document.fetch({documentId:a,libraryId:n}),e.library.libraryDocumentUrl.fetch({libraryId:n,documentId:a})]);return await r(l,i.name,i.mime_type)},[e])}}},94654:(e,t,n)=>{n.d(t,{p:()=>v});var a=n(64784),i=n(89615),l=n(44750),r=n(61392),s=n(73485),o=n(93706),c=n(8380),d=n(85040),u=n(75429),m=n(28008),p=n(30063),h=n(90907);let g=(0,c.createContext)(null);function f(e){let{canDownload:t,onDownload:n,canCopy:i,onCopy:l,referenceTitle:r,referenceUrl:s,referenceHostname:o,src:d,showBlur:u,children:m}=e,p=(0,c.useMemo)(()=>({canDownload:t,onDownload:n,canCopy:i,onCopy:l,referenceTitle:r,referenceUrl:s,referenceHostname:o,src:d,showBlur:u}),[t,n,i,l,r,s,o,d,u]);return(0,a.jsx)(g.Provider,{value:p,children:m})}function x(){let e=(0,c.useContext)(g);if(!e)throw Error("useZoomableImageContext must be used within a ZoomableImageProvider");return e}function v(e){let{className:t,canDownload:n,onDownload:s,canCopy:m,onCopy:h,referenceTitle:g,referenceUrl:x,referenceHostname:v,src:y,showBlur:j,originalWidth:N,originalHeight:A,children:I}=e,w=(0,o.c3)("Chat"),{zoomMargin:T}=function(e){let{src:t,width:n,height:a}=e,[i,l]=(0,c.useState)(0),r=(0,c.useCallback)(e=>{let t=e.width,n=e.height,a=window.innerWidth,i=window.innerHeight;Math.min(a/t,i/n)>1?l(Math.min((a-t)/2,(i-n)/2)):l(0)},[]);return(0,c.useEffect)(()=>{if(t)if(n&&a)r({width:n,height:a});else{let e=new Image;e.src=t,e.onload=()=>{r({width:e.naturalWidth,height:e.naturalHeight})}}},[t,n,a,r]),{zoomMargin:i}}({src:y,width:N,height:A});return(0,a.jsx)("span",{className:(0,p.cn)("group/zoomable-image relative block",t),children:(0,a.jsxs)(f,{canDownload:n,onDownload:s,canCopy:m,onCopy:h,referenceTitle:g,referenceUrl:x,referenceHostname:v,src:y,showBlur:j,children:[(0,a.jsx)(d.A,{wrapElement:"span",ZoomContent:b,zoomMargin:T,zoomImg:{src:y,alt:null!=g?g:""},children:I},"image-zoom"),(0,a.jsxs)("span",{className:"absolute end-2 top-2 z-1 flex items-center gap-1 opacity-0 transition-opacity duration-200 group-hover/zoomable-image:opacity-100",children:[m&&(0,a.jsx)(_,{"aria-label":w("message.image_copy"),mode:"icon-only",icon:(0,a.jsx)(i.A,{strokeWidth:1.5}),onClick:h,children:(0,a.jsx)(u.GM,{children:w("message.image_copy")})}),n&&(0,a.jsx)(_,{"aria-label":w("message.image_download"),mode:"icon-only",icon:(0,a.jsx)(l.A,{strokeWidth:1.5}),onClick:s,children:(0,a.jsx)(u.GM,{children:w("message.image_download")})}),x&&(0,a.jsx)(_,{"aria-label":w("message.image_open"),mode:"icon-only",icon:(0,a.jsx)(r.A,{strokeWidth:1.5}),onClick:e=>E(e,x),children:(0,a.jsx)(u.GM,{children:w("message.image_open")})})]})]})})}function b(e){let{img:t,onUnzoom:n,modalState:r}=e,d=(0,o.c3)("Chat"),{canDownload:m,onDownload:p,canCopy:h,onCopy:g,referenceTitle:f,referenceUrl:v,referenceHostname:b}=x(),_=(0,c.useRef)(null);return(0,c.useLayoutEffect)(()=>{if("LOADING"===r){var e;null==(e=_.current)||e.focus()}},[r]),(0,a.jsxs)("span",{className:"block h-full w-full cursor-zoom-out bg-subtle",onClick:n,children:[(0,a.jsx)(y,{}),t,(0,a.jsx)(j,{referenceHostname:b,referenceUrl:v,referenceTitle:f}),(0,a.jsxs)("span",{className:"absolute end-5 top-5 z-1 flex items-center gap-2",children:[h&&(0,a.jsx)(u.$n,{size:"lg",mode:"icon-only",variant:"secondary",shape:"pill",icon:i.A,"aria-label":d("message.image_copy"),onClick:g}),m&&(0,a.jsx)(u.$n,{size:"lg",mode:"icon-only",variant:"secondary",shape:"pill",icon:l.A,"aria-label":d("message.image_download"),onClick:p}),(0,a.jsx)(u.$n,{ref:_,size:"lg",mode:"icon-only",variant:"secondary",shape:"pill",icon:s.A,"aria-label":d("message.image_unzoom"),onClick:n})]})]})}function _(e){return(0,a.jsx)(u.$n,{size:"xs",variant:"ghost",className:"h-7 w-7 bg-(--secondary-900)/40 p-1.5 text-(--secondary-100) hover:bg-(--secondary-900)/50 hover:text-(--secondary-50) dark:bg-subtle/40 dark:text-default dark:hover:bg-subtle/50 dark:hover:text-default",...e})}function y(){let{src:e,showBlur:t}=x();return t&&e?(0,a.jsx)("span",{className:"absolute start-[-5%] top-[-5%] block h-[110%] w-[110%] bg-cover bg-center opacity-20 blur-xl",style:{backgroundImage:"url(".concat(e,")")}}):null}function j(e){let{referenceHostname:t,referenceUrl:n,referenceTitle:i}=e,l=!!n;return t||i?(0,a.jsxs)(l?"a":"span",{className:(0,p.cn)("absolute start-0 bottom-0 flex w-full flex-col gap-2 bg-[#000000]/40 px-6 py-4",l&&"group/source-info cursor-pointer"),target:l?"_blank":void 0,onClick:l?e=>{n&&E(e,n)}:void 0,children:[t&&(0,a.jsxs)("span",{className:"flex flex-row items-center gap-2",children:[(0,a.jsx)(h.A,{hostname:t,height:18,width:18}),(0,a.jsx)(m.ac,{variant:"subtle",size:"sm",className:"group-hover/source-info:underline",children:t})]}),i&&(0,a.jsx)(m.ac,{className:"group-hover/source-info:underline",children:i})]}):null}function E(e,t){e.stopPropagation(),window.open(t,"_blank","noopener,noreferrer")}},96721:(e,t,n)=>{n.d(t,{g:()=>s});var a=n(93706),i=n(37215),l=n(8424),r=n(35111);function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.c3)(),n=r.api.useUtils();return r.api.project.removeChat.useMutation({onMutate:async t=>{var a,l;let{chatId:r}=t,s=null!=(l=e.projectId)?l:null==(a=n.chat.byId.getData({id:r}))?void 0:a.projectId;return await Promise.all([s&&n.project.byId.cancel({id:s}),n.project.list.cancel(void 0),n.chat.byId.cancel({id:r})]),s&&n.project.byId.setData({id:s},e=>e&&{...e,chats:(0,i.c)(e.chats,[r]),updatedAt:new Date}),n.project.list.setData(void 0,e=>null==e?void 0:e.map(e=>e.id===s?{...e,chatCount:e.chatCount-1}:e)),n.chat.byId.setData({id:r},e=>e&&{...e,projectId:null}),s},onSuccess:()=>{n.chat.last.invalidate(void 0,{exact:!1})},onError:(e,a)=>{let{chatId:i}=a;n.project.list.invalidate(void 0),n.chat.byId.invalidate({id:i}),(0,l.oRP)(t("Projects.chats.actions.remove.error_message"))},onSettled:e=>{var t;(null==e||null==(t=e.project)?void 0:t.id)&&n.project.byId.invalidate({id:e.project.id})}})}},99639:(e,t,n)=>{n.d(t,{e:()=>m});var a=n(64784),i=n(474),l=n(36246),r=n(65007),s=n(27603),o=n(79654),c=n(22753),d=n(8038),u=n(72745);let m={"image/svg+xml":(0,a.jsx)(i.A,{}),"text/markdown":(0,a.jsx)(l.A,{}),"text/html":(0,a.jsx)(r.A,{}),react:(0,a.jsx)(s.A,{}),code:(0,a.jsx)(o.A,{}),mermaid:(0,a.jsx)(c.A,{}),slides:(0,a.jsx)(d.A,{}),table:(0,a.jsx)(u.A,{})}},99994:(e,t,n)=>{n.d(t,{w:()=>m});var a=n(64784),i=n(8007),l=n(93706),r=n(36121),s=n(23661),o=n(91518),c=n(75429),d=n(28008),u=n(30063);let m=e=>{let{children:t,errorMessage:n,className:m,onError:p}=e,h=(0,l.c3)("Chat");return(0,a.jsx)(r.tH,{fallback:(0,a.jsxs)(o.Ex,{colorScheme:"red",size:"lg",className:(0,u.cn)("flex items-center gap-2",m),children:[(0,a.jsx)(d.ac,{variant:"muted",size:"sm",weight:"light",children:null!=n?n:h("client_error.generic_message")}),(0,a.jsxs)(c.$n,{variant:"ghost-muted",onClick:()=>window.location.reload(),size:"xs",className:"py-0",children:[h("client_error.reload"),(0,a.jsx)(c.IM,{icon:i.A})]})]}),onError:e=>{null==p||p(e),s.s.captureException(e)},children:t})}}}]);