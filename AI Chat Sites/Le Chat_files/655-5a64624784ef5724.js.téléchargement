try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b75fab05-66c8-4841-a719-e256522a1d87",e._sentryDebugIdIdentifier="sentry-dbid-b75fab05-66c8-4841-a719-e256522a1d87")}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{3723:(e,t,n)=>{"use strict";n.d(t,{MessageInputSkeleton:()=>r});var a=n(64784),s=n(8424),i=n(30063);let r=e=>{let{className:t}=e;return(0,a.jsxs)("div",{className:(0,i.cn)("w-full",t),children:[(0,a.jsx)(s.EAD,{className:"h-[124px] w-full rounded-xl"}),(0,a.jsx)("div",{className:"h-10"})]})}},6664:(e,t,n)=>{"use strict";n.d(t,{EH:()=>a,Mb:()=>s});let a="##_LE_CHAT_TRANSCRIBING_AUDIO_CHUNK_CONTENT_##",s=e=>{var t;let{id:n,text:s,contentChunks:i,files:r,userId:l,canva:o,action:c,voiceInputUrl:d,transcriptions:u,turn:m,parentId:p,parentVersion:h,leChatAgentId:f,agentsApiAgentId:g}=e,x=[...null!=i?i:[]];return o&&x.push({type:"canva",id:o.id,version:o.version}),c&&x.push({type:"action",id:c}),null==u||u.forEach(e=>{null==x||x.push({type:"audio",recordingUrl:e.url,metadata:{originalTranscript:e.originalTranscript,transcriptionId:e.transcriptionId,recordingId:e.recordingId}})}),x.length>0&&i&&i.length>0&&x.push({type:"text",text:s}),0===x.length&&(x=null),d&&(x=[{type:"text",text:a}]),{id:n,role:"user",content:(null==x?void 0:x.length)?null:s,agentId:f,agentsApiAgentId:g,contentChunks:x,isAcceleratedAnswer:!1,files:null!=(t=null==r?void 0:r.map(e=>{var t;return{...e,inlineId:null!=(t=e.inlineFileId)?t:null}}))?t:[],model:"default",version:0,createdAt:new Date,status:"active",generationStatus:"success",reaction:"neutral",chatId:n+"_chat",references:[],turn:null!=m?m:0,createdById:null!=l?l:null,moderationCategory:null,memories:null,parentId:null!=p?p:null,parentVersion:null!=h?h:null,prevVersion:null,nextVersion:null,versionCount:1,visibility:"private",followups:[]}}},7694:(e,t,n)=>{"use strict";n.d(t,{z:()=>y});var a=n(64784),s=n(8380),i=n(42573),r=n(8424),l=n(30063);let o="data-scroll-deck-item";function c(e){return Array.from(e.querySelectorAll("[".concat(o,"]")))}var d=n(6016),u=n(5936),m=n(18815),p=n(55936),h=n(93706),f=n(75429);function g(e){let{viewportRef:t,showScrollButtons:n,scrollButtonsPosition:i,showScrollShadows:r,scrollShadowColor:l}=e,o="inset 0px 0px 0px 0px ".concat(l),{canScrollLeft:m,canScrollRight:p,handleScrollToPreviousPage:h,handleScrollToNextPage:f}=function(e){let{viewportRef:t}=e,[n,a]=(0,s.useState)(!1),[i,r]=(0,s.useState)(!1),l=(0,s.useCallback)(()=>{let e=t.current;if(!e)return;let{scrollLeft:n,scrollWidth:s,clientWidth:i}=e;a(n>0),r(n+i<s)},[t]);return(0,s.useEffect)(()=>{let e=t.current;if(e)return l(),e.addEventListener("scroll",l,!0),()=>{e.removeEventListener("scroll",l,!0)}},[t,l]),{canScrollLeft:n,canScrollRight:i,handleScrollToPreviousPage:(0,s.useCallback)(()=>{let e=t.current;if(e){let t=c(e).slice().reverse(),{scrollLeft:n,clientWidth:a}=e,s=t.find(e=>e.offsetLeft<n-1);if(s){let t=s.offsetLeft+s.offsetWidth;e.scrollTo({left:t-a,behavior:"smooth"});return}e.scrollTo({left:0,behavior:"smooth"})}},[t]),handleScrollToNextPage:(0,s.useCallback)(()=>{let e=t.current;if(e){let t=c(e),{scrollLeft:n,scrollWidth:a,clientWidth:s}=e,i=n+s,r=t.find(e=>e.offsetLeft+e.offsetWidth>i+1);if(r)return void e.scrollTo({left:r.offsetLeft,behavior:"smooth"});e.scrollTo({left:a-s,behavior:"smooth"})}},[t])}}({viewportRef:t}),g=m?"inset 22px 0px 10px -10px ".concat(l):o,v=p?"inset -22px 0px 10px -10px ".concat(l):o,y=r?[g,v].filter(Boolean).join(" , "):"";return(0,a.jsx)(d.P.div,{className:"pointer-events-none absolute inset-0",animate:{boxShadow:y},transition:{duration:.1},children:(0,a.jsxs)(u.N,{children:[n&&m&&(0,a.jsx)(d.P.div,{className:"absolute top-0 left-0 flex h-full items-center justify-center ps-2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(x,{side:"left",position:i,onClick:h})},"left"),n&&p&&(0,a.jsx)(d.P.div,{className:"absolute top-0 right-0 flex h-full items-center justify-center pe-2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(x,{side:"right",position:i,onClick:f})},"right")]})})}function x(e){let{side:t,position:n,onClick:s}=e,i=(0,h.c3)("Chat");return(0,a.jsx)(f.$n,{mode:"icon-only",icon:"left"===t?m.A:p.A,"aria-label":i("left"===t?"message.scroll_deck.scroll_left":"message.scroll_deck.scroll_right"),shape:"pill",variant:"secondary",className:(0,l.cn)("pointer-events-auto","center"!==n&&"absolute"),style:{...function(e){let{position:t}=e;return"center"===t?{}:{top:t.top,bottom:t.bottom}}({position:n}),[t]:-18},onClick:s})}let v={[o]:!0},y=Object.assign(function(e){let{showScrollButtons:t="hover",scrollButtonsPosition:n="center",showScrollShadows:o=!0,scrollShadowColor:c="var(--bg-subtle)",className:d,contentClassName:u,children:m}=e,p=(0,s.useRef)(null),[h,f]=(0,s.useState)(!1),x=(0,i.Ub)("(hover: hover)"),v=(0,s.useMemo)(()=>{switch(t){case"never":return!1;case"always":default:return!0;case"hover":return!x||h}},[t,x,h]);return(0,a.jsxs)("div",{className:"relative",onMouseEnter:()=>{f(!0)},onMouseLeave:()=>{f(!1)},children:[(0,a.jsxs)(r.FKN,{viewportRef:p,viewportClassName:(0,l.cn)("w-full",d),children:[(0,a.jsx)(r.$H1,{orientation:"horizontal"}),(0,a.jsx)("div",{className:(0,l.cn)("flex w-fit min-w-full items-stretch justify-start gap-4 pb-4",u),children:m})]}),(0,a.jsx)(g,{viewportRef:p,showScrollButtons:v,scrollButtonsPosition:n,showScrollShadows:o,scrollShadowColor:c})]})},{Item:function(e){let{className:t,children:n}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex-shrink-0",t),...v,children:n})}})},8936:(e,t,n)=>{"use strict";n.d(t,{AF:()=>s,CD:()=>o,Wm:()=>i,bK:()=>r,mA:()=>a,s:()=>l});let a="data-rich-table-inner-html",s="data-rich-table-title",i="rich-table",r="rich-table-title-bar";function l(e){let{richTableHtml:t,title:n}=e;return{[a]:t,[s]:n}}function o(e){let t=e.cloneNode(!0);return t.querySelectorAll("[".concat(a,"]")).forEach(e=>{var t;let n=null!=(t=e.getAttribute(a))?t:"",i=e.getAttribute(s),r=document.createDocumentFragment();if(i&&""!==i.trim()){let e=document.createElement("span");e.textContent=i,r.appendChild(e)}let l=document.createElement("div");l.innerHTML=n,r.appendChild(l),e.replaceWith(r)}),t}},9464:(e,t,n)=>{"use strict";function a(e){let t=!1;return function(){for(var n=arguments.length,a=Array(n),s=0;s<n;s++)a[s]=arguments[s];if(!t)return t=!0,e(...a)}}n.d(t,{g:()=>a})},10655:(e,t,n)=>{"use strict";n.d(t,{ChatContainer:()=>eG});var a=n(64784),s=n(8380),i=n(33987),r=n(19071),l=n(21413),o=n(19494),c=n(9360),d=n(35111),u=n(23964),m=n(29766),p=n(13461),h=n(6016),f=n(5936),g=n(93706),x=n(10315),v=n(61514),y=n(71222),j=n(42573),b=n(63123),w=n(9464),_=n(46610),C=n(24999),N=n(22374),I=n(6664),k=n(86130),A=n(8740),E=n(36168),S=n(97561),D=n(23661),T=n(8424),M=n(12965),R=n(30063),P=n(67289);function L(e){let{chatId:t}=e,n=c.P.use.abortControllerByChatId(),a=c.P.use.setAbortControllerByChatId(),s=c.P.use.unsetAbortControllerByChatId(),i=(0,j.DK)(()=>n[t]);return{getAbortController:i,setAbortController:(0,j.DK)(e=>{a(t,e)}),unsetAbortController:(0,j.DK)(()=>{s(t)})}}let O=e=>"".concat(e.id,"@v").concat(e.version);var V=n(79138),z=n(32735);Symbol("@patch/brand");let F=(e,t)=>t.reduce((e,t)=>V.Bb(e,U(e,[t])),e),H=e=>(0,z.W9)({op:"replace",path:z.P.union("","/",[])},e),U=(e,t)=>t.flatMap(t=>{var n;if("append"!==t.op)return t;let a=(n=t.path,n.split("/").filter(Boolean).reduce((e,t)=>{if(e&&"object"==typeof e&&t in e)return e[t]},e));return"string"!=typeof a?[]:{op:"replace",path:t.path,value:a+t.value}});function q(e){let{chatId:t,handleOpenCanvas:n}=e,a=d.api.useUtils();return{applyCanvasPatch:(0,T.Kw0)(e=>{var s,r,l,o;let{patches:c}=e,d=new Set(null==(s=a.canva.all.getData({chatId:t}))?void 0:s.items.map(O)),u=null!=(o=null==(r=a.message.all.getData({chatId:t}))?void 0:r.items)?o:[];a.canva.all.setData({chatId:t},e=>{if(!e)return;let t=F(e.items.reduce((e,t)=>(e.canvasesById[O(t)]=t,e),{lastAddedCanvasId:null,canvasesById:{}}),c);return{items:(0,i.zh)(Object.values(t.canvasesById),u),nextCursor:e.nextCursor}});let m=null==(l=a.canva.all.getData({chatId:t}))?void 0:l.items,p=null==m?void 0:m.find(e=>!d.has(O(e)));p&&n(p)})}}var $=n(69957),B=n(63695),G=n(22600),K=n(61413);class W{get(e,t){return this.cache[this.getMessageKey(e,t)]}set(e,t,n){let a=this.getMessageKey(e,t);return this.cache[a]=n,this.cache[a]}getMessageKey(e,t){return"".concat(e,"@").concat(t)}constructor(){this.cache={}}}function Z(e){let{chatId:t}=e,n=d.api.useUtils();return{applyMessagePatch:(0,T.Kw0)((e,a)=>{let{messageId:s,messageVersion:i,patches:r}=e,[l,o]=(0,G.j)(r,H);l.forEach(e=>{(0,K.k2)(n)({chatId:t,messageId:s,messageVersion:i})(e.value),a.set(s,i,e.value)}),(0,K.Cq)(n)({chatId:t,messageId:s,messageVersion:i})(e=>{var t,n,r;let l=a.get(s,i),c=null!=l?l:e,d={content:null!=(t=c.content)?t:"",contentChunks:null!=(n=c.contentChunks)?n:[],references:null!=(r=c.references)?r:[]};return a.set(s,i,F({...e,...d},o))})})}}var X=n(79653),Y=n(8936),J=n(70669);let Q=["ul","ol","blockquote","pre","code","h1","h2","h3","h4","h5","h6","strong","em","i","b","u","s","mark","small"],ee=["p","div","h1","h2","h3","h4","h5","h6","li","blockquote"];function et(e){var t;let n=e.getAttribute(Y.mA);return n?{html:n,title:null!=(t=e.getAttribute(Y.AF))?t:""}:null}var en=n(8866),ea=n(39161),es=n(42708),ei=n(90044),er=n(68669),el=n(32638);let eo=()=>{let e=(0,g.c3)("Chat"),t=c.P.use.numberAnonymousMessages(),n=c.P.use.setOrIncrementNumberAnonymousMessages(),s=()=>{n(0)};return(0,a.jsx)("div",{className:"relative h-fit w-full",children:(0,a.jsx)(T.lGe,{open:3===t,children:(0,a.jsxs)(T.Cff,{className:"gap-8 bg-subtle px-2 sm:px-6",hideX:!0,children:[(0,a.jsxs)(T.c75,{className:"gap-2",children:[(0,a.jsx)(T.L33,{children:e("anonymous_usage_limit.title")}),(0,a.jsx)(T.rrK,{children:e("anonymous_usage_limit.description")})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex w-full flex-row gap-2",children:[(0,a.jsx)(er.M,{className:"flex-1",onClick:s}),(0,a.jsx)(el.N,{className:"flex-1",onClick:s})]}),(0,a.jsx)("div",{className:"m-auto cursor-pointer text-center text-sm text-subtle underline",onClick:s,children:e("anonymous_usage_limit.continue_chat")})]})]})})})};var ec=n(21917),ed=n(63929),eu=n.n(ed),em=n(12330),ep=n(64371),eh=n(28008),ef=n(49943),eg=n(35287),ex=n(6974),ev=n(52522),ey=n(79373),ej=n(54277),eb=n(8748),ew=n(3723),e_=n(47799);let eC=e=>{let{children:t,chat:n,className:s}=e,i=(0,ev.sy)(ev.Zr);return(0,a.jsx)("div",{ref:i,className:(0,R.cn)("relative start-0 end-0 bottom-0 z-30 flex w-full flex-col items-center",n.permission===S.Jj.READ_ONLY,s),children:t})},eN=e=>{let{onContinue:t,session:n,messagesContainDocuments:s,messagesContainImages:i,chatId:r}=e,l=(0,g.c3)("Chat");return(0,a.jsx)("div",{className:"mt-6 mb-2 flex h-fit w-full max-w-(--breakpoint-md) items-center justify-center px-2 sm:mb-0 sm:p-3",children:(0,a.jsxs)("div",{className:"flex h-fit min-h-28 w-full max-w-(--breakpoint-md) flex-col items-center justify-between gap-2 rounded-xl border bg-default p-2 sm:min-h-0 sm:flex-row sm:p-3",children:[(0,a.jsx)("div",{className:"flex grow items-center",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(ec.A,{className:"mt-1 flex h-4 min-h-4 w-4 min-w-4 sm:mt-0"}),n?(0,a.jsx)("p",{className:"text-sm text-wrap",children:l(i||s?"message_helper_card.read_only_with_files":"message_helper_card.read_only")}):(0,a.jsx)("p",{className:"text-sm text-wrap",children:l("message_helper_card.read_only_anon")})]})}),(0,a.jsx)("div",{className:"ms-auto",children:n?!i&&!s&&(0,a.jsx)(T.$nd,{variant:"dark",className:"rounded-lg","aria-label":"Continue",onClick:t,children:l("message_helper_card.continue")}):(0,a.jsx)(er.M,{returnTo:"/chat/".concat(r),className:"bg-inverted text-inverted-default hover:bg-inverted"})})]})})},eI=e=>{let{className:t,chat:n,session:i,messages:r,latestMessage:l,isLoading:o,messagesContainDocuments:d,messagesContainImages:u,handleStop:m,handleSubmit:p,canvasIdentifiers:f,defaultAgentId:x,onAgentChange:v,incognito:y}=e,j=(0,em.useRouter)(),b=(0,g.c3)("Chat"),w=c.P.use.editMessageId(),[_,C]=(0,s.useState)(!1),{draftMessage:N,isLoading:I}=(e=>{let t,n=!eg.E.use.isLoaded(),a=eg.E.use.draftMessageByChatId()[e];if(a)try{t=a.serializedMessage?ef.Qk.parse(JSON.parse(a.serializedMessage)).filter(e=>"slash"!==e.type||"inline-file"!==e.content.slashType):void 0}catch(e){}return{draftMessage:t,isLoading:n}})(n.id),k=(0,ep.Ym)();switch(n.permission){case S.Jj.READ_ONLY:return(0,a.jsx)(eC,{chat:n,className:t,children:_?i&&(0,a.jsx)(e_.A,{className:"mt-6 mb-3 min-h-28 w-full max-w-(--breakpoint-md) px-2 sm:mt-0 sm:mb-0 sm:min-h-0",chatId:n.id,messages:r,session:i,onNewChatCreated:e=>{let{chatId:t}=e;j.push("/chat/".concat(t))},canvasIdentifiers:f}):(0,a.jsx)(eN,{onContinue:()=>C(!0),session:i,messagesContainDocuments:d,messagesContainImages:u,chatId:n.id})});case S.Jj.WRITE:{var A,E,D,T,M,P;let e=!!(n.expiredAt&&n.expiredAt<new Date),s=(0,ej.E)({id:"chat-expired",type:"blocker",active:e,element:(0,a.jsx)(eb.Eg,{className:"text-inverted-default",children:(0,a.jsx)(eb.p,{children:b("expired.description")})})});return(0,a.jsx)(eC,{chat:n,className:(0,R.cn)("px-3",t),children:I?(0,a.jsx)(ew.MessageInputSkeleton,{className:"sticky bottom-0 w-full max-w-(--breakpoint-md) rounded-sm"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ey.A,{disabled:e,notification:s,defaultValue:{files:[],richInput:null!=N?N:[],text:""},defaultModel:null==l?void 0:l.model,className:(0,R.cn)("mx-3 mb-0 w-full max-w-(--breakpoint-md) md:mb-0"),defaultAgentId:null!=(D=null!=x?x:null==l?void 0:l.agentId)?D:null,defaultAgentsApiAgentId:null!=(T=null==l?void 0:l.agentsApiAgentId)?T:null,onSubmit:p,onStop:m,isLoading:o,chatId:n.id,dragAndDropDisabled:null!==w,session:i,canvasIdentifiers:f,showSuggestions:!1,onChange:e=>{void 0!==e.agentId&&(null==v||v(e.agentId))},incognito:y}),(0,a.jsx)(h.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeInOut"},className:"max-w-6xl px-2 py-3 text-center text-xs text-muted sm:px-8 md:px-12",children:(0,a.jsx)(eh.o5,{variant:"subtle",children:null!=(P=null!=(M=null==(A=ex._.NEXT_PUBLIC_CUSTOM_DISCLAIMER)?void 0:A[k])?M:null==(E=ex._.NEXT_PUBLIC_CUSTOM_DISCLAIMER)?void 0:E.en)?P:b.rich("message_input.disclaimer",{termslink:e=>(0,a.jsx)(eu(),{href:"https://mistral.ai/terms#terms-of-service",target:"_blank",children:e})})})})]})})}default:n.permission}};var ek=n(1414),eA=n(8007),eE=n(10766),eS=n(95067),eD=n(52907),eT=n(75429),eM=n(77515),eR=n(20752),eP=n(65043),eL=n(70951),eO=n(89366);function eV(e){let{chatId:t,error:n,latestMessage:i,handleRetry:r}=e,l=(0,g.c3)("Chat"),{track:d}=(0,en.n)(),u=c.P.use.setEditMessageId(),m=c.P.use.editMessageId(),{selectedFeatures:p,isLoading:h,selectedIntegrations:f}=(0,o.mr)(),x=s.useCallback(e=>{h||(r({features:p,integrations:f}),d(en.f.RETRIED_ANSWER,{chat_id:t,answer_id:(null==i?void 0:i.role)===k.gg.ASSISTANT?i.id:void 0,answer_version:(null==i?void 0:i.role)===k.gg.ASSISTANT?i.version:void 0,model:(null==i?void 0:i.role)===k.gg.ASSISTANT?i.model:void 0,reason:e}))},[d,t,r,i,p,f,h]),{title:v,description:y,retryReason:j}=(0,eO.IN)(l,n),b=(0,eO.mW)(n),w=null===m&&(0,eO.kF)(n);return(0,a.jsx)(T.FcD,{children:(0,a.jsxs)("div",{className:"flex w-full flex-row items-start gap-4",children:[(0,a.jsxs)("div",{className:"flex w-full flex-col",children:[(0,a.jsxs)("div",{className:"flex w-full flex-row gap-2",children:[(0,a.jsx)(ec.A,{className:"h-4 min-h-4 w-4 min-w-4"}),(0,a.jsx)(T.XL1,{children:v})]}),(0,a.jsxs)(T.TND,{className:"ps-6 whitespace-break-spaces text-muted",children:[y,void 0!==n.internalCode&&(0,a.jsx)("div",{className:"mt-4 text-xs",children:l("message_error_card.error_code_label",{errorCode:n.internalCode})})]})]}),b&&(0,a.jsxs)(T.$nd,{"aria-label":"Retry",size:"sm",disabled:h,onClick:()=>{x(null!=j?j:"error")},children:[(0,a.jsx)(eP.A,{className:"h-4 w-4 flex-1"}),l("message_error_card.retry_cta")]}),w&&(0,a.jsxs)(T.$nd,{"aria-label":"Edit",size:"sm",onClick:()=>{if(!i)return null;u(i.id),d(en.f.STARTING_EDIT_AFTER_ERROR,{chat_id:t,answer_id:i.role===k.gg.ASSISTANT?i.id:void 0,answer_version:i.role===k.gg.ASSISTANT?i.version:void 0,model:i.role===k.gg.ASSISTANT?i.model:void 0})},children:[(0,a.jsx)(eL.A,{className:"h-4 w-4 flex-1"}),l("message_error_card.edit_cta")]})]})})}var ez=n(85277);let eF=(0,s.forwardRef)(function(e,t){return(0,a.jsx)(eS.z,{className:(0,R.cn)("relative h-full w-full",e.className),resize:e.isGenerating?"smooth":"instant",initial:"instant",children:(0,a.jsx)(eU,{ref:t,...e})})}),eH=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:(0,R.cn)("w-full max-w-(--breakpoint-md)"),children:t})},eU=(0,s.forwardRef)(function(e,t){var n;let{messages:i,isGenerating:r,isReadOnly:l,latestMessage:o,handleRewrite:c,handleEdit:d,user:u,session:m,canvas:p,quotes:f,features:g,chatRequestError:x,handleRetry:y,handleToolCallConfirmation:b,handleFollowUp:w,chatId:_,isIncognito:C}=e,N=i.at(-1),I=(0,v.U)(i,e=>e.role===k.gg.USER),{updateScrollPosition:A}=function(e){let{lastUserMessageId:t}=e,{stopScroll:n,scrollRef:a,contentRef:i}=(0,eS.B)(),r=(0,s.useRef)(!1),l=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!i.current)return;let e=new ResizeObserver(()=>{r.current&&n()});return e.observe(i.current),()=>{e.disconnect()}},[i,t,n]),(0,s.useEffect)(()=>{let e=a.current;if(!e)return;let t=()=>{r.current=!1};return e.addEventListener("wheel",t),e.addEventListener("touchmove",t),()=>{e.removeEventListener("wheel",t),e.removeEventListener("touchmove",t)}},[a]);let o=(0,j.DK)((e,t)=>{let n,a=e.scrollTop,s=t-a,i=null;return n=requestAnimationFrame(function t(r){var l;null===i&&(i=r);let o=r-i;e.scrollTop=a+s*(1-Math.pow(1-(l=Math.min(o/500,1)),3)*(1-.9*l)),o<500?n=requestAnimationFrame(t):i=null}),()=>{n&&cancelAnimationFrame(n)}}),c=(0,j.DK)(async()=>{l.current&&(l.current(),l.current=null),r.current=!0,await new Promise(e=>setTimeout(e,500));let e=(i.current?Array.from(i.current.querySelectorAll('[data-message-author-role="user"]')):[]).at(-1);if(!e||!a.current)return;let t=e.getBoundingClientRect(),s=a.current.scrollTop,c=t.bottom+s-160;n(),l.current=o(a.current,c)});return(0,s.useEffect)(()=>()=>{l.current&&l.current()},[]),{updateScrollPosition:c}}({lastUserMessageId:null==I?void 0:I.id});(0,s.useImperativeHandle)(t,()=>({updateScrollPosition:A}));let E=(0,ev.sy)(ev.mp);return(0,a.jsxs)("div",{className:"relative flex h-full w-full flex-col overflow-hidden",children:[(0,a.jsxs)(eS.z.Content,{className:ez.yZ,children:[(0,a.jsxs)(ez.M$,{children:[i.map(e=>(0,a.jsx)(ez.Nc,{children:(0,a.jsx)(ez.pu,{children:(0,a.jsx)(eR.Q,{ref:e.id===(null==I?void 0:I.id)?E:void 0,message:e,isGenerating:r,isReadOnly:l,isLastMessage:e.id===(null==o?void 0:o.id),isLastTurn:e.turn===(null==o?void 0:o.turn),handleRewrite:e.id===(null==o?void 0:o.id)?c:void 0,handleToolCallConfirmation:b,handleEdit:d,user:u,session:m,canvas:p,quotes:f,features:g,handleFollowUp:w,incognito:null!=C&&C})})},e.id)),N&&"user"===N.role&&!x&&r&&(0,a.jsx)(ez.Nc,{children:(0,a.jsx)(ez.pu,{children:(0,a.jsx)(h.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2,delay:.3},children:(0,a.jsx)(eR.Q,{message:(0,K.lO)({chatId:_,agentId:null!=(n=N.agentId)?n:void 0,role:"assistant"}),handleToolCallConfirmation:b,isReadOnly:l,user:u,session:m,canvas:p,quotes:f,features:g,isGenerating:r,isLastMessage:!0,isLastTurn:!0,handleFollowUp:w,incognito:null!=C&&C})})})},"assistant-message-placeholder"),x&&(0,a.jsx)(eH,{children:(0,a.jsx)(eV,{chatId:_,latestMessage:o,error:x,handleRetry:y})})]}),(0,a.jsx)("div",{className:"flex w-full flex-1"})]}),(0,a.jsx)(eq,{isReadOnly:l,isIncognito:C})]})}),eq=e=>{let{isReadOnly:t,isIncognito:n}=e,{isAtBottom:s,scrollToBottom:i}=(0,eS.B)(),r=(0,g.c3)("Chat"),{isSampleAgentChat:l,resetSampleChatId:o}=(0,eM.r)(),d=c.P.use.setAnonymousChatId(),u=c.P.use.setOrIncrementNumberAnonymousMessages();return(0,a.jsx)(f.N,{children:s?t?null:(0,a.jsx)(h.P.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeInOut"},className:"absolute bottom-3 z-10 self-center",children:l?(0,a.jsxs)(eT.$n,{variant:"secondary",size:"sm",className:"text-muted hover:text-subtle",onClick:()=>o(),children:[(0,a.jsx)(eT.IM,{icon:eA.A}),r("message_input.reset_sample_chat_cta")]}):n?(0,a.jsxs)(eD.v,{size:"sm",variant:"secondary",href:"/incognito",onClick:()=>{u(0),d(void 0)},className:"text-muted hover:text-subtle",children:[(0,a.jsx)(eT.IM,{icon:eE.A}),r("navigation_bar.new_chat_button_tooltip")]}):null},"new-chat-button"):(0,a.jsx)(h.P.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeInOut"},className:"absolute bottom-3 z-10 self-center",children:(0,a.jsx)(eT.$n,{variant:"secondary",mode:"icon-only",shape:"pill",size:"sm",className:"text-muted hover:text-subtle",icon:ek.A,onClick:()=>i()})},"follow-button")})},e$=(0,s.memo)(e=>{var t,n,r;let{chat:o,messages:m,canvas:y,quotes:O,session:V}=e,F=d.api.useUtils(),{track:H}=(0,en.n)(),U=(0,g.c3)("Chat"),{setCanvas:G,setMessagesBase:er,setIsReadOnly:el,setOnStop:ec,tempCanva:ed,setTempCanva:eu}=(0,u.o)(),[em,ep]=(0,s.useState)(!1),[eh,ef]=(0,s.useState)(null),eg=(0,s.useRef)(null),ex=(0,s.useRef)(null),[ev,ey]=(0,s.useState)((null==(t=m.at(-1))?void 0:t.role)!==k.gg.USER),ej=T.Bx2.useSidebar({required:!1}),eb=!(0,j.Ub)("(min-width: 960px)"),ew=!(0,j.Ub)("(min-width: 1024px)"),e_=(null==ej?void 0:ej.open)&&ew||eb,{openCanva:eC,setOpenCanva:eN,setChatId:ek,quote:eA,setQuote:eE}=(0,u.o)(),eS=c.P.use.setEditMessageId(),eD=c.P.use.isGeneratingByChatId(),eT=c.P.use.setIsGeneratingByChatId(),eM=c.P.use.setMessagesLimitDialog(),{setAbortController:eR,unsetAbortController:eP}=L({chatId:o.id}),{stableAnonymousId:eL,loading:eO}=(0,ei.t)();(0,s.useEffect)(()=>{let e=e=>{let t=document.getSelection();if(!t||t.isCollapsed)return;let n=document.createElement("div");for(let e=0;e<t.rangeCount;e++){let a=function(e){let t=document.createDocumentFragment(),n=Array.from(e.cloneContents().childNodes),a=(0,J.ef)(e),s=function(e){let t=e;for(;t;){let e=et(t);if(e)return e;t=t.parentElement}return null}(a);if(a&&a.childNodes.length===n.length&&n.every(e=>(function(e){if(!(0,J.nS)(e))return!1;let t=e.getAttribute("role");return t&&["cell","columnheader"].includes(t)})(e))&&s)return(0,J.rf)(s.html);let i=t;if(a&&Q.includes(a.tagName.toLowerCase())){let e=a.cloneNode(!1);t.appendChild(e),i=e}return n.forEach(e=>{if((0,J.nS)(e)){let t=function e(t,n){var a;let s=et(t),i=null!=(a=null!=s?s:n)?a:null;if(i&&"string"==typeof t.className&&t.className.includes(Y.bK)){let e=document.createElement("div");return e.textContent=i.title,e}if(i&&"string"==typeof t.className&&t.className.includes(Y.Wm))return(0,J.rf)(i.html);let r=t.cloneNode(!1);return Array.from(t.childNodes).forEach(t=>{if((0,J.nS)(t)){let n=e(t,i);r.appendChild(n)}else r.appendChild(t.cloneNode(!0))}),r}(e,s);i.appendChild(t)}else i.appendChild(e.cloneNode(!0))}),t}(t.getRangeAt(e));n.appendChild(a)}!function e(t){(0,J.nS)(t)&&(t.style.removeProperty("color"),t.style.removeProperty("background"),t.style.removeProperty("background-color"),Array.from(t.children).forEach(t=>e(t)))}(n);let a=n.innerHTML,s=function e(t){let n=[];return Array.from(t.childNodes).forEach(t=>{if(t instanceof HTMLBRElement&&n.push("\n"),t.nodeType===Node.TEXT_NODE){var a;let{textContent:e}=t;if(!e||"\n"===e&&(null==(a=n.at(-1))?void 0:a.endsWith("\n")))return;n.push(e)}if((0,J.nS)(t)){let a=e(t);n.push(ee.includes(t.tagName.toLowerCase())?"".concat(a,"\n"):a)}return""}),n.join("")}(n);e.preventDefault(),e.clipboardData&&(e.clipboardData.setData("text/plain",s),e.clipboardData.setData("text/html",a))};return document.addEventListener("copy",e),()=>{document.removeEventListener("copy",e)}},[]),function(e){let{chatId:t}=e,{trackMessageEvent:n}=(0,en.n)();(0,s.useEffect)(()=>{let e=()=>{let e=document.getSelection();if(!e||e.isCollapsed)return;let a=[];for(let t=0;t<e.rangeCount;t++){let n=e.getRangeAt(t),s=(0,J.ef)(n),i=(0,J.tk)(s);i&&!a.some(e=>e.messageId===i.messageId&&e.messageVersion===i.messageVersion)&&a.push(i)}a.forEach(e=>{n(en.f.COPY_USER_SELECTION,{chat_id:t,message_id:e.messageId,message_version:e.messageVersion})})};return document.addEventListener("copy",e),()=>{document.removeEventListener("copy",e)}},[t,n])}({chatId:o.id}),function(e){let{chatId:t}=e,{trackMessageEvent:n}=(0,en.n)(),a=(0,s.useRef)({}),i=(0,j._6)(()=>{let e=document.getSelection();if(!e||e.isCollapsed)return;let s={};for(let t=0;t<e.rangeCount;t++){let n=e.getRangeAt(t),a=(0,J.ef)(n),r=(0,J.tk)(a);if(r){var i;let t="".concat(r.messageId,"-").concat(r.messageVersion),n=null!=(i=s[t])?i:{messageId:r.messageId,messageVersion:r.messageVersion,selectionLength:0};s[t]={...n,selectionLength:n.selectionLength+e.toString().length}}}Object.entries(s).forEach(e=>{let[s,{messageId:i,messageVersion:r,selectionLength:l}]=e,o=Date.now(),c=a.current[s];c&&o-c<6e4||(a.current[s]=o,n(en.f.MESSAGE_USER_SELECTION,{chat_id:t,message_id:i,message_version:r,selection_length:l}))})},1e3);(0,s.useEffect)(()=>(document.addEventListener("selectionchange",i),()=>{document.removeEventListener("selectionchange",i)}),[i])}({chatId:o.id}),(0,s.useEffect)(()=>{ek(o.id)},[o.id,ek]);let eV=(0,s.useCallback)(()=>{F.chat.byId.setData({id:o.id},e=>{if(e)return{...e,updatedAt:new Date}}),F.chat.last.setInfiniteData({chatVisibility:S.jZ.PRIVATE,chatPermission:S.Jj.WRITE},e=>{if(e)return(0,C.lj)(e,e=>e.id===o.id,e=>({...e,updatedAt:new Date}))})},[o.id,F]),{mutate:ez}=d.api.chat.generateTitle.useMutation({onSuccess:e=>{let{generatedTitle:t}=e;t&&(F.chat.last.setInfiniteData({chatVisibility:S.jZ.PRIVATE,chatPermission:S.Jj.WRITE},e=>{if(e)return(0,C.lj)(e,e=>e.id===o.id,e=>({...e,generatedTitle:t}))}),F.chat.byId.setData({id:o.id},e=>{if(e)return{...e,generatedTitle:t}}))}}),eH=(0,s.useMemo)(()=>m.some(e=>e.files.some(e=>"image"===e.type)),[m]),eU=(0,s.useMemo)(()=>m.some(e=>e.files.some(e=>"document"===e.type)),[m]),eq=(0,s.useMemo)(()=>m.at(-1),[m]),e$=(0,s.useMemo)(()=>{var e;return!!eq&&(null==(e=eq.contentChunks)?void 0:e.some(e=>"tool_call"===e.type&&"pending"===e.confirmationStatus))},[eq]),eB=c.P.use.setOrIncrementNumberAnonymousMessages(),eG=(0,P.sZ)(),eK=(0,P.We)(),eW=(0,P.$3)(),eZ=void 0!==eW.parameters.temperature||void 0!==eW.parameters.systemPrompt,eX=(0,j.DK)(async()=>{var e,t;let n=F.message.all.getData({chatId:o.id}),a=(0,v.U)(null!=(t=null==n?void 0:n.items)?t:[],e=>e.role===k.gg.USER),s=null==a||null==(e=a.contentChunks)?void 0:e.find(e=>"text"===e.type&&e.text===I.EH);if(!a||!s)return;let i=await d.u.message.get.query({chatId:o.id,messageId:a.id});(0,K.Cq)(F)({chatId:o.id,messageId:i.id,messageVersion:i.version})(i)}),eY=(0,j.DK)((e,t)=>{F.canva.all.setData({chatId:o.id},n=>{if(n)return{items:(0,i.zh)(t(n.items),e),nextCursor:void 0}})}),eJ=(0,j.DK)(e=>eN(e)),{applyMessagePatch:eQ}=Z({chatId:o.id}),{applyCanvasPatch:e0}=q({chatId:o.id,handleOpenCanvas:eJ}),{mutateAsync:e1,isPending:e2}=function(e){let{chatId:t,session:n,handleOpenCanvas:a}=e,s=d.api.useUtils(),i=!!(null==n?void 0:n.organization.featureFlags.cause_toujours),{applyMessagePatch:r}=Z({chatId:t}),{applyCanvasPatch:l}=q({chatId:t,handleOpenCanvas:a}),{setAbortController:o,unsetAbortController:c}=L({chatId:t});return(0,X.useMutation)({mutationKey:["resumeStream",{chatId:t}],mutationFn:async e=>{let{messageId:n,messageVersion:a}=e;if(!i)return;let d=new AbortController,u=d.signal;o(d);let m=await s.client.message.resumeStream.query({chatId:t,messageId:n,messageVersion:a},{signal:u}),p=new W;for await(let e of m){if(u.aborted)break;(0,z.YW)(e).with({type:"message"},e=>r(e,p)).with({type:"canvas"},e=>l(e)).exhaustive()}c(),s.message.all.invalidate({chatId:t})}})}({chatId:o.id,session:V,handleOpenCanvas:eJ}),e3=(0,s.useMemo)(()=>{var e;return null!=(e=eD[o.id])&&e},[eD,o.id])||e2,e4=(0,M.K)(async e=>{var t,n,a,s,i,r,l;let c;if(e3||eO||o.permission===S.Jj.READ_ONLY)return;eV(),ef(null),eS(null),eT(o.id,!0),ey(!0),null==(t=ex.current)||t.updateScrollPosition();let d=new AbortController;eR(d);let u=(0,w.g)(()=>{var e,t;eT(o.id,!1),eP(),eV(),F.user.limits.invalidate();let n=(0,v.U)(null!=(t=null==(e=F.message.all.getData({chatId:o.id}))?void 0:e.items)?t:[],e=>e.role===k.gg.ASSISTANT);F.message.all.setData({chatId:o.id},e=>{if(e)return{items:e.items.map(e=>e.id===(null==n?void 0:n.id)?{...e,generationStatus:"success"}:e),nextCursor:void 0}}),eA&&eE(null),x.Fr&&(null==c?void 0:c.length)===0&&eN(null),V&&(null==n?void 0:n.version)===0&&!o.generatedTitle&&o.visibility!==S.jZ.INCOGNITO&&o.visibility!==S.jZ.AGENT_SAMPLE&&ez({chatId:o.id})});try{let t={chatId:o.id,...e,clientPromptData:{currentDate:(0,p.GP)(new Date,"yyyy-MM-dd"),userTimezone:(0,_.M)(Intl.DateTimeFormat().resolvedOptions().timeZone)},activeCanvaId:null!=(a=null==eC?void 0:eC.id)?a:void 0,stableAnonymousIdentifier:eL,customConfig:eG.customEngineConfig||eK.endpoint||eZ?{engine:null!=(s=eG.customEngineConfig)?s:void 0,customCompletionEndpoint:null!=(i=eK.endpoint)?i:void 0,customCompletionParameters:eW.parameters}:void 0,disabledFeatures:null!=(r=e.disabledFeatures)?r:[],shouldAwaitStreamBackgroundTasks:!0,shouldUseMessagePatch:!0,shouldUsePersistentStream:!0},c=await fetch("/api/chat",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"},signal:d.signal});if(V||eB(),!c.ok){let e,t;if(c.body)try{let n=await c.json();t=n.code,e=n.detail}catch(e){}if(H(en.f.CHAT_COMPLETION_ERROR,{chat_id:o.id,http_code:c.status,headers:c.headers,internal_code:t,internal_message:e,scope:"chat_http_request"}),401===c.status)return void window.location.reload();if(429===c.status){let e=c.headers.get("Retry-After"),t=e?Number(e):null;eM({open:!0,retryAfterSeconds:null!=t?t:void 0});return}if(400===c.status||409===c.status)return void F.message.all.invalidate({chatId:o.id});500===c.status&&D.s.withScope(n=>{var a;n.setFingerprint([c.status.toString(),null!=e?e:"unkwnown error",null!=(a=null==t?void 0:t.toString())?a:"unkwnown error"]),D.s.captureException(Error("Internal Error from the server for chat completion: ".concat(t)))});ef({httpCode:c.status,internalCode:t,internalMessage:e});return}await eX();let m=null!=(l=null==(n=F.message.all.getData({chatId:o.id}))?void 0:n.items)?l:[];if(eY(m,e=>e),!c.body)throw Error("The response body is empty.");ed&&eu(null),F.chat.byId.invalidate({id:o.id});let h=c.body.getReader(),f=new W;await (0,N.VD)({reader:h,signal:d.signal,onError:e=>{H(en.f.CHAT_COMPLETION_ERROR,{chat_id:o.id,internal_code:e.internalCode,scope:"chat_stream"}),ef({httpCode:1,internalCode:e.internalCode})},onPatchMessage(e,t,n){eQ({messageId:e,messageVersion:t,patches:n},f)},onPatchCanvas:e=>{e0({patches:e})},onDisclaimer:e=>{for(let t of e.disclaimers)(0,T.oRP)({variant:"warning"===t.level?"warning":"info",title:t.title,description:t.message},{dismissible:!0,duration:"warning"===t.level?1e4:void 0,id:t.code})},onDone:()=>{u()}})}catch(e){if(u(),e instanceof Error&&"AbortError"===e.name)return;D.s.captureException(e),H(en.f.CHAT_COMPLETION_ERROR,{chat_id:o.id,internal_code:E.T.CHAT_STREAM_FRONT_END,internal_message:e instanceof Error?e.message:"unknown error",scope:"chat_full_request"}),ef({httpCode:1,internalCode:E.T.CHAT_STREAM_FRONT_END})}finally{u()}}),{activeLibrarySelection:e5}=(0,l.TY)(),e6=(0,s.useCallback)(async e=>{var t,n,a,s,i,r,l,c,d,u;let m,{value:p,model:h,agentId:f,agentsApiAgentId:g,features:x,integrations:v,followupQuestionId:y,hasPastedText:j}=e;if(p.files.length>0)try{ep(!0),p.files=await (0,es.Zn)(p.files,U)}catch(e){T.oRP.error("".concat(e));return}finally{ep(!1)}if(p.canva&&!(null==x?void 0:x.includes("beta-trampoline")))return void T.oRP.error(U("canvas.feature_required"));let w="string"==typeof p.inputValue?p.inputValue:null,_=null!=(a=null==(t=p.transcriptions)?void 0:t.map(e=>{let{url:t,originalTranscript:n,transcriptionId:a,recordingId:s}=e;return{type:"audio",recordingUrl:t,metadata:{originalTranscript:n,transcriptionId:a,recordingId:s}}}))?a:[];if((null==eq?void 0:eq.role)===k.gg.USER){let e="string"!=typeof p.inputValue?p.inputValue:null;_.length>0&&(e=[..._,...null!=e?e:[]]),p.voiceInputUrl&&(e=[{type:"text",text:I.EH}]),m=eq.id,F.message.all.setData({chatId:o.id},t=>{if(!t)return;let n=t.items.find(e=>e.id===eq.id&&e.version===eq.version);if(n)return{items:[...t.items.map(e=>{if(e.id===n.id){var t;return{...e,status:"inactive",versionCount:e.versionCount+1,nextVersion:null!=(t=e.nextVersion)?t:n.version}}return e}),{...n,status:"active",version:n.version+1,versionCount:n.versionCount+1,nextVersion:null,createdAt:new Date,content:w,contentChunks:e,agentId:null!=f?f:null,agentsApiAgentId:null!=g?g:null,files:p.files.map(e=>{var t;return{type:e.type,url:e.url,name:e.name,inlineId:null!=(t=e.inlinePositionId)?t:null}}),model:null!=h?h:"default"}],nextCursor:void 0}})}else{m=(0,b.A)();let e=p.canva,t=e?[{type:"canva",id:e.id,version:0}]:[];p.action&&t.push({type:"action",id:p.action}),t.push(..._),"string"!=typeof p.inputValue?t.push(...p.inputValue):t.length>0&&t.push({type:"text",text:p.inputValue}),(0,K.DY)(F)({chatId:o.id})({messageToAdd:{id:m,role:k.gg.USER,isAcceleratedAnswer:!1,content:w,contentChunks:p.voiceInputUrl?[{type:"text",text:I.EH}]:t,files:p.files.map(e=>{var t;return{type:e.type,url:e.url,name:e.name,inlineId:null!=(t=e.inlinePositionId)?t:null}}),createdAt:new Date,createdById:null!=(s=null==V?void 0:V.user.id)?s:null,chatId:o.id,status:"active",generationStatus:"success",agentId:null!=f?f:null,agentsApiAgentId:null!=g?g:null,model:null!=h?h:"default",version:0,prevVersion:null,nextVersion:null,versionCount:1,moderationCategory:null,memories:null,references:null,reaction:k.nM.NEUTRAL,turn:(null!=(i=null==eq?void 0:eq.turn)?i:-1)+1,parentId:null!=(r=null==eq?void 0:eq.id)?r:null,parentVersion:null!=(l=null==eq?void 0:eq.version)?l:null,visibility:S.jZ.PRIVATE,followups:[]}}),e&&F.canva.all.setData({chatId:o.id},t=>{if(t)return{items:[...t.items,{...e,status:"active",messageId:m,messageVersion:0,prevVersion:null,nextVersion:null,versionCount:1,versionIndex:1}],nextCursor:void 0}}),eA&&F.quote.all.setData({chatId:o.id},e=>{if(e)return{items:[...e.items,{id:(0,b.A)(),content:eA.content,status:"active",createdAt:new Date,messageId:m,messageVersion:0,canvaId:eA.canvaId,canvaVersion:eA.canvaVersion,chatId:o.id}],nextCursor:void 0}})}x&&F.chat.byId.setData({id:o.id},e=>{if(e)return{...e,features:x}}),v&&F.chat.byId.setData({id:o.id},e=>{if(e)return{...e,integrations:v}}),F.chat.byId.setData({id:o.id},e=>{if(e)return{...e,libraries:e5}}),e4({mode:"append",model:h,agentsApiAgentId:null!=g?g:void 0,agentId:null!=f?f:void 0,messageInput:p.inputValue,voiceInput:p.voiceInputUrl?{url:p.voiceInputUrl}:void 0,audioRecording:(null==(n=p.transcriptions)?void 0:n.length)?p.transcriptions:void 0,messageFiles:p.files.map(e=>({...e,inlineFileId:e.inlinePositionId,url:e.url})),messageId:m,action:null!=(c=p.action)?c:void 0,features:x,libraries:e5,integrations:v,quote:null!=eA?eA:void 0,canva:p.canva?{content:p.canva.content,type:p.canva.type,identifier:p.canva.identifier,options:null!=(d=p.canva.options)?d:{},title:null!=(u=p.canva.title)?u:"",id:p.canva.id}:void 0,followupQuestionId:y,disabledFeatures:j?["memory-inference"]:[]}),H(en.f.PROMPT_SUBMITTED,{chat_id:o.id,prompt_id:m,prompt_version:0,prompt_chars_number:"string"==typeof p.inputValue?p.inputValue.length:(0,A.r)({contentChunks:p.inputValue}).length,model:h})},[null==eq?void 0:eq.id,null==eq?void 0:eq.version,null==eq?void 0:eq.turn,null==eq?void 0:eq.role,o.id,H,e4,V,F,eA,e5,U]),e8=(0,j.DK)(e=>{let{question:t,agentId:n,model:a,features:s,integrations:i,questionId:r}=e;e6({value:{inputValue:t,files:[]},agentId:n,model:a,features:s,integrations:i,followupQuestionId:r})}),e9=(0,s.useCallback)(e=>{let{features:t,integrations:n}=e;eq&&((0,K.dT)(F)({chatId:o.id,messageId:eq.id,messageVersion:"all"}),e4({mode:"rewrite",features:t,integrations:n,libraries:e5}),H(en.f.REWROTE_ANSWER,{chat_id:o.id,answer_id:eq.id,answer_version:eq.version,new_answer_version:eq.version+1,model:eq.model}))},[eq,F,o.id,e4,e5,H]),e7=(0,s.useCallback)(e=>{let{features:t,integrations:n}=e;eq&&eq.role===k.gg.ASSISTANT&&(0,K.dT)(F)({chatId:o.id,messageId:eq.id,messageVersion:"all"}),e4({mode:"retry",features:t,integrations:n,libraries:e5})},[eq,e4,e5,F,o.id]),te=(0,j.DK)(e=>{var t,n;let{messageId:a,value:s,agentsApiAgentId:i,model:r,agentId:l,features:c,integrations:d,followupQuestionId:u,hasPastedText:m}=e,p=null==(t=F.message.all.getData({chatId:o.id}))?void 0:t.items.find(e=>e.id===a&&"active"===e.status);p&&(F.message.all.setData({chatId:p.chatId},e=>{var t;if(!e)return;if(!e.items.find(e=>e.id===a))return e;let n=Math.max(...e.items.filter(e=>e.id===a).map(e=>e.version)),o="string"!=typeof s.inputValue?s.inputValue:p.contentChunks,c={id:a,role:k.gg.USER,content:(0,A.r)({contentChunks:o}),contentChunks:s.voiceInputUrl?[{type:"text",text:I.EH}]:o,files:s.files.map(e=>{var t,n;return{type:e.type,url:e.url,name:null!=(t=e.name)?t:null,inlineId:null!=(n=e.inlinePositionId)?n:null}}),version:n+1,status:"active",generationStatus:"success",reaction:k.nM.NEUTRAL,createdAt:new Date,createdById:null!=(t=null==V?void 0:V.user.id)?t:null,chatId:p.chatId,agentId:null!=l?l:null,agentsApiAgentId:null!=i?i:null,model:null!=r?r:"default",moderationCategory:null,memories:null,references:null,isAcceleratedAnswer:p.isAcceleratedAnswer,turn:p.turn,parentId:p.parentId,parentVersion:p.parentVersion,prevVersion:n,nextVersion:null,versionCount:p.versionCount+1,visibility:S.jZ.PRIVATE,followups:[]};return{items:[...e.items.map(e=>{if(e.id===a){var t;return{...e,status:"inactive",nextVersion:null!=(t=e.nextVersion)?t:n+1,versionCount:p.versionCount+1}}return{...e}}),c],nextCursor:void 0}}),e4({mode:"edit",features:c,integrations:d,libraries:e5,model:r,agentId:null!=l?l:void 0,agentsApiAgentId:null!=i?i:void 0,messageId:a,messageInput:s.inputValue,voiceInput:s.voiceInputUrl?{url:s.voiceInputUrl}:void 0,audioRecording:(null==(n=s.transcriptions)?void 0:n.length)?s.transcriptions:void 0,messageFiles:s.files.map(e=>({...e,inlineFileId:e.inlinePositionId,url:e.url})),followupQuestionId:u,disabledFeatures:m?["memory-inference"]:[]}))}),{handleStop:tt}=function(e){let{chatId:t,latestMessage:n,session:a}=e,i=!!(null==a?void 0:a.organization.featureFlags.cause_toujours),{getAbortController:r,unsetAbortController:l}=L({chatId:t}),o=d.api.useUtils(),{mutateAsync:c}=d.api.chat.cancelGeneration.useMutation({onSuccess:()=>{o.message.all.invalidate({chatId:t})}});return{handleStop:(0,s.useCallback)(async()=>{var e;null==(e=r())||e.abort(),l(),i&&await c({chatId:t}),o.message.all.setData({chatId:t},e=>{if(e)return{items:e.items.map(e=>"in-progress"===e.generationStatus?{...e,generationStatus:"canceled"}:e),nextCursor:void 0}}),(null==n?void 0:n.role)===k.gg.USER&&o.message.all.setData({chatId:t},e=>{if(e)return{items:e.items.map(e=>e.parentId===n.id&&e.parentVersion===n.version&&null===e.nextVersion?{...e,status:"active"}:e),nextCursor:void 0}})},[r,t,null==n?void 0:n.id,null==n?void 0:n.role,null==n?void 0:n.version,l,o,i,c])}}({chatId:o.id,latestMessage:eq,session:V}),tn=(0,ea.v)(),ta=(0,j.DK)(async e=>{let{permissionUpdates:t,confirmations:n,agentId:a,features:s,integrations:i,message:r}=e,l=(()=>{let e=new Map(n.map(e=>[e.toolCallId,{deny:"denied",allow:"allowed"}[e.confirmation]])),t=F.message.all.getData({chatId:o.id});return F.message.all.setData({chatId:o.id},t=>{if(t)return{items:t.items.map(t=>t.id===r.id&&t.contentChunks?{...t,contentChunks:t.contentChunks.map(t=>"tool_call"===t.type&&e.has(t.id)?{...t,confirmationStatus:e.get(t.id)}:t)}:t),nextCursor:t.nextCursor}}),()=>{F.message.all.setData({chatId:o.id},()=>t)}})();t.length&&await tn(t),await e4({mode:"toolCallConfirmation",confirmations:n,agentId:null!=a?a:void 0,features:s,integrations:i,libraries:e5}).catch(e=>{console.error(e),l()})});!function(e){let{chatId:t,latestMessage:n,hasChatBeenStarted:a,isStableAnonymousIdLoading:i,chatPermission:r,isGenerating:l,sendChatRequest:o,resumeStream:c}=e,d=(0,j.DK)(e=>{a||e.isStableAnonymousIdLoading||e.chatPermission===$.J.READ_ONLY?l||(null==n?void 0:n.generationStatus)!=="in-progress"||c({messageId:n.id,messageVersion:n.version}):(o({mode:"start",disabledFeatures:function(e){var t;let{chatInitMetadata:n,chatId:a}=e,s=(null==n?void 0:n.chatId)===a,i=s&&!!(null==(t=n.metadata)?void 0:t.hasPastedText);return!s||i?["memory-inference"]:[]}({chatInitMetadata:(0,B.KV)(),chatId:e.chatId})}),(0,B.NF)())});(0,s.useEffect)(()=>{d({chatId:t,isStableAnonymousIdLoading:i,chatPermission:r})},[t,i,r,d])}({chatId:o.id,latestMessage:eq,chatPermission:o.permission,hasChatBeenStarted:ev,isStableAnonymousIdLoading:eO,isGenerating:e3,sendChatRequest:e4,resumeStream:e1});let ts=(0,s.useMemo)(()=>m.map(e=>({id:e.id,version:e.version,turn:e.turn,status:e.status,role:e.role,parentId:e.parentId,parentVersion:e.parentVersion})),[m]);return(0,s.useEffect)(()=>{er(ts)},[ts,er]),(0,s.useEffect)(()=>{G(y)},[y,G]),(0,s.useEffect)(()=>{el(o.permission===S.Jj.READ_ONLY)},[o.permission,el]),(0,s.useEffect)(()=>{null==ec||ec(tt)},[tt,ec]),(0,a.jsxs)("div",{className:"flex h-full max-h-full w-full min-w-0 flex-col items-center justify-center",children:[!V&&(0,a.jsx)(eo,{}),(0,a.jsxs)("div",{className:"relative flex h-full w-full flex-col items-center overflow-hidden",ref:eg,children:[(0,a.jsx)(h.P.div,{layout:!0,layoutRoot:!0,className:"relative flex h-full w-full items-start overflow-hidden",children:(0,a.jsx)(h.P.div,{className:"absolute end-0 flex h-full min-h-full w-full flex-col items-start justify-start overflow-hidden",transition:{duration:.5,ease:"easeInOut"},children:(0,a.jsxs)("div",{className:"relative flex h-full w-full flex-col items-end justify-end",children:[(0,a.jsx)(f.N,{children:eC&&!e_&&(0,a.jsx)(h.P.div,{variants:{open:{width:"480px",translateX:"0",opacity:1},closed:{width:"480px",translateX:"480px",opacity:0}},initial:ed?"open":"closed",animate:"open",exit:"closed",transition:{duration:.5,ease:"easeInOut"},className:(0,R.cn)("absolute z-10 flex h-full w-[480px] max-w-[480px] overflow-y-auto"),children:(0,a.jsx)(eF,{ref:ex,messages:m,quotes:O,canvas:y,session:V,user:null==V?void 0:V.user,handleEdit:te,handleRewrite:e9,handleRetry:e7,handleToolCallConfirmation:ta,isGenerating:e3,features:null!=(n=o.features)?n:void 0,chatRequestError:eh,chatId:o.id,isReadOnly:o.permission===S.Jj.READ_ONLY,latestMessage:eq,isIncognito:o.visibility===S.jZ.INCOGNITO,handleFollowUp:e8})},"chat-messages-side")}),(0,a.jsx)(f.N,{children:!eC&&(0,a.jsx)(h.P.div,{initial:{opacity:1},animate:{opacity:1},transition:{duration:1,ease:"easeInOut"},exit:{opacity:0},className:"flex h-full w-full flex-col overflow-y-hidden",children:(0,a.jsx)(eF,{ref:ex,messages:m,quotes:O,canvas:y,session:V,user:null==V?void 0:V.user,handleEdit:te,handleRewrite:e9,handleRetry:e7,handleToolCallConfirmation:ta,isGenerating:e3,features:null!=(r=o.features)?r:void 0,chatRequestError:eh,chatId:o.id,isReadOnly:o.permission===S.Jj.READ_ONLY,latestMessage:eq,isIncognito:o.visibility===S.jZ.INCOGNITO,handleFollowUp:e8})},"chat-messages")})]})})}),(0,a.jsx)(eI,{isLoading:e$||e3||!V&&eO||em,messagesContainImages:eH,messagesContainDocuments:eU,handleSubmit:e6,handleStop:tt,session:V,chat:o,messages:m,latestMessage:eq,incognito:o.visibility===S.jZ.INCOGNITO})]})]})},function(e,t){return(0,y.H)(e.chat,t.chat)&&(0,y.H)(e.messages,t.messages)&&(0,y.H)(e.canvas,t.canvas)&&(0,y.H)(e.quotes,t.quotes)&&(0,y.H)(e.session,t.session)});var eB=n(96874);function eG(e){var t,n,p;let{initialChat:h,initialMessages:f,initialCanvas:g,initialQuotes:x,features:v,session:y,chatId:j}=e,b=c.P.use.setReferencesPanelMsgData(),{openCanva:w,setOpenCanva:_,setQuote:C,tempCanva:N,setTempCanva:I,setIsGeneratingMetadata:k}=(0,u.o)(),A=c.P.use.setEditMessageId();if((0,s.useEffect)(()=>(b(null),A(null),C(null),k(!1),()=>{b(null),A(null),_(null),C(null),I(null),k(!1)}),[j,A,_,b,C,I,k]),!j)throw Error("chatId is required");let{data:E}=d.api.chat.byId.useQuery({id:j},{initialData:h.id===j?h:void 0,refetchOnWindowFocus:!1}),S=d.api.message.all.useQuery({chatId:j},{initialData:h.id===j?{items:f,nextCursor:void 0}:void 0,refetchOnWindowFocus:!1}),D=d.api.canva.all.useQuery({chatId:j},{initialData:h.id===j?{items:g,nextCursor:void 0}:void 0,refetchOnWindowFocus:!1}),T=d.api.quote.all.useQuery({chatId:j},{initialData:h.id===j?{items:x,nextCursor:void 0}:void 0,refetchOnWindowFocus:!1}),M=(0,s.useMemo)(()=>S.data?(0,r.x)(S.data.items):[],[S.data]),R=(0,s.useMemo)(()=>D.data?(0,i.zh)(D.data.items,M):[],[D.data,M]);(0,s.useEffect)(()=>{w&&([...N?[N]:[],...R].find(e=>e.id===w.id&&e.version===w.version)||_(null))},[R,_,w,N]);let P=(0,s.useMemo)(()=>M.flatMap(e=>{var t;return null!=(t=e.references)?t:[]}),[M]);return E&&S.data&&D.data&&T.data?(0,a.jsx)(m.i,{references:P,children:(0,a.jsx)(o.IntegrationsProvider,{session:y,features:v,initialFeatures:null!=(t=E.features)?t:[],initialIntegrations:null!=(n=E.integrations)?n:void 0,saveSelection:!0,chatId:j,children:(0,a.jsx)(l.DocumentLibraryProvider,{session:y,initialSelection:null!=(p=E.libraries)?p:[],saveSelection:!1,children:(0,a.jsx)(e$,{chat:E,messages:M,canvas:R,quotes:T.data.items,session:y})})})}):(0,a.jsx)(eB.A,{})}},19071:(e,t,n)=>{"use strict";n.d(t,{x:()=>r});var a=n(15912),s=n(86130);let i={[s.gg.USER]:0,[s.gg.ASSISTANT]:1,[s.gg.SYSTEM]:-1},r=e=>{let t=[];return(0,a.U)(e.filter(e=>"active"===e.status),e=>e.turn,e=>i[e.role]).forEach(e=>{if(0===t.length)t.push(e);else{let n=t.at(-1);e.parentId===n.id&&e.parentVersion===n.version&&t.push(e)}}),t}},20752:(e,t,n)=>{"use strict";n.d(t,{Q:()=>a2,X:()=>a0});var a=n(64784),s=n(23536),i=n(6016),r=n(5936),l=n(67781),o=n(2053),c=n(21917),d=n(55936),u=n(7763),m=n(12330),p=n(93706),h=n(8380),f=n(83145),g=n(71222),x=n(6664),v=n(86130),y=n(76432),j=n(53112);function b(e){var t;let n;return!!e&&(!!(t=n=e.user)&&!!t.email&&"string"==typeof t.email&&(0,j.d)(t.email,"@mistral.ai")||!!n&&!!n.email&&"string"==typeof n.email&&(0,j.d)(n.email,"@ext.mistral.ai")||y._K.NEXT_PUBLIC_ENABLE_DEBUG_FOR_ADMINS&&"A"===e.role)}var w=n(8740);let _=[v.Tn.CHILD_ABUSE,v.Tn.CRIMINAL,v.Tn.HATE,v.Tn.VIOLENCE],C=[v.Tn.SELF_HARM];var N=n(33987),I=n(97561);function k(e,t){return e.filter(e=>e.messageId===t.id&&e.messageVersion===t.version)}var A=n(8424),E=n(12965),S=n(88318),D=n(30063),T=n(77515),M=n(8936),R=n(93255),P=n(93717),L=n(42573);function O(e){let t=(0,h.useRef)(e);return(0,g.H)(t.current,e)||(t.current=e),t.current}let V=e=>{let t=h.useRef(e);return h.useLayoutEffect(()=>{t.current=e}),t};var z=n(10659),F=n(89615),H=n(75429),U=n(55400),q=n(19494),$=n(90859),B=n(8866),G=n(23964),K=n(85180);function W(e){let{shouldFade:t=!1,children:n,as:s="p",...i}=e,[r,l]=(0,h.useState)([]),o=(0,h.useRef)(""),c=(0,h.useRef)(0),d="string"==typeof n;if((0,h.useEffect)(()=>{if(!d)return;let e=o.current;if(n.startsWith(e)){let a=n.slice(e.length);a.length>0&&l(e=>[...e,{id:c.current++,text:a,fadeIn:t}])}else l([{id:c.current++,text:n,fadeIn:!1}]);o.current=n},[n,d,t]),!t)return(0,a.jsx)(s,{dir:"p"===s?"auto":void 0,...i,children:n});if(!d){let e=h.Children.toArray(n);return(0,a.jsx)(s,{...i,children:e.map((e,n)=>{if("string"==typeof e)return o.current.startsWith(e)?e:(0,a.jsx)(W,{shouldFade:t,as:h.Fragment,children:e},n);if(h.isValidElement(e)&&"string"==typeof e.type&&["blockquote","h1","h2","h3","h4","h5","h6","li","ol","ul","p","a","code","em","img","pre","strong"].includes(e.type)){var s;return(0,a.jsx)(W,{dir:"p"===e.type?"auto":void 0,shouldFade:t,as:e.type,...null!=(s=e.props)?s:{}},n)}return e})})}return(0,a.jsx)(s,{...i,children:r.map(e=>e.fadeIn?(0,a.jsx)("span",{className:"fade-in",onAnimationEnd:()=>{l(t=>t.map(t=>t.id===e.id?{...t,fadeIn:!1}:t))},children:e.text},e.id):(0,a.jsx)(h.Fragment,{children:e.text},e.id))})}var Z=n(29055),X=n(37984);let Y={assembly:"aarch64",aws:"amazonwebservices",py:"python",python3:"python",sage:"python",js:"javascript",node:"javascript",nodejs:"javascript",nodets:"typescript",cpp:"cplusplus","c++":"cplusplus",cc:"cplusplus",cs:"csharp","c#":"csharp",php3:"php",php4:"php",php5:"php",php6:"php",rb:"ruby",kt:"kotlin",golang:"go",rs:"rust",ts:"typescript",tsx:"typescript",ex:"elixir",exs:"elixir",clj:"clojure",hs:"haskell",erl:"erlang",gcp:"googlecloud",jl:"julia",pl:"perl",objc:"objectivec",mm:"objectivec",m:"matlab",xhtml:"html5",html:"html5",sh:"bash",shell:"bash",ps1:"powershell",psm1:"powershell",coffee:"coffeescript",fs:"fsharp",ml:"ocaml",rkt:"racket",commonlisp:"lisp",f77:"fortran",f90:"fortran",f95:"fortran",sol:"solidity",vy:"vyper",cr:"crystal",re:"reasonml",purs:"purescript",idr:"idris",dosbatch:"batch",winbatch:"batch",vbs:"vbscript",wat:"wasm",yml:"yaml",md:"markdown",delphi:"pascal",asm:"aarch64",gql:"graphql",jsx:"javascript",scss:"sass",css:"css3",dockerfile:"docker",fish:"bash",json5:"json",jsonc:"json",ipython:"python",plsql:"postgresql",tsql:"postgresql",vlang:"v",dlang:"d",vue:"vuejs",svelte:"svelte",solid:"solidjs",solidity:"solidity"},J={sql:Z.A},Q=e=>{let{language:t,className:n}=e,{resolvedTheme:s}=(0,X.D)(),i=J[t.toLowerCase()];if(i)return(0,a.jsx)(i,{className:(0,D.cn)("size-4",n)});let r=Y[t.toLowerCase()]||t;return(0,a.jsx)("i",{role:"img","aria-label":"".concat(t," icon"),className:(0,D.cn)("devicon-".concat(r,"-plain"),"dark"!==s&&"colored")})};function ee(e){let{className:t,children:n,disableInline:s,shouldFade:i=!1,disableActions:r=!1,node:l,...o}=e,c=(0,p.c3)("Chat"),{trackMessageEvent:d}=(0,B.n)(),u=!s&&!String(n).includes("\n"),m=/language-(\w+)/.exec(null!=t?t:""),f=(null==m?void 0:m[1])||"text",g=String(n).trim();"markdown"===f&&(g=(g=g.replace(/\n(\s*)\|/g,"\n |")).replace(/\|/," "));let x=(0,h.useContext)(K.N),v=async()=>{await navigator.clipboard.writeText(n).then(()=>{A.oRP.info(c("message.copy_code_button_toast"))}),d(B.f.COPIED_MESSAGE_CODE_BLOCK,{chat_id:null==x?void 0:x.chatId,message_id:null==x?void 0:x.id,message_version:null==x?void 0:x.version,answer_id:null==x?void 0:x.id,answer_version:null==x?void 0:x.version})},{createTemporaryCanva:y,session:j}=(0,G.o)(),{allowedFeatures:b,selectedFeatures:w,setSelectedFeatures:_}=(0,q.mr)(),C=(0,h.useCallback)(()=>{y({content:g,inferedCanvaEditorType:"code",onToggleFeature(){w.includes("beta-trampoline")||_([...w,"beta-trampoline"])}})},[y,g,w,_]);return u?(0,a.jsx)(W,{as:"code",shouldFade:i,className:(0,D.cn)("font-weight-400 rounded-md bg-state-ghost-hover p-1 text-sm whitespace-normal",t),...o,"data-testid":"code-block",children:n}):(0,a.jsxs)("div",{"data-testid":"code-block",className:"relative m-0 rounded-md border border-default bg-default whitespace-break-spaces",children:[(0,a.jsxs)("div",{...$.Ux,className:"sticky top-0 mb-1 flex items-center justify-between gap-1 rounded-t-md border-b border-default bg-default px-3 font-sans select-none",children:["text"!==f?(0,a.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,a.jsx)(Q,{language:f}),(0,a.jsx)("span",{className:"text-xs capitalize",children:f})]}):(0,a.jsx)("span",{}),(0,a.jsxs)("div",{className:"inline-flex h-10 items-center gap-1",children:[b.includes("beta-trampoline")&&(null==j?void 0:j.organization.featureFlags["feathers-mcgraw"])?(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{variant:"ghost",size:"2xs",className:"text-subtle",onClick:C,isDisabled:r,children:c("canvas.edit_in_canva")})}),(0,a.jsx)(S.ZI,{children:c("canvas.edit_in_canva")})]}):null,(0,a.jsxs)(H.$n,{"aria-label":"Copy code to clipboard",variant:"ghost",size:"2xs",className:"text-subtle",onClick:v,isDisabled:r,children:[(0,a.jsx)(H.IM,{icon:F.A}),c("message.copy_button_title")]})]})]}),(0,a.jsx)(U.b,{language:f,customStyle:{background:"transparent"},children:g})]})}var et=n(32735),en=n(51039),ea=n(75165);function es(e){let{className:t}=e;return(0,a.jsx)(A.EAD,{className:(0,D.cn)("rounded-[12px]",t),style:{height:"".concat(ea.u,"px")}})}let ei=(0,u.default)(()=>n.e(9017).then(n.bind(n,89017)).then(e=>e.IFrameBlock),{loadableGenerated:{webpack:()=>[89017]},ssr:!1,loading:()=>(0,a.jsx)(es,{})});function er(e){let{part:t}=e,{resolvedTheme:n}=(0,X.D)(),s="".concat(t.source,"?dark_mode=").concat(String("dark"===n));return(0,a.jsx)(ei,{src:s,className:"mt-2 mb-4 w-full"})}var el=n(96166),eo=n(20165),ec=n(4580),ed=n(91416),eu=n(28008);function em(e){let{className:t}=e,n=(0,p.c3)("Chat");return(0,a.jsxs)("span",{className:(0,D.cn)("flex flex-col items-center justify-center gap-4 rounded-md bg-basic-gray-alpha-4 p-4",t),children:[(0,a.jsx)(ed.A,{className:"size-10 text-icon-default-subtle"}),(0,a.jsx)(eu.ac,{variant:"subtle",size:"sm",className:"text-center",children:n("message.image_gallery.blocked_image_placeholder")})]})}function ep(e){var t,n,a,s,i;let{reference:r,blockedImageSources:l}=e,o=r.id,c=null!=(i=r.url)?i:null,d=r.title,u="number"==typeof(null==(t=r.metadata)?void 0:t.width)?r.metadata.width:null,m="number"==typeof(null==(n=r.metadata)?void 0:n.height)?r.metadata.height:null,p="string"==typeof(null==(a=r.metadata)?void 0:a.original_page_url)?r.metadata.original_page_url:null,h="string"==typeof(null==(s=r.metadata)?void 0:s.image_source)?r.metadata.image_source:null,f=l.some(e=>null==p?void 0:p.includes(e));return{referenceId:o,src:c,width:u,height:m,referenceTitle:d,referenceUrl:p,referenceHostname:h,isBlocked:f}}var eh=n(35111);function ef(){var e;let{data:t}=eh.api.message.getBlockedImageSources.useQuery();return{blockedImageSources:null!=(e=null==t?void 0:t.blockedImageSources)?e:[]}}var eg=n(66318),ex=n(38912);function ev(e){let{referenceId:t,className:n,imageClassName:s}=e,{references:i}=(0,el.G)(),{blockedImageSources:r}=ef(),l=null==i?void 0:i.find(e=>e.id===t);if(!l)return null;let{src:o,width:c,height:d,referenceTitle:u,referenceUrl:m,referenceHostname:p,isBlocked:h}=ep({reference:l,blockedImageSources:r});return o?h?(0,a.jsx)(em,{className:(0,D.cn)("relative me-2 mt-2 inline-block h-40 w-24",n)}):(0,a.jsx)(ex.D,{alt:u,src:o,thumbnailWidth:400,className:(0,D.cn)("relative me-2 mt-2 inline-block h-40 max-w-72 min-w-24 overflow-hidden rounded-md bg-card-subtle",n),imageClassName:(0,D.cn)("h-full max-h-full min-h-0! w-full max-w-full min-w-0! object-cover",s),referenceTitle:u,referenceUrl:m,referenceHostname:p,originalWidth:c,originalHeight:d,showBlur:!0}):null}function ey(e){let{referenceIds:t}=e,n=(0,p.c3)("Chat"),{customGalleryImages:s,containsBlockedImages:r}=function(e){let{referenceIds:t}=e,{references:n}=(0,el.G)(),{blockedImageSources:a}=ef();return(0,h.useMemo)(()=>(function(e){let{referenceIds:t,references:n,blockedImageSources:a}=e,s=t.map(e=>{let t=n.find(t=>t.id===e);return t?ep({reference:t,blockedImageSources:a}):null}).filter(e=>null!==e),i=s.filter(e=>{let{isBlocked:t}=e;return!t});return{customGalleryImages:i,containsBlockedImages:i.length!==s.length}})({referenceIds:t,references:null!=n?n:[],blockedImageSources:a}),[n,t,a])}({referenceIds:t}),{gridContainerRef:l,gridItems:o,imageHeight:c}=function(e){let{images:t,rowHeight:n,numberOfColumns:a,minColSpan:s,maxColSpan:i}=e,[r,l]=(0,h.useState)(730),o=(0,h.useRef)(null),c=r/a,d=(0,h.useMemo)(()=>(function(e){let{numberOfColumns:t,gridItemColSpans:n}=e,a=[{items:[],totalColSpan:0}];return n.forEach(e=>{let n=a[a.length-1];n&&(e.colSpan+n.totalColSpan<=t?(n.items.push(e),n.totalColSpan+=e.colSpan):a.push({items:[e],totalColSpan:e.colSpan}))}),a.map((e,n)=>n===a.length-1?e.items:function(e){let{numberOfColumns:t,row:n}=e,a=n.reduce((e,t)=>e+t.colSpan,0),s=n.map(e=>({...e})),i=t-a;for(;i>0;){let e=s.reduce((e,t)=>{if(!e)return t;let n=e.idealColSpan-e.colSpan;return t.idealColSpan-t.colSpan<n?t:e},null);if(!e)break;e.colSpan+=1,i-=1}return s}({numberOfColumns:t,row:e.items})).reduce((e,t,n)=>[...e,...t.map(e=>({...e,rowStart:n+1}))],[])})({numberOfColumns:a,gridItemColSpans:t.map(e=>(function(e){var t,n;let{image:a,rowHeight:s,minColSpan:i,maxColSpan:r}=e,l=s*(null!=(t=a.width)?t:250)/(null!=(n=a.height)?n:250),o=(0,eg.q)(Math.round(l),{min:i,max:r});return{referenceId:a.referenceId,idealColSpan:l,colSpan:o}})({image:e,rowHeight:n,minColSpan:s,maxColSpan:i}))}),[t,n,a,s,i]);return(0,h.useEffect)(()=>{let e=()=>{o.current&&l(o.current.clientWidth)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),{gridContainerRef:o,gridItems:d,imageHeight:n*c}}({images:s,rowHeight:3,numberOfColumns:12,minColSpan:2,maxColSpan:4}),{isExpandButtonVisible:d,isExpanded:u,toggleExpand:m}=function(e){let{gridItems:t,numberOfColumns:n}=e,[a,s]=(0,h.useState)(!1);return{isExpandButtonVisible:t.reduce((e,t)=>e+t.colSpan,0)>n,isExpanded:a,toggleExpand:(0,h.useCallback)(()=>{s(e=>!e)},[])}}({gridItems:o,numberOfColumns:12});return(0,a.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,a.jsx)(i.P.div,{ref:l,className:"w-full overflow-hidden",initial:{height:c},animate:{height:u?"auto":c},transition:{duration:.2,ease:"easeInOut"},children:(0,a.jsxs)("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(".concat(12,", minmax(0, 1fr))")},children:[o.map((e,t)=>{let{referenceId:n,colSpan:s,rowStart:i}=e;return(0,a.jsx)("div",{style:{gridColumn:"span ".concat(s," / span ").concat(s),gridRowStart:i,height:c},children:(0,a.jsx)(ev,{referenceId:n,className:"m-0 h-full max-h-none w-full max-w-none overflow-hidden",imageClassName:"min-h-full min-w-full"})},t)}),r&&0===o.length&&(0,a.jsx)("div",{className:"col-span-4 row-start-1",style:{height:c},children:(0,a.jsx)(em,{className:"h-full w-full"})})]})}),d&&(0,a.jsxs)(H.$n,{variant:"ghost",onClick:m,children:[n(u?"message.image_gallery.show_less":"message.image_gallery.show_more"),(0,a.jsx)(H.qF,{icon:u?eo.A:ec.A})]})]})}var ej=n(7694),eb=n(84544),ew=n(49036),e_=n(6270),eC=n(79717),eN=n(56337),eI=n(90907);function ek(e){let{title:t,hostname:n,thumbnailUrl:s}=e,[i,r]=(0,h.useState)("loading"),l=!s||"loaded"!==i;return(0,h.useEffect)(()=>{if(r("loading"),s){let e=new Image;e.src=s,e.onload=()=>r("loaded"),e.onerror=()=>r("error")}},[s]),(0,a.jsxs)("div",{className:(0,D.cn)("relative flex w-full items-center justify-center overflow-hidden bg-muted","h-[110px] lg:h-[140px]"),children:[s&&(0,a.jsx)("img",{src:s,alt:t,className:(0,D.cn)("h-full w-full object-cover","loaded"===i?"block":"hidden"),onLoad:()=>r("loaded"),onError:()=>r("error")}),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-25 blur-[30px] dark:opacity-15",children:(0,a.jsx)(eI.A,{hostname:n,height:140,width:140})}),(0,a.jsx)(eI.A,{hostname:n,height:48,width:48})]})]})}function eA(e){let{item:t,className:n}=e,{format:s}=(0,eN.lT)(),i=t.date?s((0,eC.H)(t.date),"PP"):null;return(0,a.jsxs)("a",{"data-link-card":!0,href:t.href,target:"_blank",onClick:t.onClick,className:(0,D.cn)("link-card cursor-pointer rounded-card-sm border-[0.5px] border-darker bg-default outline-[1px] outline-[transparent]","hover:border-(--bg-basic-orangebright-accent) hover:outline-(--bg-basic-orangebright-accent)","transition-[outline-color,border-color] duration-300 hover:transition-[outline-color,border-color] hover:duration-100","shadow-[0_2px_0_0_rgba(0,0,0,0.11)]","flex min-h-full w-[209px] flex-col items-stretch overflow-hidden lg:w-[232px]",n),children:[(0,a.jsx)(ek,{title:t.title,thumbnailUrl:t.thumbnailUrl,hostname:t.hostname}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col gap-1 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eI.A,{hostname:t.hostname,height:16,width:16}),(0,a.jsx)(eu.o5,{variant:"subtle",size:"xs",children:t.sourceDisplayName})]}),(0,a.jsx)(eu.o5,{className:(0,D.cn)("flex-1 md:text-sm",i?"line-clamp-2":"line-clamp-3"),children:t.title}),i&&(0,a.jsx)(eu.o5,{variant:"subtle",size:"xs",className:"pt-2 opacity-60",children:i})]})]})}function eE(e){let{referenceIds:t}=e,n=(0,h.useContext)(K.N),s=(0,A.dvO)();if(!n)throw Error("LinkCards must be used within a MessageContext provider.");let{dialogOpen:i,afpArticle:r,onClickAFPArticle:l,setDialogOpen:o}=(0,ew.h)({message:n}),c=function(e){let{referenceIds:t,onClickAFPArticle:n}=e,{references:a}=(0,el.G)(),{getReferenceSourceDisplayName:s}=(0,e_.$)(),i=(0,h.useMemo)(()=>{var e;return null!=(e=null==a?void 0:a.reduce((e,t)=>(e[t.id]=t,e),{}))?e:{}},[a]);return(0,h.useMemo)(()=>t.map(e=>i[e.toString()]).map(e=>(function(e){var t,n,a,s;let{ragResult:i,onClickAFPArticle:r,getReferenceSourceDisplayName:l}=e;if(!i)return null;let o=i.title,c=(0,en.Ax)(i),d=null!=(n=l(i))?n:"",u=null!=(a=(0,en.vH)(i))?a:void 0;if(!o||!c)return null;let m="string"==typeof(null==(t=i.metadata)?void 0:t.thumbnail)?i.metadata.thumbnail:void 0;return{title:o,hostname:c,sourceDisplayName:d,href:u,date:null!=(s=i.date)?s:void 0,thumbnailUrl:m,onClick:e=>{i.source===en.Mv&&r(e,i)}}})({ragResult:e,onClickAFPArticle:n,getReferenceSourceDisplayName:s})).filter(e=>!!e),[t,i,n,s])}({referenceIds:t,onClickAFPArticle:l});return 0===c.length?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ej.z,{contentClassName:"pt-1 pb-4",scrollButtonsPosition:{top:(null==s?void 0:s.isLg)?124.5:94.5},children:c.map((e,t)=>(0,a.jsx)(ej.z.Item,{children:(0,a.jsx)(eA,{item:e})},t))}),(0,a.jsx)(eb.A,{article:r,isOpen:i,handleDialogOpenChange:o})]})}let eS=e=>{let{element:t}=e;return(0,et.YW)(t).with({type:"image"},e=>{let{attributes:{referenceId:t}}=e;return(0,a.jsx)(ev,{referenceId:t})}).with({type:"link-cards"},e=>{let{attributes:{referenceIds:t}}=e;return(0,a.jsx)(eE,{referenceIds:t.map(String)})}).with({type:"table-metadata"},()=>null).with({type:"tako-widget"},e=>{let{attributes:{referenceId:t}}=e;return(0,a.jsx)(eD,{referenceId:t})}).with({type:"image-gallery"},e=>{let{attributes:{referenceIds:t}}=e;return(0,a.jsx)(ey,{referenceIds:t})}).otherwise(()=>(0,a.jsx)(A.EAD,{className:"flex w-full items-center justify-center p-3",children:"Unknown element"}))},eD=e=>{let{referenceId:t}=e,{references:n}=(0,el.G)(),s=null==n?void 0:n.find(e=>e.id===t);if(!s||s.source!==en.ip)return null;let i=s.url;return i?(0,a.jsx)(er,{part:{type:"widget",source:i}}):null};n(60555);var eT=n(9464),eM=n(64027);let eR=e=>{let t=(0,h.useContext)(K.N),n=(0,p.c3)("Chat"),s=h.useRef(null),{track:r}=(0,B.n)(),l=(0,h.useMemo)(()=>(0,eT.g)(()=>{r(B.f.FOLLOWUP_HOVERED,{question:e.followup.question,question_length:e.followup.question.length,question_id:e.followup.id,chat_id:null==t?void 0:t.chatId,assistant_message_id:null==t?void 0:t.id,assistant_message_version:null==t?void 0:t.version})}),[r,e.followup.question,e.followup.id,null==t?void 0:t.chatId,null==t?void 0:t.id,null==t?void 0:t.version]),o=(()=>{let[e,t]=h.useState(!1);return(0,h.useEffect)(()=>{let e=()=>{let e=document.getSelection();e&&!e.isCollapsed?t(!0):t(!1)};return document.addEventListener("selectionchange",e),()=>{document.removeEventListener("selectionchange",e)}},[]),e})(),[c,d]=(0,eM.A)(()=>!1,[o]);return(0,a.jsxs)(A.AMh,{open:c,onOpenChange:d,children:[(0,a.jsx)(A.Wvm,{asChild:!0,children:(0,a.jsx)(i.P.span,{ref:s,"data-question":e.followup.question,className:(0,D.cn)("followup-block",o&&"followup-block-hidden","cursor-pointer outline-none","static inline","group-hover/message:[--hover-opacity:1]"),onMouseEnter:()=>{o||(d(!0),l())},onMouseLeave:()=>{d(!1)},onClick:()=>{var n;let a=document.getSelection();(!a||a.isCollapsed)&&(e.onSendFollowUp(e.followup.question,e.followup.id),r(B.f.FOLLOWUP_CLICKED,{question:e.followup.question,question_length:e.followup.question.length,question_id:e.followup.id,chat_id:null==t?void 0:t.chatId,assistant_message_id:null==t?void 0:t.id,assistant_message_version:null==t?void 0:t.version}),null==(n=s.current)||n.blur(),d(!1))},whileHover:{"--underline-opacity":.6,"--underline-height":"38%","--underline-saturation":1},whileTap:{"--underline-opacity":.6,"--underline-height":"38%","--underline-saturation":1},animate:{"--underline-opacity":.4,"--underline-height":"8%","--underline-saturation":1},initial:{"--underline-opacity":.2,"--underline-height":"0%","--underline-saturation":0},transition:{type:"spring",duration:.25},children:(0,a.jsx)(eP,{children:e.followup.snippet})})}),(0,a.jsxs)(A.hlN,{autoFocus:!1,onOpenAutoFocus:e=>{e.preventDefault()},onCloseAutoFocus:e=>{e.preventDefault()},className:"mt-1 flex w-auto max-w-96 flex-col gap-1 rounded-2xl border-brand-300 px-3 py-3 text-sm font-medium shadow-md",align:"start",children:[(0,a.jsxs)("p",{className:"m-0 text-subtle",children:[n("message.followup"),":"]}),(0,a.jsx)("p",{className:"m-0 text-sm",children:(0,a.jsx)(eP,{children:e.followup.question})})]})]})},eP=e=>(0,a.jsx)(R.oz,{components:h.useMemo(()=>({p:e=>(0,a.jsx)("span",{children:e.children})}),[]),remarkPlugins:(0,z.q)(),rehypePlugins:[],disallowedElements:["img","a","blockquote","h1","h2","h3","h4","h5","h6"],children:e.children});var eL=n(81494),eO=n(19303);function eV(e,t){return(0,h.isValidElement)(e)&&e.type===t}function ez(e,t){return h.Children.toArray(e).find(e=>eV(e,t))}function eF(e,t){return h.Children.toArray(e).filter(e=>eV(e,t))}function eH(e){var t;return(0,h.isValidElement)(e)&&(null==(t=e.props.node)?void 0:t.tagName)==="followup"&&e.props.followup?e.props.followup.snippet:null}function eU(e){let t=eH(e);if(t)return t;if(Array.isArray(e))return e.map(eU).join("");if((0,h.isValidElement)(e)){var n;return function(e){let{content:t,href:n}=e;return n?t?"[".concat(t,"](").concat(n,")"):n:t}({content:eU(e.props.children),href:(0,h.isValidElement)(e)&&(null==(n=e.props.node)?void 0:n.type)==="element"&&"a"===e.props.node.tagName&&e.props.href?e.props.href:null})}return"string"==typeof e||"number"==typeof e?String(e):""}var eq=n(43171),e$=n(71111),eB=n(32612),eG=n(72944),eK=n(37215);function eW(e){let{cellContext:t}=e,n=t.getValue();return(0,a.jsx)(eu.ac,{children:null==n?void 0:n.node})}var eZ=n(37711),eX=n(47982);function eY(e){let{headerContext:t,column:n}=e,s=t.column.getFirstSortDir(),i=t.column.getIsSorted();return(0,a.jsxs)(H.$n,{variant:"ghost-muted",size:"sm",className:"group/header h-full w-full rounded-none px-4 py-2 text-wrap whitespace-normal",onClick:t.column.getToggleSortingHandler(),children:[n.header,(0,a.jsx)(H.qF,{icon:"asc"===(i||s)?eZ.A:eX.A,className:(0,D.cn)("ms-1 shrink-0 opacity-0 group-hover/header:opacity-100",!1!==i&&"text-icon-default-subtle opacity-100")})]})}let eJ=(0,eG.FB)();function eQ(e){let t=e.getSortedRowModel().rows,n=e.getVisibleLeafColumns();return{headers:n.map(e=>{var t,n;return null!=(n=null==(t=e.columnDef.meta)?void 0:t.value)?n:""}),rows:t.map(e=>n.map(t=>e.getValue(t.id)))}}function e0(e){return e.replace(/"/g,'""')}var e1=n(44750);function e2(e){let{title:t,onCopyTable:n,onDownloadTable:s}=e,i=(0,p.c3)("Chat");return(0,a.jsxs)("div",{className:"flex items-stretch justify-between px-2 py-1",children:[(0,a.jsx)(eu.r6,{size:"default",className:"flex-1 px-1 py-1",children:t}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(H.$n,{variant:"ghost-muted",mode:"icon-only",size:"xs",icon:F.A,onClick:n,"aria-label":i("message.rich_table.copy_table"),children:(0,a.jsx)(H.GM,{children:i("message.rich_table.copy_table")})}),(0,a.jsx)(H.$n,{variant:"ghost-muted",mode:"icon-only",size:"xs",icon:e1.A,onClick:s,"aria-label":i("message.rich_table.download_table"),children:(0,a.jsx)(H.GM,{children:i("message.rich_table.download_table")})})]})]})}function e3(e){let{data:t,title:n}=e,{table:s}=function(e){let{data:t}=e,n=V(t.columns),s=O(t.columns.map(e=>(0,eK.c)(e,["header"]))),i=(0,h.useMemo)(()=>n.current.map((e,t)=>{var n,s;return eJ.accessor((n=t,e=>{let t=e.cells[n];return t||null}),{id:t.toString(),header:t=>(0,a.jsx)(eY,{headerContext:t,column:e}),cell:e=>(0,a.jsx)(eW,{cellContext:e}),sortDescFirst:!1,sortingFn:(s=t,(e,t)=>{var n,a;let i=null==(n=e.original.cells[s])?void 0:n.value,r=null==(a=t.original.cells[s])?void 0:a.value;return void 0===i&&void 0===r?0:void 0===i?-1:void 0===r?1:i.localeCompare(r)}),meta:{value:e.value}})}),[s]);return{table:(0,eq.N4)({columns:i,data:t.rows,getCoreRowModel:(0,eG.HT)(),getSortedRowModel:(0,eG.h5)()})}}({data:t}),{handleCopyTable:i,richTableHtml:r}=function(e){let{table:t}=e,n=(0,p.c3)("Chat"),{trackMessageEvent:a}=(0,B.n)(),s=(0,h.useContext)(K.N),{headers:i,rows:r}=eQ(t),l=function(e){let{headers:t,rows:n}=e,a=t.map(e=>"      <th>".concat(e,"</th>")).join("\n"),s=n.map(e=>{let t=e.map(e=>{var t;return"      <td>".concat(null!=(t=null==e?void 0:e.innerHtml)?t:"","</td>")}).join("\n");return"    <tr>\n".concat(t,"\n    </tr>")}).join("\n");return"<table>\n  <thead>\n    <tr>\n".concat(a,"\n    </tr>\n  </thead>\n  <tbody>\n").concat(s,"\n  </tbody>\n</table>")}({headers:i,rows:r}),o=function(e){let{headers:t,rows:n}=e,a=t.join(","),s=n.map(e=>e.map(e=>{var t;return null!=(t=null==e?void 0:e.value)?t:""}).join(",")).join("\n");return"".concat(a,"\n").concat(s)}({headers:i,rows:r});return{handleCopyTable:async()=>{let e={chat_id:null==s?void 0:s.chatId,message_id:null==s?void 0:s.id,message_version:null==s?void 0:s.version};try{let t=new ClipboardItem({"text/html":l,"text/plain":o});await (0,eB.J)(t),a(B.f.COPY_TABLE_SUCESS,e),A.oRP.info(n("message.rich_table.copy_table_toast"))}catch(t){console.error(t),a(B.f.COPY_TABLE_ERROR,{...e,error:t instanceof Error?t.message:"Unknown error"})}},richTableHtml:l,richTablePlainText:o}}({table:s}),{handleDownloadTable:l}=function(e){let{title:t,table:n}=e;return{handleDownloadTable:(0,h.useCallback)(()=>{let e=new Blob([function(e){let{headers:t,rows:n}=eQ(e),a=t.map(e=>'"'.concat(e0(e),'"')).join(","),s=n.map(e=>e.map(e=>{var t;return'"'.concat(e0(null!=(t=null==e?void 0:e.value)?t:""),'"')}).join(",")).join("\n");return"".concat(a,"\n").concat(s)}(n)],{type:"text/csv"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download=t?"".concat(t,".csv"):"table.csv",s.click()},[n,t])}}({table:s,title:n}),o=(0,h.useRef)(null),{tableBoxShadow:c}=function(e){let{scrollContainerRef:t}=e,[n,a]=(0,h.useState)(""),{resolvedTheme:s}=(0,X.D)(),i="dark"===s?"rgba(0, 0, 0, 0.25)":"rgba(0, 0, 0, 0.1)",r=(0,h.useCallback)(()=>{let e=t.current;if(e)a([function(e){let{element:t,color:n}=e,{scrollLeft:a}=t;if(a<=0)return"";let s=Math.min(15,a);return"inset ".concat(n," ").concat(s,"px 0 ").concat(15,"px ").concat(-15,"px")}({element:e,color:i}),function(e){let{element:t,color:n}=e,{scrollLeft:a,scrollWidth:s,clientWidth:i}=t,r=s-a-i;if(r<=0)return"";let l=Math.min(15,r);return"inset ".concat(n," -").concat(l,"px 0 ").concat(15,"px ").concat(-15,"px")}({element:e,color:i})].filter(Boolean).join(" , "))},[t,i]);return(0,h.useLayoutEffect)(()=>{r()},[r]),(0,h.useEffect)(()=>{let e=t.current;if(e)return e.addEventListener("scroll",r,!0),()=>{e.removeEventListener("scroll",r,!0)}},[t,r]),{tableBoxShadow:n}}({scrollContainerRef:o}),{headers:d,cells:u,numberOfColumns:m}=function(e){let t=(0,e$.q)(e.getHeaderGroups(),e=>e.headers),n=e.getRowModel().rows;return{headers:t,cells:(0,e$.q)(n,(e,t)=>e.getVisibleCells().map((e,a)=>({cell:e,isFirstCell:0===a,isLastRow:t===n.length-1}))),numberOfColumns:e.getAllLeafColumns().length}}(s),f="repeat(".concat(m,", minmax(").concat(150,"px, auto))");return(0,a.jsx)("div",{...(0,M.s)({richTableHtml:r,title:n}),className:"w-full pt-3",children:(0,a.jsxs)("div",{className:"min-w-full overflow-hidden rounded-card-md border border-default bg-card",children:[(0,a.jsx)("div",{className:(0,D.cn)("border-b border-default",M.bK),children:(0,a.jsx)(e2,{title:n,onCopyTable:i,onDownloadTable:l})}),(0,a.jsxs)("div",{ref:o,className:(0,D.cn)("grid overflow-x-auto",M.Wm),role:"table","aria-label":"Rich data table",style:{boxShadow:c,gridTemplateColumns:f},children:[d.map((e,t)=>(0,a.jsx)("div",{role:"columnheader",className:(0,D.cn)("min-w-0 border-b border-default bg-card p-0",t>0&&"border-l"),children:!e.isPlaceholder&&(0,eq.Kv)(e.column.columnDef.header,e.getContext())},e.id)),u.map(e=>{let{cell:t,isFirstCell:n,isLastRow:i}=e;return(0,a.jsx)("div",{role:"cell",className:(0,D.cn)("min-w-0 px-4",s.getRowModel().rows.length>8?"py-2":"py-3",!n&&"border-l border-default",!i&&"border-b border-default"),children:(0,eq.Kv)(t.column.columnDef.cell,t.getContext())},t.id)})]})]})})}function e4(e){var t,n;let{tableData:s}=function(e){let{nodeChildren:t}=e;return{tableData:(0,h.useMemo)(()=>{var e;return t?{columns:function(e){let t=ez(e,"thead"),n=ez(null==t?void 0:t.props.children,"tr");return eF(null==n?void 0:n.props.children,"th").map(e=>({value:eU(e.props.children),header:e.props.children}))}(e=t),rows:function(e){let t=ez(e,"tbody");return eF(null==t?void 0:t.props.children,"tr").map(e=>({cells:eF(e.props.children,"td").map(e=>({value:eU(e.props.children),node:e.props.children,innerHtml:function e(t){let n=eH(t);if(n)return"<span>".concat(n,"</span>");if(Array.isArray(t))return t.map(e).join("");if((0,h.isValidElement)(t)){var a,s;let n="string"==typeof t.type?t.type:null!=(s=null==(a=t.props.node)?void 0:a.tagName)?s:"span",i=function(e){let{children:t,...n}=e.props,a=Object.entries(n).filter(e=>{let[t,n]=e;return null!=n&&"function"!=typeof n&&"node"!==t&&"style"!==t&&"className"!==t}).map(e=>{let[t,n]=e;return"boolean"==typeof n?n?t:"":"".concat(t,'="').concat(String(n),'"')}).filter(Boolean).join(" ");return a?" ".concat(a):""}(t),r=e(t.props.children);return"<".concat(n).concat(i,">").concat(r,"</").concat(n,">")}return"string"==typeof t||"number"==typeof t?String(t):""}(e.props.children)}))}))}(e)}:null},[t])}}({nodeChildren:e.children});return s?(0,a.jsx)(e3,{data:s,title:null!=(n=null==(t=e.tableMetadata)?void 0:t.title)?n:""}):null}var e5=n(70852);let e6="data-message-part-type",e8=e=>{let{getTableMetadata:t,...n}=e,s=t((0,h.useId)());return(0,a.jsx)(e4,{...n,tableMetadata:s})},e9=[],e7=(0,h.memo)(e=>{let{disableInteractions:t,part:n,shouldFade:s,isUserMessage:i,className:r,styleOverride:l,type:o,tableMetadata:c=e9,onSendFollowUp:d,onLinkClick:u}=e,m=O(c),p=(0,L.DK)(d),f=V(s),g=(0,L.DK)(u),x=(0,h.useMemo)(()=>{let e=new Map,n=t=>{var n;return e.has(t)||e.set(t,e.size),null==(n=m[e.get(t)])?void 0:n.attributes},s=f.current;return{code:e=>(0,a.jsx)(ee,{...e,shouldFade:s,disableActions:t}),img:e=>(0,a.jsx)(ex.D,{...e,onLinkClick:g,shouldFade:s}),refs:eO.C,tool_references:e5.K,table:e=>(0,a.jsx)(e8,{...e,getTableMetadata:n}),followup:e=>p?(0,a.jsx)(eR,{followup:e.followup,onSendFollowUp:p}):e.followup.snippet,"custom-element":eS,a:e=>(0,a.jsx)(eL.A,{...e,onClick:g,shouldFade:s}),p:e=>(0,a.jsx)(W,{as:"p",shouldFade:s,className:"whitespace-break-spaces",children:e.children}),li:e=>(0,a.jsx)(W,{as:"li",shouldFade:s,children:e.children}),h1:e=>(0,a.jsx)(W,{as:"h1",shouldFade:s,children:e.children}),h2:e=>(0,a.jsx)(W,{as:"h2",shouldFade:s,children:e.children}),h3:e=>(0,a.jsx)(W,{as:"h3",shouldFade:s,children:e.children}),h4:e=>(0,a.jsx)(W,{as:"h4",shouldFade:s,children:e.children}),h5:e=>(0,a.jsx)(W,{as:"h5",shouldFade:s,children:e.children}),h6:e=>(0,a.jsx)(W,{as:"h6",shouldFade:s,children:e.children}),blockquote:e=>(0,a.jsx)(W,{as:"blockquote",shouldFade:s,children:e.children})}},[m,g,p,f,t]);return"hasOwn"in Object&&!i?(0,a.jsx)("div",{[e6]:o,className:(0,D.cn)(te,r),style:l,"data-testid":"text-message-part",children:(0,a.jsx)(R.oz,{components:x,remarkPlugins:(0,z.q)(),rehypePlugins:[[P.A,{errorColor:""}]],children:n.text})}):(0,a.jsx)("div",{[e6]:o,dir:"auto",className:(0,D.cn)(te,"whitespace-break-spaces"),"data-testid":"text-message-part",children:n.text})},(e,t)=>(0,g.H)(e,t)),te=(0,D.cn)("markdown-container-style max-w-none gap-1 overflow-x-visible py-0.5 pb-4 font-normal text-wrap break-words select-text");var tt=n(7977);let tn=(0,u.default)(()=>n.e(4972).then(n.bind(n,24972)),{loadableGenerated:{webpack:()=>[24972]},ssr:!1});function ta(e){let t=A.Bx2.useSidebar({required:!1}),[n,s]=(0,h.useState)(!1);return(0,a.jsxs)(A.cjw.Sheet,{onOpenChange:e=>{s(e),e&&(null==t||t.setOpen(!1))},open:n,children:[(0,a.jsx)(A.cjw.Trigger,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":"Toggle menu",variant:"ghost",className:(0,D.cn)("h-4 w-4 p-0",e.className),children:(0,a.jsx)(tt.A,{strokeWidth:2})})}),n&&(0,a.jsx)(tn,{chatId:e.chatId,messageTimestamp:e.messageTimestamp})]})}var ts=n(3819),ti=n(24999),tr=n(9360),tl=n(42708),to=n(61413),tc=n(16273),td=n(89595),tu=n(79373);function tm(e){let{disabled:t,message:n,className:s}=e,i=(0,p.c3)("Chat"),r=tr.P.use.setReferencesPanelMsgData(),{references:l}=(0,el.G)(),o=(0,h.useMemo)(()=>{var e;let t=null==(e=n.contentChunks)?void 0:e.filter(e=>"reference"===e.type).map(e=>e.referenceIds).flat();return(null==l?void 0:l.filter(e=>null==t?void 0:t.includes(parseInt(e.id))))||null},[l,n.contentChunks]),[c,d]=(0,h.useTransition)(),u=(0,L.DK)(()=>{d(()=>{r({id:n.id,version:n.version,contentChunks:n.contentChunks,references:l,chatId:n.chatId})})}),m=(0,h.useMemo)(()=>{let e=[];return null==o||o.some(t=>{let n=(0,en.Ax)(t);return n&&!e.includes(n)&&e.push(n),3===e.length}),e},[o]);return(0,a.jsxs)(H.$n,{isDisabled:t,size:"sm",variant:"secondary",className:(0,D.cn)("gap-2",s),onClick:u,"aria-busy":c,children:[i("message.sources_button_title"),(0,a.jsx)("div",{className:"relative ms-auto hidden items-center sm:flex",children:m.map((e,t)=>(0,a.jsx)(eI.A,{className:"".concat(t?"-ms-1":""," relative h-4 w-4"),height:18,width:18,hostname:e},e))})]})}var tp=n(27896);n(32901),n(98999);var th=n(64371),tf=n(30817),tg=n(34327),tx=n(6974);let tv=e=>{let{confirm:t}=(0,A.G_o)(),n=(0,p.c3)("General");return(0,L.DK)(s=>{let i=s.currentTarget.href;(0,tg.q)(i,tx._.NEXT_PUBLIC_WHITELISTED_IMAGE_DOMAINS)||(s.preventDefault(),t({title:n("external_link.title"),description:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"block py-2",children:n("external_link.description")}),(0,a.jsx)("span",{className:"block py-2 font-semibold break-all text-default",children:i})]}),confirm:{onClick:()=>{null==e||e(i),window.open(i,"_blank")}}}))})};var ty=n(88049),tj=n(35739),tb=n(1204),tw=n(68990);let t_=RegExp(/ *\\\[(.*?[^\\]) *\\\]/,"gs"),tC=/(```[\s\S]*?```|`.*?`)/g,tN=RegExp("\\\\\\(.*?\\\\\\)|\\\\\\[([\\s\\S]*?)\\\\\\]|\\$.*?\\$|\\\\begin\\{equation\\}[\\s\\S]*?\\\\end\\{equation\\}","s"),tI=RegExp(/\\\((.+?)\\\)/,"g"),tk=RegExp(/^\s*\n.*\n\s*$/,"s");function tA(e,t){return e.replace(/<<CODE_BLOCK_(\d+)>>/g,(e,n)=>{var a;return null!=(a=t[Number(n)])?a:""})}let tE=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=e,s=[],i=0;a=a.replace(tC,e=>(s[i]=e,"<<CODE_BLOCK_".concat(i++,">>")));try{t=a.replace(RegExp("(?<!\\$)(\\$(?!\\$))","gm"),"\\$")}catch(e){t=a}for(let e of a.matchAll(/(\W|^)\$([^$]+)\$($|\W)/gm))try{let n=e[2];n&&(tw.Ay.renderToString(n),t=t.replace("\\$".concat(e[2],"\\$"),"$".concat(e[2],"$")))}catch(e){continue}return tN.test(t)?tA(t=t.replace(tI,(e,t)=>"$".concat(t,"$")).replace(t_,(e,t)=>tk.test(t)?"".concat(n,"$$").concat(t,"$$"):"".concat(n,"$$\n").concat(t,"\n$$")),s):tA(t,s)};var tS=n(39343);let tD=(e,t)=>{var n,a;let s=e.at(-1);return"text"===t.type&&s&&"text"===s.type&&(null==(n=s._context)?void 0:n.contextId)===(null==(a=t._context)?void 0:a.contextId)?[...e.slice(0,-1),((e,t)=>{var n,a;let s=e._context?{...e._context,...(null==(n=t._context)?void 0:n.endTime)!==void 0&&{endTime:t._context.endTime},...(null==(a=t._context)?void 0:a.isLast)!==void 0&&{isLast:t._context.isLast}}:void 0;return{type:"text",text:e.text+t.text,_context:s}})(s,t)]:(e.push(t),e)};function tT(e){return e.reduce(tD,[])}var tM=n(76531);let tR=e=>{let t=[{regex:/```([\s\S]*?)```/g,replacementPrefix:"__BLOCK_CODE_BLOCK_",codeBlocks:[]},{regex:/^ {4}([\s\S]*?)(?=\n|$)/g,replacementPrefix:"__INDENTED_CODE_BLOCK_",codeBlocks:[]},{regex:/(^|[\r\n]+)\s{0,3}```([\s\S]*)/g,replacementPrefix:"__BLOCK_CODE_BLOCK_OPEN_",codeBlocks:[]},{regex:/`([^`\n\r]+)`/g,replacementPrefix:"__INLINE_CODE_BLOCK_",codeBlocks:[]}],n=e;return t.forEach(e=>{n=n.replace(e.regex,t=>(e.codeBlocks.push(t),"".concat(e.replacementPrefix).concat(e.codeBlocks.length-1,"__")))}),n=n.replace(/(^|[^\\:]):(?=[a-zA-Z])(?!ref|tool_references|:|\s)/gm,(e,t)=>t+"\\:"),t.some(e=>e.codeBlocks.length)&&t.forEach(e=>{let t=RegExp("".concat(e.replacementPrefix,"(\\d+)__"),"gm");n=n.replace(t,(t,n)=>e.codeBlocks[n])}),n};function tP(e){return{type:"custom_element",display:"inline",element:{type:"image",attributes:{referenceId:e}}}}function tL(e,t){var n;if(e)return null!=(n=null==t?void 0:t[e])?n:null==t?void 0:t.en}var tO=n(56046);let tV=[],tz=e=>{let{contentChunks:t,messageFiles:n,messageFollowups:a=tV,locale:s}=e,i=(e=>{let{contentChunks:t,messageFiles:n,locale:a}=e,s=[];n&&n.length>0&&s.push({type:"files",files:n});let i=[];return(function(e){let t=[],n=null;return tT(e.reduce((a,s,i)=>{let r=e=>{a.push({...e,text:tR(e.text)})},l=e=>{let t=a.at(-1);(null==t?void 0:t.type)==="text"&&"inline"===e.display?a.splice(a.length-1,1,{...t,text:"".concat(t.text).concat((0,tM.s)(e.element))}):a.push(e)},o=()=>{t.length>0&&n&&(r(n),n=null);let e=t.at(0);if(1===t.length&&e)l(tP(e)),t.length=0;else if(t.length>1){let e=a.at(-1);(null==e?void 0:e.type)==="text"?a.splice(a.length-1,1,{...e,text:"".concat(e.text).concat((0,tM.s)({type:"image-gallery",attributes:{referenceIds:t}}))}):t.forEach(e=>{l(tP(e))}),t.length=0}};if("custom_element"===s.type&&"image"===s.element.type)return t.push(s.element.attributes.referenceId),i===e.length-1&&o(),a;if("text"===s.type&&0===s.text.trim().length&&t.length>0)return n=s,i===e.length-1&&o(),a;switch(o(),s.type){case"text":r(s);break;case"image_url":{let e="object"==typeof s.imageUrl&&"url"in s.imageUrl?s.imageUrl.url:s.imageUrl;a.push({type:"text",text:"\n ![image](".concat(e,") \n")});break}case"custom_element":l(s);break;case"reference":{let e=a.at(-1);if((null==e?void 0:e.type)==="text"){let e=a.pop();if("text"===e.type){let t="";if(s.referenceIds?t+=(0,tS.kD)({contentChunkIndex:i,referenceIds:s.referenceIds}):void 0!==s.id&&(t=(0,tS.kD)({contentChunkIndex:i,referenceIds:[s.id]})),!e.text.endsWith(" ")){let n=e.text.split(" ").slice(-1)[0];n&&/(http|https):\/\/.*/.exec(n)&&(t=" "+t)}a.push({...e,text:"".concat(e.text).concat(t)})}else a.push(e),a.push(s)}else a.push(s);break}case"tool_reference":{var c;if((null==(c=e[i-1])?void 0:c.type)==="tool_reference")break;let t=(0,ty.F)(e,(0,tj.g)(i),(0,tb.v)(e=>"tool_reference"===e.type));a.push({_context:s._context,type:"text",text:(0,tS.GR)(t)});break}case"widget":a.push({type:"widget",source:s.source});break;case"file_reference":a.push({type:"text",text:"[".concat(s.fileAlt,"](").concat(s.fileUrl,")")});break;default:a.push(s)}return a},[]))})(t).forEach(e=>{var t,n,r,l,o,c,d;if("custom_element"===e.type&&"image"===e.element.type)i.push(e.element);else{let e=i.at(0);e&&1===i.length?s.push({type:"custom_element",display:"inline",element:e}):i.length>1&&s.push({type:"custom_element",display:"inline",element:{type:"image-gallery",attributes:{referenceIds:i.map(e=>e.attributes.referenceId)}}}),i.length=0}if("custom_element"===e.type)return void s.push({type:"custom_element",display:e.display,element:e.element});if("canva"===e.type){if((null==(n=s.at(-1))?void 0:n.type)==="text"){let e=s.pop(),t=/```(\w+)?$/;t.exec(e.text.trimEnd())&&(e.text=e.text.trimEnd().replace(t,"")),s.push(e)}s.push({type:"canva",canvaId:e.id,canvaVersion:e.version})}else if("task"===e.type&&"deep_research"===e.taskType)s.push({type:"deep_research_task",taskId:e.taskId,researchEngine:e.researchEngine});else if((null==(t=e._context)?void 0:t.type)==="deep_research_report"){let t=s.at(-1);(null==t?void 0:t.type)==="deep_research_report"?t.contentChunks=[...t.contentChunks,e]:s.push({type:"deep_research_report",contentChunks:[e],taskId:e._context.taskId})}else if("text"===e.type){let t=(0,ty.F)(e.text,tE,tR);if((null==(r=s.at(-1))?void 0:r.type)==="canva"&&(t=t.trimStart().replace(/^```(\w+)?/g,"")),(null==(l=e._context)?void 0:l.type)==="reasoning"){let t={id:e._context.contextId,isDone:null!=(d=e._context.isLast)&&d,content:(0,ty.F)(e.text,tE,tR),type:"reasoning",name:"reasoning",startTime:e._context.startTime,endTime:e._context.endTime};if((null==(c=s.at(-1))?void 0:c.type)==="working_step"){let e=s.pop();e.steps.push(t),s.push(e);return}s.push({type:"working_step",steps:[t]})}else{if((null==(o=e._context)?void 0:o.type)==="deep_research_plan")return s.push({type:"deep_research_plan",researchPlanSteps:e.text.split("\n"),requested:"requested"===e._context.status,taskId:e._context.taskId});s.push({type:"text",text:t})}}else if("tool_call"===e.type)if(e.requiresConfirmation){let t=s.at(-1);(null==t?void 0:t.type)==="tool_call_confirmation_step"&&t.toolCalls.every(t=>t.requiresConfirmation===e.requiresConfirmation&&t.confirmationStatus===e.confirmationStatus&&t.isDone===e.isDone)?t.toolCalls.push(e):s.push({type:"tool_call_confirmation_step",toolCalls:[e]})}else((e,t)=>{let n=e.at(-1);if((null==n?void 0:n.type)==="working_step")return n.steps.push(...t.steps);e.push(t)})(s,((e,t)=>{var n,a,s;return{type:"working_step",steps:[{id:e.id,type:"toolCall",toolCall:e,isDone:e.isDone,name:e.name,turn:e.turn,isInterrupted:e.isInterrupted,startTime:e.startTime,endTime:e.endTime,icon:e.icon,success:e.success,workingDescription:tL(t,null==(n=e.customLocale)?void 0:n.working_description),doneDescription:tL(t,null==(a=e.customLocale)?void 0:a.done_description),content:null!=(s=e.publicArguments)?s:void 0}]}})(e,a));else"widget"===e.type&&s.push({type:"widget",source:e.source})}),s})({contentChunks:t,messageFiles:n,locale:s});return(0,tO.t4)(a,i)};var tF=n(4639),tH=n(22731),tU=n(35850),tq=n(72645);function t$(e){let{action:t,title:n,description:s}=e;return(0,a.jsxs)("span",{className:"flex w-full items-center justify-start gap-2",children:[t?t.icon&&(0,a.jsx)(t.icon,{}):(0,a.jsx)(tq.A,{}),(0,a.jsxs)("span",{className:"flex flex-col justify-center",children:[(0,a.jsx)("span",{className:"text-sm",children:n}),(0,a.jsx)("span",{className:"text-xs font-normal text-muted dark:text-muted",children:s})]})]})}let tB=e=>{let{part:t}=e,n=(0,p.c3)("Chat"),s=t.actionId?(0,tU.Th)(t.actionId):void 0,i=n.raw("canvas.actions.".concat(s?s.id:"default",".title")),r=n.raw("canvas.actions.".concat(s?s.id:"default",".description"));return(0,a.jsx)("div",{className:"flex w-full flex-col items-start justify-start",children:(0,a.jsx)(t$,{action:s,title:i,description:r})})},tG=(0,u.default)(()=>Promise.all([n.e(1280),n.e(1406),n.e(3465),n.e(2999),n.e(7303)]).then(n.bind(n,17303)),{loadableGenerated:{webpack:()=>[17303]},loading:()=>(0,a.jsx)(A.$nd,{variant:"secondary",className:"my-2 flex h-fit w-full flex-col items-center justify-start overflow-hidden rounded-lg border border-default bg-default p-0 px-5 py-4 text-muted transition-colors duration-200 hover:border-default hover:bg-muted",children:(0,a.jsx)(A.EAD,{className:"h-5 w-full"})}),ssr:!1}),tK=e=>{let{part:t,messageCanvas:n,canvas:s,isGenerating:i,featureFlags:r,isFirstChunk:l,isLastChunk:o,role:c}=e,d=null==n?void 0:n.find(e=>t.canvaId===e.id&&t.canvaVersion===e.version);return d?(0,a.jsx)(tG,{canva:{...d,content:tE(d.content,"\n")},canvas:null!=s?s:null,isGenerating:i,className:(0,D.cn)("my-2",l&&c===v.gg.ASSISTANT&&"mt-0",o&&"mb-0"),featureFlags:r}):null},tW=e=>{let{element:t}=e;return(0,a.jsx)(eS,{element:t})};var tZ=n(87452),tX=n(95515),tY=n(6779),tJ=n(18599),tQ=n(94052);let t0=e=>{try{var t;let n=JSON.parse(null!=(t=e.publicArguments)?t:"");switch(e.name){case"web_search":n.query?e.publicArguments=n.query:n.url?(e.publicArguments=n.url,e.name="open_url"):n.keys&&(e.publicArguments=null,e.name="open_search_results");break;case"code_interpreter":e.publicArguments=n.code}}catch(e){}return e},t1=["in_progress","queued"],t2=e=>!!e&&t1.includes(e);var t3=n(22374),t4=n(78611),t5=n(44233),t6=n(21956),t8=n(38256);function t9(e){let{hostnames:t,maxIcons:n=5,iconsGap:s=10,isAnimating:r=!1,className:l}=e;return(0,a.jsx)("div",{className:(0,D.cn)("flex h-6 w-full min-w-16 flex-1 items-center justify-end overflow-x-hidden",l),children:(0,a.jsx)("div",{className:"relative flex h-full w-full items-center justify-end",children:t.map((e,l)=>{let o=t.length,c=(o-l-1)*s,d=o-l-1<n;return(0,a.jsx)(i.P.div,{initial:{right:r?(o-l-2)*s:c,opacity:r?0:+!!d},animate:{right:c,opacity:+!!d},exit:{right:c,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"absolute flex h-5 w-5 items-center justify-center",children:(0,a.jsx)(eI.A,{className:"".concat(l?"-ms-1":""," relative h-5 w-5 bg-card"),height:18,width:18,hostname:e},e)},l)})})})}let t7=(0,u.default)(()=>n.e(4987).then(n.bind(n,54987)),{loadableGenerated:{webpack:()=>[54987]},ssr:!1});function ne(e){let{taskId:t,children:n}=e,[s,i]=(0,h.useState)(!1),r=eh.api.research.debug.useQuery({taskId:t},{enabled:s});return(0,a.jsxs)(A.cjw.Sheet,{open:s,onOpenChange:i,children:[(0,a.jsx)(A.cjw.Trigger,{asChild:!0,children:n}),(0,a.jsx)(A.cjw.Content,{className:"w-full overflow-y-auto sm:w-[840px]",children:(0,a.jsxs)("div",{className:"h-full",children:[r.isLoading||!r.data&&(0,a.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,a.jsx)(A.y$y,{})}),s&&r.data&&(0,a.jsx)(t7,{sectionDescription:"This is the entire debug data for the research `".concat(t,"`"),debugData:[{body:r.data}],exportActions:[{name:"Export",disabled:!1,handler:()=>{let e=document.createElement("a");e.href=URL.createObjectURL(new Blob([JSON.stringify(r.data,null,2)],{type:"application/json"})),e.download="deep-research-".concat(t,".json"),e.click(),URL.revokeObjectURL(e.href)}}]})]})})]})}var nt=n(58196),nn=n(95067),na=n(69111),ns=n(63309),ni=n(31715);let nr=["web_search","code_interpreter","generate_image","edit_image","news_search","open_url","open_search_results","library_search","open_library_result","library_fetch","deep_research_summarize"],nl=["web_search","black_forest","memories","code_interpreter","document_library","sharepoint","google_drive","gmail","google_calendar"],no=e=>{if("string"==typeof e&&e)try{return JSON.parse(e)}catch(t){return{value:e}}return{}},nc=(0,l.A)(0,0,0,1);function nd(e){let{children:t,easingFunction:n=nc,duration:s=.5,offset:r=10,className:l,ref:o}=e;return(0,a.jsx)(i.P.div,{ref:o,variants:{initial:{opacity:0,y:r},animate:{opacity:1,y:0,transition:{duration:s,ease:n}},exit:{opacity:0,y:-r}},initial:"initial",animate:"animate",exit:"exit",className:l,children:t})}let nu=(0,l.A)(.22,.8,.3,1),nm={W:{o:!0}};function np(e){let{children:t,easingFunction:n=nu,delay:s=.005,duration:l=.4,className:o,pulseText:c,splitOn:d="char",start:u,end:m,...p}=e,h=0!==u.y||0!==m.y;return(0,a.jsx)("div",{className:(0,D.cn)("overflow-y-hidden",h?"flex":"inline-block",o),...p,children:(0,a.jsx)(r.N,{mode:"wait",children:t.split("char"===d?"":" ").map((e,r)=>{var p;let f=t[r+1],g=h&&"char"===d&&f&&(null==(p=nm[e])?void 0:p[f]),x=.2+.05*r;return(0,a.jsx)(i.P.span,{initial:{...u},animate:{y:0,opacity:1,...c?{animation:"pulse cubic-bezier(0.5, 0, 0.5, 1) infinite",animationDuration:"2s",animationDelay:"".concat(x,"s")}:{},transition:{delay:r*(void 0!==u.delay?u.delay:s),duration:void 0!==u.duration?u.duration:l,ease:n}},exit:{y:m.y,opacity:m.opacity,transition:{delay:r*(void 0!==m.delay?m.delay:s),duration:void 0!==m.duration?m.duration:l,ease:n}},custom:r,className:(0,D.cn)(o,g?"me-[-1px]":"","word"===d?"me-[4px]":""),children:" "===e?"\xa0":e},"".concat(t,"-letter-").concat(e,"-at-").concat(r))})})})}function nh(e){let{isDone:t,type:n,publicArguments:s,publicResult:i}=e,r=(0,p.c3)("Chat");return(0,a.jsxs)("div",{className:"mt-4 w-full text-default",children:[null!==s&&(0,a.jsx)(ee,{className:"language-python",disableInline:!0,children:s}),t&&i&&"code"===n&&(0,a.jsxs)("div",{className:"flex flex-col border-t border-default pt-3",children:[(0,a.jsx)("span",{className:"px-3 text-sm font-medium text-white-default",children:r("tool.summary.output")}),(0,a.jsx)(ee,{className:"language-text",disableInline:!0,children:"".concat(Array.isArray(i)?i.map(e=>"text"===e.type?e.text:"").join("\n"):"")})]})]})}var nf=n(83407),ng=n(65007),nx=n(57073),nv=n(67849),ny=n(17710),nj=n(3905),nb=n(94558),nw=n(77303),n_=n(83320),nC=n(73251);let nN={generate_image:nf.A,edit_image:nf.A,web_search:ng.A,code_interpreter:nx.A,news_search:nv.A,open_url:ny.A,open_search_results:ny.A,library_search:nj.A,open_library_result:nb.A,library_fetch:nw.A,deep_research_summarize:n_.A,default:nC.A};function nI(e){let{name:t,icon:n,className:s}=e,i=nN[nr.includes(t)?t:"default"];return(0,a.jsx)("div",{className:(0,D.cn)("flex size-4 items-center justify-center",s),children:n?(0,a.jsx)("img",{loading:"lazy",src:n}):(0,a.jsx)(i,{})})}var nk=n(17210);function nA(e){let t=e.map(e=>e.startTime).filter(e=>void 0!==e).sort((e,t)=>e-t)[0],n=e.map(e=>e.endTime).filter(e=>void 0!==e).sort((e,t)=>t-e)[0];return void 0!==t&&void 0!==n&&n>t?{timeMs:n-t,formatted:(0,nk.fU)(Math.max(1e3,1e3*Math.round((n-t)/1e3)))}:null}var nE=n(73485),nS=n(21655),nD=n(10315),nT=n(32987);let nM=e=>{let{children:t,hotkey:n,onTrigger:s,onHotkey:i,onClick:r,hotkeyClassName:l,...o}=e;return(0,nT.E)(null!=n?n:"",e=>{e.preventDefault(),e.stopPropagation(),null==i||i(e),null==s||s()},{isDisabled:!n}),(0,a.jsxs)(H.$n,{variant:"secondary",className:"border-none",...o,onClick:e=>{null==r||r(e),null==s||s()},children:[t,n?nL({hotkey:n,className:l}):null]})},nR={shift:"",meta:nD.Ue?"":"",alt:nD.Ue?"":void 0,ctrl:nD.Ue?"":void 0,backspace:"",delete:"",up:"",down:"",left:"",right:""},nP={enter:"Enter",meta:nD.Ue?void 0:"",alt:nD.Ue?void 0:"Alt",ctrl:nD.Ue?void 0:"Ctrl",escape:"Esc",tab:"Tab",space:"Space"},nL=e=>{let{hotkey:t,className:n}=e;return t.split(",").map(e=>(0,a.jsx)(nO,{className:n,children:e.split("+").map(e=>{var t,n;return(0,a.jsx)("span",{children:null!=(n=null!=(t=nR[e])?t:nP[e])?n:e},e)})},e))},nO=e=>{let{children:t,className:n}=e;return(0,a.jsx)("kbd",{className:(0,D.cn)("ms-1 hidden items-center gap-1 rounded border p-1 py-0.5 font-sans text-xs text-subtle md:flex",n),children:t})};var nV=n(35015);function nz(e){let{textToCopy:t}=e,n=(0,p.c3)("Chat.message"),s=async()=>{await (0,nV.e)(t).then(()=>{A.oRP.info(n("table_code_button_toast"))})};return(0,a.jsx)(H.$n,{"aria-label":n("copy_button_title"),variant:"ghost",className:"flex h-auto gap-1.5 px-1 py-2 text-xs text-inverted-muted hover:bg-none! hover:text-inverted-subtle dark:text-subtle dark:hover:text-muted",onClick:s,children:(0,a.jsx)(F.A,{size:16,color:"var(--text-subtle)"})})}let nF=e=>{let{size:t=24}=e;return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 30 30",fill:"none",children:[(0,a.jsx)("path",{d:"M13.7698 18.54H11.3108V21.0001H13.7698V18.54Z",fill:"#44B8A7"}),(0,a.jsx)("path",{d:"M16.2291 16.0803H13.77V18.5404H16.2291V16.0803Z",fill:"#44B8A7"}),(0,a.jsx)("path",{d:"M23.6062 8.7002H21.1471V11.16H18.6881V13.6201H16.229V16.0801H18.6881V13.6201H21.1471V11.16H23.6062V8.7002Z",fill:"#44B8A7"}),(0,a.jsx)("path",{d:"M11.3106 16.0803H8.85156V18.5404H11.3106V16.0803Z",fill:"#44B8A7"}),(0,a.jsx)("path",{d:"M8.85163 13.6196H6.39258V16.0797H8.85163V13.6196Z",fill:"#44B8A7"})]})},nH=e=>{let{color:t="var(--color-basic-red-strong)",size:n=16}=e;return(0,a.jsxs)("svg",{width:n,height:n,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M28.8001 19.1992H19.1997V28.7996H28.8001V19.1992Z",fill:t}),(0,a.jsx)("path",{d:"M19.2 28.7988H9.59961V38.3992H19.2V28.7988Z",fill:t}),(0,a.jsx)("path",{d:"M9.59938 38.3994H-0.000976562V47.9998H9.59938V38.3994Z",fill:t}),(0,a.jsx)("path",{d:"M38.4006 9.59863H28.8003V19.199H38.4006V9.59863Z",fill:t}),(0,a.jsx)("path",{d:"M48.0012 -0.000976562H38.4009V9.59938H48.0012V-0.000976562Z",fill:t}),(0,a.jsx)("path",{d:"M19.2 9.59863H9.59961V19.199H19.2V9.59863Z",fill:t}),(0,a.jsx)("path",{d:"M9.59938 -0.000976562H-0.000976562V9.59938H9.59938V-0.000976562Z",fill:t}),(0,a.jsx)("path",{d:"M48.0012 38.3994H38.4009V47.9998H48.0012V38.3994Z",fill:t}),(0,a.jsx)("path",{d:"M38.4006 28.7988H28.8003V38.3992H38.4006V28.7988Z",fill:t})]})},nU=()=>{},nq=()=>{};function n$(e){let{toolCalls:t,onAlwaysAllow:n,onDecline:s=nU,onAllow:i=nq,isGenerating:r=!1,className:l}=e,o=t.some(e=>"pending"===e.confirmationStatus),[c,d]=h.useState(o),u=(0,p.c3)("Chat");return(0,a.jsxs)(A.ZpM,{className:(0,D.cn)("relative overflow-hidden rounded-xl border-none border-[var(--bg-state-soft)] bg-state-soft",l),children:[(0,a.jsx)("div",{className:"flex flex-col p-1",children:t.map((e,t)=>(0,a.jsx)(nB,{toolCall:e,isOpen:c},t))}),o&&(0,a.jsxs)("div",{className:"flex justify-end gap-4 px-4 py-3",children:[!!n&&(0,a.jsx)(H.$n,{isDisabled:r,variant:"ghost",className:"hidden text-subtle md:block",onClick:()=>{n(),d(!1)},children:u("messages.confirmation.alwaysAllow")}),(0,a.jsx)(nM,{isDisabled:r,variant:"soft",hotkey:"meta+D",onTrigger:()=>{s(),d(!1)},children:u("messages.confirmation.decline")}),(0,a.jsx)(nM,{isDisabled:r,variant:"soft",hotkey:"meta+Enter",onTrigger:()=>{i(),d(!1)},children:u("messages.confirmation.continue")})]})]})}let nB=e=>{var t,n,s;let{toolCall:i,isOpen:r}=e,l=no(i.publicArguments),o=(e=>{if("string"==typeof e)return no(e);if(Array.isArray(e)){let t=e=>"text"===e.type?no(e.text):{};return 1===e.length?t(e[0]):e.map(t)}return{}})(i.publicResult),c=!!Object.keys(l).length,[d,u]=(0,eM.A)(r&&c,[r,c]),m=i.isDone?i.success&&"denied"!==i.confirmationStatus?"success":"error":"pending"===i.confirmationStatus?"pending":"loading",h=(0,p.c3)("Chat");return(0,a.jsxs)("div",{className:"overflow-hidden bg-default py-2.5 not-first:border-t-2 first:rounded-tl-lg first:rounded-tr-lg last:rounded-br-lg last:rounded-bl-lg",children:[(0,a.jsxs)("div",{className:"flex cursor-pointer items-center justify-between px-5",onClick:()=>u(e=>!e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-md",children:i.icon?(0,a.jsx)(A.Ybv,{name:null==(t=i.integration)?void 0:t.name,size:16,src:i.icon}):(0,a.jsx)(A.HHk,{className:"size-4"})}),(0,a.jsx)("span",{className:"font-medium",children:null!=(s=null==(n=i.integration)?void 0:n.name)?s:h("tool.default.name")}),(0,a.jsx)(H.$n,{variant:"ghost",className:"text-informative",children:(e=>{var t;return(0,na.Sn)(e.name.toLowerCase().replace((null==(t=e.integration)?void 0:t.name.toLowerCase())+"_",""))})(i)})]}),(0,a.jsx)("div",{className:"text-zinc-400 flex items-center gap-3",children:"loading"===m?(0,a.jsx)(tp.y,{indicatorColor:"var(--text-placeholder)",indicatorClassName:"size-4 border-2"}):"success"===m?(0,a.jsx)(nF,{}):"error"===m?(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{children:(0,a.jsx)(nH,{})}),"denied"===i.confirmationStatus?(0,a.jsx)(S.ZI,{children:(0,a.jsx)("span",{className:"text-subtle",children:h("messages.confirmation.declined")})}):null]}):null})]}),(0,a.jsx)(nG,{isOpen:d,className:"flex flex-col gap-4",children:(0,a.jsxs)(A.FKN,{className:"flex max-h-100 flex-col px-5",children:[(0,a.jsx)(nW,{title:c?h("messages.confirmation.arguments"):(0,a.jsx)("span",{className:"font-normal text-subtle",children:h("messages.confirmation.empty_arguments")}),json:l,keyClassName:"text-green",className:"py-4"}),!!Object.keys(o).length&&(0,a.jsx)(nW,{title:h("messages.confirmation.response"),json:o,keyClassName:"text-basic-purple-accent"})]})})]})},nG=e=>{let{children:t,isOpen:n,className:s}=e;return(0,a.jsx)(r.N,{children:n&&(0,a.jsx)(i.P.div,{initial:{height:0,opacity:0},animate:{opacity:1,height:"auto"},exit:{height:0,opacity:0},transition:{duration:.3,ease:(0,l.A)(0,0,0,1)},className:(0,D.cn)(s),children:t},"arguments")})},nK=e=>{let{className:t,jsonToCopy:n}=e;return(0,a.jsx)("div",{className:(0,D.cn)("flex items-center gap-2 text-subtle",t),children:!!n&&(0,a.jsx)(nz,{textToCopy:JSON.stringify(n)})})},nW=e=>{let{json:t,title:n,keyClassName:s,className:i,maxEntries:r=100}=e,l=Object.entries(t),o=l.slice(0,r).concat(l.length>r?[["...","Response truncated"]]:[]);return(0,a.jsxs)("div",{className:(0,D.cn)("group/table gap relative flex w-full flex-col",i),children:[(0,a.jsx)("div",{className:"flex w-full items-center justify-between py-1",children:(0,a.jsx)(eu.o5,{className:"font-medium",children:n})}),(0,a.jsx)("div",{className:"absolute top-0 right-0 opacity-0 transition-opacity group-hover/table:opacity-100",children:(0,a.jsx)(nK,{jsonToCopy:t})}),(0,a.jsx)("div",{className:"grid grid-cols-[auto_minmax(0,1fr)] gap-0 font-mono text-sm *:py-1.5 *:even:ps-4 *:nth-[n+3]:border-t",children:o.map(e=>{let[t,n]=e;return(0,a.jsx)(nZ,{keyClassName:s,property:t,value:JSON.stringify(n,null,2),initialIsExpanded:l.length<=3},t)})})]})},nZ=e=>{let{property:t,value:n,keyClassName:s,initialIsExpanded:i=!1}=e,[r,l]=(0,eM.A)(i,[i]),o=(0,p.c3)("Chat"),c=h.useRef(null),{width:d}=(0,L.wY)({ref:c}),u=h.useMemo(()=>{let e=(0,na.q_)(n);return void 0!==d&&e>d},[n,d]);return(0,a.jsxs)(a.Fragment,{children:[!!t&&(0,a.jsx)("div",{className:"flex items-start",children:(0,a.jsx)("span",{className:(0,D.cn)("text-subtle",s),children:t})}),(0,a.jsxs)("div",{className:(0,D.cn)("group/item flex items-center gap-2 overflow-hidden",{"items-start":r}),ref:c,children:[(0,a.jsx)("span",{className:(0,D.cn)("h-5 shrink overflow-hidden text-nowrap text-ellipsis text-subtle transition-[height] interpolate-size-allow-keywords",{"h-auto text-wrap":r}),children:r?(0,a.jsx)("pre",{className:"whitespace-pre-wrap",children:n}):n}),u&&(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{variant:"ghost",className:(0,D.cn)("m-0 h-7 shrink-0 text-subtle group-hover/item:w-auto group-hover/item:px-3",{"w-0 px-0":!r}),"aria-label":o("messages.confirmation.click_to_expand_tooltip"),onClick:e=>{l(e=>!e),e.stopPropagation()},children:r?(0,a.jsx)(nE.A,{size:16}):(0,a.jsx)(nS.A,{size:16})})}),(0,a.jsx)(S.ZI,{children:(0,a.jsx)("span",{className:"text-subtle",children:o("messages.confirmation.click_to_expand_tooltip")})})]})]})]})};var nX=n(79497);function nY(e){let{steps:t,showWebsearchResults:n}=e,s=(0,h.useMemo)(()=>t.every(e=>e.isDone),[t]),l=(0,a.jsx)(nJ,{ragToolCallsPublicResult:t.filter(e=>"toolCall"===e.type).filter(e=>"rag"===e.toolCall.toolType).map(e=>e.toolCall.publicResult)}),o=t.filter(e=>"toolCall"===e.type).filter(e=>"code"===e.toolCall.toolType).map(e=>(0,a.jsx)(nQ,{codeToolCallPublicResult:e.toolCall.publicResult},e.id)),c=(0,a.jsxs)(i.P.div,{initial:{opacity:0},animate:{opacity:1},children:[n&&l,o.length>0&&o]});return(0,a.jsx)(r.N,{children:s&&c})}function nJ(e){let{ragToolCallsPublicResult:t}=e,[n,s]=(0,h.useState)([]),i=t.reduce((e,t)=>((null==t?void 0:t.images)&&e.push(...t.images.filter(e=>!n.includes(e))),e),[]);return t.length&&i.length?(0,a.jsx)("div",{className:"overflow-x-auto py-2",children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:i.map((e,t)=>(0,a.jsx)("div",{className:"relative h-48 w-48 shrink-0 rounded-lg",children:(0,a.jsx)(nX.default,{src:e,fill:!0,alt:"image from the web",className:"rounded-lg object-cover",loader:e=>{let{src:t}=e;return t},onError:()=>s(t=>[...t,e])})},t))})}):null}let nQ=e=>{let{codeToolCallPublicResult:t}=e;if(Array.isArray(t)){let e=t.filter(e=>"file_url"===e.type).filter(e=>e.fileName.startsWith("__emitted_"));if(e.length)return e.map((e,t)=>(0,a.jsx)(ex.D,{src:e.fileUrl},t))}return null},n0="h-full w-[1px] rounded-full bg-basic-gray-alpha-10";var n1=n(5439),n2=n(80822);let n3={duration:.25,ease:(0,l.A)(0,0,0,1)},n4={initial:{height:0,opacity:0},animate:{height:"100%",opacity:1,transition:{...n3,duration:.5}},exit:{height:0,opacity:0,transition:n3}},n5={initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1,transition:n3},exit:{opacity:0,scale:.75,y:-10,transition:n3}},n6={initial:{opacity:0},animate:{opacity:1,transition:n3},exit:{opacity:0,transition:n3}},n8=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:(0,D.cn)("flex flex-row items-center justify-between gap-6 pt-[3px]"),children:t})},n9=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:"flex items-center gap-2.5",children:t})},n7=e=>{let{icon:t,isLoading:n}=e;return(0,a.jsx)(r.N,{mode:"wait",children:(0,a.jsx)(i.P.div,{initial:"initial",animate:"animate",exit:"exit",variants:n?n6:n5,className:"pointer-events-none flex h-6 w-5 items-center justify-center bg-inherit text-icon-default-muted",children:(0,a.jsx)("div",{className:"flex size-5 items-center justify-center",children:n?(0,a.jsx)(tp.y,{indicatorColor:"var(--text-placeholder)",indicatorClassName:"size-4 border-2"}):t||(0,a.jsx)(o.A,{strokeWidth:6,className:"size-5 text-icon-default-muted"})})},n?"loader":"icon")})},ae=e=>{let{header:t,parameter:n}=e;return(0,a.jsxs)(n8,{children:[(0,a.jsx)(n9,{children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)(n2.P,{text:t,className:(0,D.cn)("text-md font-medium text-subtle",n&&"flex-shrink-0 whitespace-nowrap")})})}),n&&(0,a.jsx)(aa,{parameters:n})]})},at=e=>{let{children:t,icon:n,className:s,containerClassName:r,hideLinkingLine:l,isLoading:o=!1}=e;return(0,a.jsxs)(nd,{className:(0,D.cn)("text-medium flex font-light text-muted",s),children:[(0,a.jsxs)("div",{className:"mt-[4px] flex w-5 flex-col items-center gap-1",children:[(0,a.jsx)(n7,{icon:n,isLoading:o}),!l&&(0,a.jsx)("div",{className:"flex h-full flex-col",children:(0,a.jsx)(i.P.div,{className:n0,variants:n4,initial:"initial",animate:"animate",exit:"exit"})})]}),(0,a.jsx)("div",{className:(0,D.cn)("flex w-full flex-col ps-4 pb-4",r),children:t})]})},an=e=>{let{children:t,icon:n,isLoading:s=!1,header:i,parameter:r,hideLinkingLine:l=!1,className:o,containerClassName:c}=e;return(0,a.jsxs)(at,{icon:n,isLoading:s,hideLinkingLine:l,className:o,containerClassName:c,children:[(i||r)&&(0,a.jsx)(ae,{header:null!=i?i:"",parameter:null!=r?r:void 0}),t]})},aa=e=>{let{parameters:t}=e,n=(e=>{let t=(0,ni.$)(e,ns.Ay.object({query:ns.Ay.string()}));return'"'.concat(t.success?t.data.query:e,'"')})(t),[s,i]=(0,n1.useIsTruncated)(n);return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{className:"max-w-full overflow-hidden",children:(0,a.jsx)(nd,{ref:s,className:"text-medium max-w-full truncate overflow-hidden font-light wrap-break-word text-muted",children:n})}),i&&(0,a.jsx)(S.ZI,{children:n})]})},as=e=>{let{showSubscribe:t,useWorkingLabel:n}=e,a=(0,p.c3)("Chat");return{getStepStatusHeader:(0,h.useCallback)(e=>e?"header_only"===e.type?e.header:"reasoning"===e.type?!e.isDone||n?a("tool.summary.loading_thinking"):void 0:function(e){let{t,name:n,isDone:a,doneDescription:s,workingDescription:i,isInterrupted:r,showSubscribe:l,isSuccess:o}=e;if(a&&s)return s;if(i)return i;if(nr.includes(n))return r&&l?t("tool.".concat(n,".interrupted")):a?t(!1===o?"tool.".concat(n,".failed"):"tool.".concat(n,".done")):t("tool.".concat(n,".loading"));return r&&l?t("tool.default.interrupted"):a?t(!1===o?"tool.default.failed":"tool.default.done"):t("tool.default.loading")}({name:e.name,isDone:!n&&e.isDone,isSuccess:e.success,doneDescription:e.doneDescription,workingDescription:e.workingDescription,isInterrupted:e.isInterrupted,showSubscribe:t,t:a}):a("tool.default.loading"),[t,a,n])}},ai=e=>{let{step:t,externalLinkOpener:n}=e;switch(t.type){case"toolCall":if("code"===t.toolCall.toolType&&(t.toolCall.publicResult||t.content))return(0,a.jsx)(nh,{type:t.toolCall.toolType,isDone:t.isDone,publicArguments:t.content,publicResult:t.toolCall.publicResult});return null;case"reasoning":var s;return(0,a.jsx)(e7,{type:"reasoning",styleOverride:{"--tw-prose-headings":"var(--text-subtle)","--tw-prose-body":"var(--text-muted)","--tw-prose-bold":"var(--text-muted)","--tw-prose-lead":"var(--text-muted)","--tw-prose-links":"var(--text-muted)","--tw-prose-counters":"var(--text-muted)","--tw-prose-bullets":"var(--text-muted)","--tw-prose-hr":"var(--text-muted)","--tw-prose-quotes":"var(--text-muted)","--tw-prose-quote-borders":"var(--text-muted)","--tw-prose-captions":"var(--text-muted)","--tw-prose-kbd":"var(--text-muted)","--tw-prose-kbd-shadows":"var(--text-muted)","--tw-prose-code":"var(--text-muted)","--tw-prose-pre-code":"var(--text-muted)","--tw-prose-pre-bg":"var(--text-muted)","--tw-prose-th-borders":"var(--text-muted)","--tw-prose-td-borders":"var(--text-muted)"},isUserMessage:!1,shouldFade:!t.isDone,part:{type:"text",text:null!=(s=t.content)?s:""},onLinkClick:n});default:return null}};function ar(e){var t,n;let{step:s,showSubscribe:r=!1,isFirst:l=!1,isLast:o=!1,className:c,forceDone:d}=e,{name:u,content:m,isDone:p,icon:h}=s,f=eh.api.chat.confirmExternalLink.useMutation(),g=tv(e=>{f.mutate({url:e})}),{getStepStatusHeader:x}=as({showSubscribe:r}),v="header_only"===s.type?s.header:x(s),y="toolCall"===s.type&&"code"===s.toolCall.toolType?null==m?void 0:m.split("\n").find(e=>""!==e.trim()):m,j="toolCall"===s.type&&"code"===s.toolCall.toolType&&(!!s.toolCall.publicResult||!!s.content)||"reasoning"===s.type,b=!p&&!d;return"toolCall"===s.type&&(null==(t=s.toolCall.integration)?void 0:t.name)&&(n=s.toolCall.integration.name,!nl.includes(n))?(0,a.jsxs)(nd,{className:(0,D.cn)("text-medium relative flex font-light text-muted",c),children:[(0,a.jsxs)("div",{className:(0,D.cn)("flex w-5 flex-col items-center gap-1",{"mt-0.5":l}),children:[(0,a.jsx)("div",{className:"flex h-4 shrink-0 flex-col",children:(0,a.jsx)(i.P.div,{className:(0,D.cn)(n0,"h-full"),variants:{initial:{height:0,opacity:0},animate:{height:"100%",opacity:1,transition:{...n3,duration:.5}},exit:{height:0,opacity:0,transition:n3}},initial:"initial",animate:"animate",exit:"exit"})}),(0,a.jsx)(n7,{icon:!1,isLoading:b}),!o&&(0,a.jsx)("div",{className:"flex h-full flex-col",children:(0,a.jsx)(i.P.div,{className:(0,D.cn)(n0,"h-full"),variants:{initial:{height:0,opacity:0},animate:{height:"100%",opacity:1,transition:{...n3,duration:.5}},exit:{height:0,opacity:0,transition:n3}},initial:"initial",animate:"animate",exit:"exit"})})]}),(0,a.jsx)("div",{className:(0,D.cn)("flex w-full flex-col ps-4 pb-4",j&&o?"pb-0":""),children:(0,a.jsx)(n$,{toolCalls:[s.toolCall]})})]}):(0,a.jsx)(an,{icon:"toolCall"===s.type&&(0,a.jsx)(nI,{name:u,icon:h}),className:c,containerClassName:(0,D.cn)(j&&o?"pb-0":""),header:v,parameter:"toolCall"===s.type?y:void 0,isLoading:b,hideLinkingLine:o,children:j?(0,a.jsx)(ai,{step:{...s,isDone:null!=d?d:s.isDone},externalLinkOpener:g}):null})}let al=e=>{let{steps:t,isDone:n,detailOpen:s,isFirstMessagePart:l,overrideHeader:c}=e,d=((e,t)=>{let[n,a]=(0,h.useState)(0),s=(0,h.useRef)(void 0),i=(0,h.useRef)(void 0);return(0,h.useEffect)(()=>{if(t){if(n<e.length-1){let e=i.current&&Date.now()-i.current;if(e&&e>t){i.current=Date.now(),a(e=>e+1);return}s.current=setTimeout(()=>{i.current=Date.now(),a(e=>e+1)},t-(null!=e?e:0))}return()=>{s.current&&clearTimeout(s.current)}}},[n,e,t]),n})(t,n?null:1200),u=(0,p.c3)("Chat"),{getStepStatusHeader:m}=as({showSubscribe:!1,useWorkingLabel:!0}),f=t.some(e=>"reasoning"===e.type),g=(0,h.useMemo)(()=>{var e,a,i,r,l;return c?c:n?f?u("tool.summary.done_thinking",{count:t.length,duration:null!=(i=null==(a=nA(t))?void 0:a.formatted)?i:""}):u("tool.summary.done",{count:t.length,duration:null!=(r=null==(e=nA(t))?void 0:e.formatted)?r:""}):s?f?u("tool.summary.loading_thinking"):u("tool.summary.loading"):null!=(l=m(t[d]))?l:""},[d,s,m,f,n,c,t,u]),x=t[d],[v,y]=(0,h.useState)(null),j=(0,h.useRef)(null),b=(0,L.DK)(()=>{var e;if((null==x?void 0:x.type)!=="reasoning"||!x.content){v&&y(null);return}let t=x.content.split(/\n|\.(?=\s|$)/).filter(e=>e.length>10).at(-2);if(!t){v&&y(null);return}let n=t.split(" ").filter(e=>"$"!==e).reduce((e,t,n)=>e.length+t.length>170?e:0===n?t:"".concat(e," ").concat(t),"").replaceAll("*","").replaceAll(" $ "," ").replaceAll(/\$(?!\d)/g,"").replace(/^\s*[,;-]+/,"").trim();if(n===v)return;let a={fontSize:"16px",fontWeight:"400"},s=(0,na.q_)(n,a),i=null==(e=j.current)?void 0:e.getBoundingClientRect().width,r=i?i-40:void 0;if(!r||s<=r)return void y(n);y((0,na.EJ)({text:n,maxWidth:r,stylesProp:a,preserveWords:!0}).concat("..."))});return(0,h.useEffect)(()=>{if(n)return;if((null==x?void 0:x.type)!=="reasoning")return void y(null);let e=setInterval(b,2200);return()=>clearInterval(e)},[null==x?void 0:x.type,b,n]),(0,a.jsxs)("div",{className:"flex h-auto w-full items-start gap-3 self-start text-hint",children:[(0,a.jsxs)("div",{className:"flex w-7 shrink-0 flex-col items-center pt-1.5",children:[l?(0,a.jsx)("div",{className:"h-5"}):(0,a.jsx)(o.A,{strokeWidth:8,className:(0,D.cn)("size-5 text-icon-default-muted opacity-0 transition-opacity",s&&"opacity-100")}),s&&(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)(i.P.div,{className:n0,variants:{initial:{height:0,opacity:0},animate:{opacity:1,height:"8px",transition:{duration:.5}},exit:{height:0,opacity:0}},initial:"initial",animate:"animate",exit:"exit"})})]}),(0,a.jsxs)("div",{className:"flex w-full grow-0 items-center gap-3 overflow-hidden py-0.5",children:[(0,a.jsx)(np,{pulseText:!n,start:{y:20,opacity:.8},end:{y:-30,opacity:.7},splitOn:"char",className:"shrink-0",children:g}),(0,a.jsx)("div",{className:"flex flex-grow overflow-hidden",ref:j,children:(null==x?void 0:x.type)==="reasoning"&&!n&&v&&!s&&(0,a.jsx)(np,{start:{y:0,opacity:0},end:{y:0,opacity:0,delay:0,duration:.4},splitOn:"char",delay:.008,duration:.07,className:"text-hint opacity-70",children:v})}),(0,a.jsx)("div",{className:"shrink-0",children:(0,a.jsx)(r.N,{initial:!1,children:(!s||!n)&&(0,a.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"ms-1 flex h-6 items-center justify-end overflow-x-auto",children:(0,a.jsx)("div",{className:"flex h-full items-center justify-end gap-2 overflow-hidden",children:(0,a.jsx)(r.N,{initial:!n,children:t.reduce((e,t)=>t.icon?[...e,t]:e.some(e=>e.name===t.name)?e:[...e,t],[]).map((e,t)=>"reasoning"===e.type?null:(0,a.jsx)(i.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},transition:{duration:.3,ease:"easeInOut",delay:.1*t},children:(0,a.jsx)(nI,{name:e.name,icon:e.icon,className:(0,D.cn)((e.isInterrupted||!1===e.success)&&"text-(--red-300) dark:text-(--red-200) dark:opacity-50")})},e.id))})})})})})]})]})},ao=e=>{let{steps:t,showSubscribe:n,isGenerating:s,isLastMessagePart:o,isFirstMessagePart:c,isLastMessage:d,nonCollapsible:u,overrideHeader:f}=e,g=(0,p.c3)("Chat"),x=(0,p.c3)("Billing"),v=t.every(e=>e.isDone)&&!o&&d||!s||!d||!o,y=(0,m.useRouter)(),[j,b]=(0,L.Mj)("defaultWorkingStepOpened",!1),[w,_]=(0,h.useState)(j&&!!s),{track:C}=(0,B.n)(),{workingStepPartRef:N}=((e,t,n)=>{let a=(0,h.useRef)(null),s=(0,h.useRef)(!0),{stopScroll:i}=(0,nn.B)();return(0,h.useEffect)(()=>{let e;if(n)return;let t=new IntersectionObserver(e=>{let[t]=e;s.current=null==t?void 0:t.isIntersecting},{root:null,rootMargin:"0px",threshold:.1});return a.current&&(e=a.current,t.observe(a.current)),()=>{e&&t.unobserve(e)}},[n]),(0,h.useEffect)(()=>{!n&&e&&(s.current||(i(),setTimeout(()=>{var e;null==(e=a.current)||e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)),setTimeout(()=>t(),1500))},[e]),{workingStepPartRef:a}})(v,()=>_(!1),u),I=t.find(e=>"toolCall"===e.type&&e.isInterrupted&&e.isDone),k=I?nr.includes(I.name)?g("tool.".concat(I.name,".interrupted")):g("tool.default.interrupted",{type:"toolCall"===I.type?I.toolCall.toolType:"raw"}):null;return(0,a.jsxs)("div",{className:(0,D.cn)("mt-4 mb-1 transition-all","-ms-10",o&&"mb-0",c?"mt-0":""),ref:N,children:[u?null:(0,a.jsx)(A.$nd,{variant:"ghost",onClick:()=>{b(!w),_(!w)},className:"w-full px-0 py-0 text-base text-hint hover:bg-transparent disabled:text-hint disabled:opacity-100 dark:hover:text-hint",children:(0,a.jsx)(al,{detailOpen:w,isDone:v,isFirstMessagePart:c,steps:t,overrideHeader:f})}),(0,a.jsx)(r.N,{children:(w||u)&&(0,a.jsx)(i.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.65,ease:(0,l.A)(.11,.86,0,1)},className:"w-full overflow-hidden ps-1",children:(0,a.jsxs)("div",{className:"flex w-full flex-col pb-6",children:[t.map((e,n)=>{let i=n===t.length-1;return(0,a.jsx)(ar,{className:"me-5",step:e,isFirst:0===n,isLast:i&&!f,forceDone:!!f||"reasoning"===e.type&&(!i||!s||!o)},e.id)}),f&&(0,a.jsx)(ar,{className:"me-5",step:{header:f,type:"header_only",name:"reasoning-done-dummy-toolcal",isDone:!1,id:"reasoning-done-dummy-toolcal",content:f},isFirst:!1,isLast:!0},"reasoning-done-step-id")]})},"tool-calls")}),k&&n&&(0,a.jsx)(A.lZ$,{buttonVariant:"default",buttonAction:()=>{C(B.f.UPGRADE_CTA_CLICKED,{source:"tool_call_rate_limit_reached",tool_name:null==I?void 0:I.name}),y.push("/upgrade")},buttonTooltip:x("upgrade.title"),buttonText:x("upgrade.ctas.upgrade"),description:g("usage_limit.quota_reached"),title:k,buttonIcon:(0,a.jsx)(nt.A,{className:"h-4 w-4 shrink-0"}),buttonClassName:"py-1.5 h-auto",animated:s})]})},ac=e=>{let{part:t,session:n,isGenerating:s,isLastMessagePart:i,isFirstMessagePart:r,isLastMessage:l,nonCollapsible:o,overrideHeader:c}=e,d=!(n&&(e=>!!e&&e.isLeChatPro)(n))&&!!t.isLastMessage,u=null==n?void 0:n.organization.featureFlags.webimages;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ao,{showSubscribe:d,steps:t.steps,isGenerating:s,isLastMessagePart:i,isFirstMessagePart:r,isLastMessage:l,nonCollapsible:o,overrideHeader:c}),(0,a.jsx)(nY,{steps:t.steps,showWebsearchResults:u})]})},ad=e=>{let{messageParts:t,session:n,shouldFade:s}=e,i=eh.api.chat.confirmExternalLink.useMutation(),r=tv(e=>{i.mutate({url:e})});return t.map((e,i)=>{switch(e.type){case"text":return(0,a.jsx)(e7,{type:"answer",part:e,isUserMessage:!1,shouldFade:s,className:"prose-h2:font-medium prose-h2:text-basic-orange-accent prose-h3:font-medium prose-h3:text-basic-orange-accent prose-hr:hidden [&>blockquote:first-of-type]:rounded-xl [&>blockquote:first-of-type]:border-none [&>blockquote:first-of-type]:bg-muted [&>blockquote:first-of-type]:p-6",onLinkClick:r},i);case"working_step":return(0,a.jsx)("div",{className:"ps-10",children:(0,a.jsx)(ac,{nonCollapsible:!0,part:e,isLastMessage:!0,isLastMessagePart:i===t.length-1,isFirstMessagePart:0===i,session:n})},i);default:return null}})};function au(e){var t,n,s,o,c,d,u,m,g,x,v,y,j,w,_;let{part:C}=e,N=(0,t8.w)(),I=(0,h.useContext)(K.N),k=eh.api.useUtils(),E=eh.api.research.getResearchTask.useQuery({taskId:C.taskId,message:I?{chatId:I.chatId,id:I.id,version:I.version}:void 0}),S=eh.api.research.cancel.useMutation({onSuccess:()=>{k.research.getResearchTask.setData({taskId:C.taskId},e=>e?{...e,status:"canceled"}:e),k.research.getResearchTask.invalidate({taskId:C.taskId})}});(0,h.useEffect)(()=>{var e;let t=null==(e=E.data)?void 0:e.updatedAssistantMessage;if(!t||!I)return;let n=k.message.all.getData({chatId:I.chatId});(null==n?void 0:n.items.some(e=>{var n;return e.id===t.id&&e.version===t.version&&e.chatId===t.chatId&&!(null==(n=e.contentChunks)?void 0:n.some(e=>{var t;return(null==(t=e._context)?void 0:t.type)==="deep_research_report"}))}))&&(0,to.Cq)(k)({chatId:I.chatId,messageId:I.id,messageVersion:I.version})({contentChunks:t.contentChunks})},[I,null==(t=E.data)?void 0:t.updatedAssistantMessage,k,k.message.all]);let{scrollRef:T,contentRef:M,scrollToBottom:R,stopScroll:P}=(0,tQ.q)({damping:.05,stiffness:.1,mass:1}),{deepResearchStage:O,setDeepResearchStage:V,addChunkToStep:z,resetStep:F,streamedStepsChunks:U,numberCompletedSteps:q,setStepToDone:$,addNewStep:B,resetSteps:G}=(e=>{let{onFirstContent:t}=e,[n,a]=(0,h.useState)([]),s=(0,h.useRef)(!1),[i,r]=(0,h.useState)({stage:"pending"});return{deepResearchStage:i,setDeepResearchStage:r,resetSteps:()=>{a([]),s.current=!1},addChunkToStep:(e,n)=>{a(a=>(s.current||(t(),s.current=!0),a.map(t=>t.stepId===e?{...t,contentChunks:(e=>{let{newChunk:t,existingChunks:n,withToolCallDelta:a}=e;switch(t.type){case"text":return tT(n.concat(t));case"tool_call":if(n.some(e=>"tool_call"===e.type&&e.id===t.id))return n.map(e=>{if("tool_call"===e.type&&e.id===t.id){var n,s,i,r;let l=a?(e=>{let{baseChunk:t,newChunk:n}=e;return n.isDone||!n.publicArguments?t.publicArguments:(t.publicArguments||"")+n.publicArguments})({baseChunk:e,newChunk:t}):null!=(n=t.publicArguments)?n:e.publicArguments;return{...e,isDone:t.isDone,isInterrupted:t.isInterrupted,success:t.success,endTime:t.endTime,publicArguments:l,publicResult:null!=(s=t.publicResult)?s:e.publicResult,confirmationStatus:null!=(i=t.confirmationStatus)?i:e.confirmationStatus,requiresConfirmation:null!=(r=t.requiresConfirmation)?r:e.requiresConfirmation}}return e});return n.concat(t);default:return n.concat(t)}})({newChunk:n,existingChunks:t.contentChunks}),chunkCount:t.chunkCount+1}:t)))},resetStep:e=>{a(t=>t.filter(t=>t.stepId!==e))},setStepToDone:e=>{a(t=>t.map(t=>t.stepId===e?{...t,isDone:!0}:t))},addNewStep:e=>{a(t=>[...t,{stepId:e,contentChunks:[],isDone:!1,chunkCount:0}])},streamedStepsChunks:n,numberCompletedSteps:n.filter(e=>e.isDone).length}})({onFirstContent:()=>{R()}}),W=null==(n=E.data)?void 0:n.plan.length,Z=(null==(s=E.data)?void 0:s.status)==="completed"||q===W||void 0===W?1:q/W,[X,Y]=(0,h.useState)({}),J=(0,h.useMemo)(()=>{var e;return(null==(e=E.data)?void 0:e.status)==="completed"?{count:E.data.referenceCount,hostnames:E.data.referenceHostnames}:{count:(0,tJ.H)(X).length,hostnames:(0,f.A)((0,tJ.H)(X).map(t4.zd).filter(Boolean))}},[null==(o=E.data)?void 0:o.referenceCount,null==(c=E.data)?void 0:c.referenceHostnames,null==(d=E.data)?void 0:d.status,X]),Q=(0,L.DK)(e=>{if("deep_research_event"===e.type){let t=e.value;switch(t.eventType){case"research_task_started":G(),V({stage:"pending"});return;case"research_step_started":B(t.stepId),V({stage:"research",stepId:t.stepId});return;case"research_step_completed":{$(t.stepId);let e=(0,t5.j4)({stepId:t.stepId,isDone:!0});z(t.stepId,e);return}case"research_report_started":er(!1),V({stage:"report",stepId:t.stepId});return;case"research_report_completed":return void V({stage:"done"});case"research_step_error":return void F(t.stepId);default:return}}let t=(0,t3.Ik)(e);t&&"tool_reference"===t.type&&t.url&&Y(e=>({...e,[t.url]:!0})),"report"===O.stage&&t&&I&&(0,to.Cq)(k)({chatId:I.chatId,messageId:I.id,messageVersion:I.version})(e=>{var n,a;return{...e,contentChunks:null!=(a=null==(n=e.contentChunks)?void 0:n.concat({...t,_context:{type:"deep_research_report",contextId:O.stepId,taskId:C.taskId}}))?a:null}}),V(e=>{if("research"===e.stage&&t&&"tool_call"===t.type&&t.isDone){let n=t0(t);z(e.stepId,n)}else if("research"===e.stage&&t&&t._context&&"reasoning"===t._context.type)z(e.stepId,t);else if("research"===e.stage&&t&&!t._context&&"text"===t.type){let t=(0,t5.j4)({stepId:e.stepId});z(e.stepId,t)}return e})}),ee=eh.api.research.getResearchStream.useSubscription({taskId:C.taskId},{enabled:E.isSuccess&&t2(E.data.status),onData:e=>{for(let t of(0,t3.xl)(e))Q(t)},onComplete:()=>k.research.getResearchTask.invalidate({taskId:C.taskId})}),et=(0,h.useMemo)(()=>{var e,t;if(E.isLoading)return[];return((null==(e=E.data)?void 0:e.status)==="completed"?E.data.steps?E.data.steps.flatMap(e=>e.findings).filter(e=>void 0!==e):[]:void 0!==ee.data?U.flatMap(e=>e.contentChunks):(null==(t=E.data)?void 0:t.steps)?E.data.steps.flatMap(e=>e.findings).filter(e=>void 0!==e):[]).map(e=>"tool_call"!==e.type?e:t0(e))},[null==(u=E.data)?void 0:u.status,null==(m=E.data)?void 0:m.steps,E.isLoading,U,ee.data]),en=(0,h.useMemo)(()=>tz({contentChunks:et}),[et]),{confirm:ea}=(0,A.G_o)(),es=(0,p.c3)("Chat"),[ei,er]=(0,h.useState)(!0);if(E.isLoading)return(0,a.jsxs)("div",{className:"my-6 flex flex-col gap-4 rounded-lg border border-default bg-default p-6 shadow-card",children:[(0,a.jsx)(A.EAD,{className:"h-4 w-1/2"}),(0,a.jsx)(A.EAD,{className:"h-4 w-1/3"}),(0,a.jsx)(A.EAD,{className:"h-4 w-9/12"})]});let el=b(null!=(y=null==N?void 0:N.session)?y:null);return E.isError||(null==(g=E.data)?void 0:g.status)==="error"?el&&(null==(j=E.data)?void 0:j.status)==="error"?(0,a.jsx)("div",{className:"my-6 flex flex-col rounded-lg border border-default bg-default p-6 shadow-card",children:(0,a.jsxs)(eu.r6,{className:"flex items-center gap-2 text-basic-red-strong",children:[(0,a.jsx)(tZ.A,{className:"size-4"}),es.rich("deep_research.research_message_part.error_description",{taskId:null!=(w=E.data.id)?w:"",task:e=>(0,a.jsx)("pre",{className:"text-xs",children:e})})]})}):(0,a.jsx)(t6.F,{state:"warning",className:"my-6 p-4 shadow-card",children:(0,a.jsx)(eu.r6,{className:"flex items-center gap-2",children:es("deep_research.research_message_part.unexepected_error")})}):(null==(x=E.data)?void 0:x.status)==="canceled"?(0,a.jsx)(t6.F,{className:"my-6 p-4 shadow-card",children:(0,a.jsx)(eu.r6,{className:"flex items-center gap-2",children:es("deep_research.research_message_part.canceled")})}):(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"my-6 flex flex-col rounded-lg border border-default bg-default p-6 shadow-card",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:(0,D.cn)("group/steps-header cursor-pointer rounded-md bg-default"),onClick:()=>{P(),er(e=>!e)},children:[(0,a.jsxs)("div",{className:"mb-4 flex items-end justify-between",children:[(0,a.jsx)(eu.r6,{weight:"medium",className:"text-subtle group-hover/steps-header:text-default",children:(null==(v=E.data)?void 0:v.status)==="completed"?es("deep_research.research_message_part.label_completed"):es.rich("deep_research.research_message_part.label_researching",{muted:e=>(0,a.jsx)("span",{className:"text-hint",children:e})})}),J.count>0&&(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[J.hostnames.length>0&&(0,a.jsx)(t9,{hostnames:J.hostnames}),(0,a.jsx)(eu.r6,{weight:"medium",size:"sm",className:"flex items-center gap-1 text-sm text-subtle group-hover/steps-header:text-default",children:es.rich("deep_research.research_message_part.sources",{count_widget:()=>(0,a.jsx)(A.qWl,{animateInitialValue:!1,decimalPrecision:0,value:J.count,fontSize:"14px",color:"var(--text-default)"})})})]})]}),(0,a.jsx)(A._gp,{value:Z,className:(0,D.cn)("mb-1")})]}),(0,a.jsx)(r.N,{children:ei&&(0,a.jsxs)(i.P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:(0,l.A)(.15,0,0,1),className:"overflow-auto",children:[(0,a.jsx)("div",{className:"sticky top-0 h-5 w-full bg-linear-to-b from-default to-transparent"}),(0,a.jsx)(A.FKN,{viewportRef:T,className:"h-[420px]",children:(0,a.jsx)("div",{ref:M,children:(0,a.jsx)(ad,{messageParts:en,session:null!=(_=null==N?void 0:N.session)?_:null,shouldFade:"done"!==O.stage})})})]})})]}),(0,a.jsx)("div",{className:"pt-4",children:(el||E.data&&t2(E.data.status))&&(0,a.jsxs)(i.P.div,{className:"flex items-center gap-3",exit:{opacity:0,height:0},initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.2},children:[el&&(0,a.jsx)(ne,{taskId:C.taskId,children:(0,a.jsx)(H.$n,{variant:"soft",size:"2xs",mode:"icon-only",icon:tZ.A})}),(0,a.jsx)("div",{className:"grow"}),"flash"===C.researchEngine?(0,a.jsx)(A.Hxo,{className:"size-4 text-(--yellow-500)"}):(0,a.jsx)(tX.A,{className:"size-4 text-hint"}),(0,a.jsx)(eu.o5,{weight:"medium",size:"sm",children:es("deep_research.research_message_part.eta",{minutesCount:"flash"===C.researchEngine?5:15})}),(0,a.jsxs)(H.$n,{variant:"dashed",size:"sm",onClick:()=>ea({title:es("deep_research.research_message_part.cancel_research_confirmation_title"),description:es("deep_research.research_message_part.cancel_research_confirmation_description"),confirm:{onClick(){S.mutate({taskId:C.taskId})}}}),isLoading:S.isPending,children:[(0,a.jsx)(H.qF,{icon:tY.A}),es("deep_research.research_message_part.cancel_research")]})]})})]})})}function am(e){var t,n,s;let{part:r}=e,[l,o]=(0,h.useState)(null),c=eh.api.research.downloadResearchReport.useMutation({onSuccess(e){o(e.signed_url),window.open(e.signed_url,"_blank")}}),d=(0,th.Ym)(),u=eh.api.research.getResearchTask.useQuery({taskId:r.taskId}),m=(0,p.c3)("Chat"),f=(0,t8.w)(),g=tz({contentChunks:r.contentChunks.map(e=>{let{_context:t,...n}=e;return n})});return(0,a.jsxs)(i.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.2},className:"rounded-lg border border-default bg-default px-8 pb-6",children:[(0,a.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between bg-default py-6",children:[(0,a.jsx)(eu.o5,{variant:"subtle",size:"sm",children:null==(t=u.data)?void 0:t.updatedAt.toLocaleDateString(d,{year:"numeric",month:"long",day:"numeric"})}),(0,a.jsx)(H.$n,{variant:"ghost",size:"sm",isLoading:c.isPending,isDisabled:(null==(n=u.data)?void 0:n.status)!=="completed",onClick:()=>{if(l)return window.open(l,"_blank");c.mutate({taskId:r.taskId})},children:m(l?"deep_research.research_message_part.report.download_pdf":"deep_research.research_message_part.report.save_as_pdf")})]}),(0,a.jsx)(ad,{messageParts:g,session:null!=(s=null==f?void 0:f.session)?s:null,shouldFade:!1})]})}var ap=n(5610);let ah=e=>{let{part:t}=e;return(0,a.jsx)(ap.r,{messageFiles:t.files})};function af(e){let{quote:t}=e;return(0,a.jsxs)("div",{className:"relative flex w-full flex-col rounded-2 px-4",children:[(0,a.jsx)("div",{className:"bg-border-subtle absolute start-[2px] top-[2px] bottom-[2px] w-1 rounded-full"}),(0,a.jsx)("div",{className:"no-prose line-clamp-3 text-muted",children:(0,a.jsx)(R.oz,{children:t.content})})]})}function ag(e){let{part:t}=e;return(0,a.jsx)("div",{className:"flex w-full flex-wrap",children:(0,a.jsx)(af,{quote:t.quote})})}var ax=n(13166),av=n(82248),ay=n(1883),aj=n(68273);ns.Ay.array(ns.Ay.string()).min(1).max(25).refine(e=>1e4>=e.reduce((e,t)=>e+t.length,0));var ab=n(83403);function aw(e){var t;let{part:n,message:s,isGenerating:i,isLastMessage:r,isReadOnly:l=!1}=e,o=eh.api.useUtils(),c=(0,p.c3)("Chat"),d=n.researchPlanSteps.map(e=>e.trim()).filter(Boolean).join("\n"),u=(0,h.useMemo)(()=>ay.Ik({plan:ay.Yj()}).superRefine((e,t)=>{e.plan||t.addIssue({code:aj.eq.custom,path:["plan"],message:c("deep_research.plan_message_part.error.plan_empty")});let n=e.plan.split("\n").map(e=>e.trim()).filter(Boolean).length;n<1&&t.addIssue({code:aj.eq.custom,path:["plan"],message:c("deep_research.plan_message_part.error.plan_too_few_steps")}),n>25&&t.addIssue({code:aj.eq.custom,path:["plan"],message:c("deep_research.plan_message_part.error.plan_too_many_steps",{steps:n,maxSteps:25})}),e.plan.length>1e4&&t.addIssue({code:aj.eq.custom,path:["plan"],message:c("deep_research.plan_message_part.error.plan_too_long")})}),[c]),m=(0,av.mN)({defaultValues:{plan:d},resolver:(0,ax.u)(u)});(0,h.useEffect)(()=>{m.reset({plan:d})},[d,m]);let[f,g]=(0,h.useState)(!1),{selectedFeatures:x,setSelectedFeatures:v}=(0,q.mr)(),y=eh.api.research.startResearch.useMutation({onSuccess:e=>{v(x.filter(e=>"beta-deep-research"!==e)),(0,to.Cq)(o)({chatId:s.chatId,messageId:s.id,messageVersion:s.version})({contentChunks:e.message.contentChunks})},onError:e=>{var t;if((null==(t=e.data)?void 0:t.code)==="FORBIDDEN")return A.oRP.error(c("deep_research.forbidden_error"));A.oRP.error(c("deep_research.start_research_error"))}});(0,h.useEffect)(()=>{f&&m.setFocus("plan")},[f,m]);let j=(0,ab.m)(),b=(0,t8.w)(),w=!!((null==b?void 0:b.session.acceleratedAnswersEnabled)&&j.data&&j.data.fast_deep_research.remainingPoints>0),_=j.isLoading,C=(null==(t=j.data)?void 0:t.deep_research.remainingPoints)===0,N=(0,h.useRef)(null),I=y.isPending||n.requested;return(0,a.jsx)("form",{onSubmit:m.handleSubmit(e=>{if(_||C)return;let t=e.plan.split("\n").filter(Boolean);if(g(!1),!l)return y.mutateAsync({plan:t,message:s,planWasManuallyUpdated:!!m.formState.dirtyFields.plan})}),className:"rounded-lg border border-default bg-default p-4 shadow-card",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{style:{gridTemplateAreas:'\n            "step-1-index step-1-content"\n            "step-2-index step-2-content"\n            "step-3-index step-3-content"'},className:"grid grid-cols-[auto_1fr] grid-rows-[auto_auto_auto] place-items-start gap-4",children:[(0,a.jsx)("hr",{className:"h-auto w-[1px] self-stretch justify-self-center border-0 bg-(--border-darker)",style:{gridArea:"1 / 1 / -1 / 1"}}),["research","analyze","report"].map((e,t)=>{let n="research"===e;return(0,a.jsxs)(h.Fragment,{children:[(0,a.jsx)("div",{style:{gridArea:"step-".concat(t+1,"-index")},className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:(0,D.cn)("size-8 rounded-full text-xs font-medium inset-shadow-components-default","border-4 border-(--bg-default)",n?"bg-card-inverted text-inverted-default":"bg-subtle"),children:(0,a.jsx)("span",{className:(0,D.cn)("flex h-full w-full items-center justify-center rounded-full",!n&&"border border-darker"),children:t+1})})}),(0,a.jsxs)("div",{style:{gridArea:"step-".concat(t+1,"-content")},className:"justify-self-stretch pt-0.5",children:[(0,a.jsx)(eu.ac,{weight:"medium",children:c("deep_research.plan_message_part.steps.".concat(e))}),n&&(0,a.jsxs)(h.Fragment,{children:[f?(0,a.jsx)(A.No,{minRows:5,maxRows:50,className:"resize-none rounded-md border-[1.5px] border-basic-orange-accent bg-default p-2 text-sm caret-basic-orange-accent",...m.register("plan")}):(()=>{let e=m.watch("plan").split("\n");return(0,a.jsx)("div",{className:"p-[10px] text-sm whitespace-pre-line",children:e.map((e,t)=>(0,a.jsx)("p",{children:e},"".concat(t,"-").concat(e)))})})(),(0,a.jsx)(A.Nt8,{open:f||!!m.formState.errors.plan,children:(0,a.jsx)(A.KeB,{children:m.formState.errors.plan?(0,a.jsx)(eu.o5,{size:"xs",className:"pt-1.5 text-basic-red-accent",children:m.formState.errors.plan.message}):(0,a.jsx)(eu.o5,{size:"xs",variant:"hint",className:"pt-1.5",children:c("deep_research.plan_message_part.edit_hint")})})})]})]})]},e)})]}),!(i&&r)&&!n.taskId&&!l&&(0,a.jsxs)("div",{className:"flex items-center gap-4 pt-8",children:[w?(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(eu.ac,{weight:"medium",children:c("deep_research.plan_message_part.eta",{timeInMinutes:5})}),(0,a.jsx)(A.Hxo,{size:"20"})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eu.ac,{weight:"medium",children:c("deep_research.plan_message_part.eta",{timeInMinutes:15})}),(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(A.Hxo,{size:"20",fill:"",className:"fill-(--secondary-300)"})}),(0,a.jsx)(S.ZI,{children:(null==b?void 0:b.session.acceleratedAnswersEnabled)?"":c("deep_research.plan_message_part.flash_answers_disabled")})]})]}),(0,a.jsx)("div",{className:"grow"}),f?(0,a.jsx)(nM,{hotkey:r?"meta+E":void 0,variant:"soft",onTrigger:()=>{g(!1),m.reset({plan:d})},children:c("deep_research.plan_message_part.cancel_edit_plan_cta")}):(0,a.jsx)(nM,{hotkey:r?"meta+E":void 0,variant:"soft",onTrigger:()=>{g(!0)},children:c("deep_research.plan_message_part.edit_plan_cta")}),(0,a.jsxs)(nM,{hotkey:r?"meta+Enter":void 0,variant:"brand",hotkeyClassName:(0,D.cn)("text-inherit",{"pointer-events-none opacity-0":I}),ref:N,onHotkey:e=>{var t;null==(t=N.current)||t.click(),e.preventDefault(),e.stopPropagation()},type:"submit",isDisabled:_||C,isLoading:I,children:[c("deep_research.plan_message_part.start_research_cta"),C&&(0,a.jsx)(H.GM,{children:c("deep_research.plan_message_part.start_research_rate_limit_exceeded_tooltip")})]})]})]})})}function a_(e){let{part:t,onToolCallConfirmation:n,isGenerating:s}=e,i=e=>{n({confirmations:t.toolCalls.filter(e=>!!e.integration).map(t=>({integrationId:t.integration.id,toolCallId:t.id,functionName:t.name,confirmation:e}))})};return(0,a.jsx)(n$,{toolCalls:t.toolCalls,onAllow:()=>i("allow"),onDecline:()=>i("deny"),onAlwaysAllow:()=>i("alwaysAllow"),className:"mb-5",isGenerating:s})}let aC=e=>{let{children:t,shouldAnimate:n,...s}=e;return(0,a.jsx)(i.P.div,{initial:!!n&&{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.1},...s,children:t})},aN=h.memo(function(e){let{isGenerating:t=!1,canvas:n,messageCanvas:s,messageFiles:l,messageQuotes:o,session:c,isLastMessage:d,isReadOnly:u,className:m,onToolCallConfirmation:f,onSendFollowUp:g}=e,y=(0,h.useContext)(K.N),j=(0,L.DK)(g),[b,w]=function(e,t){let[n,a]=(0,h.useState)(e),[s,i]=(0,h.useState)(e);return(0,h.useEffect)(()=>{let e=setTimeout(()=>{i(n)},100);return()=>{clearTimeout(e)}},[n,100]),[s,a]}(t&&!!d&&(null==y?void 0:y.role)===v.gg.ASSISTANT,100),_=eh.api.chat.confirmExternalLink.useMutation(),C=tv(e=>{_.mutate({url:e})}),N=(0,th.Ym)();if((0,h.useEffect)(()=>{w(t&&!!d&&(null==y?void 0:y.role)===v.gg.ASSISTANT)},[t,d,null==y?void 0:y.role,w]),!y)throw Error("MessageContext is not provided");let I=(0,h.useMemo)(()=>y.contentChunks&&y.contentChunks.length>0?y.contentChunks:y.content?[{type:"text",text:y.content}]:[],[y.contentChunks,y.content]),k=(0,h.useMemo)(()=>(y.role!==v.gg.USER?tz({contentChunks:I,messageFiles:l,messageFollowups:y.followups,locale:N in tf.rc?N:void 0}):(e=>{let{contentChunks:t,messageFiles:n,messageQuotes:a}=e,s=[];n&&n.length>0&&s.push({type:"files",files:n.filter(e=>!e.inlinePositionId)}),a&&a.length>0&&a.forEach(e=>{s.push({type:"quote",quote:e})});let i=[];return t.forEach(e=>{if("text"===e.type)i.push({type:"text",content:e.text});else if("inline_tag"===e.type)i.push({type:"slash",content:(0,td.tl)(e)});else if("action"===e.type)i.length>0&&(s.push({type:"rich_message",richChunks:i}),i=[]),s.push({type:"action",actionId:e.id});else if("audio"===e.type){var t,n,a,r,l,o,c,d;i.length>0&&(s.push({type:"rich_message",richChunks:i}),i=[]),s.push({type:"audio",recordingUrl:e.recordingUrl,metadata:{pcm:null!=(l=null==(t=e.metadata)?void 0:t.pcm)?l:null,originalTranscript:null!=(o=null==(n=e.metadata)?void 0:n.originalTranscript)?o:null,recordingId:null!=(c=null==(a=e.metadata)?void 0:a.recordingId)?c:null,transcriptionId:null!=(d=null==(r=e.metadata)?void 0:r.transcriptionId)?d:null}})}}),i.length>0&&s.push({type:"rich_message",richChunks:i}),s})({contentChunks:I,messageFiles:l,messageQuotes:o})).filter(e=>"audio"!==e.type),[y.role,y.followups,I,l,o,N]),A=O(I.filter(e=>"custom_element"===e.type&&"table-metadata"===e.element.type).map(e=>e.element)),E=(e=>{let{messageParts:t,isGenerating:n,trackingTimeMs:a,skip:s}=e,[i,r]=(0,h.useState)(null),l=(0,h.useRef)(void 0),o=(0,h.useRef)([]);return(0,h.useEffect)(()=>{if(s)return;let e=t.length-2,i=t.length-1,c=t[e],d=t[i];(null==c?void 0:c.type)==="working_step"&&(null==d?void 0:d.type)!=="working_step"&&n&&!o.current.includes(e)&&(o.current.push(e),clearTimeout(l.current),r(e),l.current=setTimeout(()=>{r(null)},a))},[i,n,t,s,a]),i})({messageParts:k,isGenerating:t,trackingTimeMs:1e3,skip:!d}),S=(0,p.c3)("Chat"),T=!!d&&t;return(0,a.jsx)("div",{className:(0,D.cn)("flex w-full flex-col gap-2 break-words",m),dir:"auto",children:k.map((e,l)=>{if(null!==E&&l>E)return null;switch(e.type){case"canva":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(tK,{part:e,isGenerating:t,messageCanvas:s,canvas:n,isFirstChunk:0===l,isLastChunk:l===k.length-1,featureFlags:null==c?void 0:c.organization.featureFlags,role:y.role})},l);case"rich_message":{let t=e.richChunks.some(e=>"text"===e.type&&e.content===x.EH);return(0,a.jsx)(r.N,{initial:!1,mode:"wait",children:t?(0,a.jsx)(i.P.div,{animate:{opacity:1},exit:{opacity:0},initial:{opacity:0},children:(0,a.jsx)(eu.r6,{className:"animate-pulse",children:S("audio.transcribing_audio")})},"transcribing"):(0,a.jsx)(i.P.div,{animate:{opacity:1},exit:{opacity:0},initial:{opacity:0},children:(0,a.jsx)(tF.C3,{files:y.files,children:(0,a.jsx)(tH.R,{initialValue:e.richChunks,readonly:!0})})},"rich_message")},l)}case"text":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(e7,{disableInteractions:t&&!!d,type:"answer",part:e,isUserMessage:y.role===v.gg.USER,tableMetadata:A,shouldFade:b,onSendFollowUp:j,onLinkClick:C})},l);case"quote":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(ag,{part:e})},l);case"action":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(tB,{part:e})},l);case"files":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(ah,{part:e})},l);case"widget":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(er,{part:e})},l);case"deep_research_plan":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(aw,{isGenerating:t,isLastMessage:!!d,isReadOnly:!!u,message:{id:y.id,chatId:y.chatId,version:y.version},part:e})},l);case"deep_research_task":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(au,{part:e})},l);case"deep_research_report":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(am,{part:e})},l);case"working_step":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(ac,{part:e,overrideHeader:E===l?S("features.reasoning.reasoning_done_transition"):void 0,isLastMessage:!!d,isGenerating:t,isLastMessagePart:l===k.length-1,isFirstMessagePart:0===l,session:c})},l);case"tool_call_confirmation_step":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(a_,{part:e,onToolCallConfirmation:f,isGenerating:t})},l);case"references":default:return null;case"custom_element":return(0,a.jsx)(aC,{shouldAnimate:T,children:(0,a.jsx)(tW,{element:e.element})},l)}})})},function(e,t){return(0,g.H)(e.canvas,t.canvas)&&(0,g.H)(e.messageCanvas,t.messageCanvas)&&(0,g.H)(e.messageFiles,t.messageFiles)&&(0,g.H)(e.messageQuotes,t.messageQuotes)&&e.isGenerating===t.isGenerating&&e.isLastMessage===t.isLastMessage&&e.className===t.className&&e.isReadOnly===t.isReadOnly});var aI=n(41285),ak=n(4422),aA=n(90795),aE=n(10918),aS=n(8007),aD=n(98747),aT=n(12171),aM=n(85148);let aR=e=>{let{isGenerating:t,version:n,prevVersion:s,nextVersion:i,versionCount:r,handleSetActive:l}=e;return(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)(H.$n,{"aria-label":"Previous version",isDisabled:t||null===s,size:"2xs",variant:"ghost",className:"h-4 w-4 p-2",onClick:()=>{null!==s&&l(s)},children:(0,a.jsx)(aI.A,{className:"h-3 w-3 shrink-0 rtl:rotate-180",strokeWidth:2})}),(0,a.jsx)("span",{className:"text-sm text-muted dark:text-muted",children:"".concat(n+1,"/").concat(r)}),(0,a.jsx)(H.$n,{"aria-label":"Next version",isDisabled:t||null===i,size:"2xs",variant:"ghost",className:"h-4 w-4",onClick:()=>{null!==i&&l(i)},children:(0,a.jsx)(ak.A,{className:"h-3 w-3 shrink-0 rtl:rotate-180",strokeWidth:2})})]})},aP=e=>{let{handleUpdateReaction:t,currentReaction:n,disabled:s}=e,i=(0,p.c3)("Chat");return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":"Like",isDisabled:s,size:"xs",variant:"ghost",className:(0,D.cn)("h-8 w-8 p-2",n===v.nM.LIKE&&"text-basic-green-strong"),onClick:()=>t(n===v.nM.LIKE?v.nM.NEUTRAL:v.nM.LIKE),children:(0,a.jsx)(aA.A,{className:"h-4 w-4 shrink-0",strokeWidth:2})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:(0,a.jsx)("p",{children:i("message.reaction_tooltip",{reaction:n===v.nM.LIKE?v.nM.NEUTRAL:v.nM.LIKE})})})]})},aL=e=>{let{handleUpdateReaction:t,currentReaction:n,disabled:s}=e,i=(0,p.c3)("Chat");return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":"Dislike",isDisabled:s,size:"xs",variant:"ghost",className:(0,D.cn)("h-8 w-8 p-2",n===v.nM.DISLIKE&&"text-brand-600 hover:text-brand-600"),onClick:()=>t(n===v.nM.DISLIKE?v.nM.NEUTRAL:v.nM.DISLIKE),children:(0,a.jsx)(aE.A,{className:"h-4 w-4 shrink-0",strokeWidth:2})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:(0,a.jsx)("p",{children:i("message.reaction_tooltip",{reaction:n===v.nM.DISLIKE?v.nM.NEUTRAL:v.nM.DISLIKE})})})]})},aO=e=>{let{handleRewrite:t,isGenerating:n}=e,s=(0,p.c3)("Chat"),{selectedFeatures:i,isLoading:r,selectedIntegrations:l}=(0,q.mr)();return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":"Rewrite",isDisabled:n||r,size:"xs",variant:"ghost",className:"h-8 w-8 p-2",onClick:()=>{t({features:i,integrations:l})},children:(0,a.jsx)(aS.A,{className:"h-4 w-4 shrink-0",strokeWidth:2})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:(0,a.jsx)("p",{children:s("message.rewrite_button_title",{isLoading:n.toString()})})})]})},aV=e=>{let{copyHandler:t}=e,n=(0,p.c3)("Chat");return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":"Copy to clipboard",size:"xs",variant:"ghost",className:"h-8 w-8 p-2",onClick:t,children:(0,a.jsx)(F.A,{strokeWidth:2})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:(0,a.jsx)("p",{children:n("message.copy_button_title")})})]})},az=e=>{let{convertToCanvasHandler:t}=e,n=(0,p.c3)("Chat");return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":n("canvas.edit_in_canva"),size:"xs",variant:"ghost",className:"h-8 w-8 p-2",onClick:t,children:(0,a.jsx)(aD.A,{strokeWidth:2})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:(0,a.jsx)("p",{children:n("canvas.edit_in_canva")})})]})},aF=e=>{let{editUserMessageHandler:t,disabled:n}=e,s=(0,p.c3)("Chat");return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":"Edit question",size:"xs",variant:"ghost",className:"h-8 w-8 p-2",onClick:t,isDisabled:n,children:(0,a.jsx)(aT.A,{className:"h-4 w-4 shrink-0",strokeWidth:2})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:s("message.edit_button_title",{isLoading:n.toString()})})]})},aH=e=>{let{disabled:t,deleteHandler:n}=e,s=(0,p.c3)("Chat");return(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(H.$n,{"aria-label":"Delete question",size:"xs",variant:"ghost",className:"h-8 w-8 p-2",onClick:n,isDisabled:t,children:(0,a.jsx)(aM.A,{className:"h-4 w-4 shrink-0",strokeWidth:2})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:s("message.delete_button_title",{isLoading:t.toString()})})]})};var aU=n(9855),aq=n(91518),a$=n(70669),aB=n(52522);let aG=h.forwardRef((e,t)=>{let{children:n,messageId:s,role:r,isGenerating:l,isLastMessage:o,messageVersion:c}=e;return(0,a.jsx)(i.P.div,{id:s,ref:t,variants:a0,initial:l&&r===v.gg.USER?"initialUser":"static",animate:"static",exit:"static",transition:{duration:.2,ease:"easeInOut"},"data-message-author-role":r,className:"group group/message flex min-h-auto w-full gap-3 interpolate-size-allow-keywords",style:o&&r===v.gg.ASSISTANT?aB.dC:void 0,...(0,a$.M2)({messageId:s,messageVersion:c}),children:n},s)}),aK=h.forwardRef((e,t)=>{let{children:n}=e;return(0,a.jsx)("div",{ref:t,className:"flex min-w-0 flex-1 flex-col",children:n})}),aW=e=>{let{children:t,isLastMessage:n,className:s,hide:i=!1}=e;return(0,a.jsx)("div",{inert:i,className:(0,D.cn)("flex min-h-8 w-full flex-row items-center justify-between gap-2 py-1 font-normal opacity-0 transition-opacity duration-500 ease-in-out group-hover:opacity-100",n&&"opacity-100",i&&"opacity-0!",s),children:t})},aZ=e=>{let{children:t,className:n}=e;return(0,a.jsx)("div",{className:(0,D.cn)("flex flex-row items-center gap-2",n),children:t})},aX=e=>{let{createdAt:t}=e,n=(0,p.c3)("Chat"),s=(0,th.Ym)();return(0,a.jsxs)(S.m_,{delayDuration:700,children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"text-sm text-hint",suppressHydrationWarning:!0,children:(0,nk.tI)(t,{locale:s,yesterdayTranslation:n("message.yesterday")})})}),(0,a.jsx)(S.ZI,{children:(0,nk.tI)(t,{locale:s,format:"long"})})]})},aY=e=>{let{memories:t,buttonLabel:n,delayDuration:s=500,onClick:i}=e,r=(0,p.c3)("Chat"),{track:l}=(0,B.n)();return(0,a.jsxs)(S.m_,{onOpenChange:e=>e&&l(B.f.MEMORY_UPDATED_IN_CHAT_TOOLTIP),delayDuration:s,children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)("div",{className:"text-sm text-hint",suppressHydrationWarning:!0,children:r("memories.update.label")})}),(0,a.jsx)(S.ZI,{className:"border-1 border-darker bg-card p-4 shadow-modal-sm",children:(0,a.jsxs)("div",{className:"min-w-65 space-y-4",children:[(0,a.jsx)("ul",{className:"space-y-4",children:t.map(e=>{let{id:t,content:n,eventType:s}=e;return(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-4",children:[(0,a.jsx)("div",{className:"line-clamp-2 text-sm",children:(0,aU.Z)(n)}),(0,a.jsx)(aq.Ex,{size:"sm",colorScheme:(e=>{switch(e){case"ADD":return"emerald";case"DELETE":return"orangebright";case"UPDATE":return"sky";case"NONE":return"neutral"}})(s),children:(0,aU.Z)(r("memories.update.events.".concat(s)))})]})},t)})}),(0,a.jsx)(H.$n,{variant:"soft",onClick:i,className:"w-full",children:n})]})})]})},aJ=(0,u.default)(()=>Promise.all([n.e(3904),n.e(5358)]).then(n.bind(n,25358)),{loadableGenerated:{webpack:()=>[25358]}}),aQ=[],a0={initialUser:{opacity:0,y:10,x:10},initialAssistant:{opacity:0,y:10,x:-10},static:{opacity:1,y:0,x:0}},a1=(0,h.forwardRef)((e,t)=>{var n,u,g,y,j,R,P,L,O,V;let{message:z,isGenerating:F,isReadOnly:H,isLastMessage:U,isLastTurn:W,handleRewrite:Z,handleEdit:X,handleToolCallConfirmation:Y,handleFollowUp:J,user:Q,canvas:ee,quotes:et=aQ,session:en,features:ea,restrictedInteractions:es,onAgentChange:ei,incognito:er}=e,eo=(0,p.c3)("Chat"),ec=(0,m.useRouter)(),ed=eh.api.useUtils(),{track:eu}=(0,B.n)(),em=(0,h.useMemo)(()=>z.files.map(e=>{var t;return{type:e.type,url:e.url,name:e.name,inlinePositionId:null!=(t=e.inlineId)?t:void 0}}),[z]),[ep,ef]=(0,h.useState)(!1),[eg,ex]=(0,h.useState)(!1),{openCanva:ev,setOpenCanva:ey,createTemporaryCanva:ej}=(0,G.o)(),eb=tr.P.use.editMessageId(),ew=tr.P.use.setEditMessageId(),{references:e_}=(0,el.G)(),{data:eC}=eh.api.agent.list.useQuery(en?void 0:s.hT),{data:eN}=eh.api.agent.agentsApiList.useQuery(en&&en.organization.featureFlags.agent_k?void 0:s.hT),eI=(0,h.useMemo)(()=>{var e;return null!=(e=null==eC?void 0:eC.find(e=>e.id===z.agentId))?e:null},[eC,z.agentId]),ek=(0,h.useMemo)(()=>{var e;return null!=(e=null==eN?void 0:eN.find(e=>e.id===z.agentsApiAgentId))?e:null},[eN,z.agentId]),eA=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=eh.api.useUtils();return eh.api.message.delete.useMutation({...e,onMutate:async function(){for(var n,a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];let[r]=s;await t.message.all.cancel({chatId:r.chatId});let l=t.message.all.getData({chatId:r.chatId});return t.message.all.setData({chatId:r.chatId},e=>e&&{items:e.items.filter(e=>{let{turn:t}=e;return t<r.turn}),nextCursor:void 0}),null==(n=e.onMutate)||n.call(e,...s),{prevData:l}},onSuccess:async function(){for(var n,a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];let[r,l,o]=s;if(await t.message.all.invalidate({chatId:l.chatId}),t.canva.all.setData({chatId:l.chatId},e=>{var t,n;if(!e)return;let a=null!=(n=null==(t=o.prevData)?void 0:t.items)?n:[];return{items:(0,N.zh)(e.items,a.filter(e=>{let{turn:t}=e;return t<l.turn})),nextCursor:void 0}}),r.deletedChat){let e={chatVisibility:I.jZ.PRIVATE,chatPermission:I.Jj.WRITE};t.chat.last.setInfiniteData(e,e=>e&&(0,ti.ZK)(e,e=>{let{id:t}=e;return t===l.chatId})),await t.chat.last.invalidate(e)}null==(n=e.onSuccess)||n.call(e,...s)},onError:function(){for(var n,a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];let[,r,l]=s;t.message.all.setData({chatId:r.chatId},null==l?void 0:l.prevData),null==(n=e.onError)||n.call(e,...s)}})}({onSuccess:(e,t,n)=>{let a=ed.canva.all.getData({chatId:t.chatId});(null==a?void 0:a.items.find(e=>e.id===(null==ev?void 0:ev.id)&&e.version===ev.version))&&ey(null),e.deletedChat&&ec.push("/chat")}}),eE=eh.api.message.setActive.useMutation({async onMutate(e){await ed.message.all.cancel({chatId:z.chatId});let t=ed.message.all.getData({chatId:z.chatId});return(0,to.GS)(ed)({chatId:z.chatId,messageId:e.id,messageVersion:e.version}),ex(!1),{prevData:t}},async onSuccess(e,t){await ed.canva.all.invalidate({chatId:z.chatId})},onError(e,t,n){ed.message.all.setData({chatId:z.chatId},null==n?void 0:n.prevData)}}),eS=eh.api.message.updateReaction.useMutation({onMutate(e){(0,to.Cq)(ed)({chatId:z.chatId,messageId:e.id,messageVersion:e.version})({reaction:e.reaction})}}),{copyMessageToClipboard:eD,containerRef:eT}=function(e){let{message:t,canvas:n}=e,{trackMessageEvent:a}=(0,B.n)(),s=(0,p.c3)("Chat"),i=(0,h.useRef)(null);return{copyMessageToClipboard:(0,h.useCallback)(async()=>{try{let r={"text/plain":function(e){var t,n;let{message:a,canvas:s}=e;return(null==(t=a.contentChunks)?void 0:t.length)?(0,w.r)({contentChunks:a.contentChunks,canvas:s}):null!=(n=a.content)?n:""}({message:t,canvas:n})};if(t.role===v.gg.ASSISTANT){var e;let t=(e=i).current?Array.from((0,$.Si)(e.current).querySelectorAll(function(e){let{type:t}=e;return"div[".concat(e6,'="').concat(t,'"]')}({type:"answer"}))).map(e=>(0,M.CD)(e)).map(e=>e.innerHTML.trim()).join("\n"):null;t&&(r["text/html"]=t)}let l=new ClipboardItem(r);await (0,eB.J)(l),A.oRP.info(s("message.copy_button_toast")),a(B.f.COPIED_MESSAGE,{chat_id:t.chatId,message_id:t.id,message_version:t.version,answer_id:t.id,answer_version:t.version})}catch(e){console.error(e)}},[t,n,s,a]),containerRef:i}}({message:z,canvas:ee}),{selectedFeatures:eM,isLoading:eR,allowedFeatures:eP,selectedIntegrations:eL,setSelectedFeatures:eO}=(0,q.mr)(),eV=(0,h.useCallback)(async e=>{let t,{value:n,model:a,agentId:s,agentsApiAgentId:i,hasPastedText:r}=e;if(X&&!eR){ef(!0);try{t=await (0,tl.Zn)(n.files,eo)}catch(e){A.oRP.error("".concat(e)),ef(!1);return}ew(null),X({messageId:z.id,agentId:s,agentsApiAgentId:i,value:{...n,files:t},integrations:eL,features:eM,model:a,hasPastedText:r}),eu(B.f.EDITED_PROMPT,{chat_id:z.chatId,prompt_id:z.id,prompt_version:z.version}),ef(!1),ex(!1)}},[X,eR,ew,z.chatId,z.id,z.version,eL,eM,eu,eo]),ez=(0,E.K)(e=>{let{confirmations:t}=e,n=t.map(e=>e.integrationId).concat(eL);Y({message:z,confirmations:t.map(e=>({toolCallId:e.toolCallId,confirmation:({allow:"allow",deny:"deny",alwaysAllow:"allow"})[e.confirmation]})),permissionUpdates:t.filter(e=>"alwaysAllow"===e.confirmation).map(e=>({functionName:e.functionName,integrationId:e.integrationId,permission:"allow"})),integrations:(0,f.A)(n),features:eM,agentId:z.agentId})}),eF=(0,h.useCallback)((e,t)=>{J({question:e,parentMessageId:z.id,agentId:z.agentId,features:eM,integrations:eL,questionId:t})},[J,z.id,z.agentId,eM,eL]),eH=e=>{z.id&&(H?(0,to.GS)(ed)({chatId:z.chatId,messageId:z.id,messageVersion:e}):eE.mutate({id:z.id,chatId:z.chatId,version:e}),eu(B.f.CHANGED_MESSAGE_VERSION,{chat_id:z.chatId,answer_id:z.id,from_answer_version:z.version,to_answer_version:e,role:z.role}))},eU=e=>{!H&&z.id&&e!==z.reaction&&(eS.mutate({id:z.id,chatId:z.chatId,version:z.version,reaction:e}),A.oRP.info(eo("message.reaction_toast",{reaction:e})),e===v.nM.DISLIKE?ex(!0):ex(!1))};(0,h.useEffect)(()=>ex(!1),[z.id,z.version]);let{isSampleAgentChat:eq}=(0,T.r)(),e$=(0,h.useMemo)(()=>{var e,t;return null!=(t=null!=(e=null==eI?void 0:eI.name)?e:null==ek?void 0:ek.name)?t:null},[eI,ek]),eG=F&&U,eK=(null!=(R=null==(n=z.contentChunks)?void 0:n.filter(e=>"reference"===e.type).map(e=>e.referenceIds).flat().map(e=>null==e_?void 0:e_.find(t=>t.id.toString()===e.toString())).filter(e=>!!e))?R:[]).length>0,eW=eP.includes("beta-trampoline")&&(null==en?void 0:en.organization.featureFlags["feathers-mcgraw"]),eZ=(null!=(P=null==(u=z.contentChunks)?void 0:u.filter(e=>"canva"===e.type).flat())?P:[]).length>0,eX=U&&F&&z.role===v.gg.ASSISTANT&&0===(null!=(L=z.contentChunks)?L:[]).length,eY=null==(g=z.contentChunks)?void 0:g.some(e=>"text"===e.type&&e.text===x.EH);return z.role===v.gg.ASSISTANT?(0,a.jsx)(K.N.Provider,{value:z,children:(0,a.jsx)(S.Bc,{delayDuration:0,children:(0,a.jsxs)(aG,{isLastMessage:U,messageId:z.id,ref:t,isGenerating:F,role:v.gg.ASSISTANT,messageVersion:z.version,children:[(0,a.jsx)("div",{className:"relative flex flex-col items-center gap-4",children:(0,a.jsxs)(i.P.div,{initial:{borderRadius:F?"50%":"25%"},animate:{borderRadius:eX?"50%":"25%"},transition:{duration:.3,ease:"easeInOut"},className:"flex items-center justify-center overflow-hidden",children:[(null==eI?void 0:eI.avatar)?(0,a.jsx)(ts.m,{avatar:eI.avatar,className:"flex size-[28px] items-center justify-center rounded-sm",children:(0,a.jsx)(ts.l,{size:16})}):(0,a.jsx)(A.euF,{children:(0,a.jsx)(tc.n,{session:en})}),eX&&(0,a.jsx)(tp.y,{containerClassName:"absolute",indicatorColor:(null==eI||null==(O=eI.avatar)?void 0:O.type)==="pixel_avatar"?eI.avatar.background_color:void 0})]})}),(0,a.jsxs)(aK,{ref:eT,children:[(0,a.jsxs)(a.Fragment,{children:[z.content||z.contentChunks?(0,a.jsx)(aN,{isGenerating:F,messageFiles:em,messageQuotes:k(et,z),session:en,isLastMessage:U,messageCanvas:ee&&(0,N.iz)(ee,z),canvas:ee,onToolCallConfirmation:ez,isReadOnly:H,onSendFollowUp:eF}):(0,a.jsx)("div",{className:"px-0.5 py-1 text-sm font-light text-muted italic",children:!eX&&eo("message.empty")}),eK&&!(U&&eG)&&(0,a.jsx)(i.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},transition:{duration:.5,ease:"easeInOut"},children:(0,a.jsx)(tm,{message:z,disabled:F,className:"mt-4 w-fit"})}),(0,a.jsxs)(aW,{isLastMessage:U,hide:eG,className:(0,D.cn)("mb-2",eK&&"mt-1"),children:[(0,a.jsxs)(aZ,{className:"gap-0",children:[e$&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"hidden truncate text-xs whitespace-nowrap text-hint sm:block dark:text-hint",children:e$}),(0,a.jsx)("div",{className:"hidden text-xs text-hint sm:block dark:text-hint",children:(0,a.jsx)(o.A,{})})]}),z.isAcceleratedAnswer&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(A.Hxo,{className:"size-3.5 text-(--yellow-500)"})}),(0,a.jsx)(S.ZI,{side:"bottom",children:(0,a.jsx)("p",{children:eo("message.accelerated_tooltip")})})]}),(0,a.jsx)(o.A,{className:"text-(--transparent-dark-15)"})]}),(0,a.jsx)("div",{className:"relative overflow-hidden",children:(0,a.jsx)(r.N,{initial:!1,mode:"wait",children:z.memories&&z.memories.length>0?(0,a.jsx)(i.P.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},transition:{duration:.225,ease:(0,l.A)(0,0,0,1)},children:(0,a.jsx)(aY,{memories:z.memories,buttonLabel:eo("memories.manage.button.label"),onClick:()=>{ec.push("/memories")}})},"memories"):(0,a.jsx)(i.P.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:-100,opacity:0},transition:{duration:.225,ease:(0,l.A)(0,0,0,1)},children:(0,a.jsx)(aX,{createdAt:z.createdAt})},"creation-date")})})]}),(0,a.jsxs)(aZ,{children:[z.versionCount>1&&!(null==es?void 0:es.includes("version-navigation"))&&(0,a.jsx)(aR,{handleSetActive:eH,isGenerating:F,version:z.version,nextVersion:z.nextVersion,prevVersion:z.prevVersion,versionCount:z.versionCount}),!H&&(0,a.jsxs)(a.Fragment,{children:[!(null==es?void 0:es.includes("like-and-dislike"))&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(aP,{currentReaction:z.reaction,handleUpdateReaction:eU,disabled:F||eS.isPending}),(0,a.jsx)(aL,{currentReaction:z.reaction,disabled:F||eS.isPending,handleUpdateReaction:eU})]}),U&&Z&&!(null==es?void 0:es.includes("re-generate"))&&(0,a.jsx)(aO,{handleRewrite:Z,isGenerating:F})]}),!ev&&!(null==es?void 0:es.includes("copy"))&&(0,a.jsx)(aV,{copyHandler:eD}),!H&&!eZ&&eW&&!eq&&!(null==es?void 0:es.includes("edit-in-canva"))&&(0,a.jsx)(az,{convertToCanvasHandler:()=>{ej({inferedCanvaEditorType:"text",content:z.content?z.content:(0,w.r)({contentChunks:z.contentChunks,canvas:ee}),onToggleFeature(){eM.includes("beta-trampoline")||eO([...eM,"beta-trampoline"])}})}}),Q&&b(en)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{className:"text-(--transparent-dark-15)"}),(0,a.jsx)(ta,{chatId:z.chatId,className:"h-8 w-8 p-2 lg:pointer-events-auto",messageTimestamp:z.createdAt})]})]})]})]}),eg&&en&&(0,a.jsx)(aJ,{message:z,handleUpdateReactionDetail:(e,t)=>{!H&&z.id&&(eS.mutate({id:z.id,chatId:z.chatId,version:z.version,reaction:z.reaction,reactionDetail:e,reactionComment:t}),setTimeout(()=>ex(!1),1150))},handleDismiss:()=>ex(!1),session:en,features:ea,incognito:er})]})]})})}):(0,a.jsx)(K.N.Provider,{value:z,children:(0,a.jsx)(S.Bc,{delayDuration:0,children:(0,a.jsx)(aG,{isLastMessage:U,messageId:z.id,ref:t,isGenerating:F,role:v.gg.USER,messageVersion:z.version,children:(0,a.jsxs)(aK,{children:[(0,a.jsx)(r.N,{children:eb===z.id?(0,a.jsx)(i.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1,transition:{duration:.4,ease:"easeInOut"}},exit:{opacity:0,scale:.9,transition:{duration:0,ease:"easeInOut"}},className:"ms-auto flex w-full min-w-0 flex-col items-stretch justify-between gap-1",children:(0,a.jsx)(tu.A,{defaultValue:{text:null!=(V=z.content)?V:"",richInput:((e,t)=>t?e.contentChunks&&0!==e.contentChunks.length?(0,td.TG)(e.contentChunks):e.content&&e.content.length>0?(0,td.TG)([{type:"text",text:e.content}]):[]:[])(z,en),files:z.files.map(e=>{var t;return{type:e.type,url:e.url,name:e.name,inlinePositionId:null!=(t=e.inlineId)?t:void 0}})},defaultAgentId:z.agentId,defaultAgentsApiAgentId:z.agentsApiAgentId,defaultModel:z.model,isLoading:ep||eR,onSubmit:eV,onCancel:()=>ew(null),chatId:z.chatId,session:en,editMode:!0,showSuggestions:!1,onChange:e=>{void 0!==e.agentId&&(null==ei||ei(e.agentId))},incognito:er})},"edit-message"):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i.P.div,{layout:eY,className:"ms-auto flex w-fit max-w-full min-w-0 flex-col items-stretch justify-between gap-1 rounded-3xl bg-basic-gray-alpha-4 px-5 py-2.5",children:[(0,a.jsx)(aN,{isGenerating:F,messageFiles:em,messageQuotes:k(et,z),session:en,isLastMessage:U,messageCanvas:ee&&(0,N.iz)(ee,z),canvas:ee,onToolCallConfirmation:ez,onSendFollowUp:eF}),Q&&function(e){return e.moderationCategory&&_.includes(e.moderationCategory)}(z)&&(0,a.jsxs)(S.m_,{children:[(0,a.jsx)(S.k$,{asChild:!0,children:(0,a.jsx)(i.P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,ease:"easeInOut"},children:(0,a.jsxs)("div",{className:"hover:bg-state-destructive-foreground flex items-center rounded-sm text-xs font-semibold text-destructive hover:text-destructive",children:[(0,a.jsx)(c.A,{className:"fill-destructive me-2 h-4 w-4"}),eo("messages.moderation.title")]})})}),(0,a.jsx)(S.ZI,{side:"bottom",children:(0,a.jsx)("p",{children:eo("messages.moderation.description")})})]})]}),(0,a.jsxs)(aW,{className:"ms-auto mb-2 w-fit max-w-full gap-3",children:[(0,a.jsxs)(aZ,{children:[z.versionCount>1&&!(null==es?void 0:es.includes("version-navigation"))&&(0,a.jsx)(aR,{handleSetActive:eH,isGenerating:F,version:z.version,nextVersion:z.nextVersion,prevVersion:z.prevVersion,versionCount:z.versionCount}),!H&&(0,a.jsxs)(a.Fragment,{children:[!(null==(y=z.contentChunks)?void 0:y.some(e=>"action"===e.type))&&X&&!(null==es?void 0:es.includes("edit"))&&(0,a.jsx)(aF,{editUserMessageHandler:()=>{!F&&!H&&z.id&&X&&ew(z.id)},disabled:F||!!H}),W&&!(null==es?void 0:es.includes("delete"))&&(0,a.jsx)(aH,{deleteHandler:()=>{F||H||!z.id||eA.mutate({id:z.id,version:z.version,chatId:z.chatId,turn:z.turn})},disabled:F||!!H})]}),!ev&&!(null==(j=z.contentChunks)?void 0:j.some(e=>"action"===e.type))&&!(null==es?void 0:es.includes("copy"))&&(0,a.jsx)(aV,{copyHandler:eD})]}),(0,a.jsx)(aZ,{children:(0,a.jsx)(aX,{createdAt:z.createdAt})})]})]})}),Q&&function(e){return e.moderationCategory&&C.includes(e.moderationCategory)}(z)&&(0,a.jsxs)(i.P.div,{transition:{duration:.4,ease:"easeInOut"},initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-4 flex w-full items-center gap-4 rounded-md bg-basic-purple-accent px-4 py-3",children:[(0,a.jsx)(A.C3E,{className:"size-4"}),(0,a.jsx)("p",{className:"flex-1 font-bold",children:eo("messages.moderation.selfHarmTitle")}),(0,a.jsxs)("a",{href:eo("messages.moderation.selfHarmLinkUrl"),target:"_blank",className:"flex items-center gap-2",children:[eo("messages.moderation.selfHarmLinkText"),(0,a.jsx)(d.A,{className:"size-4"})]})]})]})})})})}),a2=h.memo(a1,function(e,t){return e.message.id===t.message.id&&e.message.role===t.message.role&&e.message.content===t.message.content&&(0,g.H)(e.message.contentChunks,t.message.contentChunks)&&e.message.version===t.message.version&&e.message.versionCount===t.message.versionCount&&e.message.status===t.message.status&&e.message.reaction===t.message.reaction&&e.message.createdAt.getTime()===t.message.createdAt.getTime()&&e.message.chatId===t.message.chatId&&e.message.moderationCategory===t.message.moderationCategory&&(0,g.H)(e.message.references,t.message.references)&&e.isGenerating===t.isGenerating&&e.isReadOnly===t.isReadOnly&&e.isLastMessage===t.isLastMessage&&e.isLastTurn===t.isLastTurn&&e.handleRewrite===t.handleRewrite&&e.handleEdit===t.handleEdit&&(0,g.H)(e.quotes,t.quotes)&&(0,g.H)(e.canvas,t.canvas)&&(0,g.H)(e.features,t.features)});a2.displayName="Message"},22374:(e,t,n)=>{"use strict";n.d(t,{xl:()=>A,VD:()=>D,Ik:()=>E});var a=n(30091);let s={code:"0",name:"text",parse:(e,t)=>({type:"text",value:e,context:t})},i={code:"1",name:"moderation",parse:e=>({type:"moderation",value:e})},r={code:"2",name:"references",parse:(e,t)=>({type:"references",value:e,context:t})},l={code:"3",name:"canva",parse:e=>({type:"canva",value:e})},o={code:"4",name:"canva_token",parse:e=>({type:"canva_token",value:e})},c={code:"5",name:"tool_call",parse:e=>({type:"tool_call",value:e})},d={code:"6",name:"error",parse:e=>({type:"error",value:e})},u={code:"7",name:"image",parse:(e,t)=>({type:"image",value:e,context:t})},m={code:"8",name:"done",parse:()=>({type:"done",value:null})},p={code:"9",name:"references_ids",parse:(e,t)=>({type:"references_ids",value:e,context:t})},h={code:"10",name:"file_reference",parse:(e,t)=>({type:"file_reference",value:e,context:t})},f={code:"11",name:"widget",parse:e=>({type:"widget",value:e})},g={code:"12",name:"reasoning",parse:e=>({type:"reasoning",value:e})},x={code:"13",name:"deep_research_event",parse:e=>({type:"deep_research_event",value:e})},v={code:"14",name:"tool_reference",parse:(e,t)=>({type:"tool_reference",value:e,context:t})},y={code:"15",name:"state_update",parse:e=>({type:"state_update",value:e})},j={code:"16",name:"disclaimer",parse:e=>({type:"disclaimer",value:e})},b=[s,i,r,l,o,c,d,u,m,p,h,f,g,x,v,y,j],w={[s.code]:s,[i.code]:i,[r.code]:r,[l.code]:l,[o.code]:o,[c.code]:c,[d.code]:d,[u.code]:u,[m.code]:m,[p.code]:p,[h.code]:h,[f.code]:f,[g.code]:g,[x.code]:x,[v.code]:v,[y.code]:y,[j.code]:j};s.name,s.code,i.name,i.code,r.name,r.code,l.name,l.code,o.name,o.code,c.name,c.code,d.name,d.code,u.name,u.code,m.name,m.code,p.name,p.code,h.name,h.code,f.name,f.code,g.name,g.code,x.name,x.code,v.name,v.code,y.name,y.code,j.name,j.code;let _=b.map(e=>e.code),C={parse:(e,t)=>parseInt(e,10)>=15?a.Ay.parse(t):JSON.parse(t)},N=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let n=e.slice(0,t);if(!_.includes(n))return;let[a,s]=e.slice(t+1).split("__context__:"),i=a?C.parse(n,a):void 0,r=s?C.parse(n,s):void 0;return w[n].parse(i,r)};async function*I(e){let{isAborted:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],a=0;for(;;){let{value:s}=await e.read();if(s&&(n.push(s),a+=s.length,10!==s[s.length-1]))continue;if(0===n.length)break;let i=function(e,t){let n=new Uint8Array(t),a=0;for(let t of e)n.set(t,a),a+=t.length;return e.length=0,n}(n,a);a=0;let r=A(i);if(yield r,null==t?void 0:t()){await e.cancel();break}}}let k=new TextDecoder,A=e=>k.decode(e,{stream:!0}).split("\n").filter(e=>""!==e).map(N).filter(e=>!!e),E=e=>{let{type:t,value:n,context:a}=e;switch(t){case"text":return{type:"text",text:n,_context:a};case"moderation":case"references":case"canva_token":case"error":case"reasoning":case"deep_research_event":case"done":case"state_update":case"disclaimer":break;case"references_ids":return{type:"reference",referenceIds:n,_context:a};case"canva":return{type:"canva",id:n.id,version:n.version};case"tool_call":var s,i;return{type:"tool_call",id:n.id,name:n.name,publicArguments:null!=(s=n.publicArguments)?s:null,toolType:n.type,publicResult:n.publicResult,isDone:n.isDone,isInterrupted:null!=(i=n.isInterrupted)&&i,success:n.success,startTime:n.startTime,endTime:n.endTime,icon:n.icon,customLocale:n.customLocale,turn:n.turn,integration:n.integration,requiresConfirmation:n.requiresConfirmation,confirmationStatus:n.confirmationStatus};case"image":return{type:"image_url",imageUrl:n.url,_context:a};case"file_reference":return{type:"file_reference",fileReference:n.fileReference,fileAlt:n.fileAlt,fileUrl:n.fileUrl,_context:a};case"widget":return{type:"widget",source:n.source,_context:a};case"tool_reference":return{type:"tool_reference",url:n.url,favicon:n.favicon,title:n.title,description:n.description,_context:a}}},S=async e=>{let{streamPart:t,onPatchMessage:n,onPatchCanvas:a,onError:s,onDisclaimer:i,onDone:r}=e,{type:l,value:o}=t;switch(l){case"text":case"references_ids":case"canva":case"canva_token":case"references":case"tool_call":case"image":case"file_reference":case"widget":case"reasoning":case"deep_research_event":case"tool_reference":case"moderation":break;case"disclaimer":i(o);break;case"error":await s(o);break;case"done":null==r||r();break;case"state_update":switch(o.type){case"message":await n(o.messageId,o.messageVersion,o.patches);break;case"canvas":await a(o.patches)}}};async function D(e){let{reader:t,signal:n,onError:a,onDisclaimer:s,onDone:i,onPatchMessage:r,onPatchCanvas:l}=e;for await(let e of I(t,{isAborted:()=>n.aborted}))for(let t of e)await S({streamPart:t,onPatchMessage:r,onPatchCanvas:l,onError:a,onDisclaimer:s,onDone:i})}},24999:(e,t,n)=>{"use strict";n.d(t,{$P:()=>a,ZK:()=>i,lj:()=>s});let a=(e,t)=>({...e,items:e.items.filter(e=>!t(e))}),s=(e,t,n)=>({pageParams:e.pageParams,pages:e.pages.map(e=>({...e,items:e.items.map(e=>t(e)?n(e):e)}))}),i=(e,t)=>({pageParams:e.pageParams,pages:e.pages.map(e=>({...e,items:e.items.filter(e=>!t(e))}))})},27896:(e,t,n)=>{"use strict";n.d(t,{y:()=>r});var a=n(64784),s=n(6016),i=n(30063);function r(e){let{duration:t=1.5,repeat:n=1/0,indicatorColor:r="#FF8A00",containerClassName:l,indicatorClassName:o,...c}=e;return(0,a.jsx)("div",{...c,className:(0,i.cn)("flex items-center justify-center rounded-lg",l),children:(0,a.jsx)(s.P.div,{className:(0,i.cn)("size-10 rounded-full border-3 border-[--divide] will-change-transform",o),style:{borderTopColor:r},animate:{rotate:360},transition:{duration:t,repeat:n,ease:"linear"}})})}},29766:(e,t,n)=>{"use strict";n.d(t,{i:()=>r});var a=n(64784),s=n(8380),i=n(96166);let r=e=>{let{references:t,children:n}=e,r=(0,s.useMemo)(()=>({references:null!=t?t:null}),[t]);return(0,a.jsx)(i.o.Provider,{value:r,children:n})}},33987:(e,t,n)=>{"use strict";n.d(t,{CW:()=>d,H5:()=>v,LP:()=>j,P_:()=>f,TK:()=>x,UH:()=>h,hL:()=>y,iz:()=>u,jf:()=>g,zh:()=>m});var a=n(79481),s=n(44242),i=n(6790),r=n(15912),l=n(83554),o=n(86130);n(97561);var c=n(19071);let d=e=>!!e&&o.JH.includes(e);function u(e,t){return e.filter(e=>e.messageId===t.id&&e.messageVersion===t.version&&["active","inactive"].includes(e.status))}function m(e,t){let n=(function(e,t){let n=(0,s.$)(e,e=>e.id),a=[],l=(0,c.x)(t);return(0,i.u)(n,e=>{let t=[];(0,r.U)(e.filter(e=>e.role===o.gg.USER?"active"===e.status:!!l.find(t=>t.id===e.messageId&&t.version===e.messageVersion)&&"active"===e.status),e=>e.order).forEach(e=>{if(0===t.length)t.push(e);else{let n=t.at(-1);e.role===o.gg.ASSISTANT?t.push(e):n&&e.parentId===n.id&&e.parentVersion===n.version&&t.push(e)}}),a.push(...t)}),a})(e.filter(e=>"active"===e.status||"temporary"===e.status),t).reduce((e,t)=>(e[t.id]||(e[t.id]=[]),e[t.id].push(t),e),{});return Object.keys(n).map(e=>{if(!n[e])return[];let t=n[e],a=t.length,s=t.sort((e,t)=>e.order-t.order);return s.map((e,t)=>{var n,i;return{...e,versionCount:a,versionIndex:t+1,nextVersion:s[t+1]&&"number"==typeof(null==(n=s[t+1])?void 0:n.version)?s[t+1].version:null,prevVersion:s[t-1]&&"number"==typeof(null==(i=s[t-1])?void 0:i.version)?s[t-1].version:null}})}).flat()}let p=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),h=e=>{let t=/^```(\w+)?([\s\S]*?)(?:```$|$)/g.exec(e.trim());if(null==t?void 0:t[2]){let e=t[1];return{content:t[2].trim(),language:e}}let n=/^```([\s\S]*?)```$/g.exec(e.trim());return(null==n?void 0:n[1])?{content:n[1].trim()}:{content:e.trim()}},f=e=>{let t=e.content;switch(e.type){case"code":{let n=e.options;if(null==n?void 0:n.language){let{content:e}=h(t);t='<pre><code class="language-'.concat(null==n?void 0:n.language,'">').concat(p(e),"</code></pre>")}else{let{content:e,language:n}=h(t);t=n?'<pre><code class="language-'.concat(n,'">').concat(p(e),"</code></pre>"):"<pre><code>".concat(p(e),"</code></pre>")}break}case"react":{let{content:e}=h(p(t));t='<pre><code class="language-jsx">'.concat(e,"</code></pre>");break}case"image/svg+xml":{let{content:e}=h(p(t));t='<pre><code class="language-xml">'.concat(e,"</code></pre>");break}case"text/html":{let{content:e}=h(p(t));t='<pre><code class="language-html">'.concat(e,"</code></pre>");break}case"text/markdown":case"table":{let{content:e}=h(p(t));t=e;break}case"mermaid":case"slides":{let{content:e}=h(p(t));t='<pre><code class="language-markdown">'.concat(e,"</code></pre>")}}return t},g=(e,t)=>{let n=new Map(Object.entries(e));return t.forEach(e=>{let[t,a]=e;n.has(t)?n.set(t,n.get(t)+a):n.set(t,a)}),Object.fromEntries(n.entries())};function x(e){let t=new a.A().render(e);return l.g.convert(t)[0]}function v(e){if(!e||0===e.length||!e[0])return"";let t=Object.keys(e[0]),n="| ".concat(t.join(" | ")," |");return[n,"| ".concat(t.map(()=>"---").join(" | ")," |"),...e.map(e=>{let n=t.map(t=>e[t]);return"| ".concat(n.join(" | ")," |")})].join("\n")}let y=e=>v(x(e));function j(e){var t;let n=e.trim().split("\n").map(e=>e.split("|").map(e=>e.trim()).filter(e=>e)),a=n.length>2&&(null==(t=n[1])?void 0:t.every(e=>/^-+$/.exec(e)));return[a?n[0]:[],...a?n.slice(2):n].filter(e=>e&&e.length>0).map(e=>null==e?void 0:e.join("	")).join("\n")}},35015:(e,t,n)=>{"use strict";async function a(e){try{if("clipboard"in navigator)return await navigator.clipboard.writeText(e);return document.execCommand("copy",!0,e)}catch(e){}}n.d(t,{e:()=>a})},35850:(e,t,n)=>{"use strict";n.d(t,{Th:()=>k,d:()=>A,um:()=>E});var a=n(60066),s=n(94558),i=n(6571),r=n(30688),l=n(47753),o=n(77409),c=n(20275),d=n(28231),u=n(43472),m=n(17989),p=n(87452),h=n(73251),f=n(42505),g=n(94636),x=n(79654),v=n(15826),y=n(28404),j=n(83320),b=n(82696),w=n(47982),_=n(28809),C=n(82407),N=n(41728),I=n(29718);let k=e=>{let t=[...S.text,...S.code,...D.text,...D.code,...S.table,...D.table],n=t.find(t=>t.id===e);if(n)return n;let a=t.map(e=>e.options).flat().find(t=>(null==t?void 0:t.id)===e);if(a){if(!a.icon){let n=t.find(t=>{var n;return null==(n=t.options)?void 0:n.some(t=>t.id===e)});if(n)return{...a,icon:n.icon}}return a}},A=e=>"text/markdown"===e?S.text:"table"===e?S.table:S.code,E=e=>"text/markdown"===e?D.text:"table"===e?[]:D.code,S={text:[{id:"polish",icon:a.A,type:I.X.Edit,weight:1,prompt:"Add final polish to the text. Check the spelling, grammar, and sentence structure. Reduce any repetitive words or complicated sentences. Ensure the text is readily understandable. Review the writing's clarity and formality. Ensure style is consistent. If relevant, add formatting such as a large title, section titles, tables, lists, and/or bullet points. You can reply that you added some final polish and checked for grammar, but do not mention the prompt."},{id:"text_format",icon:s.A,weight:2,options:[{id:"text_format_email",type:I.X.Edit,weight:1,prompt:"Reformat this Canvas as an email. Make sure to include a subject line and a greeting. Do not mention the prompt."},{id:"text_format_blog_post",type:I.X.Edit,weight:3,prompt:"Reformat this Canvas as a blog post or article. Do not mention the prompt."},{id:"text_format_report",type:I.X.Edit,weight:4,prompt:"Reformat this Canvas as a report or essay. Include a title and a conclusion. Do not mention the prompt."},{id:"text_format_letter",type:I.X.Edit,weight:2,prompt:"Reformat this Canvas as a letter. Include a greeting and a closing. Do not mention the prompt."}]},{id:"text_length",icon:i.A,weight:3,options:[{id:"text_length_longer",prompt:"Make this Canvas 50% longer. Do not mention the prompt.",type:I.X.Edit,weight:1},{id:"text_length_shorter",prompt:"Make this Canvas 50% shorter. Do not mention the prompt.",type:I.X.Edit,weight:2}]},{id:"text_tone",icon:r.A,weight:4,options:[{id:"text_tone_professional",prompt:"Change the tone of this Canvas to be more professional.",type:I.X.Edit,weight:1},{id:"text_tone_normal",prompt:"Change the tone of this Canvas to be neutral, but keep the language it is written in the same (for example if in french, keep it french). The writing tone should be devoid of character or style, and instead intended for a larger, global audience. Remember to always proofread for grammar and spelling.",type:I.X.Edit,weight:2},{id:"text_tone_concise",prompt:"Change the tone of this Canvas to be more concise.",type:I.X.Edit,weight:3},{id:"text_tone_explanatory",prompt:"Change the tone of this Canvas to be more explanatory, whereby the audience is guided to learn the text's key points. The writing should expand on the current text and elaborate its core concepts. To help explain, the writing can include a core explanation or answer, supporting examples or evidence, as well as any common misconceptions or pitfalls. Remember to mimic the original text's style and format choices.",type:I.X.Edit,weight:4},{id:"text_tone_friendly",prompt:"Change the tone of this Canvas to be more friendly.",type:I.X.Edit,weight:5}]},{id:"audience",icon:l.A,weight:5,options:[{id:"audience_executive",prompt:"Change the tone of this Canvas into a more senior professional voice, imagine the audience as your senior.",type:I.X.Edit,weight:1},{id:"audience_teacher",prompt:"Change the tone of this Canvas into a more academic voice, imagine the audience as your teacher.",type:I.X.Edit,weight:3},{id:"audience_coworker",prompt:"Change the tone of this Canvas into a more professional voice, imagine the audience are your colleagues.",type:I.X.Edit,weight:2},{id:"audience_friend",prompt:"Change the tone of this Canvas into a more friendly voice, imagine the audience is your friends.",type:I.X.Edit,weight:4}]},{id:"text_translate",icon:o.A,weight:6,options:[{id:"text_translate_french",prompt:"Translate this Canvas into French.",type:I.X.Edit,weight:3},{id:"text_translate_spanish",prompt:"Translate this Canvas into Spanish.",type:I.X.Edit,weight:6},{id:"text_translate_german",prompt:"Translate this Canvas into German.",type:I.X.Edit,weight:4},{id:"text_translate_english",prompt:"Translate this Canvas into English.",type:I.X.Edit,weight:2},{id:"text_translate_russian",prompt:"Translate this Canvas into Russian.",type:I.X.Edit,weight:5},{id:"text_translate_chinese",prompt:"Translate this Canvas into Chinese.",type:I.X.Edit,weight:1}]}],code:[{id:"code_improve",icon:c.A,weight:1,options:[{id:"code_improve_review",type:I.X.Edit,icon:d.A,weight:1,prompt:"Search for bugs and opportunities to improve the codefor example, ways that performance or code structure could be improved. Leave as few comments as possible, but add more comments if the text is long. DO NOT leave more than 5 comments. You may reply that you reviewed the code and left suggestions to improve the coding quality, but do not mention the prompt."},{id:"code_improve_comments",type:I.X.Edit,icon:u.A,weight:2,prompt:"Add inline code comments to explain the code, especially parts that are more complex. Make sure to rewrite all the code. You may reply that you added inline comments, but do not mention the prompt."},{id:"code_improve_optimize",type:I.X.Edit,icon:m.A,weight:3,prompt:"Optimize the code for performance. Make sure to rewrite all the code. You may reply that you optimized the code for performance, but do not mention the prompt."}]},{id:"code_debugging",icon:p.A,weight:2,options:[{id:"code_debugging_fix",type:I.X.Edit,icon:h.A,weight:1,prompt:"Fix the bugs in the code. Do not add any new comments. If there are no bugs, reply that you reviewed the code and found no bugs."},{id:"code_debugging_logs",type:I.X.Edit,icon:f.A,weight:2,prompt:"Insert logs/print statements in the code that will help debug its behavior. Do not make any other changes to the code."},{id:"code_debugging_tests",type:I.X.Edit,icon:g.A,weight:3,prompt:"Write tests for the code. Make sure to test all the functions and edge cases. Do not make any other changes to the code."}]},{id:"code_port",icon:x.A,weight:3,options:[{id:"code_port_php",prompt:"Create a new Canvas that rewrites the code in PHP",type:I.X.Create,weight:1},{id:"code_port_cpp",prompt:"Create a new Canvas that rewrites the code in C++",type:I.X.Create,weight:2},{id:"code_port_python",prompt:"Create a new Canvas that rewrites the code in Python",type:I.X.Create,weight:3},{id:"code_port_javascript",prompt:"Create a new Canvas that rewrites the code in JavaScript",type:I.X.Create,weight:4},{id:"code_port_typescript",prompt:"Create a new Canvas that rewrites the code in TypeScript",type:I.X.Create,weight:5},{id:"code_port_java",prompt:"Create a new Canvas that rewrites the code in Java",type:I.X.Create,weight:6}]}],table:[{id:"table_insights",icon:v.A,weight:1,options:[{id:"table_insights_patterns",type:I.X.Create,weight:1,prompt:"Perform analysis on the table and identify patterns in the data."},{id:"table_insights_trends",prompt:"Analyze the table data and identify trends.",type:I.X.Create,weight:2},{id:"table_insights_outliers",prompt:"Analyze the table data and identify outliers.",type:I.X.Reflect,weight:3}]},{id:"table_visualize",icon:y.A,weight:2,options:[{id:"table_visualize_bar",prompt:"Create a bar chart based on the table data using recharts in a react Canvas.",type:I.X.Create,weight:1},{id:"table_visualize_pie",prompt:"Create a pie chart based on the table data using recharts in a react Canvas.",type:I.X.Create,weight:2},{id:"table_visualize_line",prompt:"Create a line chart based on the table data using recharts in a react Canvas.",type:I.X.Create,weight:3},{id:"table_visualize_scatter",prompt:"Create a scatter plot based on the table data using recharts in a react Canvas.",type:I.X.Create,weight:4},{id:"table_visualize_box",prompt:"Create a box plot based on the table data using recharts in a react Canvas.",type:I.X.Create,weight:5}]}]},D={text:[{id:"analyze",type:I.X.Reflect,icon:j.A,weight:1,prompt:'Provide an analysis of the selected prose. A good analysis is well written and economical in word choice. It combines observations, identifies patterns, asks 2-3 questions related to the patterns or subject matter. Then draws conclusions by answering: "why are these observations significant?" You may reply that you analyzed the text and provided insights, but do not mention the prompt.'},{id:"proofread",icon:b.A,type:I.X.Edit,weight:2,prompt:"Proofread the selected text. Check for grammar, spelling, and punctuation errors. You may reply that you proofread the text, but do not mention the prompt."},{id:"summarize",icon:w.A,type:I.X.Edit,weight:3,prompt:"Summarize the selected text by provide readers with a condensed version of the text's key points. Pay attention to nuance. A summary can be as short as a few sentences or much longer, depending on the complexity of the text and the level of detail you wish to provide to your readers. Double check consistency of names and acronyms. Mimic the writing tone not style. You may reply that you summarized the text, but do not mention the prompt."},{id:"more_bullet_points",icon:_.A,type:I.X.Edit,weight:4,prompt:"Add more bullet points to the selected text. You may reply that you added more bullet points, but do not mention the prompt."},{id:"less_bullet_points",icon:C.A,type:I.X.Edit,weight:5,prompt:"Remove a few bullet points from the selected text. Remember to keep the text in a list format. Keep the content the same and instead rephrase the text with fewer bullet points by combining, editing, and reducing the number of words. If there are no bullet points selected, don't change the text. You may reply that you removed some bullet points, but do not mention the prompt."}],code:[{id:"refactor",icon:N.A,type:I.X.Edit,weight:1,prompt:"Refactor the selected code. Improve the structure of the code without changing its behavior. You may reply that you refactored the code, but do not mention the prompt."}],table:[]}},46610:(e,t,n)=>{"use strict";n.d(t,{M:()=>c});var a=n(86539),s=n.n(a),i=n(99907),r=n.n(i),l=n(47678),o=n.n(l);function c(e){try{let t=s()().tz(e).format("Z");return"T".concat(t," (").concat(e,")")}catch(e){return}}s().extend(r()),s().extend(o())},52522:(e,t,n)=>{"use strict";n.d(t,{Zr:()=>r,dC:()=>o,mp:()=>i,sy:()=>s});var a=n(8380);let s=e=>((e,t)=>{let n=a.useCallback(e,t),s=a.useRef(void 0);return a.useCallback(e=>{var t,a;e?(null==(t=s.current)||t.call(s),s.current=n(e)):(null==(a=s.current)||a.call(s),s.current=void 0)},[n])})(t=>{let n=new ResizeObserver(t=>{let[n]=t;(null==n?void 0:n.contentRect.height)&&document.body.style.setProperty(e,"".concat(n.contentRect.height,"px"))});return n.observe(t),()=>{n.unobserve(t),document.body.style.removeProperty(e)}},[]),i="--last-user-message-height",r="--message-box-height",l="calc(var(".concat(r,", 250px) + ").concat(130,"px)"),o={transition:"min-height 0.5s easeOut",minHeight:"calc(100dvh - ".concat(l," - min(").concat("200px",", var(").concat(i,", 90px)))")}},60555:()=>{},61413:(e,t,n)=>{"use strict";n.d(t,{Cq:()=>s,DY:()=>i,GS:()=>o,dT:()=>l,k2:()=>r,lO:()=>a});let a=e=>{let{chatId:t,agentId:n,role:a}=e;return{role:a,id:"placeholder",turn:1,versionCount:1,version:0,agentId:null!=n?n:null,createdAt:new Date,files:[],chatId:t,content:null,contentChunks:null,createdById:null,status:"active",generationStatus:"assistant"===a?"in-progress":"success",isAcceleratedAnswer:!1,model:null,moderationCategory:null,nextVersion:null,parentVersion:null,parentId:null,reaction:"neutral",prevVersion:null,references:null,visibility:null,memories:null,followups:[]}},s=e=>t=>{let{chatId:n,messageId:a,messageVersion:s}=t;return t=>{e.message.all.setData({chatId:n},e=>{if(e)return c(e,{chatId:n,messageId:a,messageVersion:s},t)})}},i=e=>t=>{let{chatId:n}=t;return t=>{let{messageToAdd:a}=t;e.message.all.setData({chatId:n},e=>{if(e)return d(e,a)})}},r=e=>t=>{let{chatId:n,messageId:a,messageVersion:s}=t;return t=>{e.message.all.setData({chatId:n},e=>{if(e)return e.items.find(e=>e.id===t.id&&e.version===t.version)?c(e,{chatId:n,messageId:a,messageVersion:s},t):d(e,t)})}},l=e=>t=>{let{chatId:n,messageId:a,messageVersion:s}=t;e.message.all.setData({chatId:n},e=>{if(e)return{items:e.items.map(e=>e.id===a&&("all"===s||e.version===s)?{...e,status:"inactive"}:e),nextCursor:void 0}})},o=e=>t=>{let{chatId:n,messageId:a,messageVersion:s}=t;e.message.all.setData({chatId:n},e=>{if(e)return{items:e.items.map(e=>e.id===a?{...e,status:e.version===s?"active":"inactive"}:e),nextCursor:void 0}})},c=(e,t,n)=>{let{messageId:a,messageVersion:s}=t;return{items:e.items.map(e=>e.id===a&&e.version===s?"function"==typeof n?n(e):{...e,...n}:e),nextCursor:void 0}},d=(e,t)=>{let n=e.items.map(e=>{if(e.id===t.id){var n;return{...e,status:"inactive",versionCount:e.versionCount+1,nextVersion:null!=(n=e.nextVersion)?n:t.version}}return e});return{...e,items:[...n,t]}}},62044:(e,t,n)=>{"use strict";n.d(t,{$3:()=>l,We:()=>r,sZ:()=>i});var a=n(73415),s=n(61639);let i=(0,a.vt)()((0,s.Zr)((e,t)=>({customEngineConfig:null,setCustomEngineConfig:t=>e({customEngineConfig:t}),deleteCustomEngineConfig:()=>e({customEngineConfig:null})}),{name:"debug-custom-engine-config"})),r=(0,a.vt)()((0,s.Zr)(e=>({endpoint:void 0,setEndpoint:t=>e({endpoint:t})}),{name:"debug-custom-completion-endpoint"})),l=(0,a.vt)()((0,s.Zr)(e=>({parameters:{},setParameters:t=>e({parameters:t}),deleteParameters:()=>e({parameters:{}})}),{name:"debug-custom-parameters"}))},63695:(e,t,n)=>{"use strict";n.d(t,{KV:()=>l,NF:()=>c,g6:()=>o});var a=n(63309),s=n(31715);let i="chat-init-metadata",r=a.Ay.object({chatId:a.Ay.string().uuid(),metadata:a.Ay.object({hasPastedText:a.Ay.boolean().optional()}).optional()});function l(){try{let e=window.localStorage.getItem(i);if(!e)return null;let t=(0,s.$)(e,r);return t.success?t.data:null}catch(e){return null}}function o(e){try{window.localStorage.setItem(i,JSON.stringify(e))}catch(e){}}function c(){window.localStorage.removeItem(i)}},67289:(e,t,n)=>{"use strict";n.d(t,{$3:()=>a.$3,We:()=>a.We,sZ:()=>a.sZ}),n(95027);var a=n(62044)},70669:(e,t,n)=>{"use strict";n.d(t,{M2:()=>i,ef:()=>r,nS:()=>o,rf:()=>c,tk:()=>l});let a="data-message-id",s="data-message-version";function i(e){let{messageId:t,messageVersion:n}=e;return{[a]:t,[s]:n}}function r(e){return e.commonAncestorContainer.nodeType===Node.ELEMENT_NODE?e.commonAncestorContainer:e.commonAncestorContainer.parentElement}function l(e){let t=e;for(;t;){let e=t.getAttribute(a),n=t.getAttribute(s);if(e&&n)return{messageId:e,messageVersion:Number(n)};t=t.parentElement}return null}function o(e){return e.nodeType===Node.ELEMENT_NODE}function c(e){let t=document.createElement("template");return t.innerHTML=e,t.content}},75165:(e,t,n)=>{"use strict";n.d(t,{k:()=>s,u:()=>a});let a=200,s="tako::resize"},85277:(e,t,n)=>{"use strict";n.d(t,{yZ:()=>x,ChatPageLayout:()=>p,M$:()=>g,pu:()=>h,Nc:()=>f});var a=n(64784),s=n(7763),i=n(30063),r=n(9360),l=n(8380),o=n(23964);let c=(0,s.default)(()=>Promise.all([n.e(1280),n.e(1406),n.e(9769),n.e(3465),n.e(5262),n.e(2999),n.e(2058)]).then(n.bind(n,22058)),{loadableGenerated:{webpack:()=>[22058]},loading:()=>null,ssr:!1}),d=()=>{let{canvas:e,tempCanva:t}=(0,o.o)(),[n,s]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{(e.length||t)&&s(!0)},[e.length,t,s]),n)?(0,a.jsx)(c,{}):null};var u=n(14416);let m=(0,s.default)(()=>Promise.all([n.e(6869),n.e(4604)]).then(n.bind(n,54604)),{loadableGenerated:{webpack:()=>[54604]},ssr:!1}),p=e=>{var t;let{children:n,chat:s,session:i,chatId:l,incognito:o=!1}=e,c=r.P.use.openShareDialog();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.NavigationBar,{chat:s,session:i,incognito:o}),(0,a.jsxs)("div",{className:"relative flex h-full w-full items-center justify-center overflow-hidden",children:[(0,a.jsx)(d,{}),(0,a.jsx)("div",{className:"relative flex h-full w-full flex-1 flex-col items-center justify-center",children:n})]}),l&&s&&c&&(0,a.jsx)(m,{isPublicSharingEnabled:null==(t=null==i?void 0:i.organization.publicChatSharingEnabled)||t,chatId:l,initialChat:s})]})},h=e=>{let{children:t,asCard:n}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex max-w-(--breakpoint-md) min-w-0 flex-1 shrink flex-col gap-8",n?"max-w-(--breakpoint-sm) rounded-2xl border-1 border-default bg-default p-6 transition-all duration-150 hover:ring-2 hover:ring-brand-400":""),children:t})},f=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex w-full justify-center gap-6","flex-col md:flex-row"),children:t})},g=e=>{let{children:t}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex h-fit w-full flex-col items-center"),"data-testid":"conversation-layout",children:t})},x="mx-auto flex min-h-full w-full flex-col items-stretch gap-5 px-2 pt-6 pb-5 md:px-4 md:pb-9"},95027:(e,t,n)=>{"use strict";n.d(t,{MistralersConfigDialog:()=>E});var a=n(64784),s=n(13166),i=n(5936),r=n(6016),l=n(85148),o=n(8462),c=n(19664),d=n(8380),u=n(82248),m=n(42573),p=n(1883),h=n(87790),f=n(8424),g=n(75429),x=n(31991),v=n(21956),y=n(801),j=n(62367),b=n(88318),w=n(30063),_=n(35111),C=n(62044);let N={endpoint:"",inference_engine_version:"",name:"custom-engine-{model_name}",type:"",modelName:""};function I(e){let{onClose:t}=e,n=(0,C.sZ)(),i=(0,u.mN)({defaultValues:N,resolver:(0,s.u)(h.Jc)});return(0,d.useEffect)(()=>{n.customEngineConfig?i.reset(n.customEngineConfig):i.reset(N)},[i,n.customEngineConfig]),(0,a.jsxs)(x.lV,{onSubmit:i.handleSubmit(e=>{n.setCustomEngineConfig(e),t()}),form:i,children:[(0,a.jsx)(f.c75,{className:"sr-only mb-6",children:(0,a.jsx)(f.L33,{children:"Customize Harmattan config"})}),(0,a.jsxs)("div",{className:"mb-4 space-y-3",onPaste:e=>{try{let t=h.Jc.parse(JSON.parse(e.clipboardData.getData("text/plain")));i.reset(t),e.preventDefault()}catch(e){}},children:[(0,a.jsxs)(x.zB,{name:"endpoint",form:i,children:[(0,a.jsx)(x.lR,{children:"Endpoint"}),(0,a.jsx)(y.pd,{inputMode:"url",...i.register("endpoint"),placeholder:"https://example.com/api"})]}),(0,a.jsxs)(x.zB,{name:"name",form:i,children:[(0,a.jsx)(x.lR,{children:"Engine name"}),(0,a.jsx)(y.pd,{...i.register("name"),placeholder:"engine"}),(0,a.jsxs)(x.mH,{children:["Interpolations: ","{model_name}","  model name as sent to Harmattan"]})]}),(0,a.jsxs)(x.zB,{name:"inference_engine_version",form:i,children:[(0,a.jsx)(x.lR,{children:"Inference engine version"}),(0,a.jsx)(y.pd,{variant:"default",...i.register("inference_engine_version"),placeholder:"1.0.0"})]}),(0,a.jsxs)(x.zB,{name:"type",form:i,children:[(0,a.jsx)(x.lR,{children:"Engine type"}),(0,a.jsx)(y.pd,{variant:"default",...i.register("type"),placeholder:"vllm"})]}),(0,a.jsxs)(x.zB,{name:"modelName",form:i,children:[(0,a.jsx)(x.lR,{children:"Model name"}),(0,a.jsx)(y.pd,{...i.register("modelName"),placeholder:"Custom model name"})]})]}),(0,a.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,a.jsxs)(g.$n,{variant:"secondary",onClick:()=>{n.deleteCustomEngineConfig(),i.reset(N),t()},children:["Clear",(0,a.jsx)(g.qF,{icon:l.A})]}),(0,a.jsx)("div",{className:"grow"}),(0,a.jsxs)(b.m_,{children:[(0,a.jsx)(b.k$,{asChild:!0,children:(0,a.jsxs)(g.$n,{variant:"secondary",onClick:async()=>{await i.trigger()&&await navigator.clipboard.writeText(JSON.stringify(i.getValues())).then(()=>{(0,f.oRP)("Config copied to clipboard")})},children:["Export",(0,a.jsx)(g.qF,{icon:o.A})]})}),(0,a.jsx)(b.ZI,{children:"This will copy a config object to your clipboard. Paste this object into any field of the form to re-import it."})]}),(0,a.jsx)(g.$n,{type:"submit",children:"Save"})]})]})}function k(e){let{onClose:t}=e,n=(0,C.We)(),i=(0,u.mN)({defaultValues:{endpoint:""},resolver:(0,s.u)(p.Ik({endpoint:p.Yj()}))});return(0,d.useEffect)(()=>{n.endpoint?i.reset({endpoint:n.endpoint}):i.reset({endpoint:""})},[i,n.endpoint]),(0,a.jsxs)(x.lV,{onSubmit:i.handleSubmit(e=>{n.setEndpoint(e.endpoint),t()}),form:i,children:[(0,a.jsx)(f.c75,{className:"sr-only mb-6",children:(0,a.jsx)(f.L33,{children:"Customize completion API URL"})}),(0,a.jsxs)(x.zB,{name:"endpoint",form:i,className:"mt-4 mb-8",children:[(0,a.jsx)(x.lR,{children:"Harmattan endpoint"}),(0,a.jsx)(y.pd,{...i.register("endpoint"),placeholder:"https://api.mistral.ai"})]}),(0,a.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,a.jsxs)(g.$n,{variant:"secondary",onClick:()=>{n.setEndpoint(""),i.reset({endpoint:""}),t()},children:["Clear",(0,a.jsx)(g.qF,{icon:l.A})]}),(0,a.jsx)("div",{className:"grow"}),(0,a.jsx)(g.$n,{type:"submit",children:"Save"})]})]})}function A(e){let{onClose:t}=e,n=(0,C.$3)(),[o,c]=(0,d.useState)(),h=_.api.internal.checkAssistantMessage.useMutation({onSuccess:e=>{let{isJSON:t,isValidSystemMessage:n}=e;if(!t)return void c("No JSON detected. SP will be text only.");n&&t?c("Valid JSON system message."):c("Valid JSON, but not a valid system message. SP will be text only.")}}),j=(0,m._6)(e=>{h.mutate({serializedAssistantMessageContent:e})},1500),b=(0,u.mN)({defaultValues:{temperature:n.parameters.temperature,systemPrompt:n.parameters.systemPrompt},resolver:(0,s.u)(p.Ik({temperature:p.KC([p.ai().min(0).max(1),p.oi().transform(()=>void 0)]),systemPrompt:p.Yj().optional()}))});return(0,a.jsxs)(x.lV,{onSubmit:b.handleSubmit(e=>{n.setParameters(e),t()}),form:b,children:[(0,a.jsx)(f.c75,{className:"sr-only mb-6",children:(0,a.jsx)(f.L33,{children:"Customize model parameters"})}),(0,a.jsxs)(x.zB,{name:"temperature",form:b,className:"mt-4 mb-8",children:[(0,a.jsx)(x.lR,{children:"Temperature"}),(0,a.jsx)(y.pd,{type:"number",...b.register("temperature",{valueAsNumber:!0}),placeholder:"0.15",step:.01})]}),(0,a.jsxs)(x.zB,{name:"systemPrompt",form:b,className:"mb-8 flex flex-col gap-2",children:[(0,a.jsx)(x.lR,{children:"System prompt"}),(0,a.jsx)("pre",{children:(0,a.jsx)(f.No,{...b.register("systemPrompt",{onChange:()=>{let e=b.getValues().systemPrompt;if(!e||""===e){j.cancel(),c(void 0);return}j(e)}}),className:"sm:text-xs"})}),o&&(0,a.jsx)(i.N,{children:(0,a.jsx)(r.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:(0,a.jsx)(v.F,{children:o})})})]}),(0,a.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,a.jsxs)(g.$n,{variant:"secondary",onClick:()=>{n.deleteParameters(),b.reset({temperature:void 0,systemPrompt:void 0}),t()},children:["Clear",(0,a.jsx)(g.qF,{icon:l.A})]}),(0,a.jsx)("div",{className:"grow"}),(0,a.jsx)(g.$n,{type:"submit",children:"Save"})]})]})}function E(e){let{className:t}=e,{endpoint:n}=(0,C.We)(),{customEngineConfig:s}=(0,C.sZ)(),{parameters:i}=(0,C.$3)(),r=(0,C.sZ)(),l=(0,C.We)(),[o,u]=(0,d.useState)(!1);return(0,a.jsxs)(f.lGe,{open:o,onOpenChange:e=>{u(e)},children:[(0,a.jsx)(f.zMO,{className:t,onClick:()=>u(!0),children:r.customEngineConfig?(0,a.jsx)("span",{className:"text-xs font-semibold text-(--purple-500)",children:r.customEngineConfig.endpoint||"custom harmattan config"}):l.endpoint?(0,a.jsx)("span",{className:"text-xs font-semibold text-(--purple-500)",children:l.endpoint}):i.temperature||i.systemPrompt?(0,a.jsx)(c.A,{className:"text-secondary-500 size-4 text-(--purple-500)"}):(0,a.jsx)(c.A,{className:"text-secondary-500 size-4"})}),(0,a.jsx)(f.Cff,{"aria-describedby":"",children:(0,a.jsxs)(j.tU,{children:[(0,a.jsxs)(j.j7,{children:[(0,a.jsx)(j.oz,{value:"engine",className:(0,w.cn)(s&&"!text-(--purple-500)"),children:"Custom vLLM (prod Harmattan)"}),(0,a.jsx)(j.oz,{value:"endpoint",className:(0,w.cn)(n&&"!text-(--purple-500)"),children:"Custom Harmattan"}),(0,a.jsx)(j.oz,{value:"other",className:(0,w.cn)(i.temperature&&"!text-(--purple-500)"),children:"Other"})]}),(0,a.jsxs)(j.T2,{children:[(0,a.jsx)(j.Kp,{value:"engine",className:"mt-6",children:(0,a.jsx)(I,{onClose:()=>u(!1)})}),(0,a.jsx)(j.Kp,{value:"endpoint",className:"mt-6",children:(0,a.jsx)(k,{onClose:()=>u(!1)})}),(0,a.jsx)(j.Kp,{value:"other",className:"mt-6",children:(0,a.jsx)(A,{onClose:()=>u(!1)})})]})]})})]})}},96874:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var a=n(64784),s=n(30063),i=n(3723),r=n(8424);function l(e){let{nbMessages:t=2}=e;return(0,a.jsx)("div",{className:"flex w-full flex-col gap-10",children:t&&Array.from({length:t}).map((e,t)=>(0,a.jsx)("div",{className:"flex w-full",children:t%2==0?(0,a.jsx)(c,{}):(0,a.jsx)(o,{})},t))})}let o=()=>(0,a.jsxs)("div",{className:"flex w-full gap-3",children:[(0,a.jsx)(r.EAD,{className:"size-7 rounded-md"}),(0,a.jsxs)("div",{className:"flex w-full flex-col items-start space-y-4",children:[(0,a.jsx)(r.EAD,{className:"h-8 w-full"}),(0,a.jsx)(r.EAD,{className:"h-8 w-full"}),(0,a.jsx)(r.EAD,{className:"h-8 w-full"})]})]}),c=()=>(0,a.jsx)("div",{className:"flex w-full gap-3",children:(0,a.jsx)("div",{className:"ms-auto flex w-2/3 flex-col items-end space-y-4",children:(0,a.jsx)(r.EAD,{className:"h-12 w-full rounded-3xl"})})});var d=n(91008);function u(e){let{newChat:t}=e;return(0,a.jsxs)("div",{className:(0,s.cn)(r.yk.eh,"h-16"),children:[(0,a.jsx)(r.yk.SQ,{}),!t&&(0,a.jsx)(r.yk.wn,{children:(0,a.jsx)(d.ShareButton,{disabled:!0})})]})}function m(){return(0,a.jsxs)("div",{className:(0,s.cn)("relative flex h-full w-full flex-col items-center justify-center overflow-hidden bg-subtle"),children:[(0,a.jsx)(u,{}),(0,a.jsx)("div",{className:"flex h-full w-full flex-1 flex-col items-center justify-center overflow-hidden pt-6 md:px-5",children:(0,a.jsx)("div",{className:"flex min-h-full w-full flex-1 flex-col items-center",children:(0,a.jsxs)("div",{className:"flex h-fit w-full max-w-(--breakpoint-md) flex-1 flex-col items-stretch justify-start gap-5",children:[(0,a.jsx)("div",{className:"flex h-fit w-full flex-col px-4",children:(0,a.jsx)(l,{nbMessages:6})}),(0,a.jsx)("div",{className:"flex w-full flex-1"}),(0,a.jsx)(i.MessageInputSkeleton,{className:"sticky bottom-0 w-full max-w-(--breakpoint-md) rounded-sm"})]})})})]})}},98999:()=>{}}]);